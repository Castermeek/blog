<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Japan Azure Identity Support Blog</title>
  
  <subtitle>日本マイクロソフトの Azure Active Directory と AD FS に関するサポート情報のブログです。</subtitle>
  <link href="https://jpazureid.github.io/blog/atom.xml" rel="self"/>
  
  <link href="https://jpazureid.github.io/blog/"/>
  <updated>2022-03-28T02:13:40.039Z</updated>
  <id>https://jpazureid.github.io/blog/</id>
  
  <author>
    <name>Azure Identity Support Japan</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Salesforce で多要素認証が必須に - Azure AD 側での対応</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/salesforce-now-enforcing-multi-factor-authentication-azure-ad/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/salesforce-now-enforcing-multi-factor-authentication-azure-ad/</id>
    <published>2022-03-28T00:00:00.000Z</published>
    <updated>2022-03-28T02:13:40.039Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Azure Identity サポート チームの 村上 です。</p><p>本記事は、2022 年 3 月 21 日に米国の Azure Active Directory Identity Blog で公開された <a href="https://techcommunity.microsoft.com/t5/azure-active-directory-identity/salesforce-now-enforcing-multi-factor-authentication-azure-ad/ba-p/2810644">Salesforce now enforcing multi-factor authentication—Azure AD has you covered</a> を意訳したものになります。ご不明点等ございましたらサポート チームまでお問い合わせください。</p><hr><p>Salesforce が、Salesforce 製品へのアクセスに多要素認証 (MFA) の有効化を要求していることを受け、Azure Active Directory がどのようにこの要件へ対応できるかを紹介したいと思います。ハイブリッド ワークを実施している組織では、従業員がさまざまなアプリケーションを使用して仕事を行うため、Salesforce などのアプリケーションへのアクセスを確実に保護することが非常に重要です。  </p><p>Salesforce の新しい要件を満たし、Salesforce 製品へのアクセスを確実に保護する方法について、ID アライアンス チームのプリンシパル プログラム マネージャーである Jonathon Lyon が説明します。</p><hr><p>ハイブリッド ワークへの移行が進むにつれて、ファイアウォールやサイロ化、パスワードといった旧来のセキュリティ パラダイムが多くの組織を脆弱な状態にしています。攻撃者は、常にチャンスを探っており、企業ネットワークに侵入する最も早い方法の 1 つが ID であることに気づいています。ダークウェブ (闇サイト) には盗まれた認証情報が大量に出回っており、ID の窃取 (アカウントの乗っ取りやビジネス メールの漏洩など) は、ID 攻撃の最も一般的な形態となっています。最近のセキュリティ分析では、「ID は依然としてネットワークへのアクセスを行う際のカギとなる要素である。ID に対する攻撃や ID を使った攻撃が 2022 年に増加することは、間違いなく確実である」と言われています。 </p><p>あらゆる分野において、先進的な企業は、ボーダーレスなデジタル領域において脅威を迅速に検知し対応するためには、<a href="https://www.microsoft.com/ja-jp/security/business/zero-trust/">ゼロ トラスト</a> セキュリティが最良のアプローチであることを認識しています。<a href="https://security.salesforce.com/mfa">Salesforce</a> では、ゼロ トラストを念頭に置き、2022 年 2 月 1 日より、すべてのお客様が Salesforce 製品にアクセスする際に <a href="https://www.microsoft.com/ja-jp/security/business/identity-access-management/mfa-multi-factor-authentication">多要素認証 (MFA)</a> を有効にすることを義務付けると発表しています。<a href="https://www.microsoft.com/security/blog/2021/03/02/4-ways-microsoft-is-delivering-security-for-all-in-a-zero-trust-world/">すべての人にセキュリティを提供する</a> というマイクロソフトのミッションの一環として、Salesforce のお客様が <a href="https://azure.microsoft.com/ja-jp/services/active-directory/">Microsoft Azure Active Directory (Azure AD)</a> を使用して、MFA とシングル サインオン (SSO) を簡単に実現できるよう支援したいと思っています。</p><h1 id="パスワードの問題点"><a href="#パスワードの問題点" class="headerlink" title="パスワードの問題点"></a>パスワードの問題点</h1><p>15 万人以上の顧客と 2,000 億ドルを超える時価総額である Salesforce はセキュリティにおいて妥協が許されません。大手クラウド企業はもとよりいかなる企業においても、従業員の選んだ数桁の数字や文字に頼って企業全体を守るのはリスクが大きすぎるのです。<a href="https://jpazureid.github.io/blog/azure-active-directory/your-password-doesnt-matter/">パスワードは簡単にハッキングされます</a>。<a href="https://www.foodbusinessnews.net/articles/20118-oversight-committee-finds-minor-security-lapses-behind-jbs-cyberattack">米 JBS 社に対するランサムウェア攻撃</a> は、まさにこのような脆弱なパスワードで放置された管理者アカウントによって引き起こされ、最終的に 1,100 万ドルの損失となりました。この種の「ブルートフォース」攻撃は、2021 年 6 月に <a href="https://securityintelligence.com/news/credential-phishing-brute-force-attacks-increased-2021/">671% 増加</a> しました。実際、Azure AD は 2021 年 1 月から 12 月の間に、盗んだパスワードでのブルートフォース攻撃にて企業の顧客アカウントを乗っ取ろうとする試みを <a href="https://www.microsoft.com/security/blog/2022/02/03/cyber-signals-defending-against-cyber-threats-with-the-latest-research-insights-and-trends/">256 億回以上検知</a> し、ブロックしています。</p><p>マイクロソフトは、2021 年に <a href="https://techcommunity.microsoft.com/t5/azure-active-directory-identity/passwordless-authentication-is-now-generally-available/ba-p/1994700">パスワードレス サインインを一般的に商用利用可能</a> にすることで、パスワードを利用しない方法を提供しました。つまり、マイクロソフトの顧客はアカウントからパスワードを完全に削除し、代わりに以下を使用してサインインすることができるようになったのです:</p><ul><li><a href="https://www.microsoft.com/ja-jp/security/mobile-authenticator-app">Microsoft Authenticator アプリ</a>: このアプリにより iOS や Android の携帯電話を、パスワードなしの強力な資格情報として利用できます。ユーザーは、携帯電話に通知が届き、画面に表示された番号と照合することであらゆるプラットフォームやブラウザにサインインすることができます。生体認証 (指や顔) または PIN を使用して確認することも可能です。最近のアップデートにより、<a href="https://jpazureid.github.io/blog/azure-active-directory/microsoft-authenticator-app/?msclkid=af50f21cabb011ec950d24738a07b742">企業アカウントの追加や管理がより簡単</a> になりました。</li><li><a href="https://docs.microsoft.com/ja-jp/windows/security/identity-protection/hello-for-business/hello-overview">Windows Hello for Business</a>: 生体認証と PIN をユーザーの端末に直接結びつけて使用するため、所有者以外のアクセスを防ぐことができます。公開鍵基盤 (PKI) の統合と SSO のサポートにより、Windows Hello for Business を使用することでオンプレミスおよびクラウドの両方で企業リソースにシームレスにアクセスできるようになります。</li><li><a href="https://docs.microsoft.com/ja-jp/azure/active-directory/authentication/howto-authentication-passwordless-security-key">FIDO2 セキュリティ キー</a>: クラウドまたはオンプレミスのリソース、およびサポートされているブラウザに対して SSO を提供します。FIDO2 セキュリティ キーは、携帯電話を第二要素として使用することに抵抗がある企業にとって最適なオプションです。</li></ul><h1 id="Azure-AD-を使用した多要素認証の実装"><a href="#Azure-AD-を使用した多要素認証の実装" class="headerlink" title="Azure AD を使用した多要素認証の実装"></a>Azure AD を使用した多要素認証の実装</h1><p>MFA は、<a href="https://www.microsoft.com/security/blog/2019/08/20/one-simple-action-you-can-take-to-prevent-99-9-percent-of-account-attacks/">ID 関連の攻撃を 99.9% 防ぐ</a> ことが証明されています。それにも関わらず、2021 年末までに MFA を導入済みの Azure AD のお客様はわずか 22% に過ぎません。MFA のきっかけとなる <a href="https://docs.microsoft.com/ja-jp/azure/active-directory/conditional-access/overview">条件付きアクセス</a> は、ID を中心とした制御の中核として Azure AD に直接組み込まれており、様々な情報をまとめることで組織のポリシーを即時に適用します。</p><p>Microsoft のお客様は Azure AD を使用して、生体認証、Authenticator アプリ、SMS テキスト、通話、ワンタイム パスコードなど、数ある認証方法の中から選択し、Salesforce やその他のアプリケーションの認証を行うことができます。(<strong>注:</strong> <a href="https://techcommunity.microsoft.com/t5/azure-active-directory-identity/it-s-time-to-hang-up-on-phone-transports-for-authentication/ba-p/1751752">音声とテキストは最も安全性が低い</a> ため、Salesforce では SMS や電話による認証は許可されていません)。Azure AD と Salesforce を統合して SSO と MFA を実現すると、以下のようなことが可能になります:</p><ul><li>Salesforce にどのユーザーがアクセス可能かを Azure AD で制御</li><li>Azure AD アカウントを使用してユーザーが自動的に Salesforce にサインインできるように構成</li><li>両方のアカウントを、<a href="https://azure.microsoft.com/ja-jp/features/azure-portal/">Microsoft Azure ポータル</a> で一元管理</li><li>Salesforce アプリケーションに MFA を適用する条件付きアクセス ルールを作成</li></ul><p>Azure AD で MFA を有効にする方法の詳細については、<a href="https://docs.microsoft.com/ja-jp/azure/active-directory/authentication/tutorial-enable-azure-mfa">チュートリアル</a> を参照ください。</p><h1 id="Salesforce-の多要素認証-設定手順"><a href="#Salesforce-の多要素認証-設定手順" class="headerlink" title="Salesforce の多要素認証 - 設定手順"></a>Salesforce の多要素認証 - 設定手順</h1><p>Salesforce は要件となる期限 (日付は製品によって異なります) を迎えると、同社の <a href="https://help.salesforce.com/s/articleView?language=en_US&type=1&id=000362737">実施ロードマップ</a> に従って、管理者が MFA を無効にするためのコントロールを削除することによって要件の実施を開始します。現時点で Salesforce は、この新しい要件を契約上のみで実施しています。つまり、MFA を有効にしないお客様は契約を更新することができなくなります。技術的な強制はその後に行われる可能性があります。</p><p>新しい要件を満たすために、Salesforce のお客様は以下のいずれかを行う必要があります。</p><ul><li>Salesforce の画面から MFA を有効にする、もしくは… </li><li>Salesforce 製品へのアクセスには、<a href="https://www.microsoft.com/ja-jp/security/business/identity-access-management/single-sign-on">SSO</a> を使用する。Azure AD は、Salesforce やその他多くのアプリケーションへユーザーを自動的に認証できます (以下の「Salesforce で MFA を有効にするクイック手順」を参照ください)。</li></ul><p>また、お客様は <a href="https://security.salesforce.com/mfa-requirement-check">Salesforce MFA 要件チェッカー</a> を使用して、実装が要件を満たしていることを確認することもできます。併せて、<a href="https://docs.microsoft.com/ja-jp/azure/active-directory/authentication/concept-authentication-methods">Azure AD で利用可能な認証および検証方法</a> についてもご確認ください。 </p><p>以下では、Salesforce ユーザーに MFA を適用する条件付きアクセス ポリシーの作成手順をご紹介します。</p><ol><li>テナントの <strong>グローバル管理者</strong> として <strong>Azure ポータル</strong> にサインインします。</li><li><strong>Azure Active Directory</strong> を選択し、<strong>管理</strong> 配下の <strong>セキュリティ</strong> を選択します。</li><li><strong>条件付きアクセス</strong> を選択します。</li></ol><p><img src="/blog/azure-active-directory/salesforce-now-enforcing-multi-factor-authentication-azure-ad/image01.jpg"></p><ol start="4"><li><strong>新しいポリシー</strong> をクリックし、<strong>新規ポリシーの作成</strong> を選択します。</li></ol><p><img src="/blog/azure-active-directory/salesforce-now-enforcing-multi-factor-authentication-azure-ad/image02.jpg"></p><ol start="5"><li><strong>ポリシーの名前を入力</strong> します。</li></ol><p><img src="/blog/azure-active-directory/salesforce-now-enforcing-multi-factor-authentication-azure-ad/image03.jpg"></p><ol start="6"><li><strong>割り当て</strong> 配下の、<strong>ユーザーまたはワークロード ID</strong> を選択します。</li><li><strong>ユーザーとグループ</strong> を選択します。次に Salesforce を使用するユーザ、またはユーザのグループを選択します。必要なユーザーまたはグループを選択したら、<strong>選択</strong> をクリックします。</li></ol><p><img src="/blog/azure-active-directory/salesforce-now-enforcing-multi-factor-authentication-azure-ad/image04.jpg"></p><ol start="8"><li><strong>クラウド アプリまたは操作</strong> を選択します。</li><li><strong>アプリを選択</strong> を選択し、Salesforce を検索します。<strong>選択</strong> をクリックします。(必要に応じて条件を指定することもできますが、この例では条件のままにしておきます)。</li></ol><p><img src="/blog/azure-active-directory/salesforce-now-enforcing-multi-factor-authentication-azure-ad/image05.jpg"></p><ol start="10"><li><strong>アクセス制御</strong> で <strong>許可</strong> を選択します。</li><li><strong>アクセス権の付与</strong> を選択し、<strong>多要素認証を要求する</strong> オプションにチェックを入れます。そして、<strong>選択</strong>をクリックします。</li></ol><p><img src="/blog/azure-active-directory/salesforce-now-enforcing-multi-factor-authentication-azure-ad/image06.jpg"></p><p>最後のステップは、ポリシーを有効にすることです。</p><ol start="12"><li><strong>ポリシーの有効化</strong> を <strong>レポート専用</strong> から <strong>オン</strong> に変更します。次に、<strong>作成</strong> をクリックします。</li></ol><p><img src="/blog/azure-active-directory/salesforce-now-enforcing-multi-factor-authentication-azure-ad/image07.jpg"></p><p>このルールが有効になると、選択したすべてのユーザーが Salesforce にサインインする際に MFA を使用するようになります。</p><p><strong>注</strong>: 初めて条件付きアクセス ポリシーを作成する場合、次のようなメッセージが表示されることがあります。</p><p><img src="/blog/azure-active-directory/salesforce-now-enforcing-multi-factor-authentication-azure-ad/image08.jpg" alt="条件付きアクセス ポリシーは、セキュリティ既定値群を置き換えるため、事前にセキュリティの既定値群を無効にする必要があります。"></p><p>以下の手順で、セキュリティの既定値群を無効にします。</p><ol><li>セキュリティ管理者、条件付きアクセス管理者、またはグローバル管理者として、<strong>Azure ポータル</strong> にサインインします。</li><li><strong>Azure Active Directory</strong> &gt; <strong>プロパティ</strong> を参照します。</li><li><strong>セキュリティ既定値群の管理</strong> を選択します。</li><li><strong>セキュリティ既定値群の有効化</strong> を <strong>いいえ</strong> に設定します。</li><li><strong>保存</strong> を選択します。</li></ol><p><img src="/blog/azure-active-directory/salesforce-now-enforcing-multi-factor-authentication-azure-ad/image09.jpg"></p><h1 id="すべてのアプリケーションにシームレスにサインイン"><a href="#すべてのアプリケーションにシームレスにサインイン" class="headerlink" title="すべてのアプリケーションにシームレスにサインイン"></a>すべてのアプリケーションにシームレスにサインイン</h1><p>Azure AD は MFA を提供するだけではなく、すべてのユーザーが場所やデバイスを問わず、以下を含めて安全かつシームレスにアクセスできるようにします:</p><ul><li>一元化されたユーザー ポータルによりアプリ展開作業を単純化</li><li>Identity Protection と条件付きアクセスによる、リスク ベースのアクセス ポリシーの強力な適用</li><li>自動化されたプロビジョニング ワーク フローとセルフ サービス ツールによる IT コストの削減 </li></ul><p>Azure AD は、<strong>Adobe、AWS、Dropbox、SAP Concur、ServiceNow</strong> など、広く利用されている他のアプリケーションとの統合を容易に実現します。<a href="https://azure.microsoft.com/ja-jp/services/active-directory/sso/#overview">Azure Active Directory のシングル サインオン</a> により、<strong>Salesforce</strong> をはじめとする多くのエンタープライズ　アプリケーションでシンプルかつ安全な MFA を実現し、信頼性と拡張性の高い ID  サービスにアクセスが可能となります。</p><p>ご参考: <a href="https://www.securityweek.com/cyber-insights-2022-identity">Security Week Cyber Insights 2022: Identity</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Azure Identity サポート チームの 村上 です。&lt;/p&gt;
&lt;p&gt;本記事は、2022 年 3 月 21 日に米国の Azure Active Directory Identity Blog で公開された &lt;a href=&quot;https://techco</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="US Identity Blog" scheme="https://jpazureid.github.io/blog/tags/US-Identity-Blog/"/>
    
  </entry>
  
  <entry>
    <title>スマホを替える時は、Microsoft Authenticator の移行を忘れないでください！</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/move-authenticator-to-new-phone/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/move-authenticator-to-new-phone/</id>
    <published>2022-03-24T03:00:00.000Z</published>
    <updated>2022-03-28T02:13:39.943Z</updated>
    
    <content type="html"><![CDATA[<div class="alert is-info"><p class="alert-title">Note</p><p>検索キーワード : Offce 365 / Microsoft 365 / Azure AD / Azure Active Directory / Multi Factor Authentication / MFA / 多要素認証 / 変更 / 買い替え / Microsoft Authenticator / アカウント / ロックアウト / サインインできない / ログインできない / サインイン要求を承認</p></div><p>こんにちは。Azure Identity チームの栗井です。</p><p>Microsoft のクラウド サービスを利用しているすべての人々にお願いです。<strong>スマートフォンを替える時は、Microsoft Authenticator (以下 MS Authenticator) の移行を忘れないでください！</strong> </p><p>※ 加えて、末尾の <strong>まとめ : スマートフォン移行にあたっての注意点</strong> に記載の注意事項も一読ください。</p><h2 id="よくあるお問い合わせ"><a href="#よくあるお問い合わせ" class="headerlink" title="よくあるお問い合わせ"></a>よくあるお問い合わせ</h2><p>「スマートフォンを替えたところ、下記画面で要求される多要素認証 (以下 MFA) を完了することができなくなってしまいました。<br>おそらく、以前のスマートフォン宛に要求が送信されているのだと思います。どうやったら新しい端末で MFA ができるようになりますか？」</p><p><img src="/blog/azure-active-directory/move-authenticator-to-new-phone/mfa-required.png"></p><h2 id="原則-古い端末を破棄する前に、かならず新しい端末への移行作業をしてください"><a href="#原則-古い端末を破棄する前に、かならず新しい端末への移行作業をしてください" class="headerlink" title="原則 : 古い端末を破棄する前に、かならず新しい端末への移行作業をしてください"></a>原則 : 古い端末を破棄する前に、かならず新しい端末への移行作業をしてください</h2><p>新しい端末への移行作業を忘れていると、MFA を完了できずに、Office 365 や Azure ポータルなどに入れなくなってしまう恐れがあります。そのため、新しい端末に移行する際は、すみやかに MS Authenticator の移行を実施ください。</p><p>移行作業の大まかな手順は下記の通りです。</p><h3 id="MS-Authenticator-の移行方法"><a href="#MS-Authenticator-の移行方法" class="headerlink" title="MS Authenticator の移行方法"></a>MS Authenticator の移行方法</h3><ol><li><p>任意の端末 (PC 端末が見やすいです) で <a href="https://aka.ms/mfasetup">https://aka.ms/mfasetup</a> にアクセスします。</p></li><li><p>登録済みの MFA の方法一覧が表示されます。<br><img src="/blog/azure-active-directory/move-authenticator-to-new-phone/mysecurityinfo-before.png"></p></li><li><p>[+ 方法の追加] を押下します。画面の指示に従って、新しいスマートフォンの MS Authenticator をセットアップします。<br><img src="/blog/azure-active-directory/move-authenticator-to-new-phone/mfa-setup.png"></p></li><li><p>新しいスマートフォンが一覧に追加されます。<br><img src="/blog/azure-active-directory/move-authenticator-to-new-phone/mysecurityinfo-after.png"></p></li><li><p>以前のスマートフォンは不要になったら、上記の一覧から削除しましょう。</p></li></ol><h2 id="もし移行作業を忘れてしまったら"><a href="#もし移行作業を忘れてしまったら" class="headerlink" title="もし移行作業を忘れてしまったら ?"></a>もし移行作業を忘れてしまったら ?</h2><p>移行作業を忘れたまま以前の端末をリセット・破棄してしまった場合、前述の &lt;MS Authenticator の移行方法&gt; が実施できません。なぜなら <a href="https://aka.ms/mfasetup">https://aka.ms/mfasetup</a> にサインインする際に、既存の方法による MFA が要求されるためです。</p><p><img src="/blog/azure-active-directory/move-authenticator-to-new-phone/mfasetup-lockout.png"></p><p>このような場合の回避策は下記の通りです。</p><ul><li><p>回避策 1 : MS Authenticator 以外の方法 (SMS、音声通話 等) で MFA を完了</p><p>MS Authenticator 以外の方法で MFA が可能な場合、<a href="https://aka.ms/mfasetup">https://aka.ms/mfasetup</a> へ問題なくアクセスが可能です。前述の &lt;MS Authenticator の移行方法&gt; の手順でご対応ください。</p><p><img src="/blog/azure-active-directory/move-authenticator-to-new-phone/mfa-anothermethod.png"></p></li><li><p>回避策 2 : 社内の管理者に依頼して、MFA のリセットを依頼</p><p>管理者アカウントを持つユーザーに、自身の MFA をリセットしてもらうよう依頼してください。</p></li><li><p>回避策 3 (最終手段) : マイクロソフトに MFA の一時解除を依頼</p><p>回避策 1 と 2 の両方が実施不可能な場合、具体的には下記のすべてを満たすような場合には、お客様側での対処策が無く、マイクロソフトのデータセンター側での対応が必要になります。対応完了には数営業日いただくことになりますので、予めご了承ください。</p><ul><li>MS Authenticator 以外の方法での MFA が構成されていない</li><li>テナント唯一の全体管理者</li><li>Azure ポータルにアクセスする際にも MFA が求められる</li></ul></li></ul><p>各回避策の詳細については <a href="https://jpazureid.github.io/blog/azure-active-directory/change-mfa-verification-method/">別記事 「MFA 認証方法を、変更 / 再登録 / 追加 したい！」</a> をご確認ください。</p><h2 id="まとめ-スマートフォン移行にあたっての注意点"><a href="#まとめ-スマートフォン移行にあたっての注意点" class="headerlink" title="まとめ : スマートフォン移行にあたっての注意点"></a>まとめ : スマートフォン移行にあたっての注意点</h2><p>上記の内容をふまえて、下記の 3 つの注意事項にご留意ください。</p><ol><li>【最重要】 スマートフォンを替える時は、MS Authenticator の移行を忘れないでください！</li></ol><ol start="2"><li>MFA の方法は、あらかじめ複数登録しておくと安心です<ul><li>もし MS Authenticator の移行を忘れてしまった場合でも、SMS 等による MFA が可能であれば、前述の回避策がご利用いただけます。</li></ul></li><li>【管理者向け】テナントに、複数の管理者を用意しておきましょう。<ul><li>上記の 1 と 2 が満たされていない場合でも、管理者のアカウントによって、当該ユーザーの MFA をリセットすることができるためです。なお、管理者自身が MS Authenticator の移行を忘れてしまった時のために、管理者は複数いることが望ましいです。</li></ul></li></ol><h2 id="関連情報"><a href="#関連情報" class="headerlink" title="関連情報"></a>関連情報</h2><ul><li><a href="https://jpazureid.github.io/blog/azure-active-directory/change-mfa-verification-method/">MFA 認証方法を、変更 / 再登録 / 追加 したい！ | Azure AD サポート チーム ブログ</a></li><li><a href="https://docs.microsoft.com/ja-jp/azure/active-directory/authentication/concept-mfa-howitworks">Azure AD Multi-Factor Authentication | Microsoft Docs</a></li><li><a href="https://docs.microsoft.com/ja-jp/azure/active-directory/authentication/concept-mfa-licensing">Azure AD Multi-Factor Authentication の機能とライセンス | Microsoft Docs</a></li></ul><h2 id="編集後記"><a href="#編集後記" class="headerlink" title="編集後記"></a>編集後記</h2><p>ありがたいことに、昨今では数多くの組織・学校のお客様によって、多要素認証 (MFA) を導入のうえ、MS Authenticator をご活用いただいております。</p><p>一方で、<strong>スマートフォンを替える場合、MS Authenticator の移行が必要である</strong>という事実は、まだあまり多くのユーザーの方にご認識いただけていない現状があります。</p><p>MS Authenticator の移行を忘れて、各種サービスにアクセスできなくなってしまうことによる業務影響は、お客様によってはかなり深刻です。大事なプレゼンテーションの直前に PowerPoint が開けなくなってしまったら ? 取引先に緊急の連絡が必要なのに、Outlook に入れなくなってしまったら ?</p><p>怖がらせるような例ばかりを並べてしまってすみません。しかしいずれも起こりうることです。</p><p>「そのようなリスクがあるのなら、MFA 自体を無効化してしまおう !」、そう考える管理者の方いらっしゃるかもしれません。しかしこれは、セキュリティ性を大きく損ねることになるので、お勧めすることができません。<br>ベスト プラクティスは MFA を利用しつつ、ユーザーの方には前述の「まとめ : スマートフォン移行にあたっての注意点」にご留意いただくことです。</p><p>そのため、もしこのブログ記事を読んでくださっている方の中で、社内の情報システム部門の方がいらっしゃれば、社内ポータルや配布資料などに、このブログ記事の URL をご記載いただけますと嬉しいです。</p><p>本記事の Twitter や facebook 等の SNS へのシェアも大歓迎です。<a href="https://feedback.azure.com/d365community/">Microsoft Azure のフィードバックサイト</a> へのご意見もお待ちしております。</p><p><strong>スマートフォンを替える場合、MS Authenticator の移行が必要である</strong> ということを、もっと多くのご利用者の方にご認識いただけるよう、弊社としても引き続き情報発信を進めて参ります。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;div class=&quot;alert is-info&quot;&gt;&lt;p class=&quot;alert-title&quot;&gt;Note&lt;/p&gt;&lt;p&gt;検索キーワード : Offce 365 / Microsoft 365 / Azure AD / Azure Active Directory / Multi</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="MFA" scheme="https://jpazureid.github.io/blog/tags/MFA/"/>
    
    <category term="Multi Factor Authentication" scheme="https://jpazureid.github.io/blog/tags/Multi-Factor-Authentication/"/>
    
  </entry>
  
  <entry>
    <title>認証プロンプト分析ワークブックを使用して余分なプロンプトを削減する</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/reducing-extra-prompts-with-authentication-prompt-analysis-workbook/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/reducing-extra-prompts-with-authentication-prompt-analysis-workbook/</id>
    <published>2022-03-24T00:00:00.000Z</published>
    <updated>2022-03-28T02:13:40.011Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、 Azure Identity サポート チームの小出です。</p><p>本記事は、 2022 年 3 月 3 日に米国の Azure Active Directory Identity Blog で公開された <a href="https://techcommunity.microsoft.com/t5/azure-active-directory-identity/reducing-extra-prompts-with-the-authentication-prompt-analysis/ba-p/2810647">Reducing Extra Prompts with the Authentication Prompt Analysis Workbook</a> を意訳したものになります。ご不明点などございましたら、サポート チームまでお問い合わせください。</p><hr><p>最新の Azure AD ワークブック「認証プロンプトの分析」をご紹介します！これまでのワークブックについての情報は、<a href="https://docs.microsoft.com/ja-jp/azure/active-directory/reports-monitoring/howto-use-azure-monitor-workbooks">Azure Active Directory レポートに Azure Monitor ブックを使用する方法</a> でご覧いただけます。もし Log Analytics を使用するようにログをまだセットアップしていない場合は、チュートリアルの <a href="https://docs.microsoft.com/ja-jp/azure/active-directory/reports-monitoring/tutorial-log-analytics-wizard">チュートリアル: Log Analytics ワークスペースを構成する</a> を利用いただけます。その後、さらにこの新しいワークブックを読んで、利用可能なさまざまなデータセットについて学ぶとともに、余分なプロンプトを減らしてエンドユーザー体験を向上させる方法について知見を得ていただけたらと思います。</p><p>Inbar と Corissa より詳細を説明いたします。</p><hr><p>こんにちは、Inbar Cizer Kobrinsky です！今回は、Corissa Koopmans と一緒に、最新の Azure AD ワークブック <strong>「認証プロンプト分析」</strong> を紹介します。このワークブックで利用できるさまざまなデータセットを紹介し、余分なプロンプトを減らすことによって、エンド ユーザー体験を向上させる方法について、いくつか知見を紹介いたします。</p><h2 id="余分なプロンプトに着目する理由"><a href="#余分なプロンプトに着目する理由" class="headerlink" title="余分なプロンプトに着目する理由"></a>余分なプロンプトに着目する理由</h2><p>ワークブックの詳細に入る前に、お客様の環境でサイバー攻撃をシミュレートしたお客様事例を紹介したいと思います。まず、簡単なパスワード スプレー攻撃を行い、組織において脆弱で簡単に推測できるパスワードをすべて探し出しました。そして、これらのユーザーに MFA のプロンプトを大量に要求し、ユーザーがどのように反応するかを確認しました。念のため、この会社では経営陣の承認を得てこれらの対応を実施しておりますので心配は無用です。</p><p>驚いたことに、このような予期せぬプロンプトが表示されたことを報告したユーザーは皆無でした。さらに悪いことに、多くのユーザーが、自分が MFA を開始したわけではないのに、それをよく理解せず、MFA プロンプトを盲目的に承認していたのです。あるユーザーは、嫌気がさしたのか Authenticator アプリを完全にアンインストールしてしまいました。</p><p>サイバー攻撃のシミュレーション以外に、ユーザーに過剰なプロンプトが表示される場合としては、アプリケーションの設定ミスや過度に多くの認証プロンプトを表示するポリシーが原因と考えられます。過剰にプロンプトを表示するとユーザーの生産性に影響を与えますし、しばしばユーザーが自分では開始しなかった MFA プロンプトを承認してしまうことにつながります。誤解のなきよう、MFA は非常に重要なものです！MFA を求めるべきかどうかという話をしているのではなく、どの程度の頻度でユーザーに MFA を求めるべきかという話をしているのです。</p><p>それでは、新しいワークブックとそれを使ってテナント内のプロンプトを分析する方法について説明していきたいと思います。例となるお客様環境を見ながら説明していきます。</p><h3 id="認証方法"><a href="#認証方法" class="headerlink" title="認証方法"></a>認証方法</h3><p>まずお客様の環境で、どのような種類の認証が、どのようなデバイスから行われているかを把握することから始めましょう。このためには、最初のデータのグラフである「認証方法別の認証プロンプト」を見ることになります。</p><p><img src="/blog/azure-active-directory/reducing-extra-prompts-with-authentication-prompt-analysis-workbook/reducing-extra-prompts-with-authentication-prompt-analysis-workbook1.png"></p><p>まずは、組織内のユーザーがどのような認証方法を使用しているか、その利用状況は思っていたとおりかどうかという点をご確認ください。この例のお客様は、プロンプトを減らし、エンドユーザー体験を向上させるために、認証の二要素目として Authenticator アプリを使用するようにユーザーを促しています。Authenticator アプリを使用することで、どのようにモバイル デバイスのプロンプトを減らすことができるかについては、PRT に関するこの <a href="https://docs.microsoft.com/ja-jp/azure/active-directory/devices/concept-primary-refresh-token">詳細な記事</a> をお読みください。  </p><p>ヒント: 電話ベースの方法から Authenticator アプリにユーザーを移行させるには、Microsoft Authenticator をセットアップするようユーザーを誘導ください。<br>詳細情報: <a href="https://docs.microsoft.com/ja-jp/azure/active-directory/authentication/how-to-mfa-registration-campaign">https://aka.ms/nudge</a></p><p><img src="/blog/azure-active-directory/reducing-extra-prompts-with-authentication-prompt-analysis-workbook/reducing-extra-prompts-with-authentication-prompt-analysis-workbook2.png"></p><p>MFA プロンプトを減らすもう一つの方法は、<a href="https://docs.microsoft.com/ja-jp/windows/security/identity-protection/hello-for-business/hello-overview">Hello for Business</a> や FIDO2 など、サインイン時に <a href="https://docs.microsoft.com/ja-jp/azure/active-directory/authentication/concept-authentication-passwordless">パスワードレスの認証方式</a> に移行することです。ユーザーがテナントでどのような認証方法を登録しているかを確認するには、<a href="https://docs.microsoft.com/ja-jp/azure/active-directory/authentication/howto-authentication-methods-activity">Authentication Methods insights ダッシュボード</a> を使用ください。実体が想定と異なる状態であれば、このダッシュボードをベースにさらに調査するのがおすすめです。</p><h3 id="デバイス"><a href="#デバイス" class="headerlink" title="デバイス"></a>デバイス</h3><p>次の 2 つのグラフは、環境で使用されているデバイスに焦点を当てたものです。最初の図は、1 時間に何件の認証がどの OS から行われているかを示しています。ワークステーションや携帯電話で不要なプロンプトが表示されていないかどうか、どこから手を付ければユーザー体験を最も改善できるか判断するのに役立つはずです。また、古い OS のデバイス (前回のアップグレードで見落してしまったもの) があるかどうかを確認するのにも良い方法です。</p><p><img src="/blog/azure-active-directory/reducing-extra-prompts-with-authentication-prompt-analysis-workbook/reducing-extra-prompts-with-authentication-prompt-analysis-workbook3.png"></p><p>これらのデータから、1 時間あたりのプロンプトのほとんどは、携帯電話ではなくワークステーションから発生していることがわかります。また、いくつかの Windows 8 マシンが、企業向け Windows 10 ビルドに正しくアップグレードされていないようです。この点も対応する必要があります。携帯電話からの認証が多かった場合、先に述べたように、Authenticator アプリを使用することでこれらのプロンプトを削減することが可能です。しかし、この例では Windows ワークステーションに着目しますので、次の図に移りましょう。</p><p><img src="/blog/azure-active-directory/reducing-extra-prompts-with-authentication-prompt-analysis-workbook/reducing-extra-prompts-with-authentication-prompt-analysis-workbook4.png"></p><p>「デバイスの状態ごとの認証プロンプト」の画面では、Azure AD 参加デバイス、ハイブリッド Azure AD Join デバイス、Azure AD 登録デバイス、または Azure AD にとって不明な (管理されていない) デバイスがそれぞれどれだけのプロンプトに関連しているか表示されます。</p><p>上のグラフでは、プロンプトの大部分は管理されていないデバイスによるものであることがわかります。<a href="https://docs.microsoft.com/ja-jp/azure/active-directory/devices/hybrid-azuread-join-plan">Azure AD Join と Hybrid Azure AD Join</a> を実装することで、デバイスが Azure AD Primary Refresh Token (PRT) を持つようになるため、お客様は追加の MFA プロンプトを劇的に削減することができます。これは、Authenticator アプリがモバイルでプロンプトを減らすことができるのと同じです。 </p><p>全体的な認証のビューと、デバイス観点で認証体験の状況を確認する方法は以上となります。次に、「ユーザーごとの認証プロンプト」のデータより、ユーザー観点で情報を見てみましょう。</p><h3 id="ユーザー"><a href="#ユーザー" class="headerlink" title="ユーザー"></a>ユーザー</h3><p>他のビューと同様に、このユーザー ビューでは、期間内に行われたプロンプトがユーザーの観点から表示されます。見てわかるように、これらの数字の一部は予想どおりです。しかし、予想以上に多くのプロンプトが求められているユーザーが数名いるため、さらに調査を行う必要があります。 </p><p><img src="/blog/azure-active-directory/reducing-extra-prompts-with-authentication-prompt-analysis-workbook/reducing-extra-prompts-with-authentication-prompt-analysis-workbook5.png"></p><p>少し下にスクロールすると、プロンプトが最も多かったユーザーの概要と、アプリケーションやタイムスタンプ、リクエスト ID など、トラブルシューティングのための追加情報が表示されます。 参考として、全ユーザーのプロンプト数の平均値と中央値も表示されます。このリストの上位ユーザーは、ユーザー体験が良くない可能性が高い状況です。これは通常、何かが間違って設定されているか、またはアカウントが攻撃を受けていることが原因です。いずれにせよ、調査が必要であり、対策を講じる必要があります。  </p><p><img src="/blog/azure-active-directory/reducing-extra-prompts-with-authentication-prompt-analysis-workbook/reducing-extra-prompts-with-authentication-prompt-analysis-workbook6.png"></p><h3 id="アプリケーション"><a href="#アプリケーション" class="headerlink" title="アプリケーション"></a>アプリケーション</h3><p>アプリケーションの設定が間違っていると、認証に失敗し続け、最終的にプロンプトの数が非常に多くなることがあります。 このことを念頭に置いて、プロンプトの割合が異常に高いアプリケーションに注目ください。多くのお客様にとって、最も使用しているアプリケーションはビジネス生産性アプリケーションでしょう。想定と異なるものがあれば、調査の必要があります。  </p><p><img src="/blog/azure-active-directory/reducing-extra-prompts-with-authentication-prompt-analysis-workbook/reducing-extra-prompts-with-authentication-prompt-analysis-workbook7.png"></p><h3 id="認証プロセスの詳細"><a href="#認証プロセスの詳細" class="headerlink" title="認証プロセスの詳細"></a>認証プロセスの詳細</h3><p>サインインごとに、OAUTH のスコープ、認証ライブラリの種類、IP アドレス、レガシー TLS の有無、CAE (継続的アクセス評価) など、認証プロセスの詳細が記載されています。また、1 つのサインインに複数のプロセスが含まれる場合があることにも注意が必要です。</p><p><img src="/blog/azure-active-directory/reducing-extra-prompts-with-authentication-prompt-analysis-workbook/reducing-extra-prompts-with-authentication-prompt-analysis-workbook8.png"></p><p>このデータは、TLS 1.0/1.1 および 3DES が廃止された際に、レガシー TLS のトラブルシューティングや環境内の検索に役立つはずです。詳しく知りたい方は <a href="https://docs.microsoft.com/ja-jp/troubleshoot/azure/active-directory/enable-support-tls-environment?tabs=azure-monitor&WT.mc_id=Portal-fx">Azure AD TLS 1.1 および 1.0 の非推奨の環境で TLS 1.2 のサポートを有効にする</a> をご確認ください。</p><h3 id="認証ポリシー"><a href="#認証ポリシー" class="headerlink" title="認証ポリシー"></a>認証ポリシー</h3><p>Azure AD には、ユーザーに MFA を要求できる複数のポリシーがあります。例えば、条件付きアクセス、ユーザーごとの MFA、セキュリティの既定値群からユーザーに MFA の実行を要求することができます。ユーザーが MFA を要求されるあまり知られていない方法としては、アクセスのためにアプリが MFA を要求する場合です (ID プロバイダーではなく、Relying party によって強制される)。例えば、ユーザーがセキュリティ情報を更新しに行く場合、毎回 MFA が要求されます。以下のグラフは、テナントでユーザーに MFA を強制する想定外のポリシーがあるかどうかを確認するのに役立ちます。</p><p><img src="/blog/azure-active-directory/reducing-extra-prompts-with-authentication-prompt-analysis-workbook/reducing-extra-prompts-with-authentication-prompt-analysis-workbook9.png"></p><h3 id="推薦事項とワークブックのヒント"><a href="#推薦事項とワークブックのヒント" class="headerlink" title="推薦事項とワークブックのヒント"></a>推薦事項とワークブックのヒント</h3><p>最後に、ユーザー体験を向上させ、プロンプトを減らすための 4 つの方法を以下に示します。例えば、Authenticator アプリ以外の方法を使用しているモバイル デバイスの認証プロンプトを特定することが可能です。</p><p><img src="/blog/azure-active-directory/reducing-extra-prompts-with-authentication-prompt-analysis-workbook/reducing-extra-prompts-with-authentication-prompt-analysis-workbook10.png"></p><p><img src="/blog/azure-active-directory/reducing-extra-prompts-with-authentication-prompt-analysis-workbook/reducing-extra-prompts-with-authentication-prompt-analysis-workbook11.png"></p><p>ワークブックの最後のヒントとして、ワークブックの最上部よりフィルタリングをより細かく設定することができます。認証要求の多い特定のユーザーをフィルタリングしたり、サインインに失敗したアプリケーションのみを表示したりすることで、新たな発見を得て、引き続き解決に取り組むことができます。 </p><p><img src="/blog/azure-active-directory/reducing-extra-prompts-with-authentication-prompt-analysis-workbook/reducing-extra-prompts-with-authentication-prompt-analysis-workbook12.png"></p><p>詳しくは、<a href="https://docs.microsoft.com/ja-jp/azure/active-directory/authentication/concepts-azure-multi-factor-authentication-prompts-session-lifetime">再認証プロンプトを最適化し、Azure AD Multi-Factor Authentication のセッションの有効期間について理解する</a> をお読みになることをお勧めします。</p><p>このワークブックにより貴重な洞察が得られたり、貴社の組織でプロンプトを削減するのに役立てられたりすれば幸いです。このワークブックに関するご意見、ご感想がありましたら、この <a href="https://forms.office.com/pages/responsepage.aspx?id=v4j5cvGGr0GRqy180BHbR-Fe8yfx1zBKhEr1JlI5HMlUNUc4M1BEM0I5SThDWVM3QldESVhZU09TWC4u">簡単なアンケート</a> にお答えください。  </p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、 Azure Identity サポート チームの小出です。&lt;/p&gt;
&lt;p&gt;本記事は、 2022 年 3 月 3 日に米国の Azure Active Directory Identity Blog で公開された &lt;a href=&quot;https://techcom</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="US Identity Blog" scheme="https://jpazureid.github.io/blog/tags/US-Identity-Blog/"/>
    
  </entry>
  
  <entry>
    <title>Azure AD RBAC でアプリ管理用のカスタム ロールが利用可能になりました</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/custom-roles-for-app-management-now-available/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/custom-roles-for-app-management-now-available/</id>
    <published>2022-03-19T00:00:00.000Z</published>
    <updated>2022-03-28T02:13:39.767Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、 Azure Identity サポート チームの小出です。</p><p>本記事は、 2022 年 3 月 2 日に米国の Azure Active Directory Identity Blog で公開された <a href="https://techcommunity.microsoft.com/t5/azure-active-directory-identity/azure-ad-rbac-custom-roles-for-app-management-now-available/ba-p/3185206">Azure AD RBAC: Custom roles for app management now available</a> を意訳したものになります。ご不明点などございましたら、サポート チームまでお問い合わせください。</p><hr><p>皆さん、こんにちは。</p><p>Azure Active Directory (Azure AD) のロールベースのアクセス制御 (RBAC) に関連する機能について、一連の発表ができることをとても嬉しく思っています。これらの機能は、Azure AD と Microsoft 365 の RBAC において、きめ細かな権限付与の実現をサポートし、大規模環境での管理をよりシンプルにするものです。</p><p>このシリーズではまず、アプリ管理を委任するためのカスタム ロールの一般提供 (GA) について紹介したいと思います。  </p><p><a href="https://docs.microsoft.com/ja-jp/azure/active-directory/roles/custom-enterprise-app-permissions">アプリの登録</a> と <a href="https://docs.microsoft.com/ja-jp/azure/active-directory/roles/custom-available-permissions">エンタープライズ アプリ</a> のカスタム ロールを合わせて使用することで、管理者がアプリ管理のために持つアクセス権をきめ細かく制御することができます。なお、Azure AD のカスタム ロールを利用するには、Azure AD Premium P1 ライセンスが必要です。  </p><p>ここでは、架空の会社 Woodgrove の IT 管理者である Alice が、どのように効果的かつ安全にアプリの管理を委任できるか見てみましょう。</p><h2 id="Woodgrove-社ではアプリ管理用のカスタム-ロールを使用して安全なアプリ管理の委譲を実現"><a href="#Woodgrove-社ではアプリ管理用のカスタム-ロールを使用して安全なアプリ管理の委譲を実現" class="headerlink" title="Woodgrove 社ではアプリ管理用のカスタム ロールを使用して安全なアプリ管理の委譲を実現"></a>Woodgrove 社ではアプリ管理用のカスタム ロールを使用して安全なアプリ管理の委譲を実現</h2><p>地理的に分散した組織である Woodgrove は、小規模な IT チームが Azure AD のロールの委任を集中的に管理しています。シニア IT 管理者の Alice は、IT システムを安全に保つために、最小限の権限を行使して Azure AD のロールを委任する責任を負っています。</p><p>Charlie は、Woodgrove が持つ多くの LOB (Line of Business) アプリケーションの 1 つである 「Woodgrove Portal アプリ」の所有者です。Alice は、LOB アプリケーションのアクセス管理を所有者に委任したいと考えています。具体的には、Charlie にロールを付与し、Charlie が Woodgrove Portal アプリへのアクセスを管理できるようにしたいのです。  </p><p>Alice がこのシナリオのために新しいカスタム ロールを作成し、そのロールを Chalie に割り当てる方法を見てみましょう。   </p><h2 id="カスタム-ロールの作成と割り当て"><a href="#カスタム-ロールの作成と割り当て" class="headerlink" title="カスタム ロールの作成と割り当て"></a>カスタム ロールの作成と割り当て</h2><p>次の例では、Alice はアプリケーションへのユーザーとグループの割り当てを管理する権限だけを持つカスタム ロールを作成します。カスタム ロールを作成したら、Alice はこのロールを Woodgrove Portal アプリのスコープで Charlie に割り当てることができます。これにより Charlie には、Woodgrove Portal アプリのユーザーとグループの割り当てを管理する権限が付与されます。  </p><h3 id="カスタム-ロールの作成"><a href="#カスタム-ロールの作成" class="headerlink" title="カスタム ロールの作成"></a>カスタム ロールの作成</h3><ol><li>ロールと管理者タブで、<strong>新しいカスタムロール</strong> を選択します。    </li></ol><p><img src="/blog/azure-active-directory/custom-roles-for-app-management-now-available/custom-roles-for-app-management-now-available1.png">  </p><ol start="2"><li>ロールの名前と説明を入力し、<strong>次へ</strong> を選択します。  </li></ol><p><img src="/blog/azure-active-directory/custom-roles-for-app-management-now-available/custom-roles-for-app-management-now-available2.png">  </p><ol start="3"><li>ロールにアクセス許可を割り当てます。<strong>servicePrincipal</strong> と入力して検索し、 <strong>microsoft.directory/servicePrincipals/appRoleAssignedTo/update</strong> 権限を選択します。  </li></ol><p><img src="/blog/azure-active-directory/custom-roles-for-app-management-now-available/custom-roles-for-app-management-now-available3.png">  </p><ol start="4"><li>新しいロールを確認します。問題がなければ、<strong>作成</strong> を選択して新しいロールを作成します。  </li></ol><p><img src="/blog/azure-active-directory/custom-roles-for-app-management-now-available/custom-roles-for-app-management-now-available4.png">  </p><h3 id="カスタム-ロールを割り当てる"><a href="#カスタム-ロールを割り当てる" class="headerlink" title="カスタム ロールを割り当てる"></a>カスタム ロールを割り当てる</h3><p>組み込みロールと同様に、カスタム ロールもディレクトリ レベルで割り当てて、すべてのエンタープライズ アプリケーションに対するアクセスを許可することができます。さらに、上の例で示すように、1 つのアプリケーションに対してのみ、カスタム ロールを割り当てることもできます。これにより、2 つ目のカスタム ロールを作成することなく、単一のアプリケーションのユーザとグループの割り当てを管理する権限をユーザーに与えることができます。</p><ol><li><strong>エンタープライズ アプリケーション</strong> タブを選択し、ユーザーとグループの割り当てを管理するためのアクセス権を与えたいアプリケーションを選択します。</li></ol><p><img src="/blog/azure-active-directory/custom-roles-for-app-management-now-available/custom-roles-for-app-management-now-available5.png"></p><ol start="2"><li>新しい <strong>ロールと管理者</strong> タブに移動します。上で作成したカスタムロールが表示されます。</li></ol><p><img src="/blog/azure-active-directory/custom-roles-for-app-management-now-available/custom-roles-for-app-management-now-available6.png"></p><ol start="3"><li>ロールを選択して、割り当てブレードを開きます。 <strong>割り当ての追加</strong> を選択し、ロールに追加するユーザーを選択します。</li></ol><p><img src="/blog/azure-active-directory/custom-roles-for-app-management-now-available/custom-roles-for-app-management-now-available7.png"></p><ol start="4"><li>割り当てを受けたユーザーは、アプリケーションのユーザーとグループ ブレードに移動すると、ユーザーの追加オプションが有効になっていることを確認できます。</li></ol><p>これで完了です。 Charlie は、Woodgrove Portal アプリへのアクセスを管理できるようになりました。その他に作成できる役割については、<a href="https://docs.microsoft.com/ja-jp/azure/active-directory/roles/custom-enterprise-app-permissions">こちら</a> を参照してください。</p><h2 id="今後の予定"><a href="#今後の予定" class="headerlink" title="今後の予定"></a>今後の予定</h2><p>私たちは、カスタム ロールや管理単位に関する追加機能、その他の最小特権を実現する仕組みなど、Azure AD RBAC のさらなる素晴らしい機能の開発に取り組んでいます。今後のアナウンスにご期待ください。</p><p>いつもどおり、皆様のご意見、ご感想、ご提案をお聞かせください。<a href="https://feedback.azure.com/forums/169401-azure-active-directory?category_id=166032">Azure AD 管理者ロール フォーラム</a> で共有するか、以下にコメントを残してください。ご連絡をお待ちしております。</p><p>Alex Simons (<a href="https://twitter.com/Alex_A_Simons">@Alex_A_Simons</a>)<br>Corporate VP of Program Management<br>Microsoft Identity Division</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、 Azure Identity サポート チームの小出です。&lt;/p&gt;
&lt;p&gt;本記事は、 2022 年 3 月 2 日に米国の Azure Active Directory Identity Blog で公開された &lt;a href=&quot;https://techcom</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="US Identity Blog" scheme="https://jpazureid.github.io/blog/tags/US-Identity-Blog/"/>
    
  </entry>
  
  <entry>
    <title>Azure AD の新しい多段階アクセス レビューによる最小権限モデルの実現</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/achieve-a-least-privilege-model-using-azure-ad-s-new-multi-stage/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/achieve-a-least-privilege-model-using-azure-ad-s-new-multi-stage/</id>
    <published>2022-03-13T00:00:00.000Z</published>
    <updated>2022-03-28T02:13:39.611Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Azure Identity サポート チームの 村上 です。</p><p>本記事は、2022 年 2 月 28 日に米国の Azure Active Directory Identity Blog で公開された <a href="https://techcommunity.microsoft.com/t5/azure-active-directory-identity/achieve-a-least-privilege-model-using-azure-ad-s-new-multi-stage/ba-p/3185211">Achieve a least privilege model using Azure AD’s new multi-stage access reviews</a> を意訳したものになります。ご不明点等ございましたらサポート チームまでお問い合わせください。</p><hr><p>皆さん、こんにちは。</p><p>本日、Azure AD のアクセス レビューにおける、複数ステージのレビューのパブリック プレビューを発表いたします。</p><p>この機能拡張により、アクセス レビューを順を追ったステージで構築し、ステージ毎に異なるレビュー担当者と設定を実装することができます。</p><p>この機能により、お客様のテナント内で複数のレビュー担当者が特定の順序でユーザーのアクセスを証明するよう再認定や監査の要件を満たすよう複雑なワークフローを実現することができます。また、各レビュー担当者が責任を負う意思決定の数を減らすことで、リソース所有者やレビュー担当者が、より効率的なレビューを設計できるようになります。以前は、レビューのために人為的に複数の異なるレビューを作成していたかもしれませんが、複数ステージのレビューでは、このすべてをたった一度のレビューの中で行えます。</p><h2 id="複数ステージのレビューにより実現できるアクセス認定の主要なシナリオ"><a href="#複数ステージのレビューにより実現できるアクセス認定の主要なシナリオ" class="headerlink" title="複数ステージのレビューにより実現できるアクセス認定の主要なシナリオ"></a>複数ステージのレビューにより実現できるアクセス認定の主要なシナリオ</h2><ul><li><strong>複数のレビュー担当者の間での合意形成</strong>: アクセスを再認定する前に、すべてのステージで異なるレビュー担当者の合意を必要とする。 </li><li><strong>未審査の決定について代替のレビュー担当者を設定</strong>: レビュー担当者が不在や外出中の際に未審査のまま放置されたアカウントは、ユーザーの上司やリソース所有者など、次の適切なレビュー担当者に送られるようにする。 </li><li><strong>後続のステージのレビュー担当者の負担を軽減</strong>: 前のステージで拒否されたアカウントを除外することで、後のステージのレビュー担当者が行う決定の数を絞り込みます。例えば、リソースの所有者に認証を依頼する前に、ユーザー自身にアクセスの必要性を確認してもらうようにします。 </li></ul><h2 id="複数ステージのアクセス-レビューをぜひお試しください"><a href="#複数ステージのアクセス-レビューをぜひお試しください" class="headerlink" title="複数ステージのアクセス レビューをぜひお試しください"></a>複数ステージのアクセス レビューをぜひお試しください</h2><p><img src="/blog/azure-active-directory/achieve-a-least-privilege-model-using-azure-ad-s-new-multi-stage/ja_image01.png"></p><p>上記は、複数ステージのレビューの設定画面です。最大 3 つのステージを指定でき、各ステージのレビュー担当者と期間を個別に選択することもできます。さらに、前のステージでの決定を後のステージのレビュー担当者に公開するかどうかを定義することもできます。 </p><p>最後に、どのレビュー担当者が次のステージへ進むかを指定します。</p><p><img src="/blog/azure-active-directory/achieve-a-least-privilege-model-using-azure-ad-s-new-multi-stage/ja_image2.png"></p><p>複数ステージのレビューの設定方法の詳細については、<a href="https://docs.microsoft.com/ja-jp/azure/active-directory/governance/create-access-review">Azure AD アクセス レビューのドキュメント</a> をご参照ください。MS Graph API (beta) を使ってこれらのレビューを試すには、<a href="https://docs.microsoft.com/ja-jp/graph/api/accessreviewset-post-definitions?view=graph-rest-beta&tabs=http%22%20%5Cl%20%22example-4-create-an-access-review-on-a-group-with-multiple-stages">MS Graph API ドキュメント</a> をご確認ください。</p><p>お客様の認証ニーズに対して、複数ステージのレビューがどのように活用されるかとても楽しみです。</p><p>Alex Simons (Twitter: <a href="https://twitter.com/alex_a_simons">@Alex_A_Simons</a><br>Corporate Vice President Program Management<br>Microsoft Identity Division</p><hr><h2 id="よくあるご質問"><a href="#よくあるご質問" class="headerlink" title="よくあるご質問"></a>よくあるご質問</h2><p><strong>Q: ゲストのレビューに複数ステージのレビューを使用できますか？</strong></p><p>はい、ゲスト ユーザーにも複数ステージのレビューを使用することができます。また、ゲスト ユーザーをセルフ レビュアー (自身をレビュー担当者) として、3 つのステージのいずれかに参加させることも可能です。</p><p><strong>Q: ダウンロードできるレビュー履歴レポートには、複数ステージののレビュー担当者が表示されますか？</strong></p><p>はい、表示されます。レビュー履歴レポートには、最大 3 ステージのレビュー担当者が記録されます。レビュー履歴レポートのダウンロードについては <a href="https://docs.microsoft.com/ja-jp/azure/active-directory/governance/access-reviews-downloadable-review-history">こちら</a> をご覧ください。</p><p><strong>Q: 以前、レビューで複数のレビュー担当者を設定したことがあります。複数ステージのレビューはどう違うのですか？</strong></p><p>複数のレビュー担当者の場合、ひとつのステージで全員が同時にレビューに関与します。それらレビュー担当者の判断に優劣はなく、レビュー期間の終了時には、最後のレビュー担当者の判断が適用されます。 </p><p>複数ステージのレビューでは、1 人または複数のレビュー担当者からなる最大 3 名の担当者を定義し、順次レビューを行っていきます。最初のステージのレビュー担当者がレビューを完了してから、2 番目のステージのレビュー担当者がレビューを開始します。異なるステージのレビュー担当者は独立してレビューを行い、どのレビュー担当者の場合にそのステージから別のステージに移動するか、またレビュー担当者が以前のステージの判断結果を見れるかどうかを設定することができます。</p><p><strong>Q: Azure AD ロールまたは Azure RBAC ロールの Privileged Identity Management ロール割り当てに複数ステージのレビューを使用したいです。ロール割り当てレビューに複数ステージを設定するにはどうすればよいですか?</strong></p><p>現在、多段構成をサポートするレビューの種類を拡張すべく取り組んでいます。現時点では、アプリケーションに加え、Security グループと M365 グループのレビューに対してのみ、複数ステージのレビューをサポートしています。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Azure Identity サポート チームの 村上 です。&lt;/p&gt;
&lt;p&gt;本記事は、2022 年 2 月 28 日に米国の Azure Active Directory Identity Blog で公開された &lt;a href=&quot;https://techco</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="US Identity Blog" scheme="https://jpazureid.github.io/blog/tags/US-Identity-Blog/"/>
    
  </entry>
  
  <entry>
    <title>Azure AD Identity Protection をワークロード ID へも拡張</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/extend-the-reach-of-azure-ad-identity-protection-into-workload/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/extend-the-reach-of-azure-ad-identity-protection-into-workload/</id>
    <published>2022-03-12T00:00:00.000Z</published>
    <updated>2022-03-28T02:13:39.779Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Azure Identity サポート チームの 村上 です。</p><p>本記事は、2022 年 2 月 23 日に米国の Azure Active Directory Identity Blog で公開された <a href="https://techcommunity.microsoft.com/t5/azure-active-directory-identity/extend-the-reach-of-azure-ad-identity-protection-into-workload/ba-p/2365666">Extend the reach of Azure AD Identity Protection into workload identities</a> を意訳したものになります。ご不明点等ございましたらサポート チームまでお問い合わせください。</p><hr><p>本日は、<a href="https://docs.microsoft.com/ja-jp/azure/active-directory/identity-protection/concept-workload-identity-risk">ワークロード ID 向け Azure AD Identity Protection のパブリック プレビュー</a> をご紹介できることを嬉しく思います。弊社では、特に現在の攻撃者の振る舞いを考慮し、ユーザー アカウントの保護から得たすべての知見を <a href="https://docs.microsoft.com/ja-jp/azure/active-directory/develop/workload-identities-overview">ワークロード ID</a> に適用すべく、お客様とともに取り組んできました。ワークロード ID 用に開発された異常検知機能により、ユーザー用の検知機能と併せ、お客様の資産全体を保護可能です。</p><p>企業のクラウド コンピューティングへの移行に伴い、企業はクラウド リソースにアクセスするソフトウェア ワークロード (アプリケーション、サービス、スクリプトなど) を展開しています。これらのワークロードでは、Azure AD の <a href="https://www.microsoft.com/en-us/security/business/identity-access-management/workload-identity-management">ワークロード ID</a>（アプリケーション、マネージド ID、およびサービス プリンシパル）が利用されます。</p><p>当社の社内調査によると、通常、組織にはユーザーの <strong>5 倍以上</strong> のソフトウェア ワークロードが存在すると言われています。ワークロード ID が侵害されると、それらは攻撃者が攻撃先をさらに横展開して広げていく足がかりとなります。このような攻撃は増加の一途をたどっており、お客様においても喫緊でこれら ID のセキュリティに、人間のユーザーのセキュリティと同じように目を向けつつある状況です。</p><p>さっそく、<a href="https://docs.microsoft.com/ja-jp/azure/active-directory/identity-protection/concept-workload-identity-risk">ワークロード ID 向け Azure AD Identity Protection</a> の新しい検出、制御、SIEM 統合機能とその効果について見ていきましょう。</p><h2 id="侵害されたワークロード-ID-の検出と対応"><a href="#侵害されたワークロード-ID-の検出と対応" class="headerlink" title="侵害されたワークロード ID の検出と対応"></a>侵害されたワークロード ID の検出と対応</h2><p>組織は貴重なリソースとデータを保護するために、侵害のリスクを減らす機能を必要としています。Azure AD Identity Protection ではすでに、認証情報が漏洩したユーザーやリスクの高いセッションを検出することでお客様を保護しています。今回の発表では、この保護をワークロード ID に拡張し、疑わしいログイン パターンやディレクトリの変更を含む、アプリケーションの異常な動作のレポート機能を提供することで、より迅速に攻撃を検出して修正できるように支援します。</p><p><img src="/blog/azure-active-directory/extend-the-reach-of-azure-ad-identity-protection-into-workload/Image01.png" alt="危険なワークロード ID レポート"></p><h2 id="リスク-ベースの条件付きアクセスで、ゼロ-トラストの展開を強化"><a href="#リスク-ベースの条件付きアクセスで、ゼロ-トラストの展開を強化" class="headerlink" title="リスク ベースの条件付きアクセスで、ゼロ トラストの展開を強化"></a>リスク ベースの条件付きアクセスで、ゼロ トラストの展開を強化</h2><p>ゼロ トラストの重要なポイントは、「明示的な検証」を行い、システムが異常を検出した場合には安全を確保することです。リスク ベースの条件付きアクセス ポリシーを適用することで、Identity Protection がリスクの高いワークロード ID を Microsoft Graph で検出したときに、アクセスをブロックすることが可能です (Azure Portal でのサポートは近日公開予定です)。つまり、すべてのシングル テナントのアプリケーションにおいて、高リスク、中リスク、低リスクの任意の組み合わせでブロックするポリシーを設定できます (マルチ テナントのアプリケーションについては、今後対応予定です)。</p><p><img src="/blog/azure-active-directory/extend-the-reach-of-azure-ad-identity-protection-into-workload/Image02.png" alt="条件付きアクセスにおけるワークロード ID 向けリスク レベル設定"></p><h2 id="リスク-データを任意の場所にエクスポート"><a href="#リスク-データを任意の場所にエクスポート" class="headerlink" title="リスク データを任意の場所にエクスポート"></a>リスク データを任意の場所にエクスポート</h2><p>非常に多くのお客様が、Azure ポータル以外のツールを使って Identity Protection のログを解析しています。本日より、分析または長期保存のために、リスク イベントをご希望のソリューションにエクスポートすることが可能となります。ポータル上の [診断設定] から、お試しいただけます。</p><p><img src="/blog/azure-active-directory/extend-the-reach-of-azure-ad-identity-protection-into-workload/Image03.png" alt="危険なサービス プリンシパルとサービス プリンシパル イベントのエクスポート"></p><p>弊社では、ワークロード ID を含むすべての ID の保護に取り組んでおり、この分野のさらなる新機能を近々お届けする予定です。わたしたちは、いつもながら、皆様の貴重なフィードバックをお待ちしています。ワークロード ID に関する詳細は、<a href="https://docs.microsoft.com/ja-jp/azure/active-directory/identity-protection/concept-workload-identity-risk">ID 保護に関するドキュメント</a> をご覧ください。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Azure Identity サポート チームの 村上 です。&lt;/p&gt;
&lt;p&gt;本記事は、2022 年 2 月 23 日に米国の Azure Active Directory Identity Blog で公開された &lt;a href=&quot;https://techco</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="US Identity Blog" scheme="https://jpazureid.github.io/blog/tags/US-Identity-Blog/"/>
    
  </entry>
  
  <entry>
    <title>Microsoft Graph PowerShell SDK を使用したライセンス管理操作の紹介 (一括設定編)</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/operating-license-with-microsoft-graph2/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/operating-license-with-microsoft-graph2/</id>
    <published>2022-03-10T00:00:00.000Z</published>
    <updated>2022-03-28T02:13:39.991Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Azure Identity サポート チームの中井です。</p><p>MSOnline および Azure AD PowerShell モジュールにてライセンス割り当て操作が利用できなくなることに伴い、弊サポート チームでは以下ブログにて Microsoft Graph PowerShell を用いた代替操作方法をご紹介させていただきました。</p><p><a href="https://jpazureid.github.io/blog/azure-active-directory/operating-license-with-microsoft-graph/">Microsoft Graph PowerShell SDK を使用したライセンス管理操作の紹介</a></p><p>上記事では主に単一のユーザーに対して、一部のサービス プランを無効にしてライセンスを割り当てるなど、様々なシナリオにおけるライセンス割り当て・削除のコマンド例を記載いたしました。</p><p>今回のブログでは、ご要望いただくことも多い、複数のユーザーに対しライセンスを一括で設定する手順について、ご紹介いたします。</p><p><strong>主に CSV ファイルを用いて、テナント内ユーザーに対するライセンス付与・削除操作となります。</strong> </p><p>なお Microsoft Graph PowerShell のインストールおよび、Connect-MgGraph によるテナント接続方法の詳細につきましては上記記事内の項目１, 2 をご覧ください。本記事では、以下の項目 2 のうち 「管理者の資格情報を使用する」方法にて、テナント接続を行うとします。</p><p>項目 1. <a href="https://jpazureid.github.io/blog/azure-active-directory/operating-license-with-microsoft-graph/#idx1">Microsoft Graph PowerShell のインストール</a><br>項目 2. <a href="https://jpazureid.github.io/blog/azure-active-directory/operating-license-with-microsoft-graph/#idx2">Connect-MgGraph による Azure AD へのサインイン</a></p><p>▼ 一部抜粋<br>事前に以下コマンドにて、テナントへの接続を行います。</p><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Connect-MgGraph</span> <span class="literal">-Scopes</span> <span class="string">&quot;Organization.Read.All&quot;</span>,<span class="string">&quot;User.ReadWrite.All&quot;</span></span><br><span class="line"><span class="built_in">Import-Module</span> <span class="literal">-Name</span> Microsoft.Graph.Users</span><br></pre></td></tr></table></figure><h2 id="目次"><a href="#目次" class="headerlink" title="目次"></a>目次</h2><ol><li>CSV ファイルを用いて一括で新規ユーザーを作成する (新規ユーザーへの割り当ての場合)</li><li>ライセンス割り当て対象の既存ユーザーを CSV ファイルにまとめる</li><li>ユーザーに割り当てるライセンス情報を作成する</li><li>CSV ファイルにまとめた既存ユーザーへライセンスを割り当てる</li></ol><p>※ テナント上の既存ユーザーに対しライセンスを割り当てる場合は手順 2 へお進みください。</p><div class="alert is-important"><p class="alert-title">重要</p><p>Microsoft Graph PowerShell にて新規ユーザー作成を行う New-MgUser コマンドでは、MSOnline PowerShell の <code>New-MsolUserLicense  -LicenseAssignment</code>のように、新規ユーザー作成と同時にライセンスを割り当てるオプションがありません。</p><p>したがって、新規ユーザーに対してライセンスの割り当てを行う場合は、事前にテナント上に対象のユーザーを作成しておき、Set-MgUser コマンドを用いて対象ユーザーに対しライセンスを割り当てを行います。</p></div><p>以下では、CSV ファイルを用いて、ライセンス割り当て対象のユーザーを一括で作成するサンプル スクリプトをご紹介します。ライセンス割り当てに限らず、PowerShell を用いてユーザーを作成したいシナリオでぜひお役立てください。</p><h2 id="1-CSV-ファイルを用いて一括で新規ユーザーを作成する-新規ユーザーへの割り当ての場合"><a href="#1-CSV-ファイルを用いて一括で新規ユーザーを作成する-新規ユーザーへの割り当ての場合" class="headerlink" title="1. CSV ファイルを用いて一括で新規ユーザーを作成する (新規ユーザーへの割り当ての場合)"></a>1. CSV ファイルを用いて一括で新規ユーザーを作成する (新規ユーザーへの割り当ての場合)</h2><p>メモ帳を開き、以下のようにカンマ区切りで値を設定し、<strong>CSV ファイル</strong> として保存します。MailNickname 属性はユーザーのメール エイリアス値であり、必須項目となっています。</p><p>※エラーが発生するリスクを回避する為、1 つの CSV ファイルに最大で 1,000 アカウント前後とすることを推奨いたします。</p><p>▼ CSV ファイル（メモ帳）の作成例</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">UserPrincipalName,MailNickname,DisplayName,GivenName,Surname,Password,&lt;その他属性&gt;</span><br><span class="line">user1@xxx.com,user1,User01,User,01,Pass1234,…</span><br><span class="line">user2@xxx.com,user2,User02,User,02,Pass1234,…</span><br></pre></td></tr></table></figure><p>▼ メモ帳での作成例</p><p><img src="/blog/azure-active-directory/operating-license-with-microsoft-graph2/making-users-memo.png"></p><p>Office 365 の既定のパスワードは、一定のパスワード強度を満たしたものを設定する必要があります。一定の強度 (要件) を満たしていない場合にはパスワード設定は完了しません。パスワード要件に関する詳細は <a href="https://docs.microsoft.com/ja-jp/azure/active-directory/authentication/concept-sspr-policy#password-policies-that-only-apply-to-cloud-user-accounts">Azure AD パスワード ポリシー</a> に関する公開情報もご参照ください。</p><p>▼ パスワードの設定要件例</p><ul><li>8 文字以上の文字数である必要があります。</li><li>簡単に推測されたり、解読されない強力なパスワードを作成します。英字の大文字、小文字、数字、記号のうち、最低でも 3 つの種類を含める必要があります。</li></ul><p>他に設定したい項目がある場合には、以下より CSV ファイルおよび 後述の コマンドレットの &lt;その他属性&gt; に追記ください。</p><ul><li>ユーザー名: UserPrincipalName</li><li>名: Surname</li><li>姓: GivenName</li><li>表示名: DisplayName</li><li>役職: JobTitle</li><li>部署: Department</li><li>事業所: OfficeLocation</li><li>事業所の電話: BusinessPhones</li><li>携帯電話: MobilePhone</li><li>FAX 番号: FaxNumber</li><li>番地: StreetAddres</li><li>市区町村: City</li><li>都道府県: State</li><li>郵便番号: PostalCode</li><li>国/地域: Country</li></ul><p>CSV ファイルの作成が完了しましたら、以下例のコマンドレットを実行し新規にユーザーを作成します。</p><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="variable">$path</span> = <span class="string">&quot;＜作成した CSV ファイル名を含んだ保存先のパス&gt;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">Import-Csv</span> <span class="literal">-Path</span> <span class="variable">$path</span> |<span class="built_in">ForEach-Object</span> &#123;<span class="built_in">New-MgUser</span> <span class="literal">-AccountEnabled</span> <span class="literal">-UsageLocation</span> <span class="string">&quot;JP&quot;</span> <span class="literal">-UserPrincipalName</span> <span class="variable">$_</span>.UserPrincipalName <span class="literal">-DisplayName</span> <span class="variable">$_</span>.DisplayName <span class="literal">-MailNickname</span> <span class="variable">$_</span>.MailNickname <span class="literal">-PasswordProfile</span> <span class="selector-tag">@</span>&#123;<span class="string">&quot;Password&quot;</span>=<span class="variable">$_</span>.Password;ForceChangePasswordNextSignIn=<span class="variable">$false</span>&#125;&#125;</span><br></pre></td></tr></table></figure><p>▼ 実行例</p><p>以下では、&lt;その他属性&gt; として「名」「姓」「部署」を追加しています。</p><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="variable">$path</span> = <span class="string">&quot;C:\temp\users.csv&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">Import-Csv</span> <span class="literal">-Path</span> <span class="variable">$path</span> |<span class="built_in">ForEach-Object</span> &#123;<span class="built_in">New-MgUser</span> <span class="literal">-AccountEnabled</span> <span class="literal">-UsageLocation</span> <span class="string">&quot;JP&quot;</span> <span class="literal">-UserPrincipalName</span> <span class="variable">$_</span>.UserPrincipalName<span class="literal">-DisplayName</span> <span class="variable">$_</span>.DisplayName <span class="literal">-MailNickname</span> <span class="variable">$_</span>.MailNickname <span class="literal">-PasswordProfile</span> <span class="selector-tag">@</span>&#123;<span class="string">&quot;Password&quot;</span>=<span class="variable">$_</span>.Password;ForceChangePasswordNextSignIn=<span class="variable">$false</span>&#125;`</span><br><span class="line"><span class="literal">-GivenName</span> <span class="variable">$_</span>.GivenName <span class="literal">-Surname</span> <span class="variable">$_</span>.Surname <span class="literal">-Department</span> <span class="variable">$_</span>.Department</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>ForceChangePasswordNextSignIn</code> は、初回サインイン時の挙動を指定するオプションです。<code>ForceChangePasswordNextSignIn = $true</code> を指定すると、ユーザーは初回サインイン時にパスワード変更が求められます。<code>ForceChangePasswordNextSignIn = $false</code> の場合、ユーザーにはパスワード変更が求められず、管理者が指定したパスワードを使い続けることができます。</p><p>▼ 実行結果例</p><p><img src="/blog/azure-active-directory/operating-license-with-microsoft-graph2/making-users.png"></p><h2 id="2-ライセンス割り当て対象の既存ユーザーを-CSV-ファイルにまとめる"><a href="#2-ライセンス割り当て対象の既存ユーザーを-CSV-ファイルにまとめる" class="headerlink" title="2. ライセンス割り当て対象の既存ユーザーを CSV ファイルにまとめる"></a>2. ライセンス割り当て対象の既存ユーザーを CSV ファイルにまとめる</h2><p>csv ファイルを使用してライセンスの一括割当および変更を行う場合は、下記例を参考に事前準備として既存ユーザーを CSV ファイルに一覧で出力ください。</p><p>なお形式は、以下のように 1 つの列に「UserPrincipalName」属性が含まれていれば手動で作成いただいて構いません。</p><p>※ 一行目には、ラベル “UserPrincipalName” を値として格納ください。</p><p><img src="/blog/azure-active-directory/operating-license-with-microsoft-graph2/assigned-users.png"></p><h3 id="全ユーザーの-UserPrincipalName-の一覧を出力する"><a href="#全ユーザーの-UserPrincipalName-の一覧を出力する" class="headerlink" title="全ユーザーの UserPrincipalName の一覧を出力する"></a>全ユーザーの UserPrincipalName の一覧を出力する</h3><p>Get-MgUser コマンドを用いて、テナント内の全ユーザーを出力します。</p><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Get-MgUser</span> <span class="literal">-All</span> | <span class="built_in">Select-Object</span> UserPrincipalName | <span class="built_in">Export-Csv</span> &lt;出力先の csv ファイルパス&gt; <span class="literal">-Encoding</span> UTF8 <span class="literal">-NoTypeInformation</span></span><br></pre></td></tr></table></figure><h3 id="特定ライセンスが付与されているユーザーの-UserPrincipalName-の一覧を出力する"><a href="#特定ライセンスが付与されているユーザーの-UserPrincipalName-の一覧を出力する" class="headerlink" title="特定ライセンスが付与されているユーザーの UserPrincipalName の一覧を出力する"></a>特定ライセンスが付与されているユーザーの UserPrincipalName の一覧を出力する</h3><p>ユーザー属性の 1 つである <code>assingedLicenses</code> プロパティを用いてフィルタリングすることで、テナント内で特定ライセンスが付与されているユーザーを抽出することが可能です。事前に、下記ブログにて紹介しております <code>Get-MgSubscribedSku</code> コマンドにて、割り当てたいライセンスの [SkuId] をご確認ください。</p><p>ブログ該当箇所: <a href="https://jpazureid.github.io/blog/azure-active-directory/operating-license-with-microsoft-graph/#idx3">3. ライセンス情報の取得</a></p><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="variable">$skuId</span> = <span class="string">&quot;&lt;ライセンスの skuId&gt;&quot;</span></span><br><span class="line"><span class="comment"># CSV ファイルの出力先を入力ください。</span></span><br><span class="line"><span class="variable">$path</span> = <span class="string">&quot;C:\temp\assignedUser.csv&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$users</span> = <span class="built_in">Get-MgUser</span> <span class="literal">-Filter</span> <span class="string">&quot;assignedLicenses/any(s:s/skuId eq <span class="variable">$skuId</span>)&quot;</span> </span><br><span class="line"><span class="variable">$users</span> |<span class="built_in">select</span> <span class="selector-tag">@</span>&#123;n=<span class="string">&quot;ObjectId&quot;</span>; e=&#123;<span class="variable">$_</span>.Id&#125;&#125;, <span class="selector-tag">@</span>&#123;n=<span class="string">&quot;UserPrincipalName&quot;</span>; e=&#123;<span class="variable">$_</span>.UserPrincipalName&#125;&#125;, <span class="selector-tag">@</span>&#123;n=<span class="string">&quot;DisplayName&quot;</span>; e=&#123;<span class="variable">$_</span>.DisplayName&#125;&#125; | <span class="built_in">Export-Csv</span> <span class="literal">-NoTypeInformation</span> <span class="literal">-Encoding</span> UTF8 <span class="literal">-Path</span> <span class="variable">$path</span></span><br></pre></td></tr></table></figure><h3 id="特定のライセンスに含まれるサービスが有効になっているユーザーだけを一覧で出力する"><a href="#特定のライセンスに含まれるサービスが有効になっているユーザーだけを一覧で出力する" class="headerlink" title="特定のライセンスに含まれるサービスが有効になっているユーザーだけを一覧で出力する"></a>特定のライセンスに含まれるサービスが有効になっているユーザーだけを一覧で出力する</h3><p>ユーザー属性の１つである <code>assignedPlans</code> プロパティを用いてフィルタリングすることで、テナント内で特定のサービス プランが付与されているユーザーを抽出することが可能です。事前に、下記ブログにて紹介しております <code>Get-MgSubscribedSku</code> コマンドにて、割り当てたいライセンスの中に含まれる各サービスの [ServicePlanId] をご確認ください。</p><p>ブログ該当箇所: <a href="https://jpazureid.github.io/blog/azure-active-directory/operating-license-with-microsoft-graph/#idx3">3. ライセンス情報の取得</a></p><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="variable">$servicePlanId</span> = <span class="string">&quot;&lt;サービスプラン Id&gt;&quot;</span></span><br><span class="line"><span class="comment"># CSV ファイルの出力先を入力ください。</span></span><br><span class="line"><span class="variable">$path</span> = <span class="string">&quot;C:\temp\assignedUser.csv&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$users</span> = <span class="built_in">Get-MgUser</span> <span class="literal">-Filter</span> <span class="string">&quot;assignedPlans/any(s:s/servicePlanId eq <span class="variable">$servicePlanId</span> and s/capabilityStatus eq &#x27;Enabled&#x27;)&quot;</span> <span class="literal">-CountVariable</span> CountVar <span class="literal">-ConsistencyLevel</span> eventual</span><br><span class="line"><span class="variable">$users</span> |<span class="built_in">select</span> <span class="selector-tag">@</span>&#123;n=<span class="string">&quot;ObjectId&quot;</span>; e=&#123;<span class="variable">$_</span>.Id&#125;&#125;, <span class="selector-tag">@</span>&#123;n=<span class="string">&quot;UserPrincipalName&quot;</span>; e=&#123;<span class="variable">$_</span>.UserPrincipalName&#125;&#125;, <span class="selector-tag">@</span>&#123;n=<span class="string">&quot;DisplayName&quot;</span>; e=&#123;<span class="variable">$_</span>.DisplayName&#125;&#125; | <span class="built_in">Export-Csv</span> <span class="literal">-NoTypeInformation</span> <span class="literal">-Encoding</span> UTF8 <span class="literal">-Path</span> <span class="variable">$path</span></span><br></pre></td></tr></table></figure><p>※ 上記で紹介した<code>assignedLicense</code> と <code>assignedPlans</code> プロパティによるクエリ文については、Graph API に関する以下公開情報が参考情報とりますので、併せてお役立てください。</p><p>タイトル: <a href="https://docs.microsoft.com/ja-jp/graph/query-parameters#filter-parameter">クエリ パラメーターを使用して応答をカスタマイズする</a></p><h2 id="3-ユーザーに割り当てるライセンス情報を作成する"><a href="#3-ユーザーに割り当てるライセンス情報を作成する" class="headerlink" title="3. ユーザーに割り当てるライセンス情報を作成する"></a>3. ユーザーに割り当てるライセンス情報を作成する</h2><p>いよいよライセンス付与に移る前に、本項目ではまずライセンス割り当ての考え方を説明します。</p><p>ライセンス割り当ておよび削除には全て、以下の <code>Set-MgUserLicense</code> コマンドを用います。作成したライセンス オプション (<code>$NewLicenseArray</code>) をユーザーに適用することで、現在のライセンスの内容から、作成したライセンス オプションの内容に変更します。</p><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Set-MgUserLicense</span> <span class="literal">-UserId</span> &lt;対象ユーザーの UPN&gt; <span class="literal">-AddLicenses</span> <span class="selector-tag">@</span>(&lt;ライセンス オプション&gt;) <span class="literal">-RemoveLicenses</span> <span class="selector-tag">@</span>(<span class="string">&quot;&lt;削除するライセンスの SkuId&gt;&quot;</span>)</span><br></pre></td></tr></table></figure><p><code>AddLicenses</code> パラメータに指定するライセンス オプションでは、<strong>MicrosoftGraphAssignedLicense オブジェクト</strong> を作成し、割り当てるライセンスの SkuId を配列として指定します。一方、<code>RemoveLicenses</code> パラメータには、削除するライセンスの <strong>SkuId を文字列として</strong> そのまま指定します。(必須オプションとなり、ライセンス付与のみを行う際には空の配列 @() を指定します。)</p><p><code>AddLicenses</code> と <code>RemoveLicenses</code> パラメータで指定するオブジェクトの形式が異なるため、混乱を招くかもしれません。 図にまとめると以下のイメージです。</p><p><img src="/blog/azure-active-directory/operating-license-with-microsoft-graph2/license-option.png"></p><p>さて、<code>AddLicenses</code> パラメータに指定するライセンス オプションの形式は以下のようになります。</p><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="variable">$</span>&lt;ライセンスオプション名&gt; = <span class="built_in">New-Object</span> <span class="literal">-TypeName</span> Microsoft.Graph.PowerShell.Models.MicrosoftGraphAssignedLicense <span class="literal">-Property</span> <span class="selector-tag">@</span>&#123;SkuId = <span class="string">&quot;&lt;割り当てるライセンスの SkuId&gt;&quot;</span>; DisabledPlans = <span class="selector-tag">@</span>(<span class="string">&quot;&lt;無効にするサービス プランの ServicePlanId&gt;&quot;</span>)&#125;</span><br></pre></td></tr></table></figure><p>例えば、利用したいサービス以外の一部のサービスを無効化したライセンス オプションは以下のようになります。</p><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="variable">$License1</span> = <span class="built_in">New-Object</span> <span class="literal">-TypeName</span> Microsoft.Graph.PowerShell.Models.MicrosoftGraphAssignedLicense <span class="literal">-Property</span> <span class="selector-tag">@</span>&#123;SkuId = <span class="string">&quot;c7df2760-2c81-4ef7-b578-5b5392b571df&quot;</span>; DisabledPlans = <span class="selector-tag">@</span>(<span class="string">&quot;a23b959c-7ce8-4e57-9140-b90eb88a9e97&quot;</span>, <span class="string">&quot;7547a3fe-08ee-4ccb-b430-5077c5041653&quot;</span>)&#125;</span><br></pre></td></tr></table></figure><p>上記実行例では Office 365 Enterprise E5 から、[Sway] と [Yammer Enterprise] の 2 つのサービスを無効にしています。</p><p>詳細なライセンス オプションのパターンは、下記のライセンス割り当てのシナリオそれぞれにおいてご紹介しておりますので、併せて参照ください。</p><p>ブログ該当箇所: <a href="https://jpazureid.github.io/blog/azure-active-directory/operating-license-with-microsoft-graph/#idx4">シナリオ 1: ユーザーにライセンスを割り当てる</a></p><h2 id="4-CSV-ファイルにまとめた既存ユーザーへライセンスを割り当てる"><a href="#4-CSV-ファイルにまとめた既存ユーザーへライセンスを割り当てる" class="headerlink" title="4. CSV ファイルにまとめた既存ユーザーへライセンスを割り当てる"></a>4. CSV ファイルにまとめた既存ユーザーへライセンスを割り当てる</h2><div class="alert is-info"><p class="alert-title">Note</p><p>まずは上述の手順 1 または 手順 2 にて、UserPrincipalName が列名として存在する CSV ファイルをご用意ください。</p><p>また、以後、csv ファイルのパスは変数 $path に格納しているものとします。</p><p>例) $path = “C:\temp\assignedUser.csv”</p></div><h3 id="PowerShell-を用いた一括割り当ての構文"><a href="#PowerShell-を用いた一括割り当ての構文" class="headerlink" title="PowerShell を用いた一括割り当ての構文"></a>PowerShell を用いた一括割り当ての構文</h3><p>さて、肝心の一括割り当て操作ですが、一括操作には以下の PowerShell コマンドレットの構文を用います。</p><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Import-Csv</span> &lt;csv ファイルのパス名&gt; | <span class="built_in">ForEach-Object</span> &#123; </span><br><span class="line">    &lt;各データに対するコマンドレット操作&gt; &#125;</span><br></pre></td></tr></table></figure><p><code>Import-Csv</code> コマンド にて読み込まれた CSV ファイル内の各行データの情報を、<code>ForEach-Object &#123;&#125;</code> へパイプ（<code>|</code>）することで順次実行します。パイプにより渡されたオブジェクトは <code>$_</code> で参照します。実際に、以下の複数の例を見ながら理解を深めていただけると幸いです。</p><h3 id="初めてライセンスを割り当てる場合"><a href="#初めてライセンスを割り当てる場合" class="headerlink" title="初めてライセンスを割り当てる場合"></a>初めてライセンスを割り当てる場合</h3><p>対象ユーザーについて、これまでライセンスの割り当てがなく今回初めてライセンスを割り当てる場合は、事前に以下のコマンドレットで [所在地] を設定します。以下例では、所在地として日本「JP」を設定しています。</p><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Import-Csv</span> <span class="variable">$path</span> | <span class="built_in">ForEach-Object</span> &#123; </span><br><span class="line">    <span class="built_in">Update-MgUser</span> <span class="literal">-UserId</span> <span class="variable">$_</span>.UserPrincipalName <span class="literal">-UsageLocation</span> <span class="string">&quot;JP&quot;</span> &#125;</span><br></pre></td></tr></table></figure><h3 id="ライセンスの割り当て"><a href="#ライセンスの割り当て" class="headerlink" title="ライセンスの割り当て"></a>ライセンスの割り当て</h3><p>所在地を設定したら、項目 2 でお伝えの <code>Set-MgUserLicense</code> コマンドにてユーザーに対しライセンスを割り当てます。下記コマンド内のライセンス オプションでは、「3. ユーザーに割り当てるライセンス情報を作成する」で作成した <code>$License1</code> のような引数 (ライセンス オプション) を指定します。</p><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Import-Csv</span> &lt;csv ファイルのパス名&gt; | <span class="built_in">ForEach-Object</span> &#123; <span class="built_in">Set-MgUserLicense</span> <span class="literal">-UserId</span> <span class="variable">$_</span>.UserPrincipalName <span class="literal">-AddLicenses</span> <span class="selector-tag">@</span>(&lt;ライセンス オプション&gt;) <span class="literal">-RemoveLicenses</span> <span class="selector-tag">@</span>() &#125;</span><br></pre></td></tr></table></figure><p>▼ 実行例</p><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Import-Csv</span> <span class="variable">$path</span> | <span class="built_in">ForEach-Object</span> &#123; <span class="built_in">Set-MgUserLicense</span> <span class="literal">-UserId</span> <span class="variable">$_</span>.UserPrincipalName <span class="literal">-AddLicenses</span> <span class="selector-tag">@</span>(<span class="variable">$License1</span>) <span class="literal">-RemoveLicenses</span> <span class="selector-tag">@</span>() &#125;</span><br></pre></td></tr></table></figure><p>新しいライセンス割り当てと同時に、割り当てられている既存のライセンスを削除する場合は、RemoveLicenses パラメーターに削除したいライセンスの SkuId を配列として指定します。これだけで新しいライセンス割り当てと同時に既存のライセンス削除が可能となります。</p><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Import-Csv</span> <span class="variable">$path</span> | <span class="built_in">ForEach-Object</span> &#123; <span class="built_in">Set-MgUserLicense</span> <span class="literal">-UserId</span> <span class="variable">$_</span>.UserPrincipalName <span class="literal">-AddLicenses</span> <span class="selector-tag">@</span>(&lt;ライセンス オプション&gt;) <span class="literal">-RemoveLicenses</span> <span class="selector-tag">@</span>(<span class="string">&quot;&lt;削除するライセンスの SkuId&gt;&quot;</span>) &#125;</span><br></pre></td></tr></table></figure><p>配列には複数の要素を指定できるので、例えば複数のライセンスを割り当て、同時に複数の既存ライセンスを削除するには以下のように実行できます。</p><div class="alert is-warning"><p class="alert-title">警告</p><p>改めて、AddLicenses パラメータ $License1, $License2 には文字列ではなく、 項目 2 で作成したライセンス オプションのオブジェクトを指定しているかをご確認ください。</p><p>実際にライセンス割り当てを実施いただく前に、お客様環境で少数のテスト ユーザーを用いて動作を検証くださいますようお願い申し上げます。</p><p>適切でない構文によりライセンス付与には失敗した場合でも、RemoveLicenses 部分が正しい構文の場合には コマンドが実行され、指定したライセンスが削除されますのでご注意ください。</p></div><p>▼ 実行例</p><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Import-Csv</span> <span class="variable">$path</span> | <span class="built_in">ForEach-Object</span> &#123; <span class="built_in">Set-MgUserLicense</span> <span class="literal">-UserId</span> <span class="variable">$_</span>.UserPrincipalName  <span class="literal">-AddLicenses</span> <span class="selector-tag">@</span>(<span class="variable">$License1</span>, <span class="variable">$License2</span>) <span class="literal">-RemoveLicenses</span> <span class="selector-tag">@</span>(<span class="string">&quot;b05e124f-c7cc-45a0-a6aa-8cf78c946968&quot;</span>, <span class="string">&quot;c7df2760-2c81-4ef7-b578-5b5392b571df&quot;</span>) &#125;</span><br></pre></td></tr></table></figure><h3 id="特定のライセンスを削除する場合"><a href="#特定のライセンスを削除する場合" class="headerlink" title="特定のライセンスを削除する場合"></a>特定のライセンスを削除する場合</h3><p>前回のライセンス管理操作のブログ記事 <a href="https://jpazureid.github.io/blog/azure-active-directory/operating-license-with-microsoft-graph/#idx5">シナリオ 2: ユーザーからライセンスを削除する</a> で記載した内容の、一括処理版です。「PowerShell を用いた一括割り当ての構文」のとおり、<code>Import-Csv &lt;csv ファイルのパス名&gt; | ForEach-Object &#123;&#125;</code> のブラケット内に、単体ユーザーに対する処理を埋め込みします。</p><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Import-Csv</span> <span class="variable">$path</span> | <span class="built_in">ForEach-Object</span> &#123;</span><br><span class="line">    <span class="built_in">Set-MgUserLicense</span> <span class="literal">-UserId</span> <span class="variable">$_</span>.UserPrincipalName <span class="literal">-AddLicenses</span> <span class="selector-tag">@</span>() <span class="literal">-RemoveLicenses</span> <span class="selector-tag">@</span>(<span class="string">&quot;&lt;削除するライセンスの SkuId&gt;&quot;</span>) &#125;</span><br></pre></td></tr></table></figure><p>ライセンス割り当て方のシナリオは多く考えられ、ここでは全てを取り上げることはできませんが、前回の記事ならびに本記事が Microsoft Graph PowerShell を用いたライセンス割り当てスクリプト作成などの一助となれば幸いです。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Azure Identity サポート チームの中井です。&lt;/p&gt;
&lt;p&gt;MSOnline および Azure AD PowerShell モジュールにてライセンス割り当て操作が利用できなくなることに伴い、弊サポート チームでは以下ブログにて Microsoft</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="Microsoft Graph" scheme="https://jpazureid.github.io/blog/tags/Microsoft-Graph/"/>
    
  </entry>
  
  <entry>
    <title>Azure AD のエンタイトルメント管理におけるカスタム ワークフローの実行</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/run-custom-workflows-in-azure-ad-entitlement-management/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/run-custom-workflows-in-azure-ad-entitlement-management/</id>
    <published>2022-03-08T00:00:00.000Z</published>
    <updated>2022-03-28T02:13:40.039Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Azure Identity サポート チームの 竜 です。</p><p>本記事は、2022 年 02 月 24 日に米国の Azure Active Directory Identity Blog で公開された <a href="https://techcommunity.microsoft.com/t5/azure-active-directory-identity/run-custom-workflows-in-azure-ad-entitlement-management/ba-p/2466938">Run custom workflows in Azure AD entitlement management</a> を意訳したものになります。</p><hr><p><a href="https://docs.microsoft.com/ja-jp/azure/active-directory/governance/entitlement-management-logic-apps-integration">Azure Logic Apps を使用したエンタイトルメント管理にカスタム ワーク フロー</a>が導入されたことにより、ユーザーのアクセス管理における複雑なプロセスの自動化が、さらに容易になりました。今回は、この新しい機能を使用して、ユーザーがアクセス パッケージへオンボーディング (利用開始) およびオフボーディング (利用終了) する際のフローをカスタマイズするいくつかのシナリオをご紹介いたします。これらのプロセスを自動化することで、手動の作業によるミスを減らし、また、その他の優先度の高い事業内容に時間をさけるようになります。</p><p>アクセスの付与や削除は、Teams、SharePoint、Groups、アプリなどのリソースへのプロビジョニングだけではありません。電子メールの送信や、データ ベースのレコードの更新など、組織にとって必要となる追加の手順がしばしば発生します。これらの作業は、従来手動で行われていました。例えば、アクセス パッケージの承認者はチームに向けて新しいメンバーの参加を知らせる電子メールを送信したり、アクセス パッケージのメンバーシップの変更やさらに関連する変更を行うために、定期的にスクリプトを実行するなどしていました。</p><p>アクセス パッケージのリクエストが承認されたときや、ユーザーのアクセス期限が切れたときなど、エンタイトルメント管理の特定のイベントを使用してカスタム ワークフローを起動することで、多数の Microsoft のクラウド アプリケーションに加えて、Salesforce や ServiceNow などの外部アプリケーションにまでエンタイトルメント管理を拡張し、これまで手動で行われていたプロセスを自動化することができます。ここでは、架空の会社である Contoso 社が、これらの機能をどのように活用できるかをいくつか見てみましょう。</p><h2 id="エンタイトルメント管理を外部アプリケーションと連携させる"><a href="#エンタイトルメント管理を外部アプリケーションと連携させる" class="headerlink" title="エンタイトルメント管理を外部アプリケーションと連携させる"></a>エンタイトルメント管理を外部アプリケーションと連携させる</h2><p>例えば、Contoso 社では Salesforce を使用して営業チームの案件や機会を管理しています。営業チームは Azure Active Directory (Azure AD) のエンタイトルメント管理でアクセス パッケージを使用し、営業チームのメンバーに関連リソースや SharePoint サイトへのアクセスを付与し、Salesforce にもアクセス可能なようにしてあります。Salesforce へのアクセスの付与に加え、新しいメンバーが Salesforce の特定の案件や連絡先に割り当てられるようにし、またメンバーがチームを離れる際にはその案件や連絡先がチームの他のメンバーに割り当てられるようにしたいと考えています。</p><p><img src="/blog/azure-active-directory/run-custom-workflows-in-azure-ad-entitlement-management/smoorhead_0-1644862613628.png" alt="カスタムの呼び出しを作成し、特定のロジック アプリをカタログに追加することで、ポリシーで定義した特定のアクション (アクセス パッケージの割り当てなど) が生じた際に呼び出すことができます。"></p><p>従来は手作業で行っていた Salesforce のレコード更新を、カスタム ワークフローを設定することで自動化できるようになりました。新しいユーザーが、営業チームのアクセス パッケージへのアクセスを承認されると、自動的にロジック アプリが起動し、そのユーザーを適切な案件や連絡先に割り当てることができます。同様に、ユーザーがアクセス パッケージから削除されると、別のロジック アプリが自動的に起動し、そのメンバーが担当していた Salesforce リソースなどの再割り当てが行われます。これらのプロセスを自動化することで、チームはアクセスの管理ではなく、実際の業務に集中することができるようになります。</p><p><img src="/blog/azure-active-directory/run-custom-workflows-in-azure-ad-entitlement-management/smoorhead_1-1644862613635.png"></p><p><img src="/blog/azure-active-directory/run-custom-workflows-in-azure-ad-entitlement-management/smoorhead_2-1644862613641.png" alt="アクセス パッケージの割り当てに紐づいた「Salesforce を編集するロジック アプリ」により、顧客アカウントの連絡先として、営業担当者が追加されます。"></p><h2 id="ポリシーと連動したカスタム-電子メールの送信"><a href="#ポリシーと連動したカスタム-電子メールの送信" class="headerlink" title="ポリシーと連動したカスタム 電子メールの送信"></a>ポリシーと連動したカスタム 電子メールの送信</h2><p>また、Contoso 社では、ユーザーが営業チームのアクセス パッケージに承認された際に、営業チームに電子メールを送信し、新しいメンバーがチームに参加したことを知らせたいと考えています。Outlook Web for Office 365 を呼び出すシンプルなロジック アプリを作成し、ユーザーが営業チームのアクセス ペッケージの承認を受けたときにこのロジック アプリが起動されることで、このプロセスをシームレスに自動化することができます。</p><p><img src="/blog/azure-active-directory/run-custom-workflows-in-azure-ad-entitlement-management/smoorhead_3-1644862613648.png" alt="ロジック アプリでカスタムメールを作成した例"></p><h2 id="リソースとフィードバック"><a href="#リソースとフィードバック" class="headerlink" title="リソースとフィードバック"></a>リソースとフィードバック</h2><p>これらは、Azure Logic Apps で作成したカスタム ワークフローにアクセス パッケージを紐づけることで、エンタイトルメント管理でさらに多くのユース ケースに対応できるようになったシナリオのほんの一例です。ぜひお試しいただき、ご意見をお聞かせください。</p><p>詳細につきましては、 <a href="https://docs.microsoft.com/ja-jp/azure/active-directory/governance/entitlement-management-logic-apps-integration">ドキュメント</a> や <a href="https://www.youtube.com/watch?v=Yh_Xl617JkM&ab_channel=JefKazimer-CloudIdentity">動画のチュートリアル</a> をご覧ください。<a href="https://feedback.azure.com/d365community">aka.ms/AzureADFeedback</a> へのフィードバックもお待ちしております。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Azure Identity サポート チームの 竜 です。&lt;/p&gt;
&lt;p&gt;本記事は、2022 年 02 月 24 日に米国の Azure Active Directory Identity Blog で公開された &lt;a href=&quot;https://techco</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="US Identity Blog" scheme="https://jpazureid.github.io/blog/tags/US-Identity-Blog/"/>
    
  </entry>
  
  <entry>
    <title>Azure AD の変更管理を簡素化します</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/azure-ad-change-management-simplified/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/azure-ad-change-management-simplified/</id>
    <published>2022-03-03T21:00:00.000Z</published>
    <updated>2022-03-28T02:13:39.635Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Azure Identity サポート チームの 高田 です。</p><p>本記事は、2022 年 3 月 1 日に米国の Azure Active Directory Identity Blog で公開された <a href="https://techcommunity.microsoft.com/t5/azure-active-directory-identity/azure-ad-change-management-simplified/ba-p/2967456">Azure AD: Change Management Simplified</a> を意訳したものになります。ご不明点等ございましたらサポート チームまでお問い合わせください。</p><hr><p>皆さん、こんにちは。</p><p>クラウド サービスでは、現実として急激な変化が日々生じています。Azure AD だけでも、新機能のリリース、既存機能の変更、廃止やサポート終了など、毎年数百の変更が行われています。これらの変更を管理することがますます難しくなっているというお客様の声を受け、本日より Azure AD の変更管理を簡素化することにしました。</p><p>年間を通じて新しい機能を提供し続ける一方で、機能の廃止や製品のサポート終了については、1 年に 2 回 (毎年 3 月と 9 月) に発表することとし、サポート終了までのタイムラインも一貫したものにします (一部の例外を除く)。この新しいモデルにより、お客様は製品や機能の変更を予測することができ、より新しく、より安全な技術を速やかに採用することができるようになります。</p><p>2022 年 3 月の発表に含まれる非推奨の情報一覧は以下のとおりです。</p><ul><li>2022 年 6 月 30 日に予定されていた Azure AD Graph API の <a href="https://techcommunity.microsoft.com/t5/azure-active-directory-identity/update-your-applications-to-use-microsoft-authentication-library/ba-p/1257363">リタイア</a> は <strong>延期</strong> となりました。Azure AD Graph API のように特に重要な依存関係のあるコンポーネントから移行するのは容易ではないというお客様のフィードバックに耳を傾け、少なくとも今年末まではリタイアの時期を遅らせることにしました。移行を支援する追加のツールの情報を含め、今年半ばにリタイアに関する最新情報を提供する予定です。詳細については、<a href="https://docs.microsoft.com/ja-jp/graph/migrate-azure-ad-graph-overview">Azure AD Graph アプリを Microsoft Graph に移行する - Microsoft Graph | Microsoft Docs</a> を参照ください。</li><li>Azure AD Graph および MSOnline PowerShell の <a href="https://jpazureid.github.io/blog/azure-active-directory/operating-license-with-microsoft-graph/">ライセンス割り当て API</a> と PowerShell コマンドレットについては引き続き 2022 年 8 月 26 日にリタイアする予定です。Microsoft Graph からライセンス管理 API にアクセスするようアプリを移行ください。詳しくは、<a href="https://jpazureid.github.io/blog/azure-active-directory/operating-license-with-microsoft-graph/">Microsoft Graph からライセンス管理 API にアクセスするようアプリを移行する</a> をご覧ください。</li><li>Azure AD の管理に Azure AD PowerShell や MSOnline PowerShell モジュールを使っている方は、ぜひ Microsoft Graph PowerShell SDK をお試しくださいとちうことを <a href="https://techcommunity.microsoft.com/t5/azure-active-directory-identity/automate-and-manage-azure-ad-tasks-at-scale-with-the-microsoft/ba-p/1942489">以前にお伝え</a> しました。Microsoft では現在および今後の PowerShell への投資をすべて Microsoft Graph PowerShell SDK に対して行っており、これは今後も変わりはありません。6 月 30 日に Azure AD Graph API を廃止しないという発表を受け、今後の弊社の目標は Azure AD Graph API と MSOnline モジュールに依存する既存のスクリプトならびに PowerShell プロセスを Microsoft Graph PowerShell SDK に移行するため、そのガイダンスとツールを提供することとなります。これは、 2022 年 12 月以降に <strong>2 つの PowerShell モジュール (MSOL &amp; AAD) が非推奨となる予定</strong> であるためです。詳しくは <a href="https://docs.microsoft.com/en-us/powershell/microsoftgraph/migration-steps?view=graph-powershell-beta">こちら</a> と <a href="https://docs.microsoft.com/en-us/graph/migrate-azure-ad-graph-faq">こちら</a> をご確認ください。</li><li>ADAL のサポート終了は、6 月 30 日から 2022 年 12 月に延長されます。 ADAL のアプリは引き続き動作しますが、サポートやセキュリティ修正サポート終了後は提供されません。 また、ADAL への機能追加や新しいプラットフォームへの対応などのリリースは予定されていません。詳しくは、<a href="https://techcommunity.microsoft.com/t5/azure-active-directory-identity/update-your-applications-to-use-microsoft-authentication-library/ba-p/1257363">Update your applications to use Microsoft Authentication Library and Microsoft Graph API</a> を参照ください。</li><li>パブリック クラウドのレガシーな TLS 1.0 および 1.1 プロトコルの廃止を開始し、今年中に段階的に廃止を進めていく予定です。詳しくは、<a href="https://docs.microsoft.com/ja-jp/troubleshoot/azure/active-directory/enable-support-tls-environment?tabs=azure-monitor">Azure AD TLS 1.0/1.1 は非推奨になるため TLS 1.2 サポートを有効にする - Active Directory | Microsoft Docs</a> を参照ください。</li><li>Azure AD Connect Sync の過去のバージョンは、それより新しいバージョンが出た日から 12 ヶ月後に非推奨となります。[Azure AD Connect Sync サーバーをアップグレードするには、<a href="https://docs.microsoft.com/ja-jp/azure/active-directory/hybrid/how-to-upgrade-previous-version">Azure AD Connect: 旧バージョンから最新バージョンにアップグレードする</a> をご覧ください。  </li><li>2020 年 8 月以前に作成された有効なテナントについて、MFA と SSPR の統合されたセキュリティ情報登録ページを有効にする予定です。このユーザー体験の詳細については、<a href="https://docs.microsoft.com/ja-jp/azure/active-directory/authentication/concept-registration-mfa-sspr-combined">Azure Active Directory での統合されたセキュリティ情報の登録の概要</a> をご覧ください。</li><li>Azure Key Vault チームは、お客様のシークレット、キー、および証明書が誤って削除されないよう保護するために、すべてのキー コンテナーにソフト デリートの保護を適用することに取り組んでいます。ソフト デリートは、削除されたキー コンテナーに加え、キー コンテナー内に保存されたシークレットを最大 90 日間復元可能にする機能で、お客様は削除されたシークレットをご自身で復元することが可能です。既存のすべてのキー コンテナーのリソースに対し、2025 年 2 月 1 日までにソフト デリートが自動的に有効になります。ソフト デリートは有効化のみが可能です。つまり一度有効にすると、この機能を無効にすることはできません。詳しくは <a href="https://docs.microsoft.com/en-us/azure/key-vault/general/soft-delete-change">すべてのキー コンテナーでの論理的な削除の有効化</a> をご覧ください。</li></ul><p><strong>2022 年の変更に関するお知らせのタイムライン:</strong></p><p><img src="/blog/azure-active-directory/azure-ad-change-management-simplified/change-comms-timeline.png"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Azure Identity サポート チームの 高田 です。&lt;/p&gt;
&lt;p&gt;本記事は、2022 年 3 月 1 日に米国の Azure Active Directory Identity Blog で公開された &lt;a href=&quot;https://techcom</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="US Identity Blog" scheme="https://jpazureid.github.io/blog/tags/US-Identity-Blog/"/>
    
  </entry>
  
  <entry>
    <title>Azure AD B2B の多要素認証について</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/b2b-mfa/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/b2b-mfa/</id>
    <published>2022-02-28T01:00:00.000Z</published>
    <updated>2022-03-28T02:13:39.675Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは。 Azure Identity サポート チームです。<br>こちらのブログでは、 Azure AD B2B (Business-To-Business) コラボレーション機能 (以下、Azure AD B2B) の多要素認証について、下記 3 つのポイントを中心にご紹介いたします。</p><ol><li>ゲスト ユーザーにおける認証方法の登録先テナントについて</li><li>ゲスト ユーザーによる登録済み認証方法の変更手順について</li><li>Azure B2B での例外的な多要素認証の動作について</li></ol><h2 id="Azure-AD-B2B-とは？"><a href="#Azure-AD-B2B-とは？" class="headerlink" title="Azure AD B2B とは？"></a>Azure AD B2B とは？</h2><p>Azure AD B2B とは、外部の組織に属するユーザーのアカウントを貴社のテナントにゲスト ユーザーとして招待することで、貴社のアクセス制御のセキュリティを維持した状態でアプリまたサービスをゲスト ユーザーと安全に共有できる機能となります。</p><p>これによりゲスト ユーザーは、各自の職場または学校のアカウント、またソーシャル アカウントなどを使用して、招待されたテナントが提供するアプリとサービスにサインインすることが可能となり、組織の外部ユーザーのアカウント管理のオーバーヘッドが削減されます。<br>なお、 B2B についてのご説明は以下のブログにもおまとめしておりますので、機能のご紹介は以下を参照ください。</p><p><a href="https://jpazureid.github.io/blog/azure-active-directory/what-is-b2b/">https://jpazureid.github.io/blog/azure-active-directory/what-is-b2b/</a></p><p>本ブログでは ユーザーのアカウントがメンバーとして所属している Azure AD を “ホーム テナント”、<br>そのユーザーがゲストとして招待された先の Azure AD を “リソース テナント” と記載します。<br>(* ゲスト ユーザーが利用するサービス、例えば SharePoint Online などのリソースが存在するテナントという意味でこのような表記としています。)</p><h2 id="1-ゲスト-ユーザーにおける認証方法の登録先テナントについて"><a href="#1-ゲスト-ユーザーにおける認証方法の登録先テナントについて" class="headerlink" title="1. ゲスト ユーザーにおける認証方法の登録先テナントについて"></a>1. ゲスト ユーザーにおける認証方法の登録先テナントについて</h2><p>テナント内のユーザーに対して条件付きアクセスなどを利用して多要素認証を要求した場合は、そのテナントに登録された多要素認証の方法が利用されていました。ゲストユーザーに対して条件付きアクセスで多要素認証を要求した時の動作はどうなるのでしょうか。</p><p>ゲスト ユーザーに対する多要素認証の要求については、基本的にユーザーがメンバーとして所属しているホーム テナントまた ID プロバイダー側ではなく、アクセス先のリソース テナントのポリシーに準拠します。<br>つまり、ゲスト ユーザーがリソーステナントのアプリまたサービスへアクセスした場合、ホーム テナントまた ID プロバイダー側で資格情報の確認が実施された後、リソース テナントに定義されている条件付きアクセスのポリシーなどにより多要素認証が要求されます。</p><p>以下に、ゲスト ユーザーとして招待されたテナントにおける多要素認証のフローをご紹介します。</p><p> <img src="/blog/azure-active-directory/b2b-mfa/1.png"></p><ol><li>会社 A のテナントに属するアカウントから、外部ユーザーをゲスト ユーザーとしてテナントに招待します。</li><li>ゲスト ユーザーは、自身のアカウントにてホーム テナントまたは ID プロバイダー側で資格情報を使用してサインインします。</li><li>ゲスト ユーザーは、会社 A のアクセス制御のポリシーにより多要素認証を求められます。</li><li>ゲスト ユーザーは、会社 A で電話また認証アプリなどの認証情報の登録が要求され※3、多要素認証を完了することでアクセスが許可されます。</li></ol><p>※3 ゲスト ユーザーはアクセス先のリソーステナント毎に認証情報の登録が必要です。</p><p>公開情報: チュートリアル: B2B ゲスト ユーザーに多要素認証を適用する<br><a href="https://docs.microsoft.com/ja-jp/azure/active-directory/external-identities/b2b-tutorial-require-mfa">https://docs.microsoft.com/ja-jp/azure/active-directory/external-identities/b2b-tutorial-require-mfa</a></p><h2 id="2-ゲスト-ユーザーによる登録済み認証方法の変更手順について"><a href="#2-ゲスト-ユーザーによる登録済み認証方法の変更手順について" class="headerlink" title="2. ゲスト ユーザーによる登録済み認証方法の変更手順について"></a>2. ゲスト ユーザーによる登録済み認証方法の変更手順について</h2><p>上述の通り、ゲスト ユーザーは多要素認証の認証情報についてテナント毎に登録が必要となります。各テナントの認証情報については、以下の手順に沿ってゲスト ユーザー自身にてセキュリティ情報ページから認証情報の追加・変更をすることができます。</p><p>(1) マイアカウント ( <a href="https://myaccount.microsoft.com/">https://myaccount.microsoft.com/</a>) にアクセスし、ゲスト ユーザーのアカウントにてサインインを実施します。</p><p>(2) 画面右上にある組織のアイコン (下図赤丸) をクリックし、所属しているテナントの一覧から、ゲスト ユーザーとして招待されているテナントをクリックしてサインインしてください。<br> ※下図の例では、ユーザーがメンバーとして所属するテナントが「MyTenant」、ゲスト ユーザーとして招待されているテナントが「Contoso」となります。<br> <img src="/blog/azure-active-directory/b2b-mfa/2.png"></p><p>(3) 画面左側の [組織] をクリックし、ユーザーがゲストとして招待されているテナントにサインイン済みであることを確認します。<br>※サインイン状態のテナントには [サインイン済み] が表示されます。下図の例では「Contoso」にサインインしている状態です。<br> <img src="/blog/azure-active-directory/b2b-mfa/3.png"></p><p>(4) 画面左側の [セキュリティ情報] をクリックすると、ゲスト ユーザーとして招待されたテナントで登録された認証情報が確認できます。<br>必要に応じて認証方法の追加 / 変更 / 削除 をクリックして設定内容を管理することが可能です。<br>※すでに認証情報が登録されている場合は多要素認証が要求されます。<br>  <img src="/blog/azure-active-directory/b2b-mfa/4.png"></p><h2 id="3-Azure-B2B-での例外的な多要素認証の動作について"><a href="#3-Azure-B2B-での例外的な多要素認証の動作について" class="headerlink" title="3. Azure B2B での例外的な多要素認証の動作について"></a>3. Azure B2B での例外的な多要素認証の動作について</h2><p>Microsoft アカウント には、Azure AD テナントとは別に Microsoft アカウント専用の 2 段階認証 (メール等) ※4 が存在します。<br>Microsoft アカウントをゲスト ユーザーとして Azure AD テナントへ招待した場合のみ、多要素認証の実装方法 (セキュリティの既定値群、または条件付きアクセス) に依存して、Azure AD テナント側の認証方法ではなく、 Microsoft アカウント 専用の 2 段階認証 (メール等) が利用される場合があります。</p><p>・リソーステナントの多要素認証が条件付きアクセスのポリシーにて実装されている場合<br>Azure AD アカウントのゲスト ユーザーと同様、Azure AD テナントのゲスト ユーザー (emailaddress#EXT#@domain 形式の UPN) としてリソーステナントに登録されている認証方法 (電話、認証アプリなど) が利用されます。</p><p>・リソーステナントでセキュリティの既定値群を有効とされている場合<br>Microsoft アカウント 側の 2 段階認証 (メール等) の認証方法が利用されます。</p><p>もしリソーステナントのゲスト ユーザーが利用できる認証方法を統一したいなどのご要望がある場合は、条件付きアクセスのポリシーにより多要素認証が求められるように構成することをお勧めいたします。</p><p>※4 Microsoft アカウント側でも 2 段階認証を登録する必要があります。<br><a href="https://support.microsoft.com/ja-jp/account-billing/microsoft---c7910146-672f-01e9-50a0-93b4585e7eb4">https://support.microsoft.com/ja-jp/account-billing/microsoft---c7910146-672f-01e9-50a0-93b4585e7eb4</a></p><p>以上の情報がご参考になれば幸いです。<br>ご不明な点がございましたら弊社サポートまでお気軽にお寄せください。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは。 Azure Identity サポート チームです。&lt;br&gt;こちらのブログでは、 Azure AD B2B (Business-To-Business) コラボレーション機能 (以下、Azure AD B2B) の多要素認証について、下記 3 つのポイントを中</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="MFA" scheme="https://jpazureid.github.io/blog/tags/MFA/"/>
    
    <category term="Azure AD B2B" scheme="https://jpazureid.github.io/blog/tags/Azure-AD-B2B/"/>
    
  </entry>
  
  <entry>
    <title>CloudKnox Permissions Management がパブリック プレビューに</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/cloudknox-permissions-management-is-now-in-public-preview/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/cloudknox-permissions-management-is-now-in-public-preview/</id>
    <published>2022-02-26T18:00:00.000Z</published>
    <updated>2022-03-28T02:13:39.695Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、 Azure Identity サポート チームの高田です。</p><p>本記事は、 2022 年 2 月 23 日に米国の Azure Active Directory Identity Blog で公開された <a href="https://techcommunity.microsoft.com/t5/azure-active-directory-identity/cloudknox-permissions-management-is-now-in-public-preview/ba-p/2464391">CloudKnox Permissions Management is now in Public Preview</a> を意訳したものになります。ご不明点などございましたら、サポート チームまでお問い合わせください。</p><hr><p>昨年 7 月、Microsoft は <a href="https://docs.microsoft.com/azure/active-directory/cloud-infrastructure-entitlement-management">Cloud Infrastructure Entitlement Management (CIEM)</a> 分野のリーダーである CloudKnox Security の <a href="https://blogs.microsoft.com/blog/2021/07/21/microsoft-acquires-cloudknox-security-to-offer-unified-privileged-access-and-cloud-entitlement-management/">買収を発表</a> しました。当社が思い描くマルチクラウドのセキュリティの重要な取り組みとして、CloudKnox を当社のテクノロジーに統合するべく取り組んでまいりました。本日、<a href="https://microsoft.com/security/business/identity-access-management/permissions-management">CloudKnox Permissions Management</a> のパブリック プレビューを発表することができ、大変うれしく思います。</p><p>皆様もご存じのとおり、クラウドでは ID とアクセス許可の数が爆発的に増加しており、新たなセキュリティ上の課題が生まれています。社内 IT チームは、ID とそのアクセス許可を可視化することが大変難しい状況にあり、さらに増え続けるアクセス許可と利用実態の乖離に格闘している状況です。これらの課題には、完全な可視化とリスクの是正を実現する包括的な統合ソリューションが必要です。</p><p>以下では、重要なクラウド リソースを保護するために、CloudKnox Permissions Management がアクセス許可のリスクを継続的に監視して是正する方法の概要をまとめました。CloudKnox Permissions Management の詳細については、<a href="https://docs.microsoft.com/en-us/azure/active-directory/cloud-infrastructure-entitlement-management/">当社のドキュメントをご覧</a> ください。</p><h2 id="アクセス許可に関わるリスクを包括的に把握する"><a href="#アクセス許可に関わるリスクを包括的に把握する" class="headerlink" title="アクセス許可に関わるリスクを包括的に把握する"></a>アクセス許可に関わるリスクを包括的に把握する</h2><p>CloudKnox Permissions Management は、クラウド基盤全体のすべての ID とそれらに付与されたアクセス許可および実際に使用されたアクセス許可の内容を詳細に可視化することができ、これによりどの ID が何のリソースに対してどのような操作を実行したかを確認することが可能となります。これには、ユーザー ID に限らず、仮想マシン、アクセス キー、コンテナ、スクリプトなどのワークロード ID も含まれており、Amazon Web Services (AWS)、Google Cloud Platform (GCP)、Microsoft Azure の 3 つの主要クラウド プロバイダーで確認可能です。ダッシュボードでは、組織のアクセス許可状況の概要を確認し、基盤全体で最もリスクの高い ID とリソースがどこにあるのかを特定できます。これには、与えられたアクセス許可と使用されたアクセス許可との間の乖離を計算する 0 から 100 までの単一の指数である <strong>Permission Creep Index</strong> が活用いただけます。未使用のアクションや手つかずのリソースが多いほど、その乖離と指数は高くなります。</p><p>これにより、Permission Creep Index が高い特定の ID を簡単に特定し、付与されたアクセス許可と実際に使用されたアクセス許可、およびアクセス可能なリソースを確認することができます。最も高いリスクがどこにあるかを特定し、そのリスクを解消するためには、このレベルの可視化機能が必要です。</p><p><img src="/blog/azure-active-directory/cloudknox-permissions-management-is-now-in-public-preview/ck-gif-1.gif"></p><h2 id="最小特権アクセスを自動的に実現する"><a href="#最小特権アクセスを自動的に実現する" class="headerlink" title="最小特権アクセスを自動的に実現する"></a>最小特権アクセスを自動的に実現する</h2><p>基盤全体の最も重要なアクセス許可のリスクが特定できたら、CloudKnox Permissions Management により過剰なアクセス許可を適正化し、<strong>自動的に最小特権のポリシーを強制</strong> することが可能です。このソリューションは、各 ID の過去のアクセス許可の利用状況データを継続的に分析しており、その ID のアクセス許可を日々の運用に使用されている権限にのみに適正化することができます。また、未使用でリスクの高いアクセス許可はすべて削除することもできます。</p><p>ID が特定のリソースに対して特定のアクションを実行する必要がある場合、その ID はセルフサービス ワークフローを使用して、期間限定でこれらの <strong>アクセス許可を適宜要求</strong> することができます。ビルトインのワークフロー エンジンに加えて、お気に入りの ITSM ツールを使用することも可能です。ID の種類 (人に紐づくものならびに人に紐づかないもの)、ID のソース (ローカル、エンタープライズ ディレクトリ、フェデレーション)、クラウドに関係なく、同じように操作が可能です。</p><p><img src="/blog/azure-active-directory/cloudknox-permissions-management-is-now-in-public-preview/ck-gif-2.gif"></p><h2 id="異常検知を効率化してインシデント対応を加速させる"><a href="#異常検知を効率化してインシデント対応を加速させる" class="headerlink" title="異常検知を効率化してインシデント対応を加速させる"></a>異常検知を効率化してインシデント対応を加速させる</h2><p>アクセス許可の悪用や発生しうるデータ漏洩を防ぐため、<strong>機械学習を活用した異常値と特異動作の検出アラート</strong> により、疑わしい動きがあった場合に管理者に通知が可能です。また、特定のアクションやリソース、または任意の組み合わせに対してカスタム アラート トリガーを設定し、監視を自動化してインシデント レスポンスを実行することも可能です。</p><p>基盤を監視して迅速な改善をサポートするもう一つの方法として、カスタム フォレンジック レポートを生成するもできます。例えば、Permissions Analytics Report では、クラウド環境全体の主要なアクセス許可リスクの概要を確認可能です。これらのレポートは、特定のクラウド アカウントを対象にカスタマイズすることができ、事前に設定した間隔で電子メールで配信することもできます。</p><p><img src="/blog/azure-active-directory/cloudknox-permissions-management-is-now-in-public-preview/ck-gif-3.gif"></p><p>CloudKnox Permissions Management を是非お試しください。ご質問やパブリック プレビューにご興味のある方は、<a href="https://aka.ms/CloudKnoxPublicPreview">こちらのフォームにご記入</a> ください。また、2 月 24 日に開催されるイベント <a href="https://mssecurityinnovationevent.eventcore.com/?ocid=AID3043366_QSG_563806https://mssecurityinnovationevent.eventcore.com/?ocid=AID3043366_QSG_563806">What’s Next in Security</a> にて、Balaji Parimi と Joseph Dadzie がお客様を交えて講演を行いますので、こちらもお見逃しなく。</p><p>Alex Simons (Twitter: <a href="https://twitter.com/Alex_A_Simons">@Alex_A_Simons</a>)<br>Corporate Vice President<br>Microsoft Identity and Network Access Division</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、 Azure Identity サポート チームの高田です。&lt;/p&gt;
&lt;p&gt;本記事は、 2022 年 2 月 23 日に米国の Azure Active Directory Identity Blog で公開された &lt;a href=&quot;https://techco</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="US Identity Blog" scheme="https://jpazureid.github.io/blog/tags/US-Identity-Blog/"/>
    
  </entry>
  
  <entry>
    <title>よくわかるパスワード ポリシーとよくある質問</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/comprehend-password-policy/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/comprehend-password-policy/</id>
    <published>2022-02-25T16:00:00.000Z</published>
    <updated>2022-03-28T02:13:39.719Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、 Azure ID チームの小出です。</p><p>今日は、混乱しやすい Azure AD のパスワード ポリシーについて、どのユーザーにどの項目が該当するか、同期ユーザーとクラウド ユーザーの観点からそれぞれご案内します。</p><h2 id="はじめに"><a href="#はじめに" class="headerlink" title="はじめに"></a>はじめに</h2><p>多くの企業では、Azure AD Connect を使用し、オンプレミス側からユーザー アカウントを同期して Azure AD や Microsoft 365 を利用していることと思います。Azure AD には、クラウド上に直接作成したクラウド ユーザーや、ほかのテナントから招待したゲスト ユーザーなど、多くの種類のアカウントも登録されている場合もあります。</p><p>最近では、MFA などパスワード以外の方法も併用してサインインする方法も増えてきましたが、パスワードを使用して Azure AD やオンプレミス環境にサインインしている方がほとんどと思います。こうしたパスワードを利用する様々なユーザー アカウントを管理するうえで、Azure AD や Microsoft 365 の管理者は、どのユーザーにどういったパスワード ポリシーが割り当たっているか確認する必要がありますが、ユーザーの種類や環境の多さにより、どの設定が適用されているのかわかりにくい場面が多くあります。</p><p>こうしたパスワード ポリシーについて、「公開情報を確認しても混乱している、認識を確認したい」といったお問い合わせを多く頂戴していることから、今回は各設定の詳細についてご案内します。</p><p>最後の FAQ ではマイクロソフトが推奨するパスワード ポリシーについても記載してありますので併せてご覧ください。</p><h2 id="目次"><a href="#目次" class="headerlink" title="目次"></a>目次</h2><p>A. ユーザー種類別のパスワード ポリシー早見表<br>B. パスワード変更およびリセット時に評価されるポリシー (文字数と複雑性)<br>C. 認証時に評価されるポリシー (有効期限)</p><ul><li>C-1. パスワード ハッシュ同期環境の同期ユーザー    </li><li>C-2. パススルー認証や AD FS 環境などオンプレミス側で認証を行う同期ユーザー    </li><li>C-3. クラウド ユーザー    </li><li>C-4. ゲスト ユーザー</li></ul><p>D. 補足情報 (FAQ)</p><h2 id="A-ユーザー種類別のパスワード-ポリシー早見表"><a href="#A-ユーザー種類別のパスワード-ポリシー早見表" class="headerlink" title="A. ユーザー種類別のパスワード ポリシー早見表"></a>A. ユーザー種類別のパスワード ポリシー早見表</h2><p>パスワード ポリシーの詳細に入る前に、まずはパスワード ポリシー早見表をユーザー種類別に案内します。</p><p><img src="/blog/azure-active-directory/comprehend-password-policy/comprehend-password-policy1b.png"></p><h2 id="B-パスワード変更およびリセット時に評価されるポリシー-文字数と複雑性"><a href="#B-パスワード変更およびリセット時に評価されるポリシー-文字数と複雑性" class="headerlink" title="B. パスワード変更およびリセット時に評価されるポリシー (文字数と複雑性)"></a>B. パスワード変更およびリセット時に評価されるポリシー (文字数と複雑性)</h2><p>パスワードの文字数や複雑性は、同期ユーザーかクラウド ユーザーかの観点で判断することができます。同期ユーザーの文字数や複雑性のポリシーには、オンプレミス AD 側のパスワード ポリシーが適用されます。</p><h3 id="同期ユーザー"><a href="#同期ユーザー" class="headerlink" title="同期ユーザー"></a>同期ユーザー</h3><p>同期ユーザーに適用されるオンプレミス AD 側のポリシーは、有効期限と同様、[アカウント ポリシー] 内の [パスワードのポリシー] から変更できます。<br>たとえば、以下の [パスワードの長さ] を変更することで、長さを 6 文字以上などと短縮したり、 10 文字以上などより厳しいポリシーに設定したりすることも可能です。</p><p><img src="/blog/azure-active-directory/comprehend-password-policy/comprehend-password-policy2.png"></p><h3 id="クラウド-ユーザー"><a href="#クラウド-ユーザー" class="headerlink" title="クラウド ユーザー"></a>クラウド ユーザー</h3><p>クラウド ユーザーに適用される Azure AD のパスワード ポリシーは、有効期限を除いてポリシーを変更することができません。Azure AD のパスワード ポリシーの詳細は、<a href="https://docs.microsoft.com/ja-jp/azure/active-directory/authentication/concept-sspr-policy#azure-ad-password-policies">こちらの公開情報</a> もご利用ください。  </p><p>クラウド ユーザーのパスワードの複雑性 (図の△部分) については、オンプレミス側と同じような設定が用意されているわけではありませんが、グローバル禁止リスト・カスタム禁止リストの機能が用意されています。グローバル禁止リストは、どのテナントでも有効になっており、無効化することはできません。 admin や baseball などの脆弱なパスワードを排除します。カスタム禁止リストは、お客様の会社名や会社の略称などを登録し、パスワードに使用できないよう禁止する機能です。詳細につきましては、<a href="https://docs.microsoft.com/ja-jp/azure/active-directory/authentication/concept-password-ban-bad#global-banned-password-list">本公開情報</a> をご確認ください。  </p><h3 id="ゲスト-ユーザー"><a href="#ゲスト-ユーザー" class="headerlink" title="ゲスト ユーザー"></a>ゲスト ユーザー</h3><p>ゲスト ユーザーについては、ゲストがもともとメンバーとして登録されている “ホーム テナント” の設定に準じます。そのため、ゲスト ユーザーに対しどのようなポリシーが適用されているか確認したい場合は、ホーム テナント側の管理者に確認を依頼ください。</p><h2 id="C-認証時に評価されるポリシー-有効期限"><a href="#C-認証時に評価されるポリシー-有効期限" class="headerlink" title="C. 認証時に評価されるポリシー (有効期限)"></a>C. 認証時に評価されるポリシー (有効期限)</h2><p>有効期限は、1 つのパスワードを最大何日間使用できるかを指定する項目です。この期限を迎えると、ユーザーは次回サインインする際にパスワードを新しいものに変更する必要があります。有効期限について考える時は、同期ユーザー or クラウド ユーザーなのかという観点のほかに、 “オンプレミス側 or クラウド側のどちらで認証が行われているか” を考慮するとわかりやすくなります。それぞれのシナリオごとに詳細を記載しておりますので、確認されたいユーザーの種類と環境が該当する項目をご確認ください。</p><h3 id="シナリオ-C-1-パスワード-ハッシュ同期環境の同期ユーザー"><a href="#シナリオ-C-1-パスワード-ハッシュ同期環境の同期ユーザー" class="headerlink" title="シナリオ C-1: パスワード ハッシュ同期環境の同期ユーザー"></a>シナリオ C-1: パスワード ハッシュ同期環境の同期ユーザー</h3><p>同期ユーザーの場合、オンプレミス AD 側の有効期限がそのまま Azure AD 側に同期されていると誤解されていることがあります。しかしながら、同期ユーザーのパスワード有効期限は、オンプレミス AD 側と Azure AD 側のそれぞれで値を保持しています。パスワードの情報はオンプレミス AD と Azure AD の双方にあるため、「ユーザーがどこにサインインするか (どこで認証されるか)」によって、適用される有効期限が異なります。</p><p>例えば、ドメイン参加しているクライアント端末にログオンする際は、認証はオンプレミス AD にて行われるため、オンプレミス AD のパスワード有効期限が適用されます。Azure ポータルや Microsoft 365 にサインインする際は、Azure AD 側の有効期限設定が適用されます。オンプレミス AD のパスワード有効期限を迎えると、次のオンプレミス AD へのサインインの際にオンプレミス側でパスワードの変更が要求されます。パスワードを変更すると、そのパスワードが Azure AD にも反映され、新しいパスワードで Azure AD にもサインインできるようになります。</p><p>しかしながら、パスワード ハッシュ同期では、同期ユーザーの Azure AD 側のパスワード有効期限は無期限とするよう個別に設定されています。このため、オンプレミス AD のパスワード有効期限が切れたあとも、オンプレミス側で有効期限切れのパスワードにて Azure AD 側にサインインできます。オンプレミス側で新しいパスワードに変更し、それが Azure AD に同期されると、Azure AD にその新しいパスワードでサインイン可能となります。オンプレミス側で有効期限が切れているパスワードで Azure AD にサインインさせたくない場合は、EnforceCloudPasswordPolicyForPasswordSyncedUsers のオプションをオンにして、 Azure AD 側のパスワード ポリシーを無期限にしないよう設定します (詳細を補足 D にて記載しています)。</p><h3 id="シナリオ-C-2-パススルー認証や-AD-FS-環境などオンプレミス側で認証を行う同期ユーザー"><a href="#シナリオ-C-2-パススルー認証や-AD-FS-環境などオンプレミス側で認証を行う同期ユーザー" class="headerlink" title="シナリオ C-2: パススルー認証や AD FS 環境などオンプレミス側で認証を行う同期ユーザー"></a>シナリオ C-2: パススルー認証や AD FS 環境などオンプレミス側で認証を行う同期ユーザー</h3><p>パススルー認証や AD FS を利用している場合、Azure ポータルや Microsoft 365 にサインインする際の認証は Azure AD ではなく、オンプレミス AD にて行われます。そのため、Azure ポータルにサインインした際などにも、適用されるのはオンプレミス AD の有効期限ポリシーです。</p><p>また、パスワードの有効期限を確認したい場合は、オンプレミス AD のパスワード ポリシーを確認します。オンプレミス AD のパスワード ポリシーは、グループ ポリシー管理コンソールより Default Domain Policy を編集し、[アカウント ポリシー] - [パスワード ポリシー] を開くことで確認できます。</p><p>なお、アカウント ポリシーは、ドメインにリンクされた 1 つの GPO でのみ定義することが可能です。そのため、以下のように Default Domain Policy を編集して設定ください。</p><p><img src="/blog/azure-active-directory/comprehend-password-policy/comprehend-password-policy3.png"></p><h3 id="シナリオ-C-3-Azure-AD-に直接作成したクラウド-ユーザーの場合"><a href="#シナリオ-C-3-Azure-AD-に直接作成したクラウド-ユーザーの場合" class="headerlink" title="シナリオ C-3: Azure AD に直接作成したクラウド ユーザーの場合"></a>シナリオ C-3: Azure AD に直接作成したクラウド ユーザーの場合</h3><p>Azure AD で直接作成したクラウド ユーザーに対しては、パスワードの有効期限として Azure AD のパスワード ポリシーで指定された日数が適用されます。この日数を過ぎると、Azure AD にサインインする際にパスワードの変更要求が表示されます。</p><p>Azure AD のパスワード有効期限は、Microsoft 365 管理センターもしくは PowerShell から変更可能です。手順は以下のとおりです。</p><ol><li>Microsoft 365 管理センターを開きます。</li><li>[設定] - [組織設定] - [セキュリティとプライバシー] タブ内の [パスワードの有効期限ポリシー] を選択します。<br><img src="/blog/azure-active-directory/comprehend-password-policy/comprehend-password-policy4.png"></li><li>設定値を確認します。以下の画像では、パスワードの有効期限が 90 日に設定されています。<br><img src="/blog/azure-active-directory/comprehend-password-policy/comprehend-password-policy5.png"></li><li>パスワードの有効期限を無期限にしたい場合は、以下のようにチェックボックスをオフにします。<br><img src="/blog/azure-active-directory/comprehend-password-policy/comprehend-password-policy6.png"></li></ol><div class="alert is-success"><p class="alert-title">ヒント</p><p>上記の設定でパスワード有効期限を 90 日などに設定している環境でも、システム用アカウントなど、一部のユーザーだけ無期限にしたいシナリオがあるかと思います。</p><p>この場合は、上記の設定に加え、そのアカウントに対してのみ Set-AzureADUser コマンドで DisablePasswordExpiration を設定することで、個別に無期限にできます。</p><p>詳細は、<a href="https://docs.microsoft.com/ja-jp/microsoft-365/admin/add-users/set-password-to-never-expire?view=o365-worldwide">個別のユーザーのパスワードを無期限に設定する</a> の情報をご確認ください。  </p></div><h3 id="シナリオ-C-4-ゲスト-ユーザー"><a href="#シナリオ-C-4-ゲスト-ユーザー" class="headerlink" title="シナリオ C-4: ゲスト ユーザー"></a>シナリオ C-4: ゲスト ユーザー</h3><p>ゲスト ユーザーのパスワード有効期限は、ゲストがもともと登録されているホーム テナントの組織で管理されています。そのため、ゲストを招待したテナント側 (リソース テナント側) では管理する必要がなく、ホーム テナント側の組織の設定を確認します。ゲスト ユーザーが <a href="mailto:&#x75;&#x73;&#101;&#114;&#64;&#111;&#117;&#x74;&#x6c;&#111;&#x6f;&#107;&#x2e;&#x63;&#111;&#x6d;">&#x75;&#x73;&#101;&#114;&#64;&#111;&#117;&#x74;&#x6c;&#111;&#x6f;&#107;&#x2e;&#x63;&#111;&#x6d;</a> などの Microsoft アカウントの場合は、各サービスで定義されているパスワード ポリシーが適用されます。</p><h2 id="D-補足情報-FAQ"><a href="#D-補足情報-FAQ" class="headerlink" title="D. 補足情報 (FAQ)"></a>D. 補足情報 (FAQ)</h2><p>パスワード ポリシー関連でよくある質問をおまとめしております。  </p><h3 id="Q-パスワード-ハッシュ同期の環境で、オンプレミス-AD-側の有効期限が切れたときに、-Azure-AD-側に引き続き古いパスワードでアクセスできてしまいます。同期ユーザーの-Azure-AD-側のパスワードの有効期限を無期限から変更することはできますか。"><a href="#Q-パスワード-ハッシュ同期の環境で、オンプレミス-AD-側の有効期限が切れたときに、-Azure-AD-側に引き続き古いパスワードでアクセスできてしまいます。同期ユーザーの-Azure-AD-側のパスワードの有効期限を無期限から変更することはできますか。" class="headerlink" title="Q: パスワード ハッシュ同期の環境で、オンプレミス AD 側の有効期限が切れたときに、 Azure AD 側に引き続き古いパスワードでアクセスできてしまいます。同期ユーザーの Azure AD 側のパスワードの有効期限を無期限から変更することはできますか。"></a><span style="color: blue; ">Q:</span> パスワード ハッシュ同期の環境で、オンプレミス AD 側の有効期限が切れたときに、 Azure AD 側に引き続き古いパスワードでアクセスできてしまいます。同期ユーザーの Azure AD 側のパスワードの有効期限を無期限から変更することはできますか。</h3><p><span style="color: red; ">A:</span> はい、テナント側の EnforceCloudPasswordPolicyForPasswordSyncedUsers オプションを適用することで可能です。 Azure AD 側からパスワードを変更するためには、Azure AD Connect でパスワード ライトバックを有効にする必要もあります。</p><p>以下のコマンドを実行すると、Azure AD 側のユーザーにもパスワード有効期限を設定することができます。</p><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Set-MsolDirSyncFeature</span> <span class="literal">-Feature</span> EnforceCloudPasswordPolicyForPasswordSyncedUsers <span class="literal">-Enable</span> <span class="variable">$true</span></span><br></pre></td></tr></table></figure><div class="alert is-warning"><p class="alert-title">警告</p><p>同期ユーザーのパスワード有効期限自体は、オンプレミス側から Azure AD 側に同期されていません。</p><p>この機能を有効にすると、オンプレミス側にサインインする際はオンプレミス側のポリシー、 Azure AD 側で認証を行う際は Azure AD 側のポリシーが適用されることとなり、ユーザーが “どこにサインインするか” で適用される有効期限ポリシーが変わります。</p><p>オンプレミスと Azure AD の各ポリシーで異なるパスワード有効期限の日数 (例: オンプレミス側ポリシーは 30 日、Azure AD 側は 90 日) を設定していると、パスワードがいつ有効期限切れとなるかがわかりにくくなるため、オンプレミス側のポリシーと Azure AD 側のポリシーで設定する有効期限は、同じ日数にすることをお勧めします。</p><p>たとえば、オンプレミスと Azure AD の両方のポリシーで 90 日後にパスワードを変更するように設定されていれば、ほぼ同じタイミングで両方のパスワードが期限切れとなる動作となります。</p><p>また、オンプレミス側もしくは Azure AD 側のどちらかでパスワードを変更すれば、パスワードハッシュ同期およびパスワード ライトバック機能により変更内容が同期され、経過日数がリセットされます。</p></div><h3 id="Q-次回ログオン時にパスワードの変更が必要-をオンプレミス側で設定すると、Azue-AD-側にサインインした時に-“パスワードが間違っている”-旨のエラーが表示されてしまいます。Azure-AD-側で一時パスワードから新しいものに変更させることはできますか"><a href="#Q-次回ログオン時にパスワードの変更が必要-をオンプレミス側で設定すると、Azue-AD-側にサインインした時に-“パスワードが間違っている”-旨のエラーが表示されてしまいます。Azure-AD-側で一時パスワードから新しいものに変更させることはできますか" class="headerlink" title="Q:  [次回ログオン時にパスワードの変更が必要] をオンプレミス側で設定すると、Azue AD 側にサインインした時に “パスワードが間違っている” 旨のエラーが表示されてしまいます。Azure AD 側で一時パスワードから新しいものに変更させることはできますか?"></a><span style="color: blue; ">Q:</span>  [次回ログオン時にパスワードの変更が必要] をオンプレミス側で設定すると、Azue AD 側にサインインした時に “パスワードが間違っている” 旨のエラーが表示されてしまいます。Azure AD 側で一時パスワードから新しいものに変更させることはできますか?</h3><p><span style="color: red; ">A:</span> はい、テナント側の ForcePasswordChangeOnLogOn オプションを有効化することで可能です。 Azure AD 側からパスワードを変更するために、Azure AD Connect でパスワード ライトバックの機能を有効に設定ください。</p><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Set-ADSyncAADCompanyFeature</span> <span class="literal">-ForcePasswordChangeOnLogOn</span> <span class="variable">$true</span></span><br></pre></td></tr></table></figure><p>既定では上記機能は無効のため、事前にオンプレミス側でパスワードを変更しないと、以下のようにエラーになってしまいます。上記のコマンドを実行すると、Azure AD 側で新しいパスワードへの変更要求画面が表示されるようになります。この機能については、<a href="https://docs.microsoft.com/ja-jp/azure/active-directory/hybrid/how-to-connect-password-hash-synchronization#enforcecloudpasswordpolicyforpasswordsyncedusers">公開情報の記載</a> もご確認ください。</p><p><img src="/blog/azure-active-directory/comprehend-password-policy/comprehend-password-policy7.png">  </p><h3 id="Q-Microsoft-365-管理センターで確認できるパスワード有効期限の既定値は何日ですか？"><a href="#Q-Microsoft-365-管理センターで確認できるパスワード有効期限の既定値は何日ですか？" class="headerlink" title="Q: Microsoft 365 管理センターで確認できるパスワード有効期限の既定値は何日ですか？"></a><span style="color: blue; ">Q:</span> Microsoft 365 管理センターで確認できるパスワード有効期限の既定値は何日ですか？</h3><p><span style="color: red; ">A:</span> 以前は 90 日に設定されていましたが、 2021 年の春頃以降新しく作成されたテナントは、既定値が無期限となりました (そのため、既定値が無期限のテナントと、 90 日のテナントがあります)。</p><h3 id="Q-Azure-AD-のパスワード-ポリシーがいつのまにか無期限になっています。誰が変更したか確認する方法はありますか？"><a href="#Q-Azure-AD-のパスワード-ポリシーがいつのまにか無期限になっています。誰が変更したか確認する方法はありますか？" class="headerlink" title="Q: Azure AD のパスワード ポリシーがいつのまにか無期限になっています。誰が変更したか確認する方法はありますか？"></a><span style="color: blue; ">Q:</span> Azure AD のパスワード ポリシーがいつのまにか無期限になっています。誰が変更したか確認する方法はありますか？</h3><p><span style="color: red; ">A:</span> 直近でポリシーが変更されている場合は、Azure AD の監査ログで確認することが可能です。Set password policy のアクティビティでフィルターをかけたのちに、開始者（アクター）に記載のユーザーを確認ください。</p><h3 id="Q-PowerShell-で-Get-MsolPasswordPolicy-コマンドを実行し、テナントに設定されているパスワード有効期限を調べました。2147483647-日と表示されるのですが、どのような意味ですか？"><a href="#Q-PowerShell-で-Get-MsolPasswordPolicy-コマンドを実行し、テナントに設定されているパスワード有効期限を調べました。2147483647-日と表示されるのですが、どのような意味ですか？" class="headerlink" title="Q: PowerShell で Get-MsolPasswordPolicy コマンドを実行し、テナントに設定されているパスワード有効期限を調べました。2147483647 日と表示されるのですが、どのような意味ですか？"></a><span style="color: blue; ">Q:</span> PowerShell で Get-MsolPasswordPolicy コマンドを実行し、テナントに設定されているパスワード有効期限を調べました。2147483647 日と表示されるのですが、どのような意味ですか？</h3><p><span style="color: red; ">A:</span> テナントのパスワード有効期限が無期限になっていることを示しています。  </p><h3 id="Q-Microsoft-365-管理センターや-PowerShell-からパスワード-ポリシーを編集しましたが、期限切れの通知が来ません。"><a href="#Q-Microsoft-365-管理センターや-PowerShell-からパスワード-ポリシーを編集しましたが、期限切れの通知が来ません。" class="headerlink" title="Q: Microsoft 365 管理センターや PowerShell からパスワード ポリシーを編集しましたが、期限切れの通知が来ません。"></a><span style="color: blue; ">Q:</span> Microsoft 365 管理センターや PowerShell からパスワード ポリシーを編集しましたが、期限切れの通知が来ません。</h3><p><span style="color: red; ">A:</span> 以前は Microsoft 365 ポータルの右上にベル アイコンが表示されていましたが、通知設定自体が廃止されたため、”もうすぐ期限切れ” の通知は現在送信されません。</p><h3 id="Q-Azure-AD-Join-している端末にサインインしています。パスワードが切れているのに、端末にサインインできてしまうのですが、いつパスワード変更が求められますか？"><a href="#Q-Azure-AD-Join-している端末にサインインしています。パスワードが切れているのに、端末にサインインできてしまうのですが、いつパスワード変更が求められますか？" class="headerlink" title="Q: Azure AD Join している端末にサインインしています。パスワードが切れているのに、端末にサインインできてしまうのですが、いつパスワード変更が求められますか？"></a><span style="color: blue; ">Q:</span> Azure AD Join している端末にサインインしています。パスワードが切れているのに、端末にサインインできてしまうのですが、いつパスワード変更が求められますか？</h3><p><span style="color: red; ">A:</span> 端末にログオンし、Windows のデスクトップを表示するところまでは、パスワードが切れていても実施できます。Azure ポータルや Microsoft 365 管理センター、Exchange Online など Azure AD と連携するクラウド上のリソースにサインインした時にパスワード変更が求められます。 </p><p>端末に UPN (例: <a href="mailto:&#x75;&#x73;&#x65;&#x72;&#64;&#x63;&#x6f;&#110;&#x74;&#x6f;&#x73;&#x6f;&#x2e;&#111;&#110;&#x6d;&#105;&#x63;&#x72;&#111;&#x73;&#x6f;&#x66;&#116;&#x2e;&#99;&#x6f;&#x6d;">&#x75;&#x73;&#x65;&#x72;&#64;&#x63;&#x6f;&#110;&#x74;&#x6f;&#x73;&#x6f;&#x2e;&#111;&#110;&#x6d;&#105;&#x63;&#x72;&#111;&#x73;&#x6f;&#x66;&#116;&#x2e;&#99;&#x6f;&#x6d;</a>) などでサインインした場合には、端末ログオン後、右下に以下のメッセージが表示される動作を現時点で確認しております。こちらもパスワード変更の際の目安となりましたら幸いです。</p><p><img src="/blog/azure-active-directory/comprehend-password-policy/comprehend-password-policy8.png"></p><h3 id="Q-テナントに設定されている値ではなく、各ユーザーのパスワード有効期限を知りたいです。方法はありますか？"><a href="#Q-テナントに設定されている値ではなく、各ユーザーのパスワード有効期限を知りたいです。方法はありますか？" class="headerlink" title="Q: テナントに設定されている値ではなく、各ユーザーのパスワード有効期限を知りたいです。方法はありますか？"></a><span style="color: blue; ">Q:</span> テナントに設定されている値ではなく、各ユーザーのパスワード有効期限を知りたいです。方法はありますか？</h3><p><span style="color: red; ">A:</span> Azure ポータル上から簡単に確認することはできません。 PowerShell で取得した値をもとに計算ください。  </p><p>テナントに設定されている有効期限を確認するには以下のように実施ください。</p><ol><li>Connect-MsolService コマンドを実行します。</li><li>Get-Msoldomain コマンドを実行し、正しいテナントに接続できているか確認します。</li><li>下記のコマンドを実行し、テナントのパスワード有効期限ポリシーを確認します。この例では、パスワードの有効期限が切れるまでの日数（ValidityPeriod）は 90 日となります。</li></ol><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Get-MsolPasswordPolicy</span> <span class="literal">-DomainName</span> contoso.onmicrosoft.com</span><br></pre></td></tr></table></figure><p>例として、以下のようにコマンド実行結果が表示されます。</p><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">ExtensionData                                    NotificationDays ValidityPeriod</span><br><span class="line">-------------                                    ---------------- --------------  </span><br><span class="line">System.Runtime.Serialization.ExtensionDataObject               <span class="number">14</span>             <span class="number">90</span></span><br></pre></td></tr></table></figure><p>ユーザーが最後にパスワードを変更した日時を取得するには以下のようにします。</p><ol start="4"><li>引き続き、PowerShell より以下のコマンドを実行します。  </li></ol><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Get-MsolUser</span> <span class="literal">-UserPrincipalName</span> user@contoso.onmicrosoft.com | <span class="built_in">ft</span> UserPrincipalName, LastPasswordChangeTimestamp</span><br></pre></td></tr></table></figure><p>コマンドの実行結果の例は以下のとおりです。</p><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">UserPrincipalName                   LastPasswordChangeTimestamp</span><br><span class="line">-----------------                   --------------------------- </span><br><span class="line">user@consoto.onmicrosoft.com        <span class="number">2021</span>/<span class="number">02</span>/<span class="number">02</span> <span class="number">16</span>:<span class="number">11</span>:<span class="number">54</span></span><br></pre></td></tr></table></figure><ol start="5"><li>現在の日付を確認し、パスワードを最後に変更した日付とパスワード有効期限の日数と比較し、有効期限を確認します。</li></ol><h3 id="Q-“パスワードの変更”-と”パスワード-リセット”-は同じ意味ですか？どのような違いがありますか？"><a href="#Q-“パスワードの変更”-と”パスワード-リセット”-は同じ意味ですか？どのような違いがありますか？" class="headerlink" title="Q: “パスワードの変更” と”パスワード リセット” は同じ意味ですか？どのような違いがありますか？"></a><span style="color: blue; ">Q:</span> “パスワードの変更” と”パスワード リセット” は同じ意味ですか？どのような違いがありますか？</h3><p><span style="color: red; ">A:</span> パスワードの管理において混乱しやすいポイントの一つですが、パスワードの変更とリセットには、以下のような違いがあります。  </p><p><img src="/blog/azure-active-directory/comprehend-password-policy/comprehend-password-policy9.png"></p><p>パスワードの変更は、ユーザーが現在のパスワードを知っている場合に、ユーザーが自ら新しいパスワードに変更するものです。変更を行う際は、現在のパスワード (古いパスワード) を入力する必要があります。<br>たとえば、下記の要求画面もパスワード変更に該当します。</p><p><img src="/blog/azure-active-directory/comprehend-password-policy/comprehend-password-policy10.png">  </p><p>また、パスワードの有効期限が切れていない状態でも、以下のように、マイ アカウントの画面からパスワードを明示的に変更することが可能です。</p><p><img src="/blog/azure-active-directory/comprehend-password-policy/comprehend-password-policy11.png"></p><p>一方、パスワードのリセットは、ユーザーが現在のパスワードを必ずしも知っている必要はありません。パスワードを知っている場合でもリセットを行うことはできますが、パスワードがわからない、忘れた場合などにリセットを行うシナリオが一般的です (その他、発生したリスクへの対応を行うために、パスワードのリセットが必要なシナリオなどもあります)。</p><p>ユーザーが自身でパスワードのリセットを行う際は、以下のように、[アカウントを回復する] の画面が表示されます。</p><p><img src="/blog/azure-active-directory/comprehend-password-policy/comprehend-password-policy12.png"></p><h3 id="Q-ユーザーに-“パスワードの変更”-をさせない方法はありますか？"><a href="#Q-ユーザーに-“パスワードの変更”-をさせない方法はありますか？" class="headerlink" title="Q: ユーザーに “パスワードの変更” をさせない方法はありますか？"></a><span style="color: blue; ">Q:</span> ユーザーに “パスワードの変更” をさせない方法はありますか？</h3><p><span style="color: red; ">A:</span> いいえ、ユーザーは自身のパスワードをいつでも変更できます。 ユーザー自身がパスワードをリセットする SSPR の機能は、管理者が無効にすることもできます。  </p><h3 id="Q-特定の文字列をパスワードに使用させたくありません。何か方法はありますか？"><a href="#Q-特定の文字列をパスワードに使用させたくありません。何か方法はありますか？" class="headerlink" title="Q: 特定の文字列をパスワードに使用させたくありません。何か方法はありますか？"></a><span style="color: blue; ">Q:</span> 特定の文字列をパスワードに使用させたくありません。何か方法はありますか？</h3><p><span style="color: red; ">A:</span> 会社名などをパスワードに入れることを禁止したい場合は、カスタム禁止パスワード リストに文字列を追加ください。なお、Admin や Password など明らかに脆弱なパスワードは、グローバル禁止リストで拒否されているため、別途の登録は不要です (グローバル禁止リストは、全テナントに自動で適用されているリストです。具体的な禁止リストの一覧はセキュリティ上公開できません)。</p><h3 id="Q-グローバル禁止リストやカスタム禁止パスワードはいつ評価されますか？"><a href="#Q-グローバル禁止リストやカスタム禁止パスワードはいつ評価されますか？" class="headerlink" title="Q: グローバル禁止リストやカスタム禁止パスワードはいつ評価されますか？"></a><span style="color: blue; ">Q:</span> グローバル禁止リストやカスタム禁止パスワードはいつ評価されますか？</h3><p><span style="color: red; ">A:</span> パスワード変更時およびリセット時に評価されます。ただし、カスタム禁止リストに登録したワードであっても、<a href="https://docs.microsoft.com/ja-jp/azure/active-directory/authentication/concept-password-ban-bad#how-are-passwords-evaluated">公開情報</a> に記載のパスワード評価の結果によっては、パスワードが受け入れられる可能性があります。  </p><h3 id="Q-同期ユーザーが-Azure-AD-側からパスワードを変更しようとしています。毎回「数分お待ちください」-の画面が表示されるのですが、なぜですか？"><a href="#Q-同期ユーザーが-Azure-AD-側からパスワードを変更しようとしています。毎回「数分お待ちください」-の画面が表示されるのですが、なぜですか？" class="headerlink" title="Q: 同期ユーザーが Azure AD 側からパスワードを変更しようとしています。毎回「数分お待ちください」 の画面が表示されるのですが、なぜですか？"></a><span style="color: blue; ">Q:</span> 同期ユーザーが Azure AD 側からパスワードを変更しようとしています。毎回「数分お待ちください」 の画面が表示されるのですが、なぜですか？</h3><p><span style="color: red; ">A:</span> Azure AD のパスワード ポリシーを満たしていないものの、オンプレミス AD のパスワード ポリシーを満たしているパスワードを指定しているためです。たとえば、オンプレミス AD のパスワード ポリシーで、文字数を 7 文字以下にしていたり、複雑性の設定を無効にしていたりする場合に発生します。  </p><p>同期ユーザーのパスワード ポリシーは、基本的にオンプレミス側の設定で制御していますが、パスワード変更およびリセットを Azure AD 側から行う場合は、Azure AD 側でもポリシーのチェックが行われています。Azure AD のパスワード ポリシーも満たすようなパスワードに変更した場合 (例: 8 文字以上、大文字・小文字・数字・記号のうち 3 つ以上使うなど）は、即座に Azure AD 側のパスワードが変更されるため、「数分お待ちください」の画面は表示されません。  </p><p>しかしながら、オンプレミス AD 側のポリシーが Azure AD のポリシーより「緩く」設定されている環境で、オンプレミス側のポリシーのみを満たすパスワードに変更すると、この Azure AD 側のチェックをパスせず、 Azure AD 側のパスワードを直接変更することができません。オンプレミス側ではパスワードが受け入れられているため、 Azure AD Connect 経由でパスワード ハッシュ同期 (2 分毎) が行われると、Azure AD 側でも新しいパスワードに正常に変更されます。特にエラー メッセージではないため対処の必要はありませんが、次回のパスワード ハッシュ同期までの最大 2 分程度、パスワードが完全に反映されるまでに時間がかかる点にご留意ください。</p><h3 id="Q-マイクロソフトが推奨するパスワード-ポリシーはありますか？"><a href="#Q-マイクロソフトが推奨するパスワード-ポリシーはありますか？" class="headerlink" title="Q: マイクロソフトが推奨するパスワード ポリシーはありますか？"></a><span style="color: blue; ">Q:</span> マイクロソフトが推奨するパスワード ポリシーはありますか？</h3><p>マイクロソフトが推奨するパスワード ポリシーは、<a href="https://docs.microsoft.com/ja-jp/microsoft-365/admin/misc/password-policy-recommendations?view=o365-worldwide">パスワード ポリシーの推奨事項</a> にまとめられています。以下に概要をおまとめします。</p><ul><li>最小文字数を 8 桁にする</li><li>文字構成 (複雑さ) の要件を求めない (たとえば、*&amp;(^%$ などを必須としない)</li><li>ユーザーに定期的なパスワード変更を求めない</li><li>よく使われるパスワードの文字列を禁止する</li><li>業務以外の目的で組織のパスワードを再利用しない</li></ul><p>頻繁なパスワード変更や記号を用いた複雑なパスワードを強制したいというお客様は少なくありません。しかしながらそのような厳しいポリシーでは反対にセキュリティが低下することが研究により明らかになっています。これは、ユーザーが似たパスワードを使いまわしたり、推測しやすいパスワードを使う傾向にあるためです。頻繁なパスワード変更や記号を用いた複雑なパスワードを強制するという古い常識にとらわれず、上記資料をベースにした適切なパスワード管理に取り組んでいただければ幸いです。</p><p>Azure AD ではパスワードを利用しないサインインも推奨しておりますので、<a href="https://docs.microsoft.com/ja-jp/azure/active-directory/authentication/concept-authentication-passwordless">Azure AD のパスワードレス認証</a> についても今後ご検討いただければと思います。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、 Azure ID チームの小出です。&lt;/p&gt;
&lt;p&gt;今日は、混乱しやすい Azure AD のパスワード ポリシーについて、どのユーザーにどの項目が該当するか、同期ユーザーとクラウド ユーザーの観点からそれぞれご案内します。&lt;/p&gt;
&lt;h2 id=&quot;はじめに&quot;</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="SSPR" scheme="https://jpazureid.github.io/blog/tags/SSPR/"/>
    
    <category term="Password Policy" scheme="https://jpazureid.github.io/blog/tags/Password-Policy/"/>
    
  </entry>
  
  <entry>
    <title>Deep dive - Azure AD Kerberos の仕組み</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/how-azuread-kerberos-works/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/how-azuread-kerberos-works/</id>
    <published>2022-02-25T15:00:00.000Z</published>
    <updated>2022-03-28T02:13:39.787Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、 Azure Identity サポート チームの小出です。</p><p>本記事は、 2022 年 1 月 25 日に米国の ITOps Talk Blog で公開された <a href="https://techcommunity.microsoft.com/t5/itops-talk-blog/deep-dive-how-azure-ad-kerberos-works/ba-p/3070889">Deep dive: How Azure AD Kerberos works</a> を意訳したものになります。ご不明点などございましたら、サポート チームまでお問い合わせください。</p><hr><p>Active Directory (AD DS) と Azure Active Directory (Azure AD) の違いを調べたことがあれば、Active Directory は Kerberos 認証プロトコルをサポートしている一方、Azure Active Directory ではサポートしていないことに気がつくはずです。</p><p>Kerberos は、Active Directory ドメイン コントローラーでアカウントを認証するために使用されています。このおかげで、SMB プロトコルにて Windows Server 上のファイル共有にアクセスすることができます。これはほんの一例で、あなたの組織が昔作成したものも含め、多くのアプリケーションが Kerberos 認証に依存しています。ローカル Windows へのログオン プロセスがどのように動作しているかや、いつ、どのように Kerberos が動作するかなどの詳細については、<a href="https://techcommunity.microsoft.com/t5/itops-talk-blog/deep-dive-logging-on-to-windows/ba-p/2420705?WT.mc_id=modinfra-54539-socuff">Deep dive: Logging on to Windows</a> をご覧ください。</p><p>Kerberos 認証や、古いアプリケーション用に Windows Server を Azure 上でホストする場合、Azure Active Directory Domain Services (Azure AD DS) のマネージド ドメインを作成することになります。このディレクトリは、Azure AD からアカウントを同期しますが、同時に Azure AD 上のアカウントはオンプレミスの Active Directory ドメインから同期されているものの可能性もあります。これにより、Azure 上に Active Directory ドメイン コントローラーを導入することなく、Azure 仮想マシンをドメイン参加させ、グループ ポリシーを適用できるようになります。Azure AD DS にはいくつかの制限がありますが、これが Azure で Kerberos をサポートするための標準的な方法になります。</p><p><img src="/blog/azure-active-directory/how-azuread-kerberos-works/how-azuread-kerberos-works1.png" alt="Active Directory、Azure Active Directory、Azure AD Domain Servicesのハイブリッド環境">  </p><p><a href="https://docs.microsoft.com/ja-jp/azure/active-directory-domain-services/overview?WT.mc_id=modinfra-54539-socuff">Azure AD DS についての詳細はこちらへ</a></p><p>アプリケーションを刷新するために他の選択肢がない場合や、そのための時間を確保できない場合にのみ、この方法を取ることをお勧めします。<a href="https://syfuhs.net/why-we-built-azure-ad-kerberos">Why We Built Azure AD Kerberos</a> の中で、Steve Syfuhs 氏は、「Active Directory で使われている Kerberos はパスワードに依存しており、FIDO や多要素認証、条件付きアクセスのような機能をサポートしていない」と述べています。オンプレミスでこれらの機能の一部をサポートするソリューションもありますが、Azure AD のチェックボックスを選択して構成するのに比べると複雑な方法になります。</p><h2 id="具体的な使用例として-Azure-Virtual-Desktop-用の-FSLogix-を使用したプロファイル-コンテナについて見てみる"><a href="#具体的な使用例として-Azure-Virtual-Desktop-用の-FSLogix-を使用したプロファイル-コンテナについて見てみる" class="headerlink" title="具体的な使用例として Azure Virtual Desktop 用の FSLogix を使用したプロファイル コンテナについて見てみる"></a>具体的な使用例として Azure Virtual Desktop 用の FSLogix を使用したプロファイル コンテナについて見てみる</h2><p>仮想デスクトップやリモート デスクトップの世界では、複数の人が 1 つのサーバーにログオンして、自分だけの一時的なリモート セッションを利用できるサービスが存在します。既定のデスクトップ設定やアイコンを設定でき、PC 上で実行しているのと同じようにアプリケーションを実行できます。これは、すべてのコンピューターのローカルにインストールして実行させたくないような、ブラウザー以外の業務用アプリケーションへのアクセスを集中管理するのに非常に便利なものです。マイクロソフトは、1996 年に Windows NT 4.0 Terminal Server Edition で “リモート デスクトップ サービス” をリリースして以来、このような仮想化を提供してきました。</p><p>ユーザーが Windows デスクトップにログインするにあたり、ユーザー プロファイルという概念が生まれました。これは、デスクトップの背景色、スクリーン セーバー、オート コンプリートの項目などを含む、そのユーザー用の環境設定です。ローカル コンピューターでは、そのユーザー プロファイルはローカル ディスクに保存されます。「移動ユーザー プロファイル」を設定した場合、これらの設定は代わりにサーバーに保存され、ネットワーク ドライブのファイル共有 (通常はユーザーの「ホーム」ドライブと呼ばれます) にマッピングされますので、ドメインに参加している組織内のどのコンピューターにログオンしても、これらの設定が適用されます。</p><p>FSLogix は、特に非永続的な仮想環境 (仮想デスクトップ) のユーザー プロファイルをネットワーク共有の場所に保持し、同時にプロファイルがネットワーク共有にあることをアプリから見てわからなくするように設計されています。このように透過的なプロファイル構成を実現することは、ユーザー プロファイルをローカルに保存する必要がある一部のアプリケーションにとって重要です。</p><p>つまり、仮想デスクトップ環境が Azure Virtual Desktop で、ユーザー プロファイルをファイル共有に置きたい場合、Azure Files のようなものを使えばよいということになります。Azure Files は SMB ファイル共有プロトコルをサポートしているので、Windows PC から Azure Files に接続することができます。少し設定するだけで、Windows クライアントが Active Directory で認証したときに受け取ったチケットを Azure Files が解読し、受けつけてくれるからです。</p><p>Azure Virtual Desktop がドメイン参加もしくは Azure AD 参加している場合、VPN 経由で Active Directory ドメイン コントローラーにアクセスできるよう構成されているか、Azure の仮想マシンとして動作している Active Directory ドメイン コントローラに接続できるかしない限り、Azure Virtual Desktop はユーザーを認証することができません。こういった様々な基盤への依存や管理を減らそうとしているのに、反対に依存関係が増えることになってしまいます。これを解決するために、ID チームは FIDO とのハイブリッド認証に使用される Ticket-Granting Ticket (TGT) について着目しました。</p><h2 id="認証プロセス"><a href="#認証プロセス" class="headerlink" title="認証プロセス"></a>認証プロセス</h2><p>認証に関してどのくらいの知識があるかにもよりますが、参考としてこの 2 つの記事を読み返してみるのがおすすめです。</p><p><a href="https://techcommunity.microsoft.com/t5/itops-talk-blog/deep-dive-logging-on-to-windows/ba-p/2420705?WT.mc_id=modinfra-54539-socuff">Deep dive: Logging on to Windows</a><br><a href="https://techcommunity.microsoft.com/t5/itops-talk-blog/deep-dive-windows-hybrid-join-single-sign-on-to-azure-active/ba-p/2602107">Deep dive: Windows hybrid join single-sign on to Active Directory</a>  </p><p> 下の図は、Windows Local Security Authority が認証情報を保持していることを通知し、どの認証パッケージが Azure AD に対応しているかを確認し、さらに Cloud Authentication Provider パッケージ (CloudAP) が応答して AAD プラグインを使用し、OAuth プロトコルを使って Azure AD と通信しているところを示しています。  </p><p>ユーザーの認証情報が検証されると、OAuth Primary Refresh Token (PRT) が発行されます。この PRT は、特定のデバイス上の特定のユーザーに対して発行され、デバイス ID とセッション キーが含まれています。</p><p><img src="/blog/azure-active-directory/how-azuread-kerberos-works/how-azuread-kerberos-works2.png" alt="Azure Active Directory から OAuth PRT を取得する Windows ローカルセキュリティ権限">  </p><h2 id="Titkcet-Granting-Ticket-と-Realm"><a href="#Titkcet-Granting-Ticket-と-Realm" class="headerlink" title="Titkcet Granting Ticket と Realm"></a>Titkcet Granting Ticket と Realm</h2><p>Kerberos は PRT を使用せず、TGT (Ticket Granting Tickets - 特に krbtgt) を使用します。  </p><p>Microsoft は、<a href="https://techcommunity.microsoft.com/t5/itops-talk-blog/deep-dive-windows-hybrid-join-single-sign-on-to-azure-active/ba-p/2602107">FIDO セキュリティ キーの認証プロセスに、クラウドが発行した特別な Kerberos TGT</a> を使用する機能を追加しました。しかし、この機能では依然としてオンプレミスのサーバーを参照して、クラウドから発行された kerberos TGT を完全なオンプレミス TGT と交換する必要があります。必要とするすべてのコンポーネントが用意されているわけではないため、チームはクラウド TGT を開発したというわけです。</p><h2 id="Azure-AD-の-Kerberos-認証プロセス"><a href="#Azure-AD-の-Kerberos-認証プロセス" class="headerlink" title="Azure AD の Kerberos 認証プロセス"></a>Azure AD の Kerberos 認証プロセス</h2><p>Windows は Azure AD と認証し、PRT と クラウド TGT (FIDO キーでログオンした場合は、さらに Patrtial TGT) を取得します。 ここでの課題は、プライマリ TGT は、1 つのレルム (オンプレミス AD) に対して 1 つだけ持つことになっていることです。そこでこのプロセスでは、クライアントに対しクラウドのリソースについては別のレルムにマッピングするよう指示し、Azure AD のテナントの詳細についても併せて取得します。  </p><p>*.windows.net = KERBEROS.MICROSOFTONLINE.COM  </p><p><img src="/blog/azure-active-directory/how-azuread-kerberos-works/how-azuread-kerberos-works3.png" alt="Azure AD から Kerberos のクラウド TGT、レルム マッピング、Azure テナント情報を取得している Windows LSASS">  </p><p>Azure Virtual Desktop にログインし、認証して PRT と クラウド TGT を取得すると、Azure Virtual Desktop は FSLogix を呼び出して Azure Files 共有 (例: \mystuff.file.core.windows.net) からユーザー プロファイルを読み込もうとします。これは実体として SMB ファイル共有として参照されるので、SMB は cifs/mystuff.file.core.windows.net の Kerberos チケットを探しに行くのです。</p><p>Azure AD 認証プロセスで、Windows にマッピング情報を与えているので、Windows は *.windows.net リソースのために Active Directory ドメインコントローラーに問い合わせるということはしません。その代わり、Kerberos スタックはクラウド TGT を realm マッピングと一緒にキャッシュに配置し、realm マッピングと Azure AD テナントの詳細情報の間で「KDC Proxy」マップを構成します。</p><p><img src="/blog/azure-active-directory/how-azuread-kerberos-works/how-azuread-kerberos-works4.png" alt="Azure AD に TGS-REQ を送信する Kerberos">  </p><p>これにより、チケット要求に対して、Kerberos は cifs/mystuff.file.core.windows.net を参照し、*.windows.net は KERBEROS.MICROSOFTONLINE.COM にマッピングされ、その realm から <a href="https://login.microsoftonline.com/tenantid/kerberos">https://login.microsoftonline.com/tenantid/kerberos</a> にマッピングする KDC Proxy が出来上がることになります。</p><p><a href="https://docs.microsoft.com/ja-jp/openspecs/windows_protocols/ms-kkdcp/5bcebb8d-b747-4ee5-9453-428aec1c5c38?WT.mc_id=modinfra-54539-socuff">KDC Proxy protocol</a> は、インターネット上で Kerberos をやり取りする仕組みです。そして、Azure AD は Ticket Granting Service-Request (TGS-REQ) を受け取ることになります。  </p><p><img src="/blog/azure-active-directory/how-azuread-kerberos-works/how-azuread-kerberos-works5.png" alt="Ticket Granting Service - 要求">  </p><p>次に Azure AD は:</p><ol><li>クラウド TGT と Azure AD のテナント ID が一致するか確認します。  </li><li>ユーザーが存在するかどうかを問い合わせます。  </li><li>要求されたサービス プリンシパル名 (Azure AD にアプリケーションとして登録された Azure Files リソース) を検索します。  </li><li>チケットを生成します。  </li><li>チケットを、そのサービス プリンシパル名に格納されている Azure Files ストレージ キーで暗号化します。  </li><li>そしてそれをすべて TGS-REP にまとめて返します。 </li></ol><p><img src="/blog/azure-active-directory/how-azuread-kerberos-works/how-azuread-kerberos-works6.png" alt="TGT 要求の送信と受信を行う際の Kerberos の動作">  </p><p>Kerberos スタックが TGT 応答 (TGS-REP) を取り戻すと、Kerberos スタックは:</p><ol><li>チケットを開封します。</li><li>アプリケーション リクエスト (AP-REQ) を生成し、SMB にそれを渡します。  </li><li>SMB プロトコルは AP-REQ をヘッダーに詰め込み、SMB Hello を Azure Files に送信します。  </li></ol><p><img src="/blog/azure-active-directory/how-azuread-kerberos-works/how-azuread-kerberos-works7.png" alt="AP-REQ と暗号化されたチケットを受信する際の SMB の動作">  </p><p>Azure Files は hello を受け取り、チケットを復号化 (ストレージ キーを使用) して完了です。FSLogix は、Azure File Share のユーザー プロファイルを読み込んで、Azure Virtual Desktop セッションをロードします。</p><p><img src="/blog/azure-active-directory/how-azuread-kerberos-works/how-azuread-kerberos-works8.png" alt="SMB 経由で Azure File Share にアクセスする FSLogix の動作">  </p><p>SMB、Azure Files、AVD からすると、Kerberos チケットが実際に Active Directory を参照していないということは全くわかりません。</p><p>注: このサービスの現在のパブリック プレビューでは、オンプレミスの Active Directory にユーザーが存在し、Azure AD Connect を使用して Azure AD に同期されていることが必要です。Azure AD 上でのみ作成されたクラウド ユーザーの利用はまだサポートされていませんが、今後サポートされる予定です。</p><h2 id="Azure-Files-for-FSLogix-と-Azure-Virtual-Desktop-を導入する方法"><a href="#Azure-Files-for-FSLogix-と-Azure-Virtual-Desktop-を導入する方法" class="headerlink" title="Azure Files for FSLogix と Azure Virtual Desktop を導入する方法"></a>Azure Files for FSLogix と Azure Virtual Desktop を導入する方法</h2><p>Azure Files などの設定方法について、ステップごとに知りたい場合は、Dean Cefola のビデオをご覧ください。</p><p>(<a href="https://www.youtube.com/watch?v=suvDH-yNL88">https://www.youtube.com/watch?v=suvDH-yNL88</a>)</p><p>必要な PowerShell コマンドは、<a href="https://docs.microsoft.com/ja-jp/azure/virtual-desktop/create-profile-container-adds?WT.mc_id=modinfra-54539-socuff">Azure Files および Azure AD DS を使用してプロファイル コンテナーを作成する</a> をご覧ください。</p><p>図を追加し、素晴らしい技術的解説をさらに発展させる機会を与えてくれた Steve Syfus 氏に感謝します。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、 Azure Identity サポート チームの小出です。&lt;/p&gt;
&lt;p&gt;本記事は、 2022 年 1 月 25 日に米国の ITOps Talk Blog で公開された &lt;a href=&quot;https://techcommunity.microsoft.com</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="US Identity Blog" scheme="https://jpazureid.github.io/blog/tags/US-Identity-Blog/"/>
    
  </entry>
  
  <entry>
    <title>Azure AD 証明書ベース認証 パブリック プレビューのご案内</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/azure-ad-certificate-based-authentication-now-in-public-preview/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/azure-ad-certificate-based-authentication-now-in-public-preview/</id>
    <published>2022-02-22T21:00:00.000Z</published>
    <updated>2022-03-28T02:13:39.635Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Azure Identity サポート チームの 村上 です。</p><p>本記事は、2022 年 2 月 14 日に米国の Azure Active Directory Identity Blog で公開された <a href="https://techcommunity.microsoft.com/t5/azure-active-directory-identity/azure-ad-certificate-based-authentication-now-in-public-preview/ba-p/2464390">Azure AD Certificate-Based Authentication now in Public Preview</a> を意訳したものになります。ご不明点等ございましたらサポート チームまでお問い合わせください。</p><hr><p>皆さん、こんにちは。</p><p>本日、当社の商用および米国政府クラウドにおいて、Azure Active Directory 証明書ベース認証 (<strong>Azure AD CBA</strong>) がパブリック プレビューとなりましたことを発表でき、大変嬉しく思います。</p><p>2021 年 5 月、バイデン大統領は大統領令 14028 号 <a href="https://www.whitehouse.gov/briefing-room/presidential-actions/2021/05/12/executive-order-on-improving-the-nations-cybersecurity/">国家のサイバー セキュリティの改善</a> を発表し、連邦政府に対して、職員、ビジネス パートナー、そしてベンダーに対するフィッシング耐性のある多要素認証 (MFA) を含むゼロ トラスト アーキテクチャを導入するよう求めました。</p><blockquote><p>「段階的な改善では、必要なセキュリティを確保できません。その代わりに、連邦政府は、アメリカの生活様式を支える重要な組織を守るため、大胆な改革と大規模な投資を行う必要があるのです。」<br>バイデン大統領、大統領令 14028 号</p></blockquote><p>当社は政府と連携した経験をもとに、PIV/CAC カードは連邦政府内で使用される最も一般的な認証方法であると理解しています。</p><p>すべてのお客様にとって重要なことですが、<strong>Azure AD に対して直接 X.509 証明書を使用して認証できる</strong> ことは、<strong>PIV / CAC カード</strong> を使用している連邦政府組織や、大統領令 14028 の要件に準拠しようとしている組織にとっても特に重要です。</p><p>以下では、当社 ID セキュリティ チームのプロダクト マネージャーである Vimala Ranganathan より、詳細を説明いたします。</p><p>Alex Simons (Twitter: <a href="https://twitter.com/alex_a_simons">@Alex_A_Simons</a><br>Corporate Vice President Program Management<br>Microsoft Identity Division </p><hr><p>皆さん、こんにちは。</p><p>アイデンティティ PM チームの Vimala です。以下に、Azure AD CBA (Azure AD 証明書ベース認証) について説明させていただきます。</p><p>Azure AD CBA は、米国のサイバー セキュリティに関する大統領令へのコミットメントの一環として、政府機関のお客様が PIV / CAC カードを使用してフィッシング防止の MFA 認証を容易に満たすことができるよう支援します。Azure AD のユーザーは、スマート カードやデバイスの X.509 証明書を使用して、ブラウザやアプリケーションのサインインの際、Azure AD に対して直接認証することができます。</p><p>主なメリットは、以下のとおりです。</p><ul><li>フィッシングに強い証明書ベースの認証により、より高いセキュリティを実現 (ID 攻撃の大半はパスワードに関連している)</li><li>フィッシング耐性のある MFA に関する大統領令 14028 号の要件を容易に満たすことが可能</li><li>オンプレミスのフェデレーション基盤にかかるコストとリスクを排除</li><li>Azure AD でのきめ細かなコントロールによる、簡素化された管理体験を実現</li></ul><p>SAP 社は素晴らしいパートナー企業であり、Azure AD CBA のパブリック プレビューを実現する上で、重要なフィードバックを提供いただきました。</p><blockquote><p>「CBA は、SAP 製品の中核をなす歴史的なものです。証明書ベースの認証は 1999 年から SAP で使用しており、複数回にわたって移行および導入をしてきました。Azure AD にこれらの機能がネイティブに備わることで、長期的には AD FS を引退させることができ、Azure AD は我々が利用する最後のフェデレーション エンドポイントとなるのです。」<br>SAP 社 アイデンティティ アーキテクト Sven Frank 氏</p></blockquote><h2 id="Azure-AD-証明書ベース認証-Azure-AD-CBA-とは何か？"><a href="#Azure-AD-証明書ベース認証-Azure-AD-CBA-とは何か？" class="headerlink" title="Azure AD 証明書ベース認証 (Azure AD CBA) とは何か？"></a>Azure AD 証明書ベース認証 (Azure AD CBA) とは何か？</h2><p>ご存知のように、これまで Azure AD に対して X.509 証明書を使用する認証には、AD FS などの連携 ID プロバイダ (IdP) が必要でした。本日ご紹介する Azure AD CBA パブリック プレビューでは、お客様は連携プロバイダを必要とせず、Azure AD に対して直接認証することができるようになります。</p><p><img src="/blog/azure-active-directory/azure-ad-certificate-based-authentication-now-in-public-preview/Image01_SimplifiedArchitecture.png" alt="図 1: 簡素化されたアーキテクチャ"></p><h2 id="証明書ベースの認証方式管理"><a href="#証明書ベースの認証方式管理" class="headerlink" title="証明書ベースの認証方式管理"></a>証明書ベースの認証方式管理</h2><p>下の図は、管理者が CBA を有効にする手順を示しています。</p><p><img src="/blog/azure-active-directory/azure-ad-certificate-based-authentication-now-in-public-preview/Image02_MethodManagement.png"></p><p>詳細につきましては、こちらの公開情報をご覧ください: <a href="http://aka.ms/AADCBA">http://aka.ms/AADCBA</a> </p><h2 id="エンド-ユーザー体験"><a href="#エンド-ユーザー体験" class="headerlink" title="エンド ユーザー体験"></a>エンド ユーザー体験</h2><p>エンド ユーザーとして、UPN (User Principal Name) を入力すると、パスワード画面に「Sign in with a certificate」のリンクが表示されます。</p><p><img src="/blog/azure-active-directory/azure-ad-certificate-based-authentication-now-in-public-preview/Image03_UserSignin.png" alt="図 2: 証明書を利用したサインイン"></p><p>正しいクライアント証明書を選択するよう促され、選択することでアプリケーションへの認証が完了します。</p><p>注: テナントで CBA が有効になっている場合、テナント内のすべてのユーザーのサインイン ページに「証明書を使用してサインインする」というリンクが表示されます。しかし、Azure AD に対して正常に認証できるのは CBA のスコープ内のユーザーのみで、それ以外のユーザーには失敗が表示されます。</p><h2 id="今後について"><a href="#今後について" class="headerlink" title="今後について"></a>今後について</h2><p>今後、Windows スマート カード ログオン、第二認証要素としての CBA 、信頼できる発行者リストの制限撤廃、証明書失効リスト (CRL) など、さらなる素晴らしい機能の開発に取り組んでいます。</p><p>ご意見がございましたら、ぜひ遠慮なく <a href="https://feedback.azure.com/d365community/forum/22920db1-ad25-ec11-b6e6-000d3a4f0789">Azure AD コミュニティ</a> までお寄せください。</p><p>大統領令 14028 号の詳細については、<a href="https://www.microsoft.com/en-us/federal/CyberEO.aspx">こちら</a> をご確認ください。</p><p>Vimala</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Azure Identity サポート チームの 村上 です。&lt;/p&gt;
&lt;p&gt;本記事は、2022 年 2 月 14 日に米国の Azure Active Directory Identity Blog で公開された &lt;a href=&quot;https://techco</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="US Identity Blog" scheme="https://jpazureid.github.io/blog/tags/US-Identity-Blog/"/>
    
  </entry>
  
  <entry>
    <title>クロス テナントのアクセス設定でよりセキュアなコラボレーションを実現</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/collaborate-more-securely-with-new-cross-tenant-access-settings/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/collaborate-more-securely-with-new-cross-tenant-access-settings/</id>
    <published>2022-02-14T00:00:00.000Z</published>
    <updated>2022-03-28T02:13:39.715Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Azure Identity サポート チームの 村上 です。</p><p>本記事は、2022 年 2 月 7 日に米国の Azure Active Directory Identity Blog で公開された <a href="https://techcommunity.microsoft.com/t5/azure-active-directory-identity/collaborate-more-securely-with-new-cross-tenant-access-settings/ba-p/2147077">Collaborate more securely with new cross-tenant access settings</a> を意訳したものになります。ご不明点等ございましたらサポート チームまでお問い合わせください。</p><hr><p>皆さん、こんにちは。</p><p>先日の <a href="https://jpazureid.github.io/blog/azure-active-directory/external-identities-b2c-supports-authenticator-apps-and-new-data/">External Identities のアップデート</a> に続き、外部コラボレーションのためのクロス テナントのアクセス設定がパブリック プレビューで利用可能となったことをお知らせいたします。</p><p>クロス テナントのアクセス設定により、組織内のユーザーが外部の Azure AD 組織のメンバーとどのように共同作業を行うかを制御することが可能となります。組織、ユーザー、グループおよびアプリケーションごとにきめ細かなインバウンドおよびアウトバウンドのアクセス制御の設定が可能になりました。また、これらの設定により、多要素認証 (MFA)、デバイス準拠、ハイブリッド Azure AD 参加デバイスなど、外部の Azure AD 組織からのセキュリティ クレームを信頼できるようになります。</p><p>外部との連携に関しては、お客様から以下のようなご意見をいただいていました。</p><ol><li>承認された外部ユーザーのみがアプリとリソースにアクセスでき、組織の承認されたユーザーのみが外部アプリとリソースにアクセスできるようにしたい。 </li><li>パートナーからの MFA クレームを信頼し、ホーム ディレクトリ (外部ユーザーがメンバーとして所属するディレクトリ) で MFA を実行した外部ユーザーが、リソース ディレクトリ (外部ユーザーがゲストして招待されたディレクトリ) で再び MFA を要求されないようにしたい。</li><li>ユーザーが外部からアクセスしているアプリと、外部ユーザーが組織内でアクセスしているアプリを把握したい。</li></ol><p>このようなご意見を反映させ、以下のような機能を開発しました。それぞれの詳細についてご紹介いたします。</p><h2 id="クロス-テナントのアクセス設定手順"><a href="#クロス-テナントのアクセス設定手順" class="headerlink" title="クロス テナントのアクセス設定手順"></a>クロス テナントのアクセス設定手順</h2><h3 id="ユーザーとコラボレーションできる外部ユーザーと組織をコントロールする"><a href="#ユーザーとコラボレーションできる外部ユーザーと組織をコントロールする" class="headerlink" title="ユーザーとコラボレーションできる外部ユーザーと組織をコントロールする"></a>ユーザーとコラボレーションできる外部ユーザーと組織をコントロールする</h3><p><strong>インバウンドの設定</strong> では、アプリやリソースにアクセスできる外部ユーザーを制御することができます。すべての外部ユーザーとのコラボレーションを許可することも、特定の組織の特定のユーザーやグループのみにアクセスを許可するように制限することもできます。また、これらのユーザーがアクセスできる組織内のアプリを指定することもできます。 クロス テナントのアクセス設定についての詳細は、<a href="https://docs.microsoft.com/en-us/azure/active-directory/external-identities/cross-tenant-access-overview">公開情報</a> をご覧ください。</p><p><img src="/blog/azure-active-directory/collaborate-more-securely-with-new-cross-tenant-access-settings/image01.png"></p><h3 id="ユーザーがコラボレーションを行える外部組織を管理する"><a href="#ユーザーがコラボレーションを行える外部組織を管理する" class="headerlink" title="ユーザーがコラボレーションを行える外部組織を管理する"></a>ユーザーがコラボレーションを行える外部組織を管理する</h3><p><strong>アウトバウンドの設定</strong> では、ユーザーがコラボレーションできる外部組織を制御することができます。ユーザーがすべての外部組織とコラボレーションできるようにしたり、特定のユーザーやグループが、特定の外部組織の特定のアプリにアクセスすることだけを許可したりすることができます。</p><p><img src="/blog/azure-active-directory/collaborate-more-securely-with-new-cross-tenant-access-settings/image02.png"></p><h3 id="Azure-AD-の外部組織からのセキュリティ-クレームを-MFA-とデバイスのために信頼する"><a href="#Azure-AD-の外部組織からのセキュリティ-クレームを-MFA-とデバイスのために信頼する" class="headerlink" title="Azure AD の外部組織からのセキュリティ クレームを MFA とデバイスのために信頼する"></a>Azure AD の外部組織からのセキュリティ クレームを MFA とデバイスのために信頼する</h3><p><strong>インバウンドの信頼設定</strong> では、外部ユーザーがホーム ディレクトリで実行する MFA を信頼することができます。これは、外部ユーザーがホーム ディレクトリとリソース ディレクトリの両方で複数回 MFA を実行しなければならないという、お客様からいただいたフィードバックに対応するものです。外部ユーザーがホーム ディレクトリで実行した MFA を信頼することで、外部ユーザーがリソース ディレクトリで MFA を完了する必要がなくなり、シームレスな認証体験を実現できます。また、組織で発生する MFA の費用も削減できます。</p><p>さらに、インバウンドの信頼設定により、ホーム ディレクトリにて準拠したデバイス、または Azure AD に参加したハイブリッド デバイスを信頼することができます。以前は、外部ユーザーに対して、準拠デバイスまたはハイブリッド Azure AD 参加デバイスを要求するなど、デバイス ベースの条件付きアクセス ポリシーを実施することはできませんでした。インバウンドの信頼設定を使用して外部の Azure AD 組織からのデバイス クレームを受け入れることで、外部ユーザーが準拠デバイスまたはハイブリッド Azure AD 参加デバイスを使用することを要求することにより、アプリとリソースへのアクセスを保護できるようになりました。 インバウンドの信頼設定が条件付きアクセスでどのように機能するかについては、<a href="https://docs.microsoft.com/en-us/azure/active-directory/external-identities/authentication-conditional-access">こちら</a> をご覧ください。</p><p><img src="/blog/azure-active-directory/collaborate-more-securely-with-new-cross-tenant-access-settings/image03.png"></p><h3 id="組織のリソースに誰がアクセスしているかを把握する"><a href="#組織のリソースに誰がアクセスしているかを把握する" class="headerlink" title="組織のリソースに誰がアクセスしているかを把握する"></a>組織のリソースに誰がアクセスしているかを把握する</h3><p>サインイン ログから、ユーザーがアクセスしている外部アプリや、リソースにアクセスしている外部ユーザーを確認できます。詳細は <a href="https://docs.microsoft.com/en-us/azure/active-directory/external-identities/cross-tenant-access-overview#identify-inbound-and-outbound-sign-ins">公開情報</a> をご覧ください。</p><p><img src="/blog/azure-active-directory/collaborate-more-securely-with-new-cross-tenant-access-settings/image04.png"></p><h2 id="まずはどのようにコラボレーションを実現するかを決めましょう"><a href="#まずはどのようにコラボレーションを実現するかを決めましょう" class="headerlink" title="まずはどのようにコラボレーションを実現するかを決めましょう"></a>まずはどのようにコラボレーションを実現するかを決めましょう</h2><p>クロス テナントのアクセス設定をカスタマイズする前に、どの外部組織がアプリやリソースにアクセスする必要があるのか、またどのユーザーが外部アプリやリソースにアクセスする必要があるのかを確認し、進行中のコラボレーションを間違って止めてしまわないようにすることが重要です。この <a href="https://aka.ms/cross-tenant-signins-workbook">ワークブック</a> を使用して、組織がどのように外部組織とコラボレーションしているかを理解し、ビジネスへの影響を回避することをお勧めします。</p><h2 id="お客様からの声をご紹介"><a href="#お客様からの声をご紹介" class="headerlink" title="お客様からの声をご紹介"></a>お客様からの声をご紹介</h2><p>Bupa 社は、全世界で 3,100 万人以上の顧客を持つ国際的な健康保険およびヘルスケア グループです。この機能をテストしてきた中で以下のような感想をいただきました。 </p><p>“弊社の大規模で複雑な組織においても、この機能を利用することでより活発なコラボレーションが実現し、何より重要なセキュリティを強化するための基礎を築くことができました。” </p><p>さらに、最も規制の厳しい業界のお客様においてもオープンなコラボレーションを今回可能にしたことで、このようなフィードバックをいただきました。 </p><p>“クロス テナントのアクセス設定によりリスクを大幅に削減し、セキュリティを向上させることができました。さらに、外部テナントへのアクセスやコラボレーションのニーズにおいても、より良いビジネス サポートが可能になりました。セキュリティ部門に加えビジネスの面でも、そして重要なことですが監査官や規制当局からも高い満足を得ています。” </p><p>皆様からのご意見をお待ちしております。これらの新機能に関するご意見は、Azure フォーラムまたは Twitter で <a href="https://twitter.com/azuread">@AzureAD</a> 宛てにお寄せください。</p><p>Robin Goldstein<br>Twitter: <a href="https://twitter.com/RobinGo_MS">@RobinGo_MS</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Azure Identity サポート チームの 村上 です。&lt;/p&gt;
&lt;p&gt;本記事は、2022 年 2 月 7 日に米国の Azure Active Directory Identity Blog で公開された &lt;a href=&quot;https://techcom</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="US Identity Blog" scheme="https://jpazureid.github.io/blog/tags/US-Identity-Blog/"/>
    
  </entry>
  
  <entry>
    <title>シークレットなしで異なるソフトウェア ワークロードから Azure リソースにアクセス</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/access-azure-resources-from-software-workload-in-different/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/access-azure-resources-from-software-workload-in-different/</id>
    <published>2022-02-08T19:00:00.000Z</published>
    <updated>2022-03-28T02:13:39.611Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Azure Identity サポート チームの 村上 です。</p><p>本記事は、2022 年 1 月 31 日に米国の Azure Active Directory Identity Blog で公開された <a href="https://techcommunity.microsoft.com/t5/azure-active-directory-identity/access-azure-resources-from-software-workload-in-different/ba-p/2464394">Access Azure resources from software workload in different environments, no secrets necessary</a> を意訳したものになります。ご不明点等ございましたらサポート チームまでお問い合わせください。</p><hr><p>皆さん、こんにちは。</p><p>誰もが体感しているように、世界全体がデジタル化され、あらゆるものがクラウドに接続されるようになってきています。これは、皆さんの組織がこれまで以上に多くのソフトウェアを作成および使用し、そのほとんどがどこかのクラウドでワークロードとして稼働していることを意味します。</p><p>通常、これらのソフトウェア ワークロードは Azure Storage や Key Vault、Microsoft Graph からアクセスできる文書や電子メールなどクラウド上のリソースにアクセスする必要があります。そしてこれらのソフトウェア ワークロードは、ユーザーと同じように認証する必要もあります。しかしこの認証が開発者や DevOps、管理者にとって大きな課題となるのです。それは認証を行うためにシークレットを扱う必要があるからです。これらのシークレットは、安全に保管され、頻繁にローテーションされなければなりません。特に、他のリソースにアクセスする必要のあるソフトウェア ワークロードの数が増えているため、多くの組織でシークレットの管理が難しくなっています。 </p><p>そこで私たちは、認証におけるシークレットの必要性を最小限に抑えるために、Azure AD にワークロード ID フェデレーションという新しいパブリック プレビューの機能を追加しました。これは、ソフトウェア ワークロードが Azure のマネージド ID を使用できない環境で動作している場合に特に有用です。この機能により、Azure や Microsoft Graph など Azure AD で保護されたリソースに、シークレットなしでアクセスできるようになります。他の ID プロバイダーからソフトウェア ワークロードに発行されたトークンを信頼するように Azure AD を構成することができます。ソフトウェア ワークロードは、これらのトークンを使用して Azure AD からトークンを取得し、Azure と Graph リソースにアクセスできます。</p><p>以下に、ワークロード ID フェデレーションの機能を利用できるシナリオをいくつか紹介します。 </p><ul><li><strong>GitHub Actions ワークフローで Azure による CI/CD を実現</strong>: GitHub リポジトリに Azure AD シークレットを保存するのではなく、GitHub トークンを使用してサービスを認証し、Azure にデプロイすることが可能です。(詳細は <a href="https://docs.github.com/en/actions/deployment/security-hardening-your-deployments/configuring-openid-connect-in-azure">GitHub のドキュメント</a> をご覧ください) </li><li><strong>Kubernetes クラスタで動作するサービス</strong>: Kubernetes クラスタによりサービス アカウントに発行されるトークンを使用して、Azure リソースにアクセスすることができます。<a href="https://github.com/Azure/azure-workload-identity">Azure AD workload identity for Kubernetes</a> は、この機能の利用を案内しているオープンソース プロジェクトで、実行場所にかかわらずこの機能を利用いただけます。</li><li><strong>ワークロード ID に SPIFFE/SPIRE を使用しているサービス</strong>: ソフトウェア ワークロードで利用している ID に SPIFFE/SPIRE を使用している場合、SPIFFE トークンを使用して Azure リソースにアクセスすることができます。 </li><li><strong>Google Cloud Platform で動作するサービス</strong>: Google サービス アカウントに発行された ID トークンを使用すると、GCP (Google Cloud Platform) で動作するソフトウェア ワークロードは追加のシークレットなしで Azure リソースにアクセスできます。</li></ul><p>私のチーム メンバーである <a href="https://twitter.com/udayxhegde">Uday Hegde</a> のブログにて、それぞれのシナリオについて説明しています。 </p><ul><li><a href="https://blog.identitydigest.com/azuread-federate-github-actions/">GitHub Actions CI/CD to Azure</a></li><li><a href="https://blog.identitydigest.com/azuread-federate-k8s/">Services running in Kubernetes clusters</a></li><li><a href="https://blog.identitydigest.com/azuread-federate-spiffe/">Services using SPIFFE/SPIRE for their workload identities</a></li><li><a href="https://blog.identitydigest.com/azuread-federate-gcp/">Services running in Google Cloud Platform</a> </li></ul><p>私たちは今後も、このようなシークレットの必要ない認証を実現できるシナリオを拡大していく予定です。</p><p>Azure AD ワークロード ID フェデレーションについては、<a href="https://docs.microsoft.com/ja-jp/azure/active-directory/develop/workload-identity-federation">こちらの公開情報</a> で詳しく説明していますので併せてご覧ください。</p><p>いつも通り、ご意見やご感想をお待ちしております。以下のコメント欄、または <a href="(https://feedback.azure.com/d365community/forum/22920db1-ad25-ec11-b6e6-000d3a4f0789)">Azure AD フィードバック フォーラム</a> でご意見をお聞かせください。</p><p>Alex Simons (Twitter: <a href="https://twitter.com/Alex_A_Simons">@alex_a_simons</a>)<br>Corporate Vice President Program Management<br>Microsoft Identity Division</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Azure Identity サポート チームの 村上 です。&lt;/p&gt;
&lt;p&gt;本記事は、2022 年 1 月 31 日に米国の Azure Active Directory Identity Blog で公開された &lt;a href=&quot;https://techco</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="US Identity Blog" scheme="https://jpazureid.github.io/blog/tags/US-Identity-Blog/"/>
    
  </entry>
  
  <entry>
    <title>AD FS 2019 以降でセカンダリ AD FS をホスト名のみで構成すると WAP の構成および信頼関係の更新に失敗する</title>
    <link href="https://jpazureid.github.io/blog/active-directory-federation-service/adfs-wap-federation-renew/"/>
    <id>https://jpazureid.github.io/blog/active-directory-federation-service/adfs-wap-federation-renew/</id>
    <published>2022-02-04T16:00:00.000Z</published>
    <updated>2022-03-28T02:13:39.347Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Azure Identity サポート チームの山口です。</p><p>AD FS ファームを Windows Server 2019 以降 のサーバー (複数) で構成している環境において、WAP サーバーの新規構成および信頼関係の更新に失敗する事象について紹介します。<br>この事象は次の 2 つの条件を満たした場合に発生します。</p><ol><li>AD FS ファームのセカンダリ サーバーを構成する際、プライマリ サーバーを FQDN ではなくホスト名のみで構成している</li><li>WAP を新規構成する際に発生する通信、あるいは信頼関係の更新処理に伴う通信がセカンダリ AD FS に対して行われる場合</li></ol><p>本事象の影響を受ける環境か確認する方法、発生する事象の詳細と具体的な対処方法は以下のとおりです。</p><h2 id="影響を受ける構成かどうかを確認する方法"><a href="#影響を受ける構成かどうかを確認する方法" class="headerlink" title="影響を受ける構成かどうかを確認する方法"></a>影響を受ける構成かどうかを確認する方法</h2><p>AD FS 2019 以降でセカンダリ サーバーが存在する場合、セカンダリ サーバーで以下の Powershell コマンドレットを実行します。</p><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Get-AdfsSyncProperties</span></span><br></pre></td></tr></table></figure><p>以下のように、PrimaryComputerName がホスト名のみで構成されている場合に該当します。</p><p><img src="/blog/active-directory-federation-service/adfs-wap-federation-renew/adfs-wap-federation-renew-001.jpg"></p><p>以下のように、FQDN で構成されている場合には該当いたしません。</p><p><img src="/blog/active-directory-federation-service/adfs-wap-federation-renew/adfs-wap-federation-renew-002.jpg"></p><h2 id="発生する事象"><a href="#発生する事象" class="headerlink" title="発生する事象"></a>発生する事象</h2><p>以下のような事象が発生します。</p><ol><li>AD FS 2019 以降の環境で WAP の新規構成に失敗する。</li><li>AD FS 2019 以降の環境に OS をアップグレードした後に、WAP と AD FS 間の信頼関係の更新に失敗するようになり、(結果として) WAP 経由の認証に失敗するようになる。</li></ol><p>上記 1. については以下画面ショットのように Web アプリケーション プロキシ構成ウィザードより新規構成を試行した結果、<strong>フェデレーション サービスとの信頼関係の構築中にエラーが発生しました。エラー: Bad Request</strong> と表示され WAP の構成に失敗している場合に本事象に該当する可能性があります。</p><p>※エラー内容が Bad Request と表示されている場合に本事象に該当している可能性が高いです。</p><p><img src="/blog/active-directory-federation-service/adfs-wap-federation-renew/adfs-wap-federation-renew-003.jpg"></p><p>上記 2. については WAP サーバーのイベント ビューアー「アプリケーションとサービス ログ」→「AD FS」→「Admin」ログ内に、下記画面ショットのように ID 394 が定期的に記録されている場合に場合に該当する可能性があります。</p><p>※エラー内容が Bad Request と表示されている場合に本事象に該当している可能性が高いです。</p><p><img src="/blog/active-directory-federation-service/adfs-wap-federation-renew/adfs-wap-federation-renew-004.jpg"></p><h2 id="なぜ発生するのか"><a href="#なぜ発生するのか" class="headerlink" title="なぜ発生するのか"></a>なぜ発生するのか</h2><p>AD FS 2019 以降の Windows Server OS より、AD FS は所定のエンドポイントで HTTP リクエストを受信した際に、明確に FQDN を指定しないとエラーを返す (HTTP 400 エラーを返す) 実装が追加されたためです。</p><h2 id="対処方法について"><a href="#対処方法について" class="headerlink" title="対処方法について"></a>対処方法について</h2><p>セカンダリ AD FS サーバー上で以下の PowerShell コマンドレットを実行し、プライマリ AD FS サーバーをホスト名ではなく FQDN に変更します。</p><ol><li>セカンダリ AD FS サーバー上で管理者として PowerShell を起動します。</li><li>以下の PowerShell コマンドレットを実行し、「PrimaryComputerName」がプライマリ AD FS サーバーのホスト名のみになっていることを確認します。</li></ol><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Get-AdfsSyncProperties</span></span><br></pre></td></tr></table></figure><p>画面ショット例<br><img src="/blog/active-directory-federation-service/adfs-wap-federation-renew/adfs-wap-federation-renew-005.jpg"></p><ol start="3"><li>以下の PowerShell コマンドレットを実行し、「PrimaryComputerName」をプライマリ AD FS サーバーの FQDN に変更します。</li></ol><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Set-AdfsSyncProperties</span> <span class="literal">-Role</span> SecondaryComputer <span class="literal">-PrimaryComputerName</span> &lt;プライマリ AD FS サーバーの FQDN&gt;</span><br><span class="line"></span><br><span class="line">(例)</span><br><span class="line"><span class="built_in">Set-AdfsSyncProperties</span> <span class="literal">-Role</span> SecondaryComputer <span class="literal">-PrimaryComputerName</span> ADFS<span class="literal">-008</span>.shyamag.work</span><br></pre></td></tr></table></figure><ol start="4"><li>以下の PowerShell コマンドレットを実行し、「PrimaryComputerName」がプライマリ AD FS サーバーの FQDN に変更されていることを確認します。</li></ol><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Get-AdfsSyncProperties</span></span><br></pre></td></tr></table></figure><p>画面ショット例<br><img src="/blog/active-directory-federation-service/adfs-wap-federation-renew/adfs-wap-federation-renew-006.jpg"></p><p>WAP サーバーを新規に構成ができない、もしくは信頼関係が切れている場合 (WAP 経由の認証ができない場合) は、上記の作業実施後に WAP を再構築します。また、信頼関係が切れていない場合 (WAP 経由の認証ができている場合) は、作業実施後に WAP サーバー上の AD FS サービス (Active Directory フェデレーション サービス) を再起動することで正常に WAP と AD FS 間の信頼環境を更新できるようになります。</p><h3 id="Q-AD-FS-2016-や-AD-FS-3-0-Windows-Server-2012-R2-の環境では影響は出ないのか。"><a href="#Q-AD-FS-2016-や-AD-FS-3-0-Windows-Server-2012-R2-の環境では影響は出ないのか。" class="headerlink" title="Q. AD FS 2016 や AD FS 3.0 (Windows Server 2012 R2) の環境では影響は出ないのか。"></a>Q. AD FS 2016 や AD FS 3.0 (Windows Server 2012 R2) の環境では影響は出ないのか。</h3><p>A. はい、影響を受けません。</p><h3 id="Q-AD-FS-間の構成情報の同期に影響は出ないのか。"><a href="#Q-AD-FS-間の構成情報の同期に影響は出ないのか。" class="headerlink" title="Q. AD FS 間の構成情報の同期に影響は出ないのか。"></a>Q. AD FS 間の構成情報の同期に影響は出ないのか。</h3><p>A. AD FS 間の同期については影響を受けません。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Azure Identity サポート チームの山口です。&lt;/p&gt;
&lt;p&gt;AD FS ファームを Windows Server 2019 以降 のサーバー (複数) で構成している環境において、WAP サーバーの新規構成および信頼関係の更新に失敗する事象について</summary>
      
    
    
    
    
    <category term="AD FS" scheme="https://jpazureid.github.io/blog/tags/AD-FS/"/>
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
  </entry>
  
  <entry>
    <title>「要求が調整されています」エラーの原因と対処策について</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/howto-deal-with-throttling/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/howto-deal-with-throttling/</id>
    <published>2022-02-02T15:00:00.000Z</published>
    <updated>2022-03-28T02:13:39.843Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、 Azure ID チームの小出です。<br>今回は、サインイン ログや監査ログを大量にダウンロードしようとした際に発生する、 “要求が調整されます” というエラー メッセージの原因と対策についてご案内します。</p><h2 id="事象について"><a href="#事象について" class="headerlink" title="事象について"></a>事象について</h2><p>Azure AD のサインイン ログや監査ログをダウンロードしようとした際に、しばらくの間ダウンロード中の画面が表示された後、エラーになってしまう事象です。<br>同時に、下記のように “要求が調整されます” や “サーバーに対する要求が調整されています。” とのメッセージが表示されます。  </p><p><img src="/blog/azure-active-directory/howto-deal-with-throttling/howto-deal-with-throttling1.png"></p><h2 id="なぜメッセージが表示されてしまうのか"><a href="#なぜメッセージが表示されてしまうのか" class="headerlink" title="なぜメッセージが表示されてしまうのか"></a>なぜメッセージが表示されてしまうのか</h2><p>発生しているエラーは、一般的には多くの Graph API リクエストを送付したことによって発生するエラーです。  </p><p>サインイン ログや監査ログは、 Graph API を使用してログを収集します。<br>Graph API には大量の要求が行われた際、要求調整のため、しばらくの間リクエストを待つようリクエスト元に返す “スロットリング” という機能が用意されています。<br>Azure は、多くの企業様がご利用いただくパブリック クラウドです。 1 つのテナントで発生した大量の要求により、ほかのテナントの動作に影響が出ないよう、大量の要求には制限がかかるような動作となっています。  </p><p>“要求が調整されています” のメッセージが表示される場合、このスロットリングの影響でダウンロードに失敗していることが推測されます。<br>スロットリングはリクエスト数が増えることで発生するため、たとえば 1 ヶ月などの長い期間でログを取得しようとした場合、ログの数が多くスロットリングに抵触する可能性があります。  </p><h2 id="どのように対処すればよいか（暫定策）"><a href="#どのように対処すればよいか（暫定策）" class="headerlink" title="どのように対処すればよいか（暫定策）"></a>どのように対処すればよいか（暫定策）</h2><p>Azure ポータルからのダウンロードの要求とスロットリングの関連性を示した具体的なしきい値は公開されておりませんが、基本的にはダウンロード対象となるログの対象日時を小さくする、その他の要素でフィルターを行うなどの対応を実施する必要があります。</p><p>たとえば 1.2 週間ずつログをダウンロードするなど、ダウンロードの対象期間を短く設定したうえでのダウンロードをまずはご検討ください。<br>フィルターは、 Azure ポータルからログをダウンロードする前に、サインイン ログの画面から設定いただけます。<br>たとえば、下記の [許可された時刻] のフィルターをご利用いただくと、時間に基づいたフィルター設定を行うことが可能です。  </p><p><img src="/blog/azure-active-directory/howto-deal-with-throttling/howto-deal-with-throttling2.png"></p><p>なお、 お客様のご利用状況によっては、24 時間以内のログのみをダウンロードしてもエラーになってしまう場合があります。<br>この場合は、ユーザーやアプリケーションをはじめとするその他のフィルターを活用いただき、一度にダウンロードするログの件数を減らしたうえでダウンロードを実施ください。</p><h2 id="どのように対処すればよいか（恒久策）"><a href="#どのように対処すればよいか（恒久策）" class="headerlink" title="どのように対処すればよいか（恒久策）"></a>どのように対処すればよいか（恒久策）</h2><p>定期的にログを収集されたい場合には、 Log Analytics や Azure Storage にサインイン ログを転送する手法もございます。<br>この方法であれば Graph API は用いていないため、スロットリングに抵触することなくログを収集できます。<br>Azure AD のサインイン・監査ログの保存期限（最大 30 日）を超えてログをお客様の環境に保管できるメリットもあります。<br>加えて、Log Analytics に転送した場合は、 Log Analytics のクエリを使って、特定のログを絞り込むなどの操作も可能です。  </p><p>別途サブスクリプションの用意などが必要とはなりますため、コスト面などの調整が必要なものと存じておりますが、下記公開情報に記載の方法も併せてご検討ください。<br><a href="https://docs.microsoft.com/ja-jp/azure/active-directory/reports-monitoring/quickstart-azure-monitor-route-logs-to-storage-account">ストレージ アカウントへのアーカイブ方法</a><br><a href="https://docs.microsoft.com/ja-jp/azure/active-directory/reports-monitoring/howto-integrate-activity-logs-with-log-analytics">Log Analytics と Azure AD ログの連携方法</a>  </p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、 Azure ID チームの小出です。&lt;br&gt;今回は、サインイン ログや監査ログを大量にダウンロードしようとした際に発生する、 “要求が調整されます” というエラー メッセージの原因と対策についてご案内します。&lt;/p&gt;
&lt;h2 id=&quot;事象について&quot;&gt;&lt;a hr</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="Signin Logs" scheme="https://jpazureid.github.io/blog/tags/Signin-Logs/"/>
    
    <category term="Audit Logs" scheme="https://jpazureid.github.io/blog/tags/Audit-Logs/"/>
    
  </entry>
  
  <entry>
    <title>Azure AD における SAML 署名証明書を更新する</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/how-to-update-samlsigningcertificate/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/how-to-update-samlsigningcertificate/</id>
    <published>2022-02-02T08:00:00.000Z</published>
    <updated>2022-03-28T02:13:39.839Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは！ Azure &amp; Identity サポート チームの三浦 大です。</p><p>Azure AD (IDP) とアプリケーション (SP) を、SAML 連携させた (させたい) といったお客様もいらっしゃるかと思います。<br>今回は、Azure AD (IDP) とアプリケーション (SP) を SAML 連携した際に利用する、SAML 署名証明書についてご紹介いたします。<br>更新手順についても記載しておりますので、今後 SAML 署名証明書の更新を検討しているお客様もご一読いただければと思います！</p><p>SAML は、アプリケーションとのシングルサインオンを可能とする便利なフレームワークですが、<br>SAML 連携した際には、SAML 署名証明書を管理いただく必要がでてきます。</p><p>Azure AD において、具体的にどういった場面で SAML 署名証明書が利用されるかというと、Azure AD がアプリケーションに対して SAML レスポンスを返す際です。<br>Azure AD は、SAML レスポンスに SAML 署名証明書を利用して署名をします。<br>アプリケーションは、受け取った SAML レスポンスを検証し、問題がなければ、信頼している IdP である Azure AD から送られていることが証明され、アプリケーションへのアクセスを許可する動作となります。<br>以下シーケンスでいうところの、5 から 6 の処理となります。</p><p><img src="https://docs.microsoft.com/ja-jp/azure/active-directory/develop/media/single-sign-on-saml-protocol/active-directory-saml-single-sign-on-workflow.png"></p><ul><li><a href="https://docs.microsoft.com/ja-jp/azure/active-directory/develop/single-sign-on-saml-protocol">シングル サインオンの SAML プロトコル | Microsoft Docs</a></li></ul><p>以上が、SAML 署名証明書が利用されるシナリオの概要となります。<br>それでは、実際の SAML 署名証明書を確認してみましょう。<br>Azure AD が利用する SAML 署名証明書は、以下の画面で確認することが可能です。</p><p>[Azure ポータル] - [Azure Active Directory] - [エンタープライズアプリケーション] - [&lt;ご利用の SAML アプリケーション&gt;] - [シングルサインオン]<br><img src="/blog/azure-active-directory/how-to-update-samlsigningcertificate/Certificate-View.png"></p><p>右上にある “編集” をクリックすることで、証明書の一覧を確認することもできます。<br><img src="/blog/azure-active-directory/how-to-update-samlsigningcertificate/CertificateDetail-View.png"></p><p>“状態” が “アクティブ” である SAML 署名証明書が、現在署名に利用されている証明書です。<br>また、画像からも確認できるように、有効期限があることがわかります。<br>有効期限がきれると、”状態” が “期限切れ” と表示されます。<br>有効期限が切れた場合、アプリケーションへアクセスできなくなる可能性がございますので、事前に更新いただく必要がございます。</p><h1 id="2-SAML-署名証明書を更新する"><a href="#2-SAML-署名証明書を更新する" class="headerlink" title="2. SAML 署名証明書を更新する"></a>2. SAML 署名証明書を更新する</h1><p>以下では SAML 署名証明書を更新するための手順をご紹介します。</p><h3 id="1-Azure-AD-に新しい証明書を追加します"><a href="#1-Azure-AD-に新しい証明書を追加します" class="headerlink" title="(1) Azure AD に新しい証明書を追加します"></a>(1) Azure AD に新しい証明書を追加します</h3><p>[Azure ポータル] – [Azure Active Directory] – [エンタープライズ アプリケーション] – [&lt;ご利用の SAML アプリケーション&gt;] – [シングル サインオン] - [SAML 署名証明書] の [編集] をクリックし、[新しい証明書] を選択することで新しい証明書が追加されます。<br>ここで追加した証明書のデータはフェデレーション メタデータ XML に追加されます。<br>この作業の結果、新しく追加した証明書は、非アクティブとして追加され、いきなり新しい証明書を利用した署名が行われるわけではないため、この 1 の手順によるダウンタイム (利用中のアプリケーションへの影響) はありませんのでご安心ください。<br><img src="/blog/azure-active-directory/how-to-update-samlsigningcertificate/CertificateDetail-Create.png"></p><h3 id="2-アプリケーションに新しい-SAML-署名証明書をインポートする"><a href="#2-アプリケーションに新しい-SAML-署名証明書をインポートする" class="headerlink" title="(2) アプリケーションに新しい SAML 署名証明書をインポートする"></a>(2) アプリケーションに新しい SAML 署名証明書をインポートする</h3><p>具体的にはアプリケーション側の実装となるため、事前にアプリケーションベンダー様へご確認いただく必要がございます。<br>例として、アプリケーション側の SAML 署名証明書 を更新する方法は、以下のいずれかが一般的かと存じます。  </p><p>(i) Azure AD のフェデレーションメタデータ XML より SAML 署名証明書をインポートする<br>(ii) Azure AD より SAML 署名証明書をダウンロードしてインポートする  </p><p>ここで注意いただきたいのが、<br>アプリケーションにSAML 署名証明書をインポートするにあたり、複数の証明書がインポートできるかという点です。<br>理由として、SAML 署名証明書を更新する際に、ダウンタイム (利用中のアプリケーションへの影響) が発生するか否かに影響があるためです。<br>管理者にとっては、 SAML 署名証明書の更新においても、ダウンタイムが発生しないことが理想だと思います。<br>アプリケーション側で複数の SAML 署名証明書をインポート、その情報を反映でき、新旧どちらの SAML 署名証明書で署名されても検証ができるアプリケーションであれば、ダウンタイムは発生しないと考えられます。<br>しかし、アプリケーション側で複数の SAML 署名証明書をインポートできない場合は、新しい SAML 署名証明書へ更新するタイミングでダウンタイムが発生することが想定されるため、場合によっては、事前に利用ユーザーへの周知が必要です。<br>繰り返しとなりますが、どういった実装になっているか、手順やダウンタイムが発生するかという点については、事前にアプリケーションベンダーへ確認ください。  </p><h3 id="3-Azure-AD-側のアクティブな証明書を更新する"><a href="#3-Azure-AD-側のアクティブな証明書を更新する" class="headerlink" title="(3) Azure AD 側のアクティブな証明書を更新する"></a>(3) Azure AD 側のアクティブな証明書を更新する</h3><p>新しい SAML 署名証明書をアプリケーションにインポートできたら、Azure AD が署名に利用する SAML 署名証明書を切り替えます。<br>新しい証明書で署名するには、Azure ポータルで新しい証明書を右クリックし、[証明書をアクティブにする] を選択します。<br>これにより、新しい証明書がアクティブになり、古い証明書が非アクティブになります。<br><img src="/blog/azure-active-directory/how-to-update-samlsigningcertificate/CertificateDetail-Active.png"></p><h3 id="4-SAML-認証ができるかを確認する"><a href="#4-SAML-認証ができるかを確認する" class="headerlink" title="(4) SAML 認証ができるかを確認する"></a>(4) SAML 認証ができるかを確認する</h3><p>アプリケーションに問題なく SAML 認証ができるかをご確認ください。<br>問題なく成功する場合は、SAML 署名証明書の更新完了です。<br>古い SAML 署名証明書は不要ですので、削除しても問題ありません。<br>もしも、SAML 認証に失敗するようになったという場合は、<br>我々 Microsoft サポート窓口にて問題解決のご支援をしますので、お気兼ねなく、お問い合わせを発行いただけますと幸いです。</p><h1 id="3-SAML-署名証明書についてよくある質問"><a href="#3-SAML-署名証明書についてよくある質問" class="headerlink" title="3. SAML 署名証明書についてよくある質問"></a>3. SAML 署名証明書についてよくある質問</h1><h3 id="Q-SAML-署名証明書の有効期限が切れたけど、認証できるんだけど。。"><a href="#Q-SAML-署名証明書の有効期限が切れたけど、認証できるんだけど。。" class="headerlink" title="Q: SAML 署名証明書の有効期限が切れたけど、認証できるんだけど。。"></a><span style="color: blue; ">Q:</span> SAML 署名証明書の有効期限が切れたけど、認証できるんだけど。。</h3><p><span style="color: red; ">A:</span> アプリケーションに依存して有効期限が切れても認証できる可能性があります。<br>現時点での Azure AD の実装として、SAML 署名証明書の有効期限が経過した場合でも、その証明書を利用した署名を行い、 SAML レスポンスを返す動作となります。ご利用のアプリケーション側で、 署名の検証の際に証明書の有効期限をチェックしていない場合などは、引き続きアクセスできます。<br>ただし、アプリケーション次第でもありますし、有効期限が経過する前に SAML 署名証明書の更新を実施するよう、ご検討ください。  </p><h3 id="Q-SAML-リクエストをアプリケーション側で署名しているが、Azure-AD-で検証用の証明書は管理しているのか？"><a href="#Q-SAML-リクエストをアプリケーション側で署名しているが、Azure-AD-で検証用の証明書は管理しているのか？" class="headerlink" title="Q: SAML リクエストをアプリケーション側で署名しているが、Azure AD で検証用の証明書は管理しているのか？"></a><span style="color: blue; ">Q:</span> SAML リクエストをアプリケーション側で署名しているが、Azure AD で検証用の証明書は管理しているのか？</h3><p><span style="color: red; ">A:</span> 管理していません。<br>Azure AD は SAML リクエスト時の署名は検証せずに無視をする動作となります。<br>仮にアプリケーション側で証明書の更新が発生しても、Azure AD ではアプリケーション側からの SAML リクエストの署名を検証するための証明書を管理していないため、Azure AD 側での更新は考慮する必要はありません。</p><ul><li><a href="https://docs.microsoft.com/ja-jp/azure/active-directory/develop/single-sign-on-saml-protocol#signature">署名 | Microsoft Docs</a></li></ul><h3 id="Q-SAML-署名証明書の期間は？長くできるの？"><a href="#Q-SAML-署名証明書の期間は？長くできるの？" class="headerlink" title="Q: SAML 署名証明書の期間は？長くできるの？"></a><span style="color: blue; ">Q:</span> SAML 署名証明書の期間は？長くできるの？</h3><p><span style="color: red; ">A:</span> Azure AD が発行する SAML 署名証明書は、最大で 3 年の有効期限です。<br>3 年以上の有効期限を持った証明書は作成することができず、期限を延長するといったこともできません。<br>もしも、3 年以上の有効期限をもった証明書を登録したい場合は、独自に発行した自己署名証明書などを利用ください。<br>例えば、以下の手順では 10 年の有効期限の証明書を使用可能です。  </p><p>(1) 管理者権限で PowerShell を起動します。<br>(2) 以下のコマンドを順に実行します ($dnsName はどのような値でも結構です)。</p><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="variable">$dnsName</span>=<span class="string">&quot;contoso.onmicrosoft.com&quot;</span></span><br><span class="line"><span class="variable">$lifetime</span>=<span class="built_in">Get-Date</span></span><br><span class="line"><span class="built_in">New-SelfSignedCertificate</span> <span class="literal">-Subject</span> *.<span class="variable">$dnsName</span> <span class="literal">-NotAfter</span> <span class="variable">$lifetime</span>.AddYears(<span class="number">10</span>) <span class="literal">-KeyUsage</span> DigitalSignature, KeyEncipherment <span class="literal">-DnsName</span> *.<span class="variable">$dnsName</span>, <span class="variable">$dnsName</span></span><br></pre></td></tr></table></figure><p>(3) 以下のように表示されることを確認します (Thumbprint は環境によって異なる値となります)。  </p><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">PSParentPath: Microsoft.PowerShell.Security\Certificate::LocalMachine\MY</span><br><span class="line"></span><br><span class="line">Thumbprint                                Subject</span><br><span class="line">----------                                -------</span><br><span class="line"><span class="number">832</span>A24298E691642AB05A6056A6EF6C7EF8BC531  CN=*.contoso.onmicrosoft.com</span><br></pre></td></tr></table></figure><p>(4) 証明書を PFX ファイルとしてエクスポートするために以下のコマンドを実行します。Thumbprint には 3 の結果、password には任意の文字列を指定ください。  </p><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="variable">$mypwd</span> = <span class="built_in">ConvertTo-SecureString</span> <span class="literal">-String</span> <span class="string">&quot;P@ssw0rd&quot;</span> <span class="literal">-Force</span> <span class="literal">-AsPlainText</span></span><br><span class="line"><span class="built_in">Get-ChildItem</span> <span class="literal">-Path</span> cert:\localMachine\my\<span class="number">832</span>A24298E691642AB05A6056A6EF6C7EF8BC531 | <span class="built_in">Export-PfxCertificate</span> <span class="literal">-FilePath</span> C:\mypfx.pfx <span class="literal">-Password</span> <span class="variable">$mypwd</span></span><br></pre></td></tr></table></figure><p>(5) C:\mypfx.pfx としてエクスポートされますので、これを SAML 署名証明書の構成画面よりインポートします。  </p><h3 id="Q-“署名オプション”-や-“署名アルゴリズム”-はなにを設定すればいいの？"><a href="#Q-“署名オプション”-や-“署名アルゴリズム”-はなにを設定すればいいの？" class="headerlink" title="Q: “署名オプション” や “署名アルゴリズム” はなにを設定すればいいの？"></a><span style="color: blue; ">Q:</span> “署名オプション” や “署名アルゴリズム” はなにを設定すればいいの？</h3><p><span style="color: red; ">A:</span> アプリケーションの実装に依存するため、アプリケーションベンダーへご確認ください。<br>“署名オプション” は、Azure AD が返す SAML レスポンスのどこに署名するかを決める設定となります。<br>“署名アルゴリズム” は、署名に用いるアルゴリズムを決める設定となります。<br><img src="/blog/azure-active-directory/how-to-update-samlsigningcertificate/CertificateDetail-Signature.png"></p><ul><li><a href="https://docs.microsoft.com/ja-jp/azure/active-directory/manage-apps/certificate-signing-options">SAML トークンの詳細な証明書署名オプション | Microsoft Docs</a></li></ul><h3 id="Q-SAML-署名証明書がきれる前に通知できますか？"><a href="#Q-SAML-署名証明書がきれる前に通知できますか？" class="headerlink" title="Q: SAML 署名証明書がきれる前に通知できますか？"></a><span style="color: blue; ">Q:</span> SAML 署名証明書がきれる前に通知できますか？</h3><p><span style="color: red; ">A:</span> 可能です。<br>SAML 証明書の有効期限が切れる 60 日前、30 日前、7 日前に、登録したメールアドレスへ、通知メールが送信されます。<br>メールアドレスは複数登録することも可能です。<br>メールアドレスの登録は以下の画面で実施できます。  </p><p>[Azure ポータル] - [Azure Active Directory] - [エンタープライズ アプリケーション] - [&lt;ご利用の SAML アプリケーション&gt;] - [シングルサインオン] - [SAML 署名証明書 の “編集” をクリック]<br>該当のメールアドレスを登録して “保存” をクリック<br><img src="/blog/azure-active-directory/how-to-update-samlsigningcertificate/CertificateDetail-Notification.png"></p><p>送信されるメールのサンプルはこちらになります。<br><img src="/blog/azure-active-directory/how-to-update-samlsigningcertificate/NotificationSample.png"></p><ul><li><a href="https://docs.microsoft.com/ja-jp/azure/active-directory/manage-apps/manage-certificates-for-federated-single-sign-on#add-email-notification-addresses-for-certificate-expiration">証明書の有効期限のメール通知アドレスの追加 | Microsoft Docs</a></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは！ Azure &amp;amp; Identity サポート チームの三浦 大です。&lt;/p&gt;
&lt;p&gt;Azure AD (IDP) とアプリケーション (SP) を、SAML 連携させた (させたい) といったお客様もいらっしゃるかと思います。&lt;br&gt;今回は、Azure </summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="Application" scheme="https://jpazureid.github.io/blog/tags/Application/"/>
    
  </entry>
  
  <entry>
    <title>アプリでゼロ トラスト対応を実現する 2 - 最小限の特権で設計する</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/achieving-zero-trust-readiness-in-your-apps-2-designing-for-least-privilege/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/achieving-zero-trust-readiness-in-your-apps-2-designing-for-least-privilege/</id>
    <published>2022-01-24T00:00:00.000Z</published>
    <updated>2022-03-28T02:13:39.611Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Azure Identity サポート チームの竜です。</p><p>本記事は、2022 年 1 月 18 日に米国の Azure Active Directory Identity Blog で公開された <a href="https://techcommunity.microsoft.com/t5/azure-active-directory-identity/achieving-zero-trust-readiness-in-your-apps-2-designing-for/ba-p/2959986">Achieving Zero Trust readiness in your apps #2: Designing for Least Privilege</a> を意訳したものになります。</p><hr><p>こんにちは、Jeff Sakowicz です。Microsoft Identity チームで、Application Platform Security の Principal Program Management Lead をしています。私たちのチームの目標は、安全で信頼性が高く、発展的なアプリのエコシステムを作っていくことです。この目標を達成する一環として、アプリがゼロ トラストのセキュリティ モデルをサポートできるようにすることがあげられます。</p><p>前回に続き、今回は「なぜ開発者にとってゼロ トラストが重要なのか」についての二つ目の記事となります。<a href="https://jpazureid.github.io/blog/azure-active-directory/Achieving-ZeroTrust-readiness-in-your-apps1-Why-it-matters/">前回</a> は、<a href="https://www.microsoft.com/ja-jp/security/business/zero-trust?rtc=1">ゼロ トラスト</a> の原則およびゼロ トラストが ID とアクセス管理にどのように適用されるかをご紹介しました。今回は、Microsoft の ID プラットフォームにおいて、「<strong>最小限の特権アクセスの原則</strong>を使用してアプリケーションを設計する方法」についてご説明します。</p><h2 id="なぜ最小特権アクセスの使用にこだわる必要があるのでしょうか？"><a href="#なぜ最小特権アクセスの使用にこだわる必要があるのでしょうか？" class="headerlink" title="なぜ最小特権アクセスの使用にこだわる必要があるのでしょうか？"></a>なぜ最小特権アクセスの使用にこだわる必要があるのでしょうか？</h2><p>端的に言うと、アプリケーションの許可を制限することで、攻撃された場合に影響を受ける範囲を減らし、アプリを利用する顧客を増やすことができるからます。実際のところ、IT 管理者はアプリから要求される権限を確認する際やアプリに権限を付与するかどうかを決定する際に、以前より厳しく精査を行うようになっています。たくさんの権限を要求するアプリを作成した場合、アプリが承認される可能性が低くなり、時にはアプリの利用が完全に拒否される場合もあります。</p><h2 id="過剰な特権とは何でしょうか？過剰な特権が与えられているアプリとはどんなものでしょうか？"><a href="#過剰な特権とは何でしょうか？過剰な特権が与えられているアプリとはどんなものでしょうか？" class="headerlink" title="過剰な特権とは何でしょうか？過剰な特権が与えられているアプリとはどんなものでしょうか？"></a>過剰な特権とは何でしょうか？過剰な特権が与えられているアプリとはどんなものでしょうか？</h2><p>ある主体が必要以上の特権を要求し、場合によってはそのアクセス許可が付与されることを、私たちは「過剰な特権」と呼んでいます。この記事では、Microsoft Graph API を呼び出すクライアント アプリのシナリオを例に、Microsoft ID プラットフォーム上で使用される OAuth 2.0 のアクセス許可において「過剰な権限が与えられているアプリ」に特に着目して説明します。この記事に記載されている原則は、他のアクセス許可のモデルや API にも適用可能なため、より詳細については今後の記事でも説明していく予定です。</p><p>過剰な特権は、アプリが「<strong>未使用の</strong>」または「<strong>削減可能な</strong>」アクセス許可を要求し、そのアクセス許可を付与された場合に発生します。</p><ol><li>「<strong>未使用のアクセス許可</strong>」とは、目的の作業には全く必要のないアクセス許可を指します。例えば、カレンダー アプリが、”Files.ReadWrite.All” アクセス許可を取得しているにもかかわらず、Files API を利用していない場合は、<strong>未使用の</strong>アクセス許可が存在することになります。</li><li>「<strong>削減可能なアクセス許可</strong>」とは、必要な作業を実行するためのアクセスを満たす、より低い特権を持つアクセス許可を指します。例えば、サインインしたユーザーの OneDrive からファイルを読み込む必要があるが、新しいファイルの作成や既存のファイルの変更は必要としないアプリを考えてみましょう。このアプリが “Files.ReadWrite.All” アクセス許可を要求し付与された場合は、アプリは削減可能なアクセス許可を持つことになります。このアプリは 、”Files.ReadWrite.All” ではなく、”Files.Read.All” を要求することが適切です。</li></ol><h2 id="過剰な特権が付与されているアプリに対応するうえでの最終的な目標は何でしょうか？"><a href="#過剰な特権が付与されているアプリに対応するうえでの最終的な目標は何でしょうか？" class="headerlink" title="過剰な特権が付与されているアプリに対応するうえでの最終的な目標は何でしょうか？"></a>過剰な特権が付与されているアプリに対応するうえでの最終的な目標は何でしょうか？</h2><p>MMicrosoft ID チームは、過剰な特権を付与されているアプリへの対応を進めるために、3 つの主要な目標を掲げています。</p><ol><li><strong>開発者</strong>が、過剰なアクセス許可を要求せず、スムーズに採用されるような信頼できるアプリを構築できるように支援します。不必要な権限を要求すると、アプリが利用される環境において、ユーザーおよび IT 部門、さらには組織で設定された <a href="https://docs.microsoft.com/ja-jp/azure/active-directory/manage-apps/configure-user-consent?tabs=azure-portal">アプリの同意ポリシー</a> の間で不和が生じます。</li><li><strong>IT 管理者やその他の意思決定者</strong>が過剰な特権を持つアプリを制限できるよう、組織内で必要な最小限のアクセス許可を特定する方法や、最小限のアクセス許可を要求および付与する方法について支援します。</li><li>侵害の範囲を拡大したり、組織内での別マシンへのさらなる乗っ取を防止したりするような特権を<strong>攻撃者</strong>が取得できないように防止します。</li></ol><h2 id="アプリを確実に最小特権化するにはどうすれば良いのでしょうか？"><a href="#アプリを確実に最小特権化するにはどうすれば良いのでしょうか？" class="headerlink" title="アプリを確実に最小特権化するにはどうすれば良いのでしょうか？"></a>アプリを確実に最小特権化するにはどうすれば良いのでしょうか？</h2><p>ここでは、開発者と IT 管理者が、「アプリケーションの最小特権の原則を遵守すること」を考える際に、念頭に置くべき 3 つのベスト プラクティスをざっくりとご紹介します。</p><ol><li>未使用のアクセス許可や削減可能なアクセス許可を避け、過剰な特権を<strong>防止</strong>しましょう。アプリケーションが API の呼び出しに必要とするアクセス許可を確認し、お客様のシナリオを実現するために必要なものだけを要求しましょう。</li><li>お手持ちのアプリに対して既に付与されたアクセス許可を定期的に<strong>監査</strong>し、アクセス許可を削減もしくは削除できないか確認しましょう。つまり、IT 管理者においてはテナント内のアプリに付与されたアクセス許可を監査し、開発者はアプリが要求しているアクセス許可を確認しましょう。</li><li>アプリを<strong>アップデート</strong>して、未使用のアクセス許可や削減可能なアクセス許可を要求しないようにし、また以前付与されたアクセス許可の中でも不要になったものを取り消しましょう。</li></ol><p>マイクロソフトは、このプロセスを支援するツールを用意しています。例えば、<a href="https://developer.microsoft.com/ja-jp/graph/graph-explorer">Graph Explorer</a> を使用することで、お客様のシナリオを実現するためにどのような Microsoft Graph API の呼び出しが必要か確認いただけます。その後、Microsoft Graph の<a href="https://docs.microsoft.com/ja-jp/graph/permissions-reference">アクセス許可のリファレンス</a> を使用し、Microsoft Graph の最小限の特権から最大限の特権の中で、適切なアクセス許可を見つけることができます。</p><p>具体的な手順については、こちらの資料をご参照ください: <a href="https://docs.microsoft.com/ja-jp/azure/active-directory/develop/secure-least-privileged-access">最小限の特権の原則でセキュリティを高める</a></p><h2 id="ゼロ-トラストへ対応した開発を始める方法"><a href="#ゼロ-トラストへ対応した開発を始める方法" class="headerlink" title="ゼロ トラストへ対応した開発を始める方法"></a>ゼロ トラストへ対応した開発を始める方法</h2><p>さらに詳しく知りたい方は、<a href="https://docs.microsoft.com/security/zero-trust/">Zero Trust Guidance Center</a> に公開された開発者向けの新しいガイダンスをご覧ください。このガイダンスには、Zero Trust に対応したアプリケーションを開発するための <a href="https://docs.microsoft.com/en-us/security/zero-trust/identity-developer">新しい開発および統合リソース</a> が含まれています。</p><p>詳細については、こちらからダウンロードできる開発者向けホワイトペーパーをご覧ください: <a href="https://aka.ms/ztdev">Zero Trust for the Microsoft Identity developer</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Azure Identity サポート チームの竜です。&lt;/p&gt;
&lt;p&gt;本記事は、2022 年 1 月 18 日に米国の Azure Active Directory Identity Blog で公開された &lt;a href=&quot;https://techcommu</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="US Identity Blog" scheme="https://jpazureid.github.io/blog/tags/US-Identity-Blog/"/>
    
  </entry>
  
</feed>

<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Japan Azure Identity Support Blog</title>
  
  <subtitle>日本マイクロソフトの Azure Active Directory と AD FS に関するサポート情報のブログです。</subtitle>
  <link href="https://jpazureid.github.io/blog/atom.xml" rel="self"/>
  
  <link href="https://jpazureid.github.io/blog/"/>
  <updated>2021-09-16T18:49:48.566Z</updated>
  <id>https://jpazureid.github.io/blog/</id>
  
  <author>
    <name>Azure Identity Support Japan</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Azure AD Graph および MSOnline での従来のライセンスの割り当て方法が廃止され Microsoft Graph によるライセンス管理に変わります</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/migrate-your-apps-to-access-the-license-managements/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/migrate-your-apps-to-access-the-license-managements/</id>
    <published>2021-09-17T00:00:00.000Z</published>
    <updated>2021-09-16T18:49:48.566Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Azure Identity サポート チームの 馮 です。</p><p>本日は、2021 年 8 月 26 日に米国の Azure Active Directory Identity Blog で公開された <a href="https://techcommunity.microsoft.com/t5/azure-active-directory-identity/migrate-your-apps-to-access-the-license-managements-apis-from/ba-p/2464366">Migrate your apps to access the license managements APIs from Microsoft Graph</a> を元に、今後推奨されるライセンス割り当て方法について紹介いたします。英語記事の翻訳内容に加え、Microsoft Graph PowerShell を用いた今後の推奨手順をお纏めしましたので、ぜひご参照ください。</p><p>ご不明点等ございましたらサポート チームまで遠慮なくお問い合わせください。</p><h2 id="ライセンス割り当て-API-の廃止"><a href="#ライセンス割り当て-API-の廃止" class="headerlink" title="ライセンス割り当て API の廃止"></a>ライセンス割り当て API の廃止</h2><p><a href="https://techcommunity.microsoft.com/t5/azure-active-directory-identity/update-your-applications-to-use-microsoft-authentication-library/ba-p/1257363">Azure Active Directory (Azure AD) Graphのサポートが 2022 年 6 月 30 日に終了する</a> ため、Microsoft Graph を使用するようアプリケーションをアップデートするよう <a href="https://jpazureid.github.io/blog/azure-active-directory/have-you-updated-your-applications-to-use-the-microsoft/">6 月にご案内いたしました</a>。これ以降、Azure AD Graph を使用するアプリは、Azure AD Graph エンドポイントからの応答を受け取れなくなります。 </p><p>Azure AD Graph API の廃止に伴い、MSOnline および Azure AD PowerShell モジュールでのライセンス割り当て操作も利用できなくなります。運用への影響を軽減するために、Microsoft Graph エンドポイントのライセンス割り当て API を使用するよう既存のアプリケーションを更新するとともに、Microsoft Graph PowerShell モジュールを使用できるようにスクリプトを更新することをお勧めいたします。MSOnline および Azure AD PowerShell モジュールにおけるその他の操作には影響はありません。</p><p>以下の表は、2022 年 6 月 30 日以降、利用できなくなる操作の一覧です。</p><table>  <thead>    <tr>      <th>既存のコマンド (2022 年 6 月 30 日以降、利用できなくなる操作)</th>      <th>今後使用が推奨される Microsoft Graph PowerShell および API</th>    </tr>  </thead>  <tbody>    <tr>      <td><a href ="https://docs.microsoft.com/ja-jp/powershell/module/msonline/?view=azureadps-1.0" target="_blank">MSOnline Powershell</a>      <br/>・Set-MsolUserLicense      <br/>・New-MsolUser (-LicenseAssignment か -LicenseOptions を指定)</td>      <td rowspan="2">Microsoft Graph PowerShell      <br/>・<a href="https://docs.microsoft.com/ja-jp/powershell/module/microsoft.graph.users.actions/set-mguserlicense?view=graph-powershell-1.0" target="_blank">Set-MgUserLicense</a>      </td>    </tr>    <tr>      <td><a href="https://docs.microsoft.com/en-us/powershell/azure/active-directory/overview?view=azureadps-2.0">Azure AD Powershell</a>      <br/>・Set-AzureADUserLicense      </td>    </tr>    <tr>      <td>Azure AD Graph API (graph.windows.net)      <br/>・assignLicense</td>      <td>Microsoft Graph API      <br/>・<a href="https://docs.microsoft.com/ja-jp/graph/api/user-assignlicense?view=graph-rest-1.0&tabs=http">assignLicense</a></td>    </tr>      </tbody></table><h2 id="次のステップ-新しいライセンス管理プラットフォーム"><a href="#次のステップ-新しいライセンス管理プラットフォーム" class="headerlink" title="次のステップ: 新しいライセンス管理プラットフォーム"></a>次のステップ: 新しいライセンス管理プラットフォーム</h2><p>現在のライセンス管理機能は、グループベースのライセンスなど新機能の登場によりお客様のニーズに対応して成長してきました。しかし、お客様のニーズの変化に伴い、私たちはオンライン サービスのライセンス割り当てプラットフォームを再構成することを決定しました。将来のプラットフォームの変更は以下 4 つの主要な目標を念頭に置き設計されています。</p><ul><li>柔軟性: 単一の管理構造や一つの巨大なユーザー グループ、単一のテナントを超えた拡張性を提供する。</li><li>簡潔性: 不必要な複雑さを減らし、エンド ユーザーへのライセンス割り当てをシンプルにする。</li><li>迅速性: 購入したライセンスに迅速にアクセスできるようにする。</li><li>正確性: 購入したライセンスと割り当て可能なライセンスをわかりやすく表示する。</li></ul><p>このビジョン全体を実現するには時間を要しますが、本日、ビジョンの実現に向けた最初のマイルストーンをご紹介します。2022 年の第 1 四半期から、お客様は新しいライセンス管理プラットフォームの使用を選択できるようになります。このマイルストーンの一環として以下の機能が提供されます。</p><ul><li>ライセンスの分配機能により、ライセンスを小さな単位に分けて使用するライセンス数に制限を設けたり、所有権を委任して管理できるようになります。</li><li>グループベースのライセンス割り当て機能が拡張されます。新しいライセンス割り当てプラットフォームでは、グループ ベースのライセンス割り当てに Azure AD Premium または Office 365 E3 ライセンスは必要なくなります。加えて、ライセンス割り当て対象として入れ子 (ネスト) グループが利用可能となります。</li><li>新しいライセンスの種類として、<a href="https://docs.microsoft.com/ja-jp/deployoffice/device-based-licensing">デバイスベースのライセンス</a> や <a href="https://powerapps.microsoft.com/en-us/blog/partners-introducing-a-new-way-to-manage-and-enforce-licenses-for-your-products/">ISV アプリのライセンス</a> などが新プラットフォームにてネイティブに動作します。</li></ul><p>今後は、新しいライセンス管理プラットフォームの利用方法や、新機能を活用するための新しい API や PowerShell オプションの詳細などをご紹介していく予定です。</p><h2 id="Microsoft-Graph-PowerShell-を用いたライセンス割り当て手順"><a href="#Microsoft-Graph-PowerShell-を用いたライセンス割り当て手順" class="headerlink" title="Microsoft Graph PowerShell を用いたライセンス割り当て手順"></a>Microsoft Graph PowerShell を用いたライセンス割り当て手順</h2><p><a href="https://docs.microsoft.com/ja-jp/microsoft-365/enterprise/assign-licenses-to-user-accounts-with-microsoft-365-powershell?view=o365-worldwide">PowerShell を用いた従来のライセンス割り当て操作</a> の代替として、Microsoft Graph PowerShell を用いた手順をお纏めしましたので皆様のご参考となれば幸いです。参考情報としては <a href="https://docs.microsoft.com/ja-jp/powershell/module/microsoft.graph.users.actions/set-mguserlicense?view=graph-powershell-1.0">Set-MgUserLicense</a> をご覧ください。</p><p>以下では、テンプレート ユーザー（<a href="mailto:&#x74;&#101;&#109;&#112;&#108;&#x61;&#116;&#101;&#x75;&#x73;&#x65;&#114;&#64;&#99;&#x6f;&#x6e;&#x74;&#x6f;&#115;&#x6f;&#46;&#x63;&#x6f;&#x6d;">&#x74;&#101;&#109;&#112;&#108;&#x61;&#116;&#101;&#x75;&#x73;&#x65;&#114;&#64;&#99;&#x6f;&#x6e;&#x74;&#x6f;&#115;&#x6f;&#46;&#x63;&#x6f;&#x6d;</a>）に割り当てられたライセンス情報に基づいて、ユーザー (<a href="mailto:&#117;&#x73;&#101;&#114;&#x40;&#x63;&#111;&#110;&#x74;&#111;&#115;&#111;&#46;&#99;&#111;&#109;">&#117;&#x73;&#101;&#114;&#x40;&#x63;&#111;&#110;&#x74;&#111;&#115;&#111;&#46;&#99;&#111;&#109;</a>) に新たにライセンスを追加する例を説明します。</p><ol><li>準備として Microsoft Graph PowerShell モジュールをインストールします。</li></ol><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Install-Module</span> <span class="literal">-Name</span> Microsoft.Graph</span><br></pre></td></tr></table></figure><p>参考情報：<a href="https://docs.microsoft.com/ja-jp/graph/powershell/installation">Microsoft Graph PowerShell SDK をインストールする</a></p><ol start="2"><li>下記のコマンドを実行し、サインインとライセンス管理に必要なアクセス許可への同意を行います。認証画面がポップアップしますので、グローバル管理者アカウントでサインインします。アクセス許可の同意が求められますので、[承諾] をクリックします。</li></ol><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Connect-MgGraph</span> <span class="literal">-Scopes</span> <span class="string">&quot;User.ReadWrite.All&quot;</span></span><br></pre></td></tr></table></figure><ol start="3"><li>ライセンスを割り当てるためには、割り当てるライセンスの SkuId が必要となるので、Get-MgUserLicenseDetail コマンドを利用し、Skuld プロパティを取得します。</li></ol><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="variable">$LicenseDetail</span> = <span class="built_in">Get-MgUserLicenseDetail</span> <span class="literal">-UserId</span> templateuser@contoso.com</span><br><span class="line"><span class="variable">$SkuId</span> = <span class="variable">$LicenseDetail</span>.SkuId</span><br></pre></td></tr></table></figure><ol start="4"><li>SkuId を指定した MicrosoftGraphAssignedLicense オブジェクトを作成します。</li></ol><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="variable">$License</span> = <span class="built_in">New-Object</span> <span class="literal">-TypeName</span> Microsoft.Graph.PowerShell.Models.MicrosoftGraphAssignedLicense <span class="literal">-Property</span> <span class="selector-tag">@</span>&#123;SkuId = <span class="variable">$SkuId</span>&#125;</span><br></pre></td></tr></table></figure><ol start="5"><li>AddLicenses パラメーターに手順  4 にて作成した $Licenses オブジェクトを指定し、 ユーザーに割り当てます。なお、RemoveLicenses パラメータは必須なので、空の配列を指定します。</li></ol><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Set-MgUserLicense</span> <span class="literal">-UserId</span> User@contoso.com <span class="literal">-AddLicenses</span> <span class="selector-tag">@</span>(<span class="variable">$License</span>) <span class="literal">-RemoveLicenses</span> <span class="selector-tag">@</span>()</span><br></pre></td></tr></table></figure><p>以上で、ライセンス割り当ては完了となります。</p><p>なお、Microsof Graph PowerShell では、手順５にて <a href="https://docs.microsoft.com/ja-jp/powershell/module/microsoft.graph.groups/set-mggrouplicense?view=graph-powershell-1.0">Set-MgGroupLicense</a> を実行することで、グループに対するライセンス割り当てを行うことも可能です。</p><p>上記手順が皆様の参考となれば幸いです。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Azure Identity サポート チームの 馮 です。&lt;/p&gt;
&lt;p&gt;本日は、2021 年 8 月 26 日に米国の Azure Active Directory Identity Blog で公開された &lt;a href=&quot;https://techcomm</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="US Identity Blog" scheme="https://jpazureid.github.io/blog/tags/US-Identity-Blog/"/>
    
    <category term="Microsoft Graph" scheme="https://jpazureid.github.io/blog/tags/Microsoft-Graph/"/>
    
  </entry>
  
  <entry>
    <title>新しい Azure AD エンタイトルメント管理機能でパートナー (外部ユーザー) との連携をより簡単に</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/onboard-partners-more-easily-with-new-azure-ad-entitlement/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/onboard-partners-more-easily-with-new-azure-ad-entitlement/</id>
    <published>2021-09-12T00:00:00.000Z</published>
    <updated>2021-09-16T18:49:48.586Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Azure Identity サポート チームの 村上 です。</p><p>本記事は、2021 年 9 月 2 日に米国の Azure Active Directory Identity Blog で公開された <a href="https://techcommunity.microsoft.com/t5/azure-active-directory-identity/onboard-partners-more-easily-with-new-azure-ad-entitlement/ba-p/2466924">Onboard partners more easily with new Azure AD entitlement management features</a> を意訳したものになります。ご不明点等ございましたらサポート チームまでお問い合わせください。</p><hr><p>先日導入された Azure Active Directory の 2 つのエンタイトルメント管理機能 (<a href="https://techcommunity.microsoft.com/t5/azure-active-directory-identity/onboard-partners-more-easily-with-new-azure-ad-entitlement/ba-p/2466924">カスタム質問</a>と<a href="https://docs.microsoft.com/ja-jp/azure/active-directory/governance/entitlement-management-catalog-create#add-resources-to-a-catalog">属性収集</a>) により、パートナー (外部ユーザー) を簡単かつ効率的に業務に参加させることができるようになりました。本日はこの新しい機能についてご紹介するとともに、パートナーの業務参加プロセスにどのように役立つかをお伝えします。これらの追加機能により、Azure AD の ID ガバナンスが強化され、一貫したプロセスと可視性を備えつつセキュリティと生産性を両立するよう支援いたします。</p><p>パートナーの業務参加プロセスでは、アクセス権の付与に加え、使用するアプリやリソースに合わせてアカウントを適切に設定するため、パートナーに関する情報を確認するプロセスが発生します。例えば、パートナーに特定の Teams へのアクセスを許可する際は、実際に許可を行う前に、承認者はパートナーにその Teams への参加が適切かどうかを確認する必要があり、そのためにパートナーの組織内での役割を確認したいと考えると思います。また、パートナーが在庫管理アプリを使用する場合は、従業員と同じように location 属性の設定が必要な場合もあるかもしれません。</p><p>従来は、アカウント設定やアクセス権を付与する前に、情報を収集するためのカスタム フォームを作成していた企業もあるかと思います。フォームの構築には費用がかかる上に、運用するのも大変でした。そこで、以下のエンタイトルメント管理の新機能では、承認者やアプリに対して、パートナーの必要情報を自動的に収集できるようにしました。</p><h2 id="カスタム質問の設定"><a href="#カスタム質問の設定" class="headerlink" title="カスタム質問の設定"></a>カスタム質問の設定</h2><p><a href="https://docs.microsoft.com/ja-jp/azure/active-directory/governance/entitlement-management-access-package-create#add-requestor-information-to-an-access-package">エンタイトルメント管理アクセス パッケージのカスタム質問機能</a> では、申請プロセスにおいて申請者が回答する必要のある質問を設定できます。この機能は既に一般公開されており、回答形式を自由記述や多肢選択式にしたり、異なる場所のパートナーに合わせて質問文をローカライズすることもできます。</p><p><img src="/blog/azure-active-directory/onboard-partners-more-easily-with-new-azure-ad-entitlement/Newaccesspackage.png"></p><p>(Azure Portal &gt; Identity Governance &gt; アクセス パッケージ &gt; 新しいアクセス パッケージ &gt; 要求元情報)</p><p>カスタム質問を設定すると、申請するパートナーは、申請プロセスの一部としてこれらの質問に回答します。この回答を確認したうえで、承認者はパートナーの申請を承認するかどうかを決定することができます。</p><h2 id="既定の属性の指定"><a href="#既定の属性の指定" class="headerlink" title="既定の属性の指定"></a>既定の属性の指定</h2><p>申請時に取得したパートナー情報を保存したい場合、既定の属性もしくはカスタム属性を指定して、申請者のユーザー オブジェクト自体に情報を保存することも可能です。この <a href="https://docs.microsoft.com/ja-jp/azure/active-directory/governance/entitlement-management-catalog-create#add-resources-to-a-catalog">属性収集機能</a> は、このほどパブリック プレビューとして公開された機能で、例えば在庫管理アプリがユーザーの location 属性を使用する場合には、アプリが適切に機能するよう location 属性をユーザー オブジェクトに設定することが可能となります。この属性設定は、上記のカスタム質問設定と似ていますが、個々のアクセス パッケージではなく、カタログ内のリソース (この場合は在庫管理アプリ) で使用されます。</p><p><img src="/blog/azure-active-directory/onboard-partners-more-easily-with-new-azure-ad-entitlement/corsoinventory.png"></p><p>(Azure Portal &gt; Identity Governance &gt; カタログ &gt; 該当のカタログを選択 &gt; リソース &gt; 属性が必要)</p><p>アクセス パッケージに、属性収集のために設定されたリソースが含まれている場合、申請したパートナーはアクセス パッケージ自体に指定されたカスタムの質問に加えて、属性収集に設定した値を自動的に尋ねられます。提供された属性情報は承認者にも提示され、申請が承認されると、申請したパートナーのユーザー オブジェクトに書き込まれます。</p><p><img src="/blog/azure-active-directory/onboard-partners-more-easily-with-new-azure-ad-entitlement/requestaccess.png"></p><p>申請者に関して複数の情報提供を要求するシナリオは、パートナーやベンダーなど、リソースへのアクセスを要求する人物が外部ユーザーの場合によく見られますが、この機能はテナント内の従業員にも使用できます。 </p><h2 id="是非機能をお試しください"><a href="#是非機能をお試しください" class="headerlink" title="是非機能をお試しください"></a>是非機能をお試しください</h2><p>すでにエンタイトルメント管理を利用している場合は、既存のアクセス パッケージに質問や必須属性を簡単に追加することができます。初めて利用する場合は、新しいアクセス パッケージを作成および設定することで、この機能を利用することができます。皆様のご意見をお待ちしております。コメントや Twitter でフィードバックをお寄せください。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Azure Identity サポート チームの 村上 です。&lt;/p&gt;
&lt;p&gt;本記事は、2021 年 9 月 2 日に米国の Azure Active Directory Identity Blog で公開された &lt;a href=&quot;https://techcom</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="US Identity Blog" scheme="https://jpazureid.github.io/blog/tags/US-Identity-Blog/"/>
    
  </entry>
  
  <entry>
    <title>HashiCorp 社の Azure AD プロバイダーが Microsoft Graph に移行しパフォーマンスとユーザー体験が向上</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/hashicorp-s-azure-ad-provider-migrates-to-microsoft-graph/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/hashicorp-s-azure-ad-provider-migrates-to-microsoft-graph/</id>
    <published>2021-09-11T00:00:00.000Z</published>
    <updated>2021-09-16T18:49:48.494Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Azure Identity サポート チームの中井です。</p><p>本記事は、2021 年 9 月 1 日に米国の Azure Active Directory Identity Blog で公開された <a href="https://techcommunity.microsoft.com/t5/azure-active-directory-identity/hashicorp-s-azure-ad-provider-migrates-to-microsoft-graph/ba-p/2115720">HashiCorp’s Azure AD Provider Migrates to Microsoft Graph, Improving Performance and User Experience</a> を意訳したものになります。ご不明点等ございましたらサポート チームまでお問い合わせください。</p><hr><p>こんにちは。Identity ＆ Access Management プログラム マネジメント担当 パートナー ディレクターの Sue Bohn です。今回の Voice of the ISV ブログ記事では、<strong>HashiCorp 社のシニア エンジニアである Tom Bamford 氏</strong> をお招きし、同社の Terraform Azure AD プロバイダーの新しい Microsoft Graph API への移行についてご紹介します。HashiCorp 社は、<a href="https://techcommunity.microsoft.com/t5/azure-active-directory-identity/update-your-applications-to-use-microsoft-authentication-library/ba-p/1257363">2022 年 6 月 30 日のサポート終了日</a> よりも大幅に前倒しで、Azure AD Graph と Azure Active Directory Authentication Library (ADAL) からの移行を表明しました。トム氏によると、この決断はすでに成果を上げているといいます。</p><h2 id="ソリューション型ソフトウェアの構築"><a href="#ソリューション型ソフトウェアの構築" class="headerlink" title="ソリューション型ソフトウェアの構築"></a>ソリューション型ソフトウェアの構築</h2><p><a href="https://www.hashicorp.com/">HashiCorp</a> は、アプリケーションの開発、配信、保守などのデータセンター管理に革命を起こすことを目的として 2012 年に設立されたオープンソース ソフトウェア企業です。同社のツールは、物理マシンと仮想マシン、Windows、Linux、SaaS、IaaS の両方を管理しており、お客様の要望を満たすソリューションの構築、次世代技術のサポートに尽力しています。本社はサンフランシスコにありますが、約 1,500 人の従業員のうち約 80% はリモートで勤務しています。</p><h2 id="Terraform-の-Azure-AD-との連携"><a href="#Terraform-の-Azure-AD-との連携" class="headerlink" title="Terraform の Azure AD との連携"></a>Terraform の Azure AD との連携</h2><p><a href="https://www.hashicorp.com/products/terraform">HashiCorp Terraform</a> は、インフラの構築、変更、バージョン管理を安全かつ効率的に行うことができる Infrastructure as Code (IaC) ツールです。Terraform を使用することで、アカウンタビリティを維持しながら、企業の構造や目標に合わせて構成の設計、チーム間の委任、セルフサービスでの基盤構築を実現することができます。<a href="https://www.hashicorp.com/blog/terraform-azuread-provider-now-supports-microsoft-graph">Terraform Azure AD プロバイダー</a> は、<a href="https://azure.microsoft.com/en-us/services/active-directory/">Azure Active Directory (Azure AD)</a> のリソースを Terraform で管理できるようにします。私たちの目標は、Azure AD をより親しみやすく、利用しやすくし、お客様に素晴らしいワークフローを提供することです。また、<a href="https://www.hashicorp.com/products/vault">HashiCorp Vault</a> はユーザーに代わって認証プリンシパルを管理し、Azure AD と密接に連携します。</p><p><img src="/blog/azure-active-directory/hashicorp-s-azure-ad-provider-migrates-to-microsoft-graph/Hashicorp.png"></p><h2 id="変化への対応"><a href="#変化への対応" class="headerlink" title="変化への対応"></a>変化への対応</h2><p>オープンソースのソフトウェア企業として、私たちはお客様に最大限の価値を提供するために、製品をオープンに構築しています。私たちは、マイクロソフトが、今後すべての新しい ID 管理機能が、<a href="https://docs.microsoft.com/en-us/azure/active-directory/develop/msal-migration">Microsoft Authentication Library (MSAL)</a> と Microsoft Graph でのみ提供されると発表した 2019 年から、<a href="https://docs.microsoft.com/en-us/graph/overview">Microsoft Graph</a> の開発を注視してきました。私たちは、Azure AD Graph APIとActive Directory Authentication Library (ADAL) の <a href="https://techcommunity.microsoft.com/t5/azure-active-directory-identity/update-your-applications-to-use-microsoft-authentication-library/ba-p/1257363">サポート終了日である 2022 年 6 月 30 日</a> よりも十分に前に、お客様により良いサービスを提供できるよう、早急に新しい API を採用したいと考えていました。Azure AD は常に更新されているため、古い API に頼ることは時間の経過とともに難しくなります。</p><h2 id="Microsoft-Graphへの移行"><a href="#Microsoft-Graphへの移行" class="headerlink" title="Microsoft Graphへの移行"></a>Microsoft Graphへの移行</h2><p>2 年かけて Microsoft Graph へ移行するというスケジュールが私たちにはぴったりでした。マイクロソフトが <a href="https://docs.microsoft.com/en-us/graph/migrate-azure-ad-graph-planning-checklist?view=graph-rest-1.0">ドキュメントとサポート</a> に多大な投資をしてくれたおかげで、移行作業は非常に簡単でした。私たちの最大の関心事は、お客様に対し移行の過程で互換性を保つことでした。現在では、お客様が新しい Microsoft Graph API への移行を選択した場合でも、ディレクトリ内のリソースに望ましくない変更を加えることなく、また設定を更新することなく移行することができます。</p><h2 id="お客様の成功のために"><a href="#お客様の成功のために" class="headerlink" title="お客様の成功のために"></a>お客様の成功のために</h2><p>私たちは <a href="https://registry.terraform.io/providers/hashicorp/azuread/latest/docs/guides/microsoft-graph">包括的な移行ガイド</a> を作成し、Terraform が Graph API を認証するために必要なプリンシパルから、リソースの設定更新まで、お客様の構成の更新を支援しました。このガイドには、既存のリソースやデータ ソースに加えられた変更も含まれています。Microsoft Graph API へのプロバイダの移行は、メジャー バージョンのリリース (v2.0.0) に対応しているため、お客様に変更内容を認識してもらうことができました。また、移行ガイドには、Microsoft Graph のアクセス許可の変更について説明するセクションを設けました。移行作業中のお客様には、新機能のご紹介は控えさせていただきました。また、Azure AD Graph のサポートを終了する一方で、Microsoft Graph には最高クラスのサポートを開始しています。</p><p>さらに、Terraform と Azure AD v2.0.0 プロバイダの使用方法を説明したチュートリアル <a href="https://learn.hashicorp.com/tutorials/terraform/azure-ad">Manage Azure Active Directory Users and Groups Learn</a> を作成しました。本チュートリアルにて、Terraform の設定言語、Terraform Azure AD プロバイダー、およびワークフローの簡素化と自動化のために両者の活用方法を学ぶことができます。</p><h2 id="パフォーマンスとユーザーエクスペリエンスの向上"><a href="#パフォーマンスとユーザーエクスペリエンスの向上" class="headerlink" title="パフォーマンスとユーザーエクスペリエンスの向上"></a>パフォーマンスとユーザーエクスペリエンスの向上</h2><p>Microsoft Graph に移行してからすぐ、パフォーマンスの向上が見られ、より良いユーザー体験を実現しています。従来の API では、リソースに加えられた変更を確認するために、カスタムのポーリング メカニズムを設定する必要がありました。 Microsoft Graph API では、応答時間が大幅に短縮され、データの一貫性が向上することでこれらの課題解決に寄与しています。今後はお客様から寄せられる多くの機能改善要望にお応えできるようになると考えています。</p><p>お客様にとって最も大きなメリットは、Microsoft Graph API の信頼性向上にあります。Azure AD Graphを使用する以前のプロバイダーでは、お客様は特定の操作を行うために、プリンシパルに管理用のディレクトリロールを割り当てる必要がありました。Microsoft Graph では、パーミッションがより細かく管理され、監査やメンテナンスが可能になっています。また、お客様のテナントとその関連製品を自動化するために、より広い範囲でサービスを提供することができるようになっています。</p><h2 id="教訓と今後の展望"><a href="#教訓と今後の展望" class="headerlink" title="教訓と今後の展望"></a>教訓と今後の展望</h2><p>今回のような移行を計画している開発者は、主にアプリケーション周りにおいて、スキーマの違いによってテナントの特定の構成に影響が生じる可能性があることに注意ください。また、移行中も継続的に可用性を維持できることを確認し、追跡が困難な変更を不用意に行ってしまわないようにしてください。綿密な計画を立てれば、スムーズに移行することができるでしょう。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Azure Identity サポート チームの中井です。&lt;/p&gt;
&lt;p&gt;本記事は、2021 年 9 月 1 日に米国の Azure Active Directory Identity Blog で公開された &lt;a href=&quot;https://techcommu</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="US Identity Blog" scheme="https://jpazureid.github.io/blog/tags/US-Identity-Blog/"/>
    
    <category term="Microsoft Graph" scheme="https://jpazureid.github.io/blog/tags/Microsoft-Graph/"/>
    
  </entry>
  
  <entry>
    <title>Azure AD から Amazon Managed Grafana へのアクセス保護について</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/secure-access-to-amazon-managed-grafana-with-azure-ad/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/secure-access-to-amazon-managed-grafana-with-azure-ad/</id>
    <published>2021-09-05T00:00:00.000Z</published>
    <updated>2021-09-16T18:49:48.618Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Azure Identity サポート チームの竜です。</p><p>本記事は、2021 年 9 月 1 日に米国の Azure Active Directory Identity Blog で公開された <a href="https://techcommunity.microsoft.com/t5/azure-active-directory-identity/secure-access-to-amazon-managed-grafana-with-azure-ad/ba-p/2115721">Secure access to Amazon Managed Grafana with Azure AD</a> を意訳したものになります。ご不明点等ございましたらサポート チームまでお問い合わせください。</p><hr><p>お客様は、アプリケーションやサービスを特定のクラウドやプラットフォームに限らず、幅広く利用されています。そのため、私たちの ID ソリューションも、プラットフォーム間でシームレスかつ安全に動作し、すべてのクラウドやアプリケーションに対応するようにしています。 お客様がアプリケーションの構築に Azure であろうと AWS であろうと、どのクラウド プロバイダーを使用していても、弊社の目標は、<a href="https://www.microsoft.com/ja-jp/security/business/identity-access-management/secure-app-access?rtc=1">お客様のすべてのアプリケーション、サービス、データのセキュリティを確保すること</a> です。そのため、本日、<a href="https://docs.microsoft.com/ja-jp/azure/active-directory/saas-apps/amazon-managed-grafana-tutorial">Azure AD のアプリ ギャラリーにて Amazon Managed Grafana が利用できるようになりました</a> ことを発表いたします。</p><p><a href="https://aws.amazon.com/grafana/">Amazon Managed Grafana</a> を Azure AD のアプリ ギャラリーに統合済みのアプリとして提供することで、シングル サインオンの設定や条件付きアクセス ポリシーの適用を迅速に行い、適切なユーザーが Amazon Managed Grafana にアクセスできるようになります。Grafana は人気の高いオープン ソースの分析プラット フォームです。Grafana をご利用いただくことで、メトリックの保存場所に関わらず、メトリックの検索、アラート、可視化、解析を行うことが可能です。さらに、Amazon Managed Grafana を利用すると、お客様はサーバーのプロビジョニング、ソフトウェアの設定と更新、および本番環境において負担となる Grafana のセキュリティとスケーリングに関わる作業をすることなく、メトリック、ログ、トレースを分析することができます。</p><p><img src="/blog/azure-active-directory/secure-access-to-amazon-managed-grafana-with-azure-ad/BrowseAADGallery.png"></p><p>弊社の Azure AD と Amazon Managed Grafana の統合は、今年初めに発表した <a href="https://docs.microsoft.com/ja-jp/azure/active-directory/saas-apps/aws-single-sign-on-tutorial">AWS SSO 統合</a> を補完するものです。お客様は Azure AD と Amazon Managed Grafana を直接統合いただくこともできますし、AWS SSO 統合を利用してAWS サービス全体で Azure AD のユーザーとグループを一元管理することもできます。</p><p>Amazon Managed Grafana を Azure AD で保護する方法の詳細につきましては、<a href="https://docs.microsoft.com/ja-jp/azure/active-directory/saas-apps/amazon-managed-grafana-tutorial">公開資料</a> や <a href="https://aws.amazon.com/grafana/">Amazon Managed Grafana のウェブ ページ</a> にてご確認ください。いつものように、皆様のご意見やご感想をお聞かせください。</p><p>Sue Bohn<br>Partner Director of Program Management<br>Microsoft Identity Division<br>Twitter: <a href="https://twitter.com/Sue_Bohn">@Sue_Bohn</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Azure Identity サポート チームの竜です。&lt;/p&gt;
&lt;p&gt;本記事は、2021 年 9 月 1 日に米国の Azure Active Directory Identity Blog で公開された &lt;a href=&quot;https://techcommun</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="US Identity Blog" scheme="https://jpazureid.github.io/blog/tags/US-Identity-Blog/"/>
    
  </entry>
  
  <entry>
    <title>2021 年 10 月に予定されるゲスト ユーザー招待時の動作変更について</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/announcement-of-otp/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/announcement-of-otp/</id>
    <published>2021-08-25T15:00:00.000Z</published>
    <updated>2021-09-16T18:49:48.394Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、日本マイクロソフト Azure Identity チームの谷津田です。</p><p>今回はゲストユーザーの招待において、2021 年 10 月以降にサポートされなくなる動作のアナウンスがありましたので、そのアナウンスについてご案内いたします。<br>まず、今回の動作変更の詳細については、以下の公開情報でご確認いただけます。<br><a href="https://docs.microsoft.com/ja-jp/azure/active-directory/external-identities/redemption-experience">https://docs.microsoft.com/ja-jp/azure/active-directory/external-identities/redemption-experience</a></p><div class="alert is-important"><p class="alert-title">重要</p><p>2021 年 10 月 以降、Microsoft では、B2B コラボレーション シナリオ向けのアンマネージド Azure AD アカウントとテナントを作成することによる招待の利用をサポートしなくなります。 準備として、お客様は、電子メール ワンタイム パスコード認証をオプトインすることをお勧めします。</p></div><p> これはゲスト ユーザー招待時の動作が一部変更になることを示しております。</p><p>本ブログでは、アナウンス内容に関連する以下の内容について上から順にご案内いたしますので、適宜必要な情報をご確認ください。</p><ul><li><a href="#%E5%A4%89%E6%9B%B4%E3%81%AB%E3%82%88%E3%82%8B%E6%97%A2%E5%AD%98%E3%83%A6%E3%83%BC%E3%82%B6%E3%83%BC%E3%81%B8%E3%81%AE%E5%BD%B1%E9%9F%BF">変更による既存ユーザーへの影響</a></li><li><a href="#%E3%81%8A%E5%8B%A7%E3%82%81%E3%81%A8%E8%A8%98%E8%BC%89%E3%81%AE%E9%9B%BB%E5%AD%90%E3%83%A1%E3%83%BC%E3%83%AB-%E3%83%AF%E3%83%B3%E3%82%BF%E3%82%A4%E3%83%A0-%E3%83%91%E3%82%B9%E3%82%B3%E3%83%BC%E3%83%89%E8%AA%8D%E8%A8%BC-OTP-%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6">お勧めと記載の電子メール ワンタイム パスコード認証 (OTP) について</a></li><li><a href="#%E3%82%88%E3%81%8F%E3%81%82%E3%82%8B%E3%81%94%E8%B3%AA%E5%95%8F">よくあるご質問</a></li></ul><h2 id="変更による既存ユーザーへの影響"><a href="#変更による既存ユーザーへの影響" class="headerlink" title="変更による既存ユーザーへの影響"></a>変更による既存ユーザーへの影響</h2><p>今回のアナウンスは既に招待済みのゲストユーザーにおいては影響を与えることはありません。<br>あくまで、新規にゲストユーザーの招待を行う際において、招待するユーザーに紐づくテナントの状態に依存して影響があります。</p><p>影響の詳細について、ゲストユーザーの招待フローをベースにご紹介します。<br>以下が現在のゲストユーザーの招待フローです。</p><p><img src="/blog/azure-active-directory/announcement-of-otp/image01.png"></p><p>今回の影響は、フローの 9 において セルフサービスサインアップアカウントが作成される場合においてユーザーのホーム テナントが存在しない場合、あるいは検証済みのテナントではない場合に生じます。</p><p>フロー 9 について abc.onmicrosoft.com というテナントに <a href="mailto:&#x75;&#115;&#x65;&#x72;&#x31;&#x40;&#x63;&#x6f;&#x6e;&#x74;&#111;&#115;&#111;&#46;&#x63;&#111;&#109;">&#x75;&#115;&#x65;&#x72;&#x31;&#x40;&#x63;&#x6f;&#x6e;&#x74;&#111;&#115;&#111;&#46;&#x63;&#111;&#109;</a> というユーザーを招待しようとしたときを例に説明します。</p><h3 id="パターン-1"><a href="#パターン-1" class="headerlink" title="パターン 1 :"></a>パターン 1 :</h3><ul><li>＜前提条件＞</li></ul><p>Azure AD にカスタム ドメインとして contoso.com というドメイン名を登録したテナントがすでに存在している。<br>contoso.com ドメイン名を登録したテナントには <a href="mailto:&#117;&#x73;&#101;&#114;&#49;&#x40;&#99;&#x6f;&#x6e;&#116;&#111;&#115;&#x6f;&#46;&#x63;&#111;&#x6d;">&#117;&#x73;&#101;&#114;&#49;&#x40;&#99;&#x6f;&#x6e;&#116;&#111;&#115;&#x6f;&#46;&#x63;&#111;&#x6d;</a> は存在しない。</p><ul><li>＜動作＞<br>contoso.com が紐づいている Azure AD 上に <a href="mailto:&#117;&#x73;&#101;&#114;&#49;&#64;&#x63;&#x6f;&#x6e;&#x74;&#x6f;&#115;&#x6f;&#46;&#99;&#x6f;&#x6d;">&#117;&#x73;&#101;&#114;&#49;&#64;&#x63;&#x6f;&#x6e;&#x74;&#x6f;&#115;&#x6f;&#46;&#99;&#x6f;&#x6d;</a> が自動で作成されます。この動作は 2021 年 10 月以降も変わりません。</li></ul><h3 id="パターン-2"><a href="#パターン-2" class="headerlink" title="パターン 2 :"></a>パターン 2 :</h3><ul><li><p>＜前提条件＞<br>Azure AD にカスタム ドメインとして contoso.com というドメイン名を登録したテナントが存在していない。<br><a href="mailto:&#x75;&#x73;&#101;&#x72;&#x31;&#x40;&#99;&#111;&#110;&#x74;&#111;&#x73;&#x6f;&#46;&#x63;&#111;&#x6d;">&#x75;&#x73;&#101;&#x72;&#x31;&#x40;&#99;&#111;&#110;&#x74;&#111;&#x73;&#x6f;&#46;&#x63;&#111;&#x6d;</a> は Azure AD のアカウントとして Azure AD のどのテナントにも存在しない。</p></li><li><p>＜動作＞<br>現状は contoso.com が紐づくセルフ サインアップ テナントが自動で作成され、その自動で作成されたテナントに <a href="mailto:&#117;&#115;&#x65;&#x72;&#x31;&#x40;&#99;&#x6f;&#x6e;&#116;&#111;&#x73;&#111;&#46;&#99;&#111;&#x6d;">&#117;&#115;&#x65;&#x72;&#x31;&#x40;&#99;&#x6f;&#x6e;&#116;&#111;&#x73;&#111;&#46;&#99;&#111;&#x6d;</a> が自動で作成されます。2021 年 10 月以降は、このパターンでの自動テナント作成が行われなくなり、結果的にゲスト ユーザーの招待は失敗する見込みです。</p></li></ul><p>なお、セルフサービス サインアップとは、電子メール ドメインに基づいた ID がどの Azure AD にも存在しない場合に自動でユーザーが作成されることを指します。<br>後述に関連する公開情報もございますので、必要に応じご確認いただけると幸いです。</p><p>公開情報では、”サポートされない” という記載になっておりますが、該当の動作については廃止される可能性はございますので、ゲストユーザー招待に関する運用においては可能な限り、該当の動作を避けるようにワンタイム パスコードなどをご利用くださいますようお願い申し上げます。</p><h2 id="お勧めと記載の電子メール-ワンタイム-パスコード認証-OTP-について"><a href="#お勧めと記載の電子メール-ワンタイム-パスコード認証-OTP-について" class="headerlink" title="お勧めと記載の電子メール ワンタイム パスコード認証 (OTP) について"></a>お勧めと記載の電子メール ワンタイム パスコード認証 (OTP) について</h2><p>アナウンスの後半部分に記載の 電子メール ワンタイム パスコード認証については、Azure AD にアカウントがない、Microsoft アカウントがないなどの状況で、アカウントを作成することなく、招待元 Azure AD (リソーステナント) にアクセスできる機能となります。<br>これまでは、ゲスト招待されたユーザーが Azure AD に所属しないユーザーの場合、上図のフローの通り、フロー 9 で もしくは フロー 10 で パスワードをもつアカウントを作成する必要がありました。<br>電子メール ワンタイム パスコード認証を利用した場合には、リソーステナントにユーザーのソースが OTP として作成されます。</p><p><img src="/blog/azure-active-directory/announcement-of-otp/image02.png"></p><h2 id="よくあるご質問"><a href="#よくあるご質問" class="headerlink" title="よくあるご質問"></a>よくあるご質問</h2><h3 id="Q1-電子メール-ワンタイム-パスコード認証を利用したユーザーが-Azure-Portal-にサインインできない場合にどうしたらよいでしょうか？"><a href="#Q1-電子メール-ワンタイム-パスコード認証を利用したユーザーが-Azure-Portal-にサインインできない場合にどうしたらよいでしょうか？" class="headerlink" title="Q1. 電子メール ワンタイム パスコード認証を利用したユーザーが Azure Portal にサインインできない場合にどうしたらよいでしょうか？"></a>Q1. 電子メール ワンタイム パスコード認証を利用したユーザーが Azure Portal にサインインできない場合にどうしたらよいでしょうか？</h3><p>A1. 電子メール ワンタイム パスコード認証で作成されたゲストユーザーのサインインの動作において、<a href="https://azure.portal.com/">https://azure.portal.com</a> にアクセスできない動作は想定されます。<br>OTP のユーザーについては、招待を行ったテナント (リソーステナント) の情報を URL に含む形式でアクセスする必要があります。<br>そのため、URL として、アクセスしたいテナントを指定する際に、例えば、<a href="https://portal.azure.com/xxx.onmicrosoft.com">https://portal.azure.com/xxx.onmicrosoft.com</a> のような URL を指定することで、ログインすることが可能です。</p><h3 id="Q2-Azure-AD-ポータルの-External-Identities-の-すべてのプロバイダー-の-Email-one-time-passcode-Preview-の設定値で-“2021-年-10-月以降、ゲストのメール-ワンタイム-パスコードが自動的に有効になります。”-になっていますが、有効になった際に既存のゲストユーザーにも影響ありますでしょうか？"><a href="#Q2-Azure-AD-ポータルの-External-Identities-の-すべてのプロバイダー-の-Email-one-time-passcode-Preview-の設定値で-“2021-年-10-月以降、ゲストのメール-ワンタイム-パスコードが自動的に有効になります。”-になっていますが、有効になった際に既存のゲストユーザーにも影響ありますでしょうか？" class="headerlink" title="Q2. Azure AD ポータルの External Identities の [すべてのプロバイダー] の Email one-time passcode (Preview)  の設定値で “2021 年 10 月以降、ゲストのメール ワンタイム パスコードが自動的に有効になります。” になっていますが、有効になった際に既存のゲストユーザーにも影響ありますでしょうか？"></a>Q2. Azure AD ポータルの External Identities の [すべてのプロバイダー] の Email one-time passcode (Preview)  の設定値で “2021 年 10 月以降、ゲストのメール ワンタイム パスコードが自動的に有効になります。” になっていますが、有効になった際に既存のゲストユーザーにも影響ありますでしょうか？</h3><p><img src="/blog/azure-active-directory/announcement-of-otp/image03.png"></p><p>A2. 結論からお伝えしますと、既存のユーザーへの影響はありません。<br>ゲストユーザーの招待におけるフローが変更されるという内容になり、新規でゲストユーザーを招待する際にのみ影響があります。<br>”ゲストのメール ワンタイム パスコードが自動的に有効になる” という設定には、ゲストユーザー招待のフローにおいて、上図のフロー 6 でテナントの設定で自動で YES のフローに流れるというものになります。</p><h3 id="Q3-今回の変更について、新規で作成される-Azure-テナントの-ワンタイムパスワード-パスコードの設定値はどうなりますか？"><a href="#Q3-今回の変更について、新規で作成される-Azure-テナントの-ワンタイムパスワード-パスコードの設定値はどうなりますか？" class="headerlink" title="Q3. 今回の変更について、新規で作成される Azure テナントの ワンタイムパスワード パスコードの設定値はどうなりますか？"></a>Q3. 今回の変更について、新規で作成される Azure テナントの ワンタイムパスワード パスコードの設定値はどうなりますか？</h3><p>A3. 2021 年 10 月以降、電子メール ワンタイム パスコード機能は、新規に作成されるテナントにおいて、既定値として有効になることが期待される動作となります。</p><h3 id="Q4-OTP-を有効し、ゲストユーザーを作成した後に、テナントの設定で-OTP-を無効にしましたが、OTP-で作成したユーザーはどうなりますか？"><a href="#Q4-OTP-を有効し、ゲストユーザーを作成した後に、テナントの設定で-OTP-を無効にしましたが、OTP-で作成したユーザーはどうなりますか？" class="headerlink" title="Q4. OTP を有効し、ゲストユーザーを作成した後に、テナントの設定で OTP を無効にしましたが、OTP で作成したユーザーはどうなりますか？"></a>Q4. OTP を有効し、ゲストユーザーを作成した後に、テナントの設定で OTP を無効にしましたが、OTP で作成したユーザーはどうなりますか？</h3><p>A4. 結論からお伝えいたしますと、OTP として作成されたユーザーは、テナント (リソーステナント) へアクセスすることはできません。<br>そのため、ゲストユーザーの状態引き換え状態をリセットする必要があります。</p><h3 id="Q5-電子メール-ワンタイム-パスコード認証を利用することでセキュリティの強化に繋がりますか？"><a href="#Q5-電子メール-ワンタイム-パスコード認証を利用することでセキュリティの強化に繋がりますか？" class="headerlink" title="Q5. 電子メール ワンタイム パスコード認証を利用することでセキュリティの強化に繋がりますか？"></a>Q5. 電子メール ワンタイム パスコード認証を利用することでセキュリティの強化に繋がりますか？</h3><p>A5. はい、ワンタイムパスワードを利用しない場合と比較し、以下のシナリオでセキュリティ強化に繋がります。<br>まず、ワンタイムパスコードを利用しない場合、ホームテナントに所属するユーザーが会社を退職した際に、ホームテナントに該当のユーザーが残っている場合には、退職者は自身の会社 (ホームテナント) のユーザー名とパスワードを利用し、ホームテナントおよびリソーステナントにアクセスすることが可能です。<br>一方で、ワンタイムパスコードを利用すると、ホームテナントに所属するユーザーが会社を退職した場合、退職者は会社のメールアドレスを利用できなくなるためワンタイムパスコードを受け取ることができず、リソーステナントにアクセスすることはできなくなります。このような状況において、セキュリティの強化に繋がります。<br>後述に関連する公開情報もございますので、必要に応じご確認ください。</p><h3 id="公開情報"><a href="#公開情報" class="headerlink" title="公開情報"></a>公開情報</h3><ul><li><p>[セルフサービス サインアップ]<br>Azure Active Directory のセルフサービス サインアップについて<br><a href="https://docs.microsoft.com/ja-jp/azure/active-directory/enterprise-users/directory-self-service-signup">https://docs.microsoft.com/ja-jp/azure/active-directory/enterprise-users/directory-self-service-signup</a></p></li><li><p>[ゲストユーザーの招待]<br>B2B コラボレーションの招待の利用<br><a href="https://docs.microsoft.com/ja-jp/azure/active-directory/external-identities/redemption-experience">https://docs.microsoft.com/ja-jp/azure/active-directory/external-identities/redemption-experience</a></p></li><li><p>[よくあるご質問の Q1 関連]<br>B2B ゲスト ユーザーのワンタイム パスコード認証<br><a href="https://docs.microsoft.com/ja-jp/azure/active-directory/external-identities/one-time-passcode">https://docs.microsoft.com/ja-jp/azure/active-directory/external-identities/one-time-passcode</a></p></li></ul><div class="alert is-info"><p class="alert-title">Note</p><p>ワンタイム パスコードのユーザーは、テナントのコンテキストを含むリンクを使用してサインインする必要があります (たとえば、<code>https://myapps.microsoft.com/?tenantid=&lt;tenant id&gt;</code> や <code>https://portal.azure.com/&lt;tenant id&gt;</code>、または検証済みのドメインの場合は <code>https://myapps.microsoft.com/&lt;verified domain&gt;</code>)。</p></div><ul><li>[よくあるご質問の Q4 関連]<br>電子メール ワンタイム パスコードを無効にする<br><a href="https://docs.microsoft.com/ja-jp/azure/active-directory/external-identities/one-time-passcode#disable-email-one-time-passcode">https://docs.microsoft.com/ja-jp/azure/active-directory/external-identities/one-time-passcode#disable-email-one-time-passcode</a></li></ul><div class="alert is-info"><p class="alert-title">Note</p><p>お使いのテナントで電子メール ワンタイム パスコード機能が有効になっているときに、それを無効にした場合、ワンタイム パスコードを利用していたゲスト ユーザーは全員サインインできなくなります。 別の認証方法を使用してもう一度サインインできるように、利用状態をリセットすることができます。</p></div><ul><li>[よくあるご質問の Q5 関連]<br>ワンタイム パスコードのゲスト ユーザーに対するユーザー エクスペリエンス<br><a href="https://docs.microsoft.com/ja-jp/azure/active-directory/external-identities/one-time-passcode#user-experience-for-one-time-passcode-guest-users">https://docs.microsoft.com/ja-jp/azure/active-directory/external-identities/one-time-passcode#user-experience-for-one-time-passcode-guest-users</a></li></ul><div class="alert is-info"><p class="alert-title">Note</p><p>ワンタイム パスコードのゲスト ユーザーに対するユーザー エクスペリエンス</p><p>セッションの有効期限により、ゲスト ユーザーが自分の会社を退職したりアクセスを必要としなくなったときに特に、セキュリティが強化されます。</p></div><p>以上の情報がご参考になれば幸いです。<br>ご不明な点がございましたら弊社サポートまでお気軽にお問い合わせください !</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、日本マイクロソフト Azure Identity チームの谷津田です。&lt;/p&gt;
&lt;p&gt;今回はゲストユーザーの招待において、2021 年 10 月以降にサポートされなくなる動作のアナウンスがありましたので、そのアナウンスについてご案内いたします。&lt;br&gt;まず、今回</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="OTP" scheme="https://jpazureid.github.io/blog/tags/OTP/"/>
    
    <category term="B2B" scheme="https://jpazureid.github.io/blog/tags/B2B/"/>
    
  </entry>
  
  <entry>
    <title>8 月のアップデート - Identity Protection 診断設定のご紹介</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/introducing-diagnostic-settings-for-identity-protection-august/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/introducing-diagnostic-settings-for-identity-protection-august/</id>
    <published>2021-08-20T00:00:00.000Z</published>
    <updated>2021-09-16T18:49:48.546Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Azure Identity サポート チームの 村上 です。本記事は、2021 年 8 月 18 日に米国の Azure Active Directory Identity Blog で公開された <a href="https://techcommunity.microsoft.com/t5/azure-active-directory-identity/introducing-diagnostic-settings-for-identity-protection-august/ba-p/2464365">Introducing diagnostic settings for Identity Protection — August identity updates</a> を意訳したものになります。ご不明点等ございましたらサポート チームまでお問い合わせください。</p><hr><p>皆さん、こんにちは。</p><p>今回は、管理者や開発者、ユーザーの利便性を向上させる Active Azure Directory の最新情報や新機能をご紹介します。本アップデートは、セキュアな ID とアクセス管理をよりシンプルにし、さらにお客様が必要とするカスタマイズや操作を強化するものになります。</p><p><img src="/blog/azure-active-directory/introducing-diagnostic-settings-for-identity-protection-august/gif_for_demo.gif"></p><h2 id="診断設定を使用して危険なユーザーとリスク検出を追跡する"><a href="#診断設定を使用して危険なユーザーとリスク検出を追跡する" class="headerlink" title="診断設定を使用して危険なユーザーとリスク検出を追跡する"></a>診断設定を使用して危険なユーザーとリスク検出を追跡する</h2><p>Azure AD Identity Protection の診断設定がパブリック プレビューとなったことで、リスク検出や危険なユーザーのアクティビティに関するログを、ストレージ アカウントや Event Hub、Azure Monitor に送信することができます。これにより、セキュリティ リスクの追跡、そして資格情報の漏洩から組織を守ることが容易になります。また、このデータを 30 日間の既定期間を超えて保持することが可能です。診断設定を利用することで、以下のことが実現できます。</p><ul><li>カスタマイズした Azure Monitor ワークブックを作成し、組織内の資格情報漏洩の傾向を追跡する</li><li>特定の脅威に対してリスク データを参照し、リスクのトラブルシュートに利用する</li><li>危険なユーザーとリスク検出データをサード パーティのセキュリティ情報イベント管理 (SIEMs) に送信し、既存のセキュリティ オペレーション センターの手順に該当のデータを組み込む</li></ul><p><a href="https://docs.microsoft.com/ja-jp/azure/azure-monitor/essentials/diagnostic-settings?tabs=CMD">リスク保護のための診断設定</a> について確認し、以下の 2 ステップで設定ください。</p><ul><li><strong>Azure ポータル</strong> にアクセス &gt; <strong>[Azure Active Directory]</strong> &gt; <strong>[診断設定]</strong> &gt; <strong>[設定の編集]</strong> に進みます<br>(設定していない場合は、[診断設定を追加する] から設定を追加します)</li><li>危険なユーザーのデータは <strong>[RiskyUsers]</strong> を、ユーザーのリスク検出データは <strong>[UserRiskEvents]</strong> を選択します<br>(送信先の  [宛先] を選択し、[保存] をクリックします)</li></ul><p><img src="/blog/azure-active-directory/introducing-diagnostic-settings-for-identity-protection-august/AssignRolesToGroups.PNG"></p><h2 id="グループへのロールの割り当てをより簡単に管理する"><a href="#グループへのロールの割り当てをより簡単に管理する" class="headerlink" title="グループへのロールの割り当てをより簡単に管理する"></a>グループへのロールの割り当てをより簡単に管理する</h2><p><img src="/blog/azure-active-directory/introducing-diagnostic-settings-for-identity-protection-august/2.AssignRolesToGroups.png"></p><p><a href="https://docs.microsoft.com/ja-jp/azure/active-directory/roles/groups-assign-role">Azure AD グループへのロールの割り当て</a> が、より簡単に設定できるようになりました。従来のように個々のユーザーにロールを割り当てる代わりに、[特権ロール管理者] または [グローバル管理者] が、グループに対してロールを割り当てることができます。既に設定しているワーク フローがある場合は、それに沿って承認および監査を行い、適切なユーザーのみがメンバーであることを確認できるようになります。このグループへのロール割り当て機能が一般提供 (GA) となりました。</p><p>また、管理者がグループのオーナーを割り当てることで、[特権ロール管理者] や [グローバル管理者] 以外のメンバーも、グループを管理することができます。グループのオーナーは、グループのメンバーシップを管理し、誰にロールを割り当てるかを管理できます。まずは Azure AD グループでご利用可能ですが、将来的にはオンプレミスのグループにもこの機能が拡張される予定です。</p><h2 id="オーストラリア国内で-B2C-ユーザー-データを保管する"><a href="#オーストラリア国内で-B2C-ユーザー-データを保管する" class="headerlink" title="オーストラリア国内で B2C ユーザー データを保管する"></a>オーストラリア国内で B2C ユーザー データを保管する</h2><p>オーストラリアにおける Azure AD B2C の一般提供 (GA) が開始され、B2C ユーザー データをオーストラリア国内に保存できるようになりました。これによりオーストラリアでホストされているアプリケーションのレイテンシが改善されます。既に B2C テナントをお持ちのお客様は、<a href="https://azure.microsoft.com/en-au/">オーストラリアの Azure ポータル</a> で B2C を検索することで、お試しいただけます。初めてご利用されるお客様は、新しい Azure AD B2C テナントの作成時に、国/地域としてオーストラリアまたはニュージーランドを選択することで、この機能を試すことができます。 </p><h2 id="フィードバックを共有ください"><a href="#フィードバックを共有ください" class="headerlink" title="フィードバックを共有ください"></a>フィードバックを共有ください</h2><p>Azure AD をエンジニアやユーザーの皆様に役立つよう改善したいと考えております。製品の更新はお客様からの要望に基づいたものもよくございます。コメントや <a href="http://twitter.com/azuread">@AzureAD</a> にて皆様のフィードバックや新機能及び今後の改善の提案をおお待ちしております。</p><p>Alex Simons (@Alex_A_Simons)<br>Corporate VP of Program Management<br>Microsoft Identity Division</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Azure Identity サポート チームの 村上 です。本記事は、2021 年 8 月 18 日に米国の Azure Active Directory Identity Blog で公開された &lt;a href=&quot;https://techcommunity.</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="US Identity Blog" scheme="https://jpazureid.github.io/blog/tags/US-Identity-Blog/"/>
    
  </entry>
  
  <entry>
    <title>アクセス レビューにおける職務の分離チェックによるコンプライアンスの確保</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/ensure-compliance-using-separation-of-duties-checks-in-access-jp/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/ensure-compliance-using-separation-of-duties-checks-in-access-jp/</id>
    <published>2021-07-30T00:00:00.000Z</published>
    <updated>2021-09-16T18:49:48.486Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Azure Identity サポート チームの中井です。</p><p>本記事は、2021 年 7 月 26 日に米国の Azure Active Directory Identity Blog で公開された <a href="https://techcommunity.microsoft.com/t5/azure-active-directory-identity/ensure-compliance-using-separation-of-duties-checks-in-access/ba-p/2466939">Ensure compliance using separation of duties checks in access requests</a> を意訳したものになります。ご不明点等ございましたらサポート チームまでお問い合わせください。</p><hr><p>Azure Active Directory (Azure AD) の Identity Governance 機能により、一貫したプロセスや透明性を伴ちつつ、従業員の生産性とセキュリティに対する企業のニーズを両立することができます。現在プレビュー中である、Azure AD エンタイトルメント管理の新しい <a href="https://docs.microsoft.com/en-us/azure/active-directory/governance/entitlement-management-access-package-incompatible">職務の分離チェック機能</a> を用いると、ユーザーによる過剰ないしは一貫性のないアクセス権の取得を防ぐことができるようになります。</p><p>今日、弊社のカスタマー ストーリー サイトにて紹介されているような多くの企業では、Azure AD Identity Governance のエンタイトルメント管理とアクセス レビュー機能を活用することで、アクセス期間の制限を設定し、ユーザーがビジネス上重要なアプリケーションへのアクセス権を必要以上に長期間保持しないようにしています。</p><p>エンタイトルメント管理では、グループ、Teams、アプリ ロール、サイト ロールなどのすべてのプロジェクト リソースを単一のアクセス パッケージに束ねることができます。例えば、ユーザーが営業用アプリケーションを使うために営業担当ロールを必要としている場合、そのロールを含むアクセス パッケージをリクエストすることができます。 アクセス レビューが承認されると、ディスカッションのための Teams チャネルや、ドキュメントを保存するための関連する SharePoint Online サイトへのアクセス権が付与さあれます。割り当てが終了すると、そのアクセス権は自動的に削除されます。</p><p><img src="/blog/azure-active-directory/ensure-compliance-using-separation-of-duties-checks-in-access-jp/picture1.png"></p><p>職務の分離チェック機能では、不正使用につながる恐れのある権限の組み合わせをユーザーが受け取らないようにすることで、リスクを減らすことができるため、Azure AD の Identity Governance における最も追加要望の多い機能の一つでした。</p><h2 id="職務の分離チェック機能の動作"><a href="#職務の分離チェック機能の動作" class="headerlink" title="職務の分離チェック機能の動作"></a>職務の分離チェック機能の動作</h2><p>営業用アプリケーションに加えて、会計用アプリケーションがあるとします。社内の監査担当者は、誰も営業用アプリケーションと会計用アプリケーションの両方のデータを変更できないようにするべきだと考えています。そのために、すべての承認プロセスにおいて、会計データへのアクセスを要求するユーザーがすでに営業データへのアクセス権を持っているかかどうか、またその逆はないかどうか確認を行いたいと考えています。</p><p>職務の分離（プレビュー）チェック機能では、ユーザーがすでに別のアクセス パッケージに割り当てられていたり、他のグループのメンバーであったりする場合に、そのユーザーがアクセス パッケージを要求できないよう制限することができます。営業と会計のアクセス パッケージを同時に使用できないよう Azure ポータルまたは <a href="https://docs.microsoft.com/ja-jp/graph/api/resources/accesspackage?view=graph-rest-beta">Graph API</a> いずれかの方法にて設定することで、承認者 (管理者) はユーザーがどのような割り当てを保持しているか手動で確認する必要がなくなるため、アプリケーションの管理プロセスを簡略化することができます。</p><p><img src="/blog/azure-active-directory/ensure-compliance-using-separation-of-duties-checks-in-access-jp/picture2.png"></p><h2 id="2-ステップで職務の分離チェックを設定する"><a href="#2-ステップで職務の分離チェックを設定する" class="headerlink" title="2 ステップで職務の分離チェックを設定する"></a>2 ステップで職務の分離チェックを設定する</h2><p>例えば会計スペシャリストというアクセス パッケージを割り当てられた人が、MyAccess のページにアクセスして営業担当のアクセス パッケージを要求すると、それらのアクセス権を同時に取得できないことが通知されます。通知を受けたユーザーは、現在の要求を取りやめるか、異なるロールで別のアクセス パッケージを要求することができます。</p><p>設定に必要なステップはたった２つです。</p><ul><li>アプリケーションを、グループとチーム、または Share Pointサイトとともに、<a href="https://docs.microsoft.com/ja-jp/azure/active-directory/governance/entitlement-management-access-package-first">エンタイトルメント管理カタログ</a> に追加し、アクセス パッケージを設定します。 Azure を使用している場合は、Azure ロールに割り当てられたセキュリティ グループを追加することもできます。</li><li>これらのアクセス パッケージに対し、<a href="https://docs.microsoft.com/en-us/azure/active-directory/governance/entitlement-management-access-package-incompatible">職務の分離 (プレビュー)</a> を設定します。その後、Azure AD の監査ログ、あるいは、Azure Monitor における<a href="https://docs.microsoft.com/ja-jp/azure/active-directory/governance/entitlement-management-logs-and-reporting">アクセス パッケージのアクティビティやアプリケーション ロールの割り当てについての Workbook</a> を利用することで、ユーザーがどのようにアクセスしたかをレポートとして取得することができます。</li></ul><p>本プレビュー機能をご利用いただき間もない場合であっても、エンタイトルメント管理や他の Azure AD Identity Governance 機能を既にご利用いただいておりましたら、皆様よりフィードバックをお待ちしております。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Azure Identity サポート チームの中井です。&lt;/p&gt;
&lt;p&gt;本記事は、2021 年 7 月 26 日に米国の Azure Active Directory Identity Blog で公開された &lt;a href=&quot;https://techcomm</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="US Identity Blog" scheme="https://jpazureid.github.io/blog/tags/US-Identity-Blog/"/>
    
  </entry>
  
  <entry>
    <title>外部 ID ユーザー フローをより簡単に設定</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/do-more-with-external-identities-user-flows-in-just-a-few-clicks/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/do-more-with-external-identities-user-flows-in-just-a-few-clicks/</id>
    <published>2021-07-25T00:00:00.000Z</published>
    <updated>2021-09-16T18:49:48.486Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Azure Identity サポート チームの 村上 です。本記事は、2021 年 7 月 19 日に米国の Azure Active Directory Identity Blog で公開された <a href="https://techcommunity.microsoft.com/t5/azure-active-directory-identity/do-more-with-external-identities-user-flows-in-just-a-few-clicks/ba-p/2147076">Do more with External Identities user flows in just a few clicks</a> を意訳したものになります。ご不明点等ございましたらサポート チームまでお問い合わせください。</p><hr><p>皆さん、こんにちは。</p><p>弊社では皆様のフィードバックにお応えして、お客様やパートナーに向けたアプリケーションの ID を、より柔軟に、より早く設定できるよう改善しております。現在、マイクロソフトは Azure Active Directory のセルフサービス サインアップと次世代の B2C ユーザー フローを改善し、様々な ID を持つユーザーがより簡単にサインイン、サインアップ、コラボレーションできるように取り組んでいます。さらに、B2C アプリの開発者や管理者においては、ユーザー セッションやパスワード リセット設定を簡単に構成できるようになり、さらには外部のデータやサービスに接続することでユーザー体験を拡張することも容易となっています。</p><h2 id="Microsoft-アカウントと-E-メール-ワンタイム-パスコードによるセルフサービス-サインアップ"><a href="#Microsoft-アカウントと-E-メール-ワンタイム-パスコードによるセルフサービス-サインアップ" class="headerlink" title="Microsoft アカウントと E メール ワンタイム パスコードによるセルフサービス サインアップ"></a>Microsoft アカウントと E メール ワンタイム パスコードによるセルフサービス サインアップ</h2><p>Ignite (Microsoft が主催するグローバル カンファレンス) 以降、Azure AD のセルフサービス サインアップ機能を利用して、外部ユーザーが自身の ID を使用 (bring your own identity) するための 2 つの方法が追加されました。個人や中小企業において、Windows、Xbox、Skype、その他の Microsoft 365 アプリケーションにサインインするために個人の Microsoft アカウントを使用しているユーザーは、その既存のアカウントを使用して、事前に設定されたアプリケーションにサインアップできるようになりました。</p><p><img src="/blog/azure-active-directory/do-more-with-external-identities-user-flows-in-just-a-few-clicks/msaandeotpimage.PNG"></p><p>Microsoft アカウントをお持ちでないお客様は、ワンタイム パスコード (OTP) を E メール アドレスへ送信することができます。</p><p><img src="/blog/azure-active-directory/do-more-with-external-identities-user-flows-in-just-a-few-clicks/RequestOTPSignIn.png"></p><p>Azure ポータルの [すべての ID プロバイダー] ページから、[メールのワンタイム パスコード] と [Microsoft  アカウント] を有効に設定します。また、セルフ サービス サインアップのユーザー フローにおいても、上記の ID プロバイダーを有効に設定ください。</p><p><img src="/blog/azure-active-directory/do-more-with-external-identities-user-flows-in-just-a-few-clicks/IDProvider.png"></p><p>設定の詳細は、<a href="https://docs.microsoft.com/ja-jp/azure/active-directory/external-identities/microsoft-account">Microsoft アカウント (MSA) ID プロバイダー</a> と <a href="https://docs.microsoft.com/ja-jp/azure/active-directory/external-identities/one-time-passcode">E メールのワンタイム パスコード</a> をご覧ください。</p><h2 id="B2C-アプリ向けパスワード-リセットと-サインインしたままにする-を設定するためのビルトイン-ユーザー-フロー"><a href="#B2C-アプリ向けパスワード-リセットと-サインインしたままにする-を設定するためのビルトイン-ユーザー-フロー" class="headerlink" title="B2C アプリ向けパスワード リセットと [サインインしたままにする] を設定するためのビルトイン ユーザー フロー"></a>B2C アプリ向けパスワード リセットと [サインインしたままにする] を設定するためのビルトイン ユーザー フロー</h2><p>B2C 向けのビルトイン ユーザー フローにより、アプリ開発者は新しいアプリケーション コードを大量に追加する必要なく、ユーザーのサインアップ、サインイン、パスワードのリセットを設定できます。ビルトイン ユーザー フローは新たに追加された設定項目により、一層使いやすくなりました。アプリ開発者は数回のクリックだけで、[サインインしたままにする] や、より柔軟なパスワード リセットの設定を行うことができるようになりました。</p><p> [サインインしたままにする] を有効にすると、永続的なクッキーを使用することで、ユーザーのセッションを長く維持することができます。これにより、ユーザーがブラウザを閉じたり開いたりしても、セッションが有効のまま維持されます。ユーザーが明示的にサインアウトするとセッションは無効になります。また、パスワード リセットを有効にすると、ユーザーがパスワードを忘れたときや、サインイン時に期限切れパスワードのリセットを求められたときに、ユーザー自身がパスワードをリセットすることができます。</p><p><img src="/blog/azure-active-directory/do-more-with-external-identities-user-flows-in-just-a-few-clicks/KMSI_PRfinalimage(3).jpg"></p><h2 id="Azure-AD-B2C-向けの-API-コネクタ"><a href="#Azure-AD-B2C-向けの-API-コネクタ" class="headerlink" title="Azure AD B2C 向けの API コネクタ"></a>Azure AD B2C 向けの API コネクタ</h2><p>数ヶ月前のブログですが、API コネクターを利用した Azure AD アプリケーションのサインアップ フローをカスタマイズする方法について、<a href="https://techcommunity.microsoft.com/t5/azure-active-directory-identity/simple-and-secure-customization-with-b2c-user-flows/ba-p/1751709">いくつかの例</a> をご紹介しました。 外部システムと接続することでサインアップ ユーザー フローを拡張できるこの機能は GA となっています。</p><p>また、レガシーな ID システムやカスタム データ ストア、その他のクラウド サービスから提供される属性を用いてサインインやサインアップのユーザー フロー用トークンを拡張することで、ユーザー フローの拡張性を高め、API コネクターをより強力にすることにも取り組んでいます。この機能は、今後数週間以内に Azure AD B2C のプレビューとして公開される予定です。</p><p>皆様のご意見をお待ちしております。Azure フォーラムや Twitter で <a href="http://twitter.com/azuread">@AzureAD</a> をメンションして、新機能に関するフィードバックをお寄せください。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Azure Identity サポート チームの 村上 です。本記事は、2021 年 7 月 19 日に米国の Azure Active Directory Identity Blog で公開された &lt;a href=&quot;https://techcommunity.</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="US Identity Blog" scheme="https://jpazureid.github.io/blog/tags/US-Identity-Blog/"/>
    
  </entry>
  
  <entry>
    <title>ID とエンドポイント管理から始まる強固なゼロトラスト基盤の構築</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/build-a-strong-zero-trust-foundation-starting-with-identity-and-endpoint-management/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/build-a-strong-zero-trust-foundation-starting-with-identity-and-endpoint-management/</id>
    <published>2021-07-18T01:00:00.000Z</published>
    <updated>2021-09-16T18:49:48.446Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Azure Identity サポート チームの 竜 です。本記事は、2021 年 7 月 14 日に米国の Azure Active Directory Identity Blog で公開された <a href="https://techcommunity.microsoft.com/t5/azure-active-directory-identity/build-a-strong-zero-trust-foundation-starting-with-identity-and/ba-p/2520420">Build a strong Zero Trust Foundation starting with identity and endpoint management</a> を意訳したものになります。ご不明点等ございましたらサポート チームまでお問い合わせください。</p><hr><p>昨年の Microsoft Inspire では、お客様がリモートワークへ迅速に移行できるよう支援いただいたパートナー企業に感謝の意を表しました。世界が変化し続け、新しい現実が定着する中、今年は 2 つのトレンドがお客様の優先事項に影響を与えてきています。それは、ハイブリッド ワークへの移行とサイバー空間における脅威の高度化です。これらの変化に適応するために、お客様は引き続き弊社のパートナー エコシステムを活用しようとしてくださっています。お客様が変化に適応できる方法の一つとして、弊社のパートナー企業はお客様がゼロ トラスト セキュリティ戦略を採用することを支援しています。</p><p>ゼロ トラストへの移行を始めるのは大変なことかもしれませんが、何もしないという選択肢はもはやありません。私たちはパートナー企業とともに、すべてのお客様にこの道のりを案内する責任があると考えています。どこから始めればよいかの指針を求めている企業には、<a href="https://www.microsoft.com/ja-jp/security/business/identity-access-management/azure-ad-pricing">ID</a>と<a href="https://www.microsoft.com/ja-jp/security/business/microsoft-endpoint-manager">エンドポイント</a>を保護することで強固な基盤を構築することをお勧めしています。今週の <a href="https://myinspire.microsoft.com/home">Microsoft Inspire</a> では、このような基盤を構築するための主要な戦略を紹介しています。</p><p><img src="/blog/azure-active-directory/build-a-strong-zero-trust-foundation-starting-with-identity-and-endpoint-management/01.png"></p><h2 id="ID-とエンドポイント管理の刷新"><a href="#ID-とエンドポイント管理の刷新" class="headerlink" title="ID とエンドポイント管理の刷新"></a>ID とエンドポイント管理の刷新</h2><p>高度なセキュリティと包括的なゼロ トラスト戦略を実現するために、まずアイデンティティとエンドポイント管理のソリューションを刷新することで、クラウドへの移行をさらに迅速に進めることをお勧めします。ビジネス リーダーの間でもこの必要性はさらに高まっている状況です。</p><p>IT システムの刷新は、一見すると非常に大変な作業のように見えます。しかし、まずそのきっかけとして着目すべきは、重要なアクセス可否の判断をクラウドで管理し、一般的な攻撃経路を排除することです。レガシーなフェデレーション方式をやめ、<a href="https://docs.microsoft.com/ja-jp/azure/active-directory/hybrid/choose-ad-authn">認証方式を刷新する</a>ことで、ビジネスに最適なアクセス パスを選択することができます。<a href="https://docs.microsoft.com/ja-jp/azure/active-directory/hybrid/how-to-connect-staged-rollout">段階的なロールアウト</a>を用いれば特定のグループからテスト的に展開を行うことができ、移行がよりスムーズになります。また、<a href="https://docs.microsoft.com/ja-jp/azure/active-directory/conditional-access/block-legacy-authentication">レガシー認証をブロックする</a>ことによって、多要素認証を確実に施行できるようになり、条件付きアクセスによって多要素認証を既定のポリシーとして設定できます。さらに、アクセス管理を一元化するために、<a href="https://docs.microsoft.com/ja-jp/azure/active-directory/cloud-sync/what-is-cloud-sync">Azure AD クラウド同期</a>などのツールを利用してオンプレミスのすべての ID をクラウドに同期することができます。Azure AD クラウド同期は、数百の Active Directory フォレストがあるような複雑な環境にもご利用いただけます。</p><p><img src="/blog/azure-active-directory/build-a-strong-zero-trust-foundation-starting-with-identity-and-endpoint-management/02.png"></p><p>エンドポイント管理を刷新するために、 お客様の要望に合ったペースでクラウドの計画を立てられる <a href="https://www.microsoft.com/ja-jp/security/business/microsoft-endpoint-manager">Microsoft エンドポイント マネージャー</a>の利用をお勧めしています。Microsoft エンドポイント マネージャーは、Configuration Manager と Microsoft Intune を 1 つのエンドポイント管理プラットフォームに統合したものです。それぞれのツールを個別で使用することも、共同で管理することもできます。</p><p>最後に、ID とエンドポイント管理を刷新するために、1 つのクラウド ID とクラウド エンドポイント管理のソリューションを用いてアプリ管理を統一することも検討ください。<a href="https://www.microsoft.com/ja-jp/security/business/identity-access-management/secure-app-access">すべてのアプリを 1 つの ID システムに接続する</a>ことで、使用されているアプリが可視化され管理も容易になります。また、1 つの認証情報を用いて接続することで、リソースへのアクセスが簡素化されます。マイクロソフトのソリューションは、クラウド アプリからオンプレミス アプリ、デスクトップ アプリやモバイル アプリまで幅広く対応しています。</p><h2 id="ハイブリッド環境で働く従業員の保護"><a href="#ハイブリッド環境で働く従業員の保護" class="headerlink" title="ハイブリッド環境で働く従業員の保護"></a>ハイブリッド環境で働く従業員の保護</h2><p>すべての従業員がハイブリッドな環境で働く場合、ID とエンドポイントの保護がさらに重要になります。ハイブリッド環境の従業員のセキュリティを確保するために最初のステップは、<a href="https://www.microsoft.com/ja-jp/security/business/identity-access-management/mfa-multi-factor-authentication">強力な認証</a>でユーザーの ID を確認することです。パスワードは、一連のセキュリティの中で最も脆弱な部分です。セキュリティを守るために何か 1 つできるとすれば、99.9% の ID 攻撃を防ぐことができる多要素認証から始めることをお勧めします。私たちは、さらに強力な認証のために、より安全で便利な<a href="https://www.microsoft.com/ja-jp/security/business/identity-access-management/passwordless-authentication">パスワードレス</a> の世界に進もうとしています。</p><p>次に、脆弱なデバイスや侵害されたデバイスからリソースへのアクセスを不可とするポリシーを適用することで、準拠した信頼できるデバイスからのみアクセスできるように制限します。まずエンドポイントをデバイス管理に登録し、デバイスにデータ保護ポリシーを適用します。そして <a href="https://www.microsoft.com/ja-jp/security/business/threat-protection/endpoint-defender">Microsoft Defender for Endpoint</a> のような脅威保護ソリューションを使用して危険なデバイスを検出することで、エンドポイントを保護することができます。</p><p>ID とデバイスを制御できるようになったら、利用の流れとリスク評価に基づいて適応性のあるアクセス ポリシーを設定します。<a href="https://www.microsoft.com/ja-jp/security/business/identity-access-management/conditional-access-azure-ad">条件付きアクセス</a>では、ユーザー、デバイス、場所、セッションのリスク評価に基づいてアクセス ポリシーを細かく設定することができます。私たちは継続的に条件付きアクセスを改善しており、さらにきめ細やかなアクセス ポリシーも可能にしています。たとえば、認証コンテキストに基づいてポリシーを構築したり、アクセス条件が満たされているかどうかを常に再評価し、変化が検出された場合はセッションを中断することができる継続的なアクセス評価などを利用したりすることが可能です。</p><p>リソースへのアクセスの可否を決定するもう一つの重要な要素に、ユーザーの権限があります。ユーザーの権限は、お客様が従業員やパートナー企業に割り当てる役割、プロジェクト、その他の属性に基づいて設定されます。これらの権限を付与するのは簡単ですが、追跡したり、不要になったときにアクセスを取り消したりするのは非常に困難です。従業員の増加に伴い、全員のアクセス権を管理する単一のソリューションがますます重要になっています。重要なリソースへのアクセスを保護、監視、監査をするために、Azure AD に組み込まれた <a href="https://www.microsoft.com/ja-jp/security/business/identity-access-management/identity-governance">Identity Governance</a> のご利用をお勧めします。</p><p><img src="/blog/azure-active-directory/build-a-strong-zero-trust-foundation-starting-with-identity-and-endpoint-management/03.png"></p><h2 id="従業員の体験を変える"><a href="#従業員の体験を変える" class="headerlink" title="従業員の体験を変える"></a>従業員の体験を変える</h2><p>リモート ワークにより従来の方法で IT ヘルプデスクに頼ることがさらに難しくなってきていることもあり、ビジネス リーダーにとって、従業員の満足度を高めることが重要な課題となっています。たとえば、米国内だけでも、4,900 万人のリモート ワーカーが、IT の問題を解決するのに何日も、時には何週間もかかると報告しています (脚注 1)。</p><p>優れた従業員体験をつくるプロセスは、新入社員の入社時から始まります。<a href="https://www.microsoft.com/ja-jp/security/business/identity-access-management/lifecycle-management-software">Azure AD のプロビジョニング</a>、Microsoft エンドポイント マネージャー、および <a href="https://www.microsoft.com/ja-jp/microsoft-365/windows/windows-autopilot">Windows Autopilot</a> を使用することで、このプロセスを数日から数時間、あるいは数分に短縮し、初日から適切なアプリケーションとデバイスへのアクセスを付与することができます。<a href="https://www.microsoft.com/ja-jp/security/business/identity-access-management/verifiable-credentials">Azure AD の検証可能資格情報</a>を使用すると、このプロセスをさらに簡素化できます。たとえば、新入社員の個人データを収集して保存することなく、学歴や専門資格などの情報を数分で確認できます。</p><p>入社時から<a href="https://www.microsoft.com/ja-jp/security/business/identity-access-management/single-sign-on">シングル サインオン</a>を使うことにより、従業員が必要なアプリにスムーズにアクセスできるようになります。従業員の生産性を向上させる最も簡単な方法の 1 つは すべてのアプリケーションを Azure AD に接続することです。Workday、ServiceNow、さらには AWS などの<a href="https://www.microsoft.com/ja-jp/security/business/identity-access-management/integrated-apps-azure-ad">クラウド アプリケーション</a>から、<a href="https://www.microsoft.com/ja-jp/security/business/identity-access-management/application-management-services">オンプレミスのアプリケーション</a>やカスタム ビルドのアプリケーションまで、すべてのアプリケーションを Azure AD に接続することができます。アプリケーションを Azure AD に接続することで、エンド ユーザーは、一元化されたアプリケーション起動ポータルである <a href="https://www.microsoft.com/ja-jp/security/business/identity-access-management/user-self-service-portals">My Apps</a> から、すべてのアプリケーションを容易に見つけて起動することができます。</p><p><img src="/blog/azure-active-directory/build-a-strong-zero-trust-foundation-starting-with-identity-and-endpoint-management/04.png"></p><h2 id="ユーザーに合わせた安全なアクセスのカスタマイズ"><a href="#ユーザーに合わせた安全なアクセスのカスタマイズ" class="headerlink" title="ユーザーに合わせた安全なアクセスのカスタマイズ"></a>ユーザーに合わせた安全なアクセスのカスタマイズ</h2><p>私たちは、すべてのユーザーに安全なアクセスと快適な体験を提供したいと思っています。たとえば、現場の第一線で働く人々 (フロントライン ワーカー) を例に挙げてみましょう。昨年、私たちは、彼らが社会で果たす重要な役割を目の当たりにしましたが、75％ の人はまだ職務を遂行するための適切なツールを持っていない状況があります (脚注 2)。私たちはパートナー企業やお客様と協力して、彼らの仕事環境に適した体験を提供することで、この状況を変えようとしています。まずは、<a href="https://docs.microsoft.com/ja-jp/azure/active-directory/authentication/howto-authentication-sms-signin">ワンタイム SMS コード</a>を使ってサインイン プロセスがスムーズに行われるようにし、現場の方々が自ら資格情報を管理できるようにすることから始めています。そのために、たとえば <a href="https://docs.microsoft.com/ja-jp/azure/active-directory/roles/my-staff-configure">マイ スタッフ ポータル</a> から電話番号の追加やパスワード リセットの承認などを可能にしました。また、第一線で働く人々が使うツールとしてキオスクが一般的になっています。そのため、<a href="https://docs.microsoft.com/ja-jp/azure/active-directory/develop/msal-shared-devices">共有デバイス モード</a>を利用することで、キオスクのようなデバイス上ですべてのアプリやブラウザー セッションに安全にサインインおよびサインアウトすることを可能にしています。</p><p>お客様にとって、もう一つの重要な優先事項は、顧客との長期的な関係を築くことです。<a href="https://docs.microsoft.com/ja-jp/azure/active-directory-b2c/overview">Azure AD B2C</a> を利用することで、企業や開発者は顧客向けアプリケーションのサインイン体験をカスタマイズし、きめ細かなアクセス ポリシーを構築することができます。さらに、<a href="https://cloudblogs.microsoft.com/dynamics365/bdm/2021/05/12/fraud-trends-part-4-balancing-identity-authentication-with-user-experience/">Azure AD B2C を Dynamics Fraud Protection と統合する</a>ことで、不正利用や詐欺から顧客アカウントや収益を保護します。この統合により、偽のアカウントの作成、アカウントの乗っ取り、不正なアカウント アクセスを防ぐことができます。また、不正行為による損失や顧客による購入時の手間を最小化しつつ、収益機会を最大化するための知見を活用することで、取引の成功率を向上させることができます。</p><p><img src="/blog/azure-active-directory/build-a-strong-zero-trust-foundation-starting-with-identity-and-endpoint-management/05.png"></p><h2 id="Microsoft-Inspire-にバーチャル-ライブまたはオンデマンド-でご参加ください"><a href="#Microsoft-Inspire-にバーチャル-ライブまたはオンデマンド-でご参加ください" class="headerlink" title="Microsoft Inspire にバーチャル (ライブまたはオンデマンド) でご参加ください"></a>Microsoft Inspire にバーチャル (ライブまたはオンデマンド) でご参加ください</h2><p>仕事のやり方や場所が変化し、セキュリティ上の脅威が増大していることから、新たなセキュリティ アプローチが必要とされています。ID とエンドポイントを基盤としたゼロ トラストこそが、そのアプローチとなりえます。統合されたセキュリティへのアプローチと併せて、Azure AD と Microsoft エンドポイント マネージャーを利用することで、適切な人が適切なレベルのアクセス権を得られるようになり、セキュリティとエンドユーザーの生産性の両方を向上することができます。</p><p>世界のどこにいても、Microsoft Inspire の期間中、我々のセッションに参加いただけることを願っております。<a href="https://twitter.com/azuread/status/1278418103903363074">Twitter</a> や <a href="https://www.linkedin.com/showcase/microsoft-security/">LinkedIn</a> でハッシュタグ #MSInspire をつけて会話に参加ください。</p><ul><li><a href="https://myinspire.microsoft.com/sessions/a5411f0e-7928-41c2-850f-c7dfbed207a3">TS03</a>: Build a foundation of trust and security</li><li><a href="https://myinspire.microsoft.com/sessions/af379ebd-9be9-4985-9443-068f4a584344">BRK122</a>: Identity and endpoint management – a strong foundation for Zero Trust and profitability</li><li><a href="https://myinspire.microsoft.com/sessions/8f6f4cf4-3712-4e74-bd31-9efeb249298c">OD122</a>: Build a business around helping customers drive towards a Zero Trust framework</li><li><a href="https://myinspire.microsoft.com/sessions/b9f77c58-b8c7-4e95-992b-6875efa7da68">ATEBRK122</a>: Ask the Experts: Identity and endpoint management – a strong foundation for Zero Trust and profitability</li></ul><p>上記内容が参考となれば幸いです。</p><p>Irina Nechaeva<br>ID 製品マーケティング担当シニア ディレクター</p><p>脚注:</p><ol><li>1E American Remote Work Survey, July 20, 2020</li><li>Equip Firstline Workers with Better Tools to Drive Engagement, Forrester Opportunity Snapshot: A Customer Study Commissioned by Microsoft, December 2018</li></ol>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Azure Identity サポート チームの 竜 です。本記事は、2021 年 7 月 14 日に米国の Azure Active Directory Identity Blog で公開された &lt;a href=&quot;https://techcommunity.m</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="US Identity Blog" scheme="https://jpazureid.github.io/blog/tags/US-Identity-Blog/"/>
    
  </entry>
  
  <entry>
    <title>ユーザー ストアとして SQL を使用したアプリへのユーザー プロビジョニング、複雑な変換式の簡単な構築、などなど</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/provision-users-into-apps-using-sql-as-a-user-store-more-easily/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/provision-users-into-apps-using-sql-as-a-user-store-more-easily/</id>
    <published>2021-07-11T01:00:00.000Z</published>
    <updated>2021-09-16T18:49:48.594Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Azure Identity サポート チームの 村上 です。</p><p>本記事は、2021 年 7 月 1 日に米国の Azure Active Directory Identity Blog で公開された <a href="https://techcommunity.microsoft.com/t5/azure-active-directory-identity/provision-users-into-apps-using-sql-as-a-user-store-more-easily/ba-p/2464364">Provision users into apps using SQL as a user store, more easily build complex expressions, and more</a> を意訳したものになります。ご不明点等ございましたらサポート チームまでお問い合わせください。</p><hr><p>皆さん、こんにちは。</p><p>今回は、ユーザーのライフ サイクルやディレクトリ管理のニーズに応えた、最新の Active Azure Directory プロビジョニング機能をいくつかご紹介します。</p><h2 id="Azure-AD-からオンプレミス・アプリケーションへのユーザー・プロビジョニングを自動化する"><a href="#Azure-AD-からオンプレミス・アプリケーションへのユーザー・プロビジョニングを自動化する" class="headerlink" title="Azure AD からオンプレミス・アプリケーションへのユーザー・プロビジョニングを自動化する"></a>Azure AD からオンプレミス・アプリケーションへのユーザー・プロビジョニングを自動化する</h2><p>Azure AD は、オンプレミス アプリケーションへのプロビジョニングをサポートするようになりました。また、プレビュー版を用意していますので、お試しいただき、是非とも弊社へフィードバックをお送りください。</p><p>本機能を使用するためには、Azure AD Premium P1 または P2 テナントと、データ ストアとして SQL を使用する、もしくは SCIM をサポートするオンプレミス アプリケーションが必要です。プレビューへの招待状は、<a href="https://aka.ms/onpremprovisioningpublicpreviewaccess">こちら</a> から申請できます。また、数ヶ月以内に、LDAP ディレクトリ (AD DS を除く) へのユーザーのプロビジョニングのサポートを追加する予定ですので、その後は招待の申請は不要とする予定です。</p><p>既に Microsoft Identity Manager (MIM) を導入したことのあるお客様は、MIM を全面的に展開することなく、既存のコネクタや構成を再利用することができます。また、新しいアプリケーションを構築しているお客様は、当社の <a href="https://aka.ms/scimreferencecode">SCIM リファレンス コード</a> を使用して SCIM エンドポイントを立ち上げ、オンプレミスでもクラウドでもアプリケーションにユーザーを簡単にプロビジョニングすることができます。</p><p><img src="/blog/azure-active-directory/provision-users-into-apps-using-sql-as-a-user-store-more-easily/AzureAD.png"></p><h2 id="事前に構築されたユーザー-プロビジョニング-コネクタでより多くのアプリに対応"><a href="#事前に構築されたユーザー-プロビジョニング-コネクタでより多くのアプリに対応" class="headerlink" title="事前に構築されたユーザー プロビジョニング コネクタでより多くのアプリに対応"></a>事前に構築されたユーザー プロビジョニング コネクタでより多くのアプリに対応</h2><p>Azure AD サービスは、200 以上のプロビジョニング コネクタをサポートするようになりました！続々と増えるアプリケーションの一覧は <a href="https://docs.microsoft.com/azure/active-directory/saas-apps/tutorial-list">こちら</a> でご確認ください。 お探しのアプリケーションがない場合は、アプリケーション ベンダーに対して <a href="https://aka.ms/scimoverview">SCIM</a> 標準をサポートし、Azure AD アプリケーション ギャラリーに <a href="https://docs.microsoft.com/azure/active-directory/develop/v2-howto-app-gallery-listing#step-6---submit-your-app">登録</a> するよう依頼してください。私たちは ISV と協力して、迅速にオンボード化します。</p><p><img src="/blog/azure-active-directory/provision-users-into-apps-using-sql-as-a-user-store-more-easily/apps.JPG"></p><h2 id="Microsoft-365-管理センターの新しいアプリ統合ウィザード"><a href="#Microsoft-365-管理センターの新しいアプリ統合ウィザード" class="headerlink" title="Microsoft 365 管理センターの新しいアプリ統合ウィザード"></a>Microsoft 365 管理センターの新しいアプリ統合ウィザード</h2><p>より多くの管理者がサード パーティのアプリを Azure AD に接続できるよう、Microsoft 365 管理センターに新しいアプリ統合ウィザードを搭載しました。 アプリ統合ウィザードは、管理者がシングル サインオンを設定する際に、ガイド付きで設定を使うことができ、簡単に <a href="https://docs.microsoft.com/en-us/azure/active-directory/saas-apps/tutorial-list">アプリ ギャラリー</a> のアプリを Azure AD に接続することができます。アプリケーションのシングル サインオンの設定が完了しましたら、あらかじめ用意されている数百のプロビジョニング コネクタを使用して、ユーザーのプロビジョニングを自動化することができます。</p><p><img src="/blog/azure-active-directory/provision-users-into-apps-using-sql-as-a-user-store-more-easily/AppintegrationwithAzureAD.png"></p><h2 id="プロビジョニング-ログの一般提供を開始"><a href="#プロビジョニング-ログの一般提供を開始" class="headerlink" title="プロビジョニング ログの一般提供を開始"></a>プロビジョニング ログの一般提供を開始</h2><p>UI、API、または CSV としてデータをエクスポートすることで、<a href="https://docs.microsoft.com/azure/active-directory/reports-monitoring/concept-provisioning-logs">プロビジョニング ログ</a> を使用して、プロビジョニング展開を監視およびトラブル シューティングすることができます。また、<a href="https://docs.microsoft.com/azure/active-directory/app-provisioning/application-provisioning-log-analytics">Azure Monitor Integration</a> を使用して、データにカスタム ダッシュボード、アラート、およびクエリを構築することもできます。</p><p><img src="/blog/azure-active-directory/provision-users-into-apps-using-sql-as-a-user-store-more-easily/Woodgrove.png"></p><h2 id="式の構築とテストを簡素化"><a href="#式の構築とテストを簡素化" class="headerlink" title="式の構築とテストを簡素化"></a>式の構築とテストを簡素化</h2><p>Azure AD のプロビジョニング サービスでは、対象のシステムにデータをエクスポートする前に、データを変換することができます。データの変換に使う式の構築とテストを簡易にするために式ビルダーを構築し、現在パブリックプ レビューとして提供しています。 詳細は <a href="https://docs.microsoft.com/en-us/azure/active-directory/cloud-sync/how-to-expression-builder">こちら</a> をご覧ください。また、式の作成に関する一般的なガイダンスについては、<a href="https://docs.microsoft.com/en-us/azure/active-directory/cloud-sync/reference-expressions">こちら</a> をご覧ください。</p><p><img src="/blog/azure-active-directory/provision-users-into-apps-using-sql-as-a-user-store-more-easily/Expressionbuilder.png"></p><h2 id="海外赴任、ギグ-ワーカー、AD-ドメインをまたぐマネージャーに対応した-HR-システムからのプロビジョニングのアップデート"><a href="#海外赴任、ギグ-ワーカー、AD-ドメインをまたぐマネージャーに対応した-HR-システムからのプロビジョニングのアップデート" class="headerlink" title="海外赴任、ギグ ワーカー、AD ドメインをまたぐマネージャーに対応した HR システムからのプロビジョニングのアップデート"></a>海外赴任、ギグ ワーカー、AD ドメインをまたぐマネージャーに対応した HR システムからのプロビジョニングのアップデート</h2><ul><li>大規模な多国籍企業では、従業員が一時的に海外の拠点で働き、赴任終了後に本拠地に戻ることがあります。通常、人事部はこの海外勤務に対応した新しいユーザー プロファイルを作成します。このようなケースに対応するために、<a href="https://docs.microsoft.com/en-us/azure/active-directory/app-provisioning/workday-integration-reference#retrieving-international-job-assignments-and-secondary-job-details">Workday</a> および <a href="https://docs.microsoft.com/en-us/azure/active-directory/app-provisioning/sap-successfactors-integration-reference#handling-global-assignment-scenario">Success Factors</a> とのユーザー プロビジョニング統合をアップデートし、海外勤務データの検索をサポートしました。</li><li>近年のギグ エコノミー (短期、臨時や単発での仕事を受注する働き方やその経済形態) では、正社員が臨時従業員に変わったり、もしくはその逆になるシナリオが増加しています。このような場合、Workday を導入することで、以前の雇用記録を無効にし、以前の従業員 ID を保持したまま新しい雇用記録を作成することができます。従来では、正社員と臨時従業員、それぞれの Workday プロビジョニング ジョブを作成する必要がありました。最新の Workday 統合の <a href="https://docs.microsoft.com/azure/active-directory/app-provisioning/workday-integration-reference#support-for-worker-conversions">アップデート</a> により、このシナリオを円滑に処理できるようになり、Workday 雇用記録を利用して、 ID の所有権を引き継ぐことができるようになりました。</li><li>HR プロビジョニングを複数のオンプレミス Active Directory (AD) ドメインと統合している場合、ユーザーとマネージャーが別の AD ドメインに所属しているというケースがあります。このようなドメインをまたいだマネージャーの参照が、最新のアップデートで可能となりました。また、複数のドメインにまたがる UPN/sAMAccountName の値の重複を検索することもできます。詳しくは、<a href="https://docs.microsoft.com/azure/active-directory/app-provisioning/plan-cloud-hr-provision#design-hr-provisioning-app-deployment-topology">クラウド HR 計画ガイド</a> をご覧ください。</li></ul><h2 id="Azure-AD-Connect-sync-の最新版を公開"><a href="#Azure-AD-Connect-sync-の最新版を公開" class="headerlink" title="Azure AD Connect sync の最新版を公開"></a>Azure AD Connect sync の最新版を公開</h2><p>最新版では、以下の機能が追加されています。</p><ul><li><a href="https://docs.microsoft.com/en-us/azure/active-directory/hybrid/how-to-connect-selective-password-hash-synchronization">選択的なパスワード ハッシュの同期</a> をサポート。</li><li>Azure AD Connect の同期構成のトラブルシューティングに役立つ、<a href="https://docs.microsoft.com/en-us/azure/active-directory/hybrid/how-to-connect-single-object-sync">単一オブジェクトの同期コマンドレット</a>。</li><li><a href="https://docs.microsoft.com/azure/active-directory/hybrid/how-to-connect-sync-endpoint-api-v2">V2 エンド ポイント</a> をデフォルトに変更し、パフォーマンスの向上と、50,000 人以上のメンバーを持つグループの同期が可能に。</li><li>新しい組み込みロールであるハイブリッド ID 管理者を、サービスの構成を担当する管理者に使用可能に。</li></ul><h2 id="Azure-AD-Connect-クラウド同期のエージェントを更新"><a href="#Azure-AD-Connect-クラウド同期のエージェントを更新" class="headerlink" title="Azure AD Connect クラウド同期のエージェントを更新"></a>Azure AD Connect クラウド同期のエージェントを更新</h2><p>エージェントのバージョン #1.1.359 から、Azure AD Connect のクラウド同期の管理者は、 gMSA コマンドレットを使用して、gMSA 権限を詳細なレベルで設定およびリセットできるようになりました。また、グループのスコープ フィルターを使用して同期できるメンバーの上限が、50,000 人になりました。不具合の修正を含むエージェント アップデートの詳細については、<a href="https://docs.microsoft.com/en-us/azure/active-directory/cloud-sync/reference-version-history">バージョン履歴</a> をご確認ください。</p><p>いつものように、コメントや Twitter（<a href="http://twitter.com/azuread">@AzureAD</a>）で皆様のご意見やご感想をお聞かせください。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Azure Identity サポート チームの 村上 です。&lt;/p&gt;
&lt;p&gt;本記事は、2021 年 7 月 1 日に米国の Azure Active Directory Identity Blog で公開された &lt;a href=&quot;https://techcom</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="US Identity Blog" scheme="https://jpazureid.github.io/blog/tags/US-Identity-Blog/"/>
    
  </entry>
  
  <entry>
    <title>サービス プリンシパルに対する Azure AD アクセス レビューの紹介</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/introducing-azure-ad-access-reviews-for-service-principals/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/introducing-azure-ad-access-reviews-for-service-principals/</id>
    <published>2021-07-07T00:00:00.000Z</published>
    <updated>2021-09-16T18:49:48.546Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Azure Identity サポート チームの中井です。</p><p>本記事は、2021 年 6 月 10 日に米国の Azure Active Directory Identity Blog で公開された <a href="https://techcommunity.microsoft.com/t5/azure-active-directory-identity/introducing-azure-ad-access-reviews-for-service-principals/ba-p/1942488">Introducing Azure AD access reviews for service principals</a> を意訳したものになります。ご不明点等ございましたらサポート チームまでお問い合わせください。</p><hr><p>皆さん、こんにちは！</p><p>より多くのアプリケーションやサービスがクラウドに移行する中で、これらのワークロードで使用される ID を主体的に管理し、その方法を改善していく必要性が高まっています。本日、Azure AD のサービス プリンシパルに対するアクセス レビューのパブリック プレビューを発表いたします。多くのお客様では、ユーザー アカウントのアクセスを管理するために Azure AD のアクセス レビューをすでにご利用いただいておりますが、この機能をサービス プリンシパルやアプリケーションにも拡張してほしいという要望をいただいておりました。</p><p>今回のパブリック プレビューでは、Azure AD の特権ディレクトリ ロールが割り当てられているサービス プリンシパルやアプリケーションのレビューを要求することができます。さらに、サービス プリンシパルが割り当てられている Azure サブスクリプションのロールのレビューを作成することも可能となります。これにより、サービス プリンシパルに必要なロールのみが割り当てられていることを定期的に確認し、環境のセキュリティの改善に役立てることができます。</p><p>テナントや Azure サブスクリプションのサービス プリンシパルに対するアクセス レビューの設定は簡単です。アクセス レビューの作成時に “サービス プリンシパル” を選択すれば、あとは他のアクセスレビューと同様の手順です。</p><p>この新しい Azure AD の機能を Azure ポータルにて設定するには、以下の手順で行います。</p><ol><li>Azure Active Directory &gt; Identity Governance に移動します。</li><li>Azure AD ロール または Azure リソース を選択し、続いてリソース名を選択します。</li><li>アクセス レビューの項目において、新しいアクセス レビューを作成します。</li><li><strong>スコープ</strong> を <strong>サービス プリンシパル</strong> に設定します。</li></ol><p><img src="/blog/azure-active-directory/introducing-azure-ad-access-reviews-for-service-principals/CreateAnAccessReview.png"></p><p>選択されたレビュアーには、Azure ポータルからのアクセスのレビューを依頼するメールが届きます。</p><p><img src="/blog/azure-active-directory/introducing-azure-ad-access-reviews-for-service-principals/SPN.png"></p><p>また、MS Graph API や ARM (Azure Resource Manager) API を用いて、Azure AD ロールや Azure リソース ロールにそれぞれに対し、このアクセス レビューを作成することもできます。この機能の詳細につきましては、<a href="https://docs.microsoft.com/ja-jp/azure/active-directory/privileged-identity-management/pim-how-to-start-security-review?toc=/azure/active-directory/governance/toc.json">Azure AD ロール</a>のレビューや、<a href="https://docs.microsoft.com/ja-jp/azure/active-directory/privileged-identity-management/pim-resource-roles-start-access-review?toc=/azure/active-directory/governance/toc.json">Azure リソース ロール</a> の割り当てに関するドキュメントをご覧ください。</p><p>今後様々なワークロードに対して ID の関連機能を拡張していく中で、本プレビュー機能を利用してお客様よりフィードバックを収集し、これらの機能を GA するにあたっての最適な方法を模索していく予定です。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Azure Identity サポート チームの中井です。&lt;/p&gt;
&lt;p&gt;本記事は、2021 年 6 月 10 日に米国の Azure Active Directory Identity Blog で公開された &lt;a href=&quot;https://techcomm</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="US Identity Blog" scheme="https://jpazureid.github.io/blog/tags/US-Identity-Blog/"/>
    
    <category term="Access review" scheme="https://jpazureid.github.io/blog/tags/Access-review/"/>
    
  </entry>
  
  <entry>
    <title>Azure AD ゲスト アクセス レビューを活用したゲスト ユーザーとの安全なコラボレーション</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/secure-collaboration-with-AAD-guest-access-reviews/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/secure-collaboration-with-AAD-guest-access-reviews/</id>
    <published>2021-07-06T00:00:00.000Z</published>
    <updated>2021-09-16T18:49:48.618Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Azure Identity サポート チームの栗井です。</p><p>本記事は、2021 年 6 月 23 日に米国の Azure Active Directory Identity Blog で公開された <a href="https://techcommunity.microsoft.com/t5/azure-active-directory-identity/securely-collaborate-with-guests-using-azure-ad-guest-access/ba-p/2466940">Securely collaborate with guests using Azure AD guest access reviews</a> を意訳し、補足情報を追加したものになります。ご不明点等ございましたらサポート チームまでお問い合わせください。</p><hr><p>日々の業務の中で、顧客やパートナー、ベンダーと共同作業 (コラボレーション) をする機会は、沢山ありますよね。現代では、業務において多くのアプリケーションやソフトウェア、デバイスが活用されています。組織外のユーザー (以下、ゲスト ユーザー) とのコラボレーションにおいても、ゲスト ユーザーを自社のアプリに招待したり、自社のリソースへのアクセスを許可したりする必要が出てくるでしょう。このようなゲスト ユーザーのデジタル ID は、扱いを間違えればセキュリティ リスクにつながる可能性も否めません。</p><p>マイクロソフトの調査によると、IT 管理担当者の 40% 以上が、セキュリティ態勢を改善するためのデジタル ID 管理の最適策を求めていると回答しています。</p><p><img src="/blog/azure-active-directory/secure-collaboration-with-AAD-guest-access-reviews/survey.png" alt="ゲスト アカウントを管理 (チェックおよび必要に応じてクリーン アップ) するプロセスはありますか？"></p><p>これら IT における意思決定者は、会社内のリソースへのアクセスが分散することによりセキュリティ侵害のリスクが高まっていることを最大の懸念として挙げています。この問題は企業が通勤とテレワークを組み合わせたハイブリッドな業務環境が導入されたり、外部ユーザーとの安全なコラボレーションが要求されたりする中で一層大きな課題となっています。IT 管理者にはそれらの利用状況を測る方法もなく、次のような問いにも答えることができない状況にあります:</p><ul><li>ユーザーはどのような情報にアクセスしているのか？</li><li>どの程度の期間、それらの情報は共有してアクセスされているのか？</li><li>ユーザー アカウントはまだ有効なのか？</li><li>ユーザーに与えられたアクセス権が失効する危険はないか？</li></ul><h2 id="自動のレビュー機能を用いてゲストによるアクセスを管理する"><a href="#自動のレビュー機能を用いてゲストによるアクセスを管理する" class="headerlink" title="自動のレビュー機能を用いてゲストによるアクセスを管理する"></a>自動のレビュー機能を用いてゲストによるアクセスを管理する</h2><p>アンケート回答者の 70％ 以上が、<strong>ゲスト アカウントを管理するプロセスがない、または手動で管理している</strong> と回答しています。手動での管理は、カスタム スクリプトやミドルウェアに依存していることが多いため、ヒューマン エラーが発生する可能性が高く、セキュリティ リスクの増大につながります。また、IT 管理者は、会社のリソースにアクセスをするすべての外部ユーザーを、余すことなく把握することはできません。ゲスト ユーザーのデジタル ID とアクセスの管理に最も適した人物は、IT 管理者ではなく、その事業部のマネージャーです。</p><p><img src="/blog/azure-active-directory/secure-collaboration-with-AAD-guest-access-reviews/figure1.png" alt="図 1: アクセス レビュー機能により、ゲストのアクセスを安全に管理することができます。"></p><p>Azure Active Directory Identity Governance は、組織の境界を越えた安全なコラボレーションを可能にします。お客様は、<strong>直感的なインターフェースを通じて、定期的な自動アクセス レビュー</strong> を設定することができます。これによりゲスト ユーザーには過不足のないリソースおよび時間の範囲内でのアクセスが確保されます。</p><p>ゲスト ユーザーが機密データへのアクセスを必要としなくなったら、企業は自動的にユーザーのアクセス権限を取り消すことができます。事業部の担当者やマネージャーが Azure AD を利用していない場合、ゲスト ユーザーは自身でグループのメンバーシップを確認しアクセス権限の要否を確認することもできます。</p><h2 id="ゲスト-ユーザーのアクセスを自動で管理しましょう"><a href="#ゲスト-ユーザーのアクセスを自動で管理しましょう" class="headerlink" title="ゲスト ユーザーのアクセスを自動で管理しましょう"></a>ゲスト ユーザーのアクセスを自動で管理しましょう</h2><p>機密データへのゲスト アクセスのプロビジョニングとデプロビジョニングを自動化することで、従来の管理方法 (カスタム スクリプトやミドルウェア) は不要になり、手動プロセスに伴うエラーを削減することができます。さらに、SaaS アプリケーションへのゲストのアクセスを自動的にプロビジョニングおよびデプロビジョニングすることで、組織が事前に許可した範囲内でのみゲストをアプリにアクセスさせられるようになります。つまり、IT 管理者がその都度アクセスの許可を判断する手間はなくなります。</p><p>大規模な組織においては、ゲスト ユーザーのアクセスを管理するための最適役は、IT 管理者よりも現場を知る事業部のマネージャーである場合が多いでしょう。Azure AD のガバナンス機能を用いることで、<strong>外部ユーザーがどのレベルの機密データにアクセス可能かというアクセス権の管理を、その判断に最も適した事業部のマネージャーに委任できるようになる</strong> のです。IT 管理者以外の人間に管理を委任することで、本当に適した人間が部門の機密データへのアクセスを管理していることを確認できます。この委任によって、IT ヘルプ デスクの負担が軽減され、IT のスタッフはその他の戦略的な取り組みに専念できるようになります。</p><p>Azure AD Identity Governance のお客様からは、以下のような評価をいただいています。</p><blockquote><p>“Azure Active Directory のゲスト アクセス レビューにより、適切なレベルの管理を行いながら、スピード感をもって外部とのコラボレーションできるようになり、セキュリティ部門や法務、データ プライバシー担当者の負担が軽減しました。” by Avanade 様</p></blockquote><p>規制の厳しい業界や、政府機関などと連携しているお客様の場合は、アクセス権に関する管理の有効性を定期的に監査担当者に提示する必要があるでしょう。ゲスト ユーザー用の Azure AD アクセス レビューを活用することで、組織が適切な管理と制御を行っていることを監査担当者に証明しやすくなります。Azure AD 上でわずかな構成手順を経るだけで <strong>シンプルなインターフェースによって、すべてのアクセス レビューを一元的に表示</strong> することができます。これにより IT 管理者は、マルチクラウド、マルチデバイス、様々なアプリケーションごとに、ユーザーのリソースごとのアクセス可否を確認することができます。</p><p>Azure AD アクセス レビューの概要については、<a href="https://docs.microsoft.com/ja-jp/azure/active-directory/governance/manage-guest-access-with-access-reviews">公開情報</a> と <a href="https://www.youtube.com/watch?v=3D2_YW2DwQ8">YouTube 解説</a> をぜひご覧ください。Azure AD Identity Governance の詳細については、<a href="https://www.microsoft.com/ja-jp/security/business/identity-access-management/identity-governance">当社ウェブサイト</a> もご覧ください。</p><h2 id="参考情報"><a href="#参考情報" class="headerlink" title="参考情報"></a>参考情報</h2><ul><li>関連投稿 (英語): <a href="https://techcommunity.microsoft.com/t5/azure-active-directory-identity/access-reviews-for-guests-in-all-teams-and-microsoft-365-groups/ba-p/1994697">Access Reviews for guests in all Teams and Microsoft 365 Groups is now in public preview</a></li><li>当社ウェブサイト: <a href="https://www.microsoft.com/ja-jp/security/business/identity-access-management/identity-governance">Azure AD でのアイデンティティ ガバナンス</a></li><li>公開情報: <a href="https://docs.microsoft.com/ja-jp/azure/active-directory/governance/manage-guest-access-with-access-reviews">Azure AD のアクセス レビューによるゲスト アクセスの管理</a></li><li>YouTube 解説 (英語): <a href="https://www.youtube.com/watch?v=3D2_YW2DwQ8&feature=emb_imp_woyt">Review guest user access across all Microsoft 365 groups and Microsoft Teams</a></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Azure Identity サポート チームの栗井です。&lt;/p&gt;
&lt;p&gt;本記事は、2021 年 6 月 23 日に米国の Azure Active Directory Identity Blog で公開された &lt;a href=&quot;https://techcomm</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="Azure AD B2B" scheme="https://jpazureid.github.io/blog/tags/Azure-AD-B2B/"/>
    
    <category term="US Identity Blog" scheme="https://jpazureid.github.io/blog/tags/US-Identity-Blog/"/>
    
    <category term="Governance" scheme="https://jpazureid.github.io/blog/tags/Governance/"/>
    
  </entry>
  
  <entry>
    <title>Azure AD を使用して Zero Trust アーキテクチャと MFA の要件を満たすためのガイダンス</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/guidance-on-using-azure-ad-to-meet-zero-trust-architecture-and/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/guidance-on-using-azure-ad-to-meet-zero-trust-architecture-and/</id>
    <published>2021-07-03T09:00:00.000Z</published>
    <updated>2021-09-16T18:49:48.494Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Azure Identity サポート チームの村上です。</p><p>本記事は、2021 年 6 月 23 日に米国の Azure Active Directory Identity Blog で公開された <a href="https://techcommunity.microsoft.com/t5/azure-active-directory-identity/guidance-on-using-azure-ad-to-meet-zero-trust-architecture-and/ba-p/1751676">Guidance on using Azure AD to meet Zero Trust Architecture and MFA requirements</a> を意訳したものになります。ご不明点等ございましたらサポート チームまでお問い合わせください。</p><hr><p>皆さん、こんにちは。</p><p>最近発表された <a href="https://www.whitehouse.gov/briefing-room/presidential-actions/2021/05/12/executive-order-on-improving-the-nations-cybersecurity/">国家のサイバー セキュリティ向上に関する大統領令</a> では、ゼロトラスト アーキテクチャと多要素認証が義務付けられていますが、これらの要件はどのようなもので、基準を満たすために Azure AD のツールをどのように使用すればよいのか気にされている方もいらっしゃると思います。</p><p>我々の公開文書の中で、この新しいガイダンスを紹介できることを嬉しく思います。このガイダンスは、Azure Active Directory を使用して政府や業界の ID 要件を満たすためのものです。マイクロソフトは、 <a href="https://docs.microsoft.com/en-us/compliance/regulatory/offering-home">自社が</a> いかにこれら多くの標準を満たしているかをドキュメントにまとめて公開しています。貴社でもマイクロソフトがこれら標準に準拠していることを前提に、弊社サービスを活用いただくことができますが、マイクロソフトがいくらこれら標準へ準拠しているといっても、時に 「”共同責任” (貴社とマイクロソフトでともに標準への準拠に責任を負う)」の概念が生じる場合があります。この新しいガイダンスは、貴社が <strong>Azure Active Directory を使用して、これらの ID 要件を満たすことができる</strong> ように設計されたものです。また、Microsoft が連邦政府向けに作成した、クラウドと Zero Trust の刷新に関するガイド <a href="https://cloudblogs.microsoft.com/industry-blog/microsoft-in-business/government/2021/06/24/mapping-the-cybersecurity-executive-order-milestones/">Mapping the Cybersecurity Executive Order Milestones</a> もご覧ください。 </p><p>例として、FedRAMP High controls IA-2 (1-4) の要件を満たすことを考えてみましょう。これらの要件を理解するには、<a href="https://www.fedramp.gov/assets/resources/documents/FedRAMP_Security_Controls_Baseline.xlsx">FedRAMP セキュリティ コントロール ベースライン</a> に始まり、<a href="https://csrc.nist.gov/publications/detail/sp/800-53/rev-4/final">NIST SP 800-53 Rev.4</a> から、このベースとなっている <a href="https://pages.nist.gov/800-63-3/sp800-63-3.html">NIST SP 800-63 Rev.3</a>、さらにこの基盤となる <a href="https://csrc.nist.gov/publications/detail/fips/140/2/final">NIST FIPS 140-2</a> にまで踏み込まなければなりません。お分かりのとおり… とてつもない量の読解が必要です。他には、<a href="https://aka.ms/AzureADStandards">スタンダードとコンプライアンスのセクション</a> を活用することもできます。このセクションでは、以下の方法でこの管理を満たすためのガイダンスを提供しています。</p><ol><li>MFA を必要とするように Conditional Access (CA) ポリシーを設定する。</li><li>デバイス管理ポリシーと CA ポリシーを設定し、これらの管理対象デバイスへのサインインに MFA を必要とするようにする。    </li><li>FedRAMP High で要求される <a href="https://techcommunity.microsoft.com/t5/azure-active-directory-identity/10-reasons-to-love-passwordless-2-nist-compliance/ba-p/2115725">NIST 認証保証レベル</a> (AAL) 3 を満たす実行可能な MFA オプション。</li><li>PIM を使用して、PIM のアクティブ化なしに特権的なローカル アクセスを行わないようにする。</li></ol><p><strong>新しい標準およびコンプライアンス分野に関し、まず 2 つのコンテンツを以下のとおり発表いたします:</strong></p><p><a href="https://docs.microsoft.com/ja-jp/azure/active-directory/standards/nist-overview">NIST Authenticator Assurance Levels を満たすように Azure Active Directory を構成する</a> </p><ul><li>まず、NIST 800-63 - Digital Identity Guidelines より取り掛かりました。NIST 800-63 は、他の多くの規格や規制が前提としているガイドラインで、デジタル アイデンティティのフレームワークとして認知されています。 </li><li>このガイダンスでは、Azure Active Directory を使用して NIST 認証保証レベル (AAL) を満たす方法を詳細に説明し、これらの AAL を利用可能なすべての認証方法に対応付けます。</li></ul><p><a href="https://docs.microsoft.com/ja-jp/azure/active-directory/standards/configure-azure-active-directory-for-fedramp-high-impact">FedRAMP High Impact Level を満たすための Azure Active Directory の構成</a> </p><ul><li>米国の多くの連邦政府機関およびこれらの機関にクラウド サービスを提供するクラウド ソリューション プロバイダー (CSP) は、FedRAMP プログラムの要件を満たす必要があります。私たちは、FedRAMP High のベースラインに沿ってガイダンスを作成し、最も厳格な ID 管理もカバーできるようにしました。このアプローチにより、より低い FedRAMP ベースラインを遵守する必要のあるお客様にも、このガイダンスをご利用いただけます。</li></ul><p>近々、米国政府機関では、多要素認証の完全導入が求められます。ゼロ トラスト アプローチの一環として明示的に認証情報を検証する必要が生じますので、貴社においても <a href="https://www.microsoft.com/en-us/security/business/identity-access-management/mfa-multi-factor-authentication">MFA を有効にする</a> ためのリソースをご確認ください。</p><p>お客様が Azure Active Directory を利用して実現したいアイデンティティ要件に関する規格、規制、その他のコンプライアンス フレームワークについて、皆様からのご意見をお待ちしております。今後も、標準、規制、その他のコンプライアンス フレームワークの内容を確認し、必要に応じてお客様が Azure Active Directory を使用してアイデンティティ要件を満たせるようなガイダンスを作成していきます。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Azure Identity サポート チームの村上です。&lt;/p&gt;
&lt;p&gt;本記事は、2021 年 6 月 23 日に米国の Azure Active Directory Identity Blog で公開された &lt;a href=&quot;https://techcomm</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="US Identity Blog" scheme="https://jpazureid.github.io/blog/tags/US-Identity-Blog/"/>
    
  </entry>
  
  <entry>
    <title>Microsoft Authentication Library と Microsoft Graph への移行は完了済みでしょうか？</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/have-you-updated-your-applications-to-use-the-microsoft/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/have-you-updated-your-applications-to-use-the-microsoft/</id>
    <published>2021-07-01T01:00:00.000Z</published>
    <updated>2021-09-16T18:49:48.494Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Azure Identity サポート チームの竜と村上です。</p><p>本記事は、米国の Azure Active Directory Identity Blog で公開された <a href="https://techcommunity.microsoft.com/t5/azure-active-directory-identity/have-you-updated-your-applications-to-use-the-microsoft/ba-p/1144698">Have you updated your applications to use the Microsoft Authentication Library and Microsoft Graph?</a> を意訳したものになります。ご不明点等ございましたらサポート チームまでお問い合わせください。</p><hr><p>皆さん、こんにちは。</p><p>2020 年に、アプリケーションを開発する際に <a href="https://docs.microsoft.com/ja-jp/azure/active-directory/develop/msal-overview#languages-and-frameworks">Microsoft Authentication Library (MSAL)</a> と <a href="https://docs.microsoft.com/ja-jp/graph/overview">Microsoft Graph API</a> を使用することを、<a href="https://techcommunity.microsoft.com/t5/azure-active-directory-identity/update-your-applications-to-use-microsoft-authentication-library/ba-p/1257363">開発者の皆さまへ推奨しました</a>。それ以降、MSAL および Microsoft Graph 双方へのパフォーマンス、セキュリティ、信頼性の向上など機能追加に継続して取り組んで参りました。また、<a href="https://docs.microsoft.com/ja-jp/azure/active-directory/develop/app-resilience-continuous-access-evaluation">継続的なアクセス評価 (CAE)</a> に対応した API や、Microsoft Graph への <a href="https://docs.microsoft.com/ja-jp/azure/active-directory/develop/developer-guide-conditional-access-authentication-context">条件付きアクセス認証コンテキスト</a> の追加など、数百もの新しい API を追加しました。MSAL を使用している開発者の皆様がこれらを利用できるようになり、<a href="https://www.microsoft.com/security/blog/2021/01/19/using-zero-trust-principles-to-protect-against-sophisticated-attacks-like-solorigate/">ゼロトラスト対応</a> のアプリケーションを構築できるようになりました。</p><p>2022 年 6 月 30 日をもちまして Active Directory Auth Library (ADAL) および Azure Active Directory Graph のサポートを終了するため、MSAL および Microsoft Graph を使用するよう、アプリのアップデートを推奨します。また、まだ ADAL を使用しているアプリを簡単に見つけることができるようにいたしました。</p><h2 id="ADAL-と-Azure-AD-Graph-をまだ使用しているアプリケーションを特定する"><a href="#ADAL-と-Azure-AD-Graph-をまだ使用しているアプリケーションを特定する" class="headerlink" title="ADAL と Azure AD Graph をまだ使用しているアプリケーションを特定する"></a>ADAL と Azure AD Graph をまだ使用しているアプリケーションを特定する</h2><p>Azure AD Monitor Workbook を使用することで、ADAL を使用しているアプリケーションを特定可能です。Azure AD Monitor workbook は、Azure AD サインイン ログの情報を収集して視覚化する一連のクエリを使用しています。<a href="https://docs.microsoft.com/ja-jp/azure/active-directory/reports-monitoring/reference-azure-monitor-sign-ins-log-schema">こちらのサインイン ログ スキーマ</a> を使用して、サインイン ログを直接参照することもできます。</p><p>ワークブックにアクセスするには:</p><ol><li><a href="https://portal.azure.com/">Azure ポータル</a> にサインインします。</li><li><strong>Azure Active Directory</strong> &gt; <strong>監視</strong> &gt; <strong>Workbooks</strong> に移動します。</li><li>使用状況のセクションから <strong>サインインの Workbook</strong> を開きます。</li></ol><p><img src="/blog/azure-active-directory/have-you-updated-your-applications-to-use-the-microsoft/Woodgrove.png"> </p><p>サインイン Workbook では、ページ下部に新しい表が追加され、最近使用したアプリが ADAL を使用しているかどうかがわかるようになりました。また、これらのアプリの一覧をエクスポートすることもできます。</p><p><img src="/blog/azure-active-directory/have-you-updated-your-applications-to-use-the-microsoft/WoodgroveWorkbooks.png"></p><p>ADAL を使用しているアプリを特定したら、<a href="https://docs.microsoft.com/ja-jp/azure/active-directory/develop/msal-migration">MSAL の移行ガイド</a> の活用もご検討ください。Azure AD Graph を使用しているアプリを見つけるには、ソースコード内を “graph.windows.net” という文字列で検索してから、<a href="https://docs.microsoft.com/ja-jp/graph/migrate-azure-ad-graph-planning-checklist?view=graph-rest-1.0">Microsoft Graph の移行ガイド</a> を使用ください。</p><p>ご質問や問題、機能リクエストがございましたら、<a href="https://docs.microsoft.com/en-us/answers/topics/azure-ad-adal-deprecation.html">azure-ad-adal-deprecation</a> または <a href="https://docs.microsoft.com/en-us/answers/topics/azure-ad-graph-deprecation.html">azure-ad-graph-deprecation</a> タグを使用して Microsoft Q&amp;A にてお知らせください。</p><p>いつものように、ご意見やご提案をお待ちしています。以下のコメント欄または <a href="https://feedback.azure.com/forums/169401-azure-active-directory">Azure AD フィードバックフォーラム</a>で、ご意見をお聞かせください。</p><p>Alex Simons (Twitter: <a href="http://twitter.com/alex_a_simons">@Alex_A_Simons</a>)<br>Corporate Vice President of Program Management<br>Microsoft Identity Division</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Azure Identity サポート チームの竜と村上です。&lt;/p&gt;
&lt;p&gt;本記事は、米国の Azure Active Directory Identity Blog で公開された &lt;a href=&quot;https://techcommunity.microsof</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="US Identity Blog" scheme="https://jpazureid.github.io/blog/tags/US-Identity-Blog/"/>
    
  </entry>
  
  <entry>
    <title>エンタープライズ アプリケーションに、管理者の知らないアプリケーションが追加されている!</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/enterpriseapps-multitenantapps/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/enterpriseapps-multitenantapps/</id>
    <published>2021-06-30T15:00:00.000Z</published>
    <updated>2021-09-16T18:49:48.486Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは。Azure Identity チームの栗井です。</p><p>突然ですが、Azure AD の管理者ユーザー様からよく、下記のようなお問い合わせをいただきます。</p><p>「Azure AD の [エンタープライズ アプリケーション] 一覧に、管理者が追加した覚えのないアプリケーションが追加されています。」</p><p>「これはユーザーが追加したものなのでしょうか。Azure AD のアカウントと連携をとっているのでしょうか。」</p><p>「追加されたアプリケーションは、Azure AD 上の情報やリソースにアクセスが発生するものなのでしょうか。心配です。」</p><h2 id="その正体は「マルチテナント-アプリケーション」"><a href="#その正体は「マルチテナント-アプリケーション」" class="headerlink" title="その正体は「マルチテナント アプリケーション」"></a>その正体は「マルチテナント アプリケーション」</h2><p>Azure ポータル上で確認いただける [エンタープライズ アプリケーション] には、既定で多くのアプリのサービス プリンシパルが登録されております。</p><p>既定で登録されているもの以外について、どのようなパターンでサービス プリンシパルが追加されるのか？という点については、すべてを網羅的にご案内することは難しいですのですが、大まかには下記の 2 パターンに分けることができます。</p><ol><li>権限のあるユーザー (テナント管理者など) が意図的に追加したもの<ul><li>(例) [アプリの登録] 上で登録した Open ID Connect のアプリのサービス プリンシパル<br>豆知識 : [アプリの登録] で一般ユーザーがアプリケーションを登録することを禁止したい場合は <a href="https://jpazureid.github.io/blog/azure-active-directory/users-can-register-applications/">こちらのブログ</a> でご紹介しております</li><li>(例) SAML 連携しているアプリケーションのサービス プリンシパル</li></ul></li><li>ユーザーが何らかのアプリケーションでの認証時に、Azure AD のアカウントを利用することによって、自動的に追加されたもの</li></ol><p>上記の 2. の方法で追加されるサービス プリンシパルは、「マルチテナント アプリケーション」という種類のアプリです。マルチテナント アプリのサービス プリンシパル登録は、管理者の操作を必要としません。</p><p><strong>マルチテナント アプリ</strong>とは、<strong>Azure AD アカウントを持つすべてのユーザー (テナント内外問わず) による、アプリおよび API の利用を想定して設計</strong>されているアプリです。</p><p>※ 具体的には、マルチテナント アプリは外部の Azure AD のテナントの [アプリの登録] にて登録されています。かつ、サポートしているアカウントとして “任意の組織ディレクトリ内のアカウント (任意の Azure AD ディレクトリ - マルチテナント)” が選択されています。</p><h2 id="どのような操作で、ユーザーによって「マルチテナント-アプリケーション」が追加されるのか？"><a href="#どのような操作で、ユーザーによって「マルチテナント-アプリケーション」が追加されるのか？" class="headerlink" title="どのような操作で、ユーザーによって「マルチテナント アプリケーション」が追加されるのか？"></a>どのような操作で、ユーザーによって「マルチテナント アプリケーション」が追加されるのか？</h2><p>ここでは、弊社が公開しているマルチテナント アプリケーション <a href="https://developer.microsoft.com/ja-jp/graph/graph-explorer">“Microsoft Graph Explorer”</a> を例に説明します。</p><p><a href="https://developer.microsoft.com/ja-jp/graph/graph-explorer">“Microsoft Graph Explorer”</a> は、Microsoft Graph REST API 要求を簡単に作成し、対応する応答を表示できる開発者ツールです。このアプリケーションは、弊社の Azure AD テナント (microsoft.com) の [アプリの登録] 上で、マルチテナント アプリケーションとして登録されています。</p><ul><li>仮定 1 : userA さん (<a href="mailto:&#117;&#x73;&#101;&#114;&#65;&#x40;&#99;&#x6f;&#x6e;&#x74;&#111;&#x73;&#x6f;&#46;&#x63;&#111;&#x6d;">&#117;&#x73;&#101;&#114;&#65;&#x40;&#99;&#x6f;&#x6e;&#x74;&#111;&#x73;&#x6f;&#46;&#x63;&#111;&#x6d;</a>) は、contoso.com の Azure AD に所属するユーザーです。</li><li>仮定 2 : contoso.com の Azure AD の [エンタープライズ アプリケーション] 上には、まだ “Microsoft Graph Explorer” のサービス プリンシパルは存在しません。</li></ul><h3 id="userA-さんによってマルチテナント-アプリ「Graph-Explorer」が追加される時の操作"><a href="#userA-さんによってマルチテナント-アプリ「Graph-Explorer」が追加される時の操作" class="headerlink" title="userA さんによってマルチテナント アプリ「Graph Explorer」が追加される時の操作"></a>userA さんによってマルチテナント アプリ「Graph Explorer」が追加される時の操作</h3><ol><li><p>userA さんは、 <a href="https://developer.microsoft.com/ja-jp/graph/graph-explorer">“Microsoft Graph Explorer”</a> にアクセスします。</p></li><li><p>userA さんは下記のボタンから、自身の Azure AD アカウントで認証します。</p><p> <img src="/blog/azure-active-directory/enterpriseapps-multitenantapps/fig1.png" alt="fig1"></p></li><li><p>パスワード認証後、userA さんには下記の画面が表示されます。この例では、openid, profile, User.Read, offline_access へのアクセス許可が要求されているので、userA さんは “承諾” を押下します。</p><p> <img src="/blog/azure-active-directory/enterpriseapps-multitenantapps/fig2.png" alt="fig2"></p></li></ol><ol start="4"><li><p><a href="mailto:&#x75;&#x73;&#x65;&#114;&#65;&#x40;&#x63;&#x6f;&#x6e;&#116;&#x6f;&#115;&#x6f;&#x2e;&#99;&#x6f;&#109;">&#x75;&#x73;&#x65;&#114;&#65;&#x40;&#x63;&#x6f;&#x6e;&#116;&#x6f;&#115;&#x6f;&#x2e;&#99;&#x6f;&#109;</a>でのサインインが成功します。</p><p> <img src="/blog/azure-active-directory/enterpriseapps-multitenantapps/fig3.png" alt="fig3"></p></li><li><p>次回以降 userA が Graph Explorer にアクセスする際は、openid, profile, User.Read, offline_access のアクセス許可への同意が要求されることはありません。</p></li></ol><p>userA が上記の操作を行った後、管理者によって contoso.com テナントの [エンタープライズ アプリケーション] を開くと、下記のように “Graph explorer (official site)” という名前のサービス プリンシパル が追加されています。</p><p>正確には、3. でユーザーが  “承諾” を押下したタイミングで、このサービス プリンシパルが作成されています。</p><p><img src="/blog/azure-active-directory/enterpriseapps-multitenantapps/fig4.png" alt="fig4"></p><p>なお、同じアプリケーションのサービス プリンシパルが、テナント上に複数登録されることはありません。userA による上記の操作によって作成されたサービス プリンシパルは、今後他のユーザーが Graph Explorer にアクセスする際にも利用されるようになります。</p><h2 id="よくある質問-1-管理者の知らないところでユーザーによって登録された-マルチテナント-アプリケーションは、Azure-AD-上のリソースにアクセスが可能なのですか？セキュリティ的に心配です。"><a href="#よくある質問-1-管理者の知らないところでユーザーによって登録された-マルチテナント-アプリケーションは、Azure-AD-上のリソースにアクセスが可能なのですか？セキュリティ的に心配です。" class="headerlink" title="よくある質問 (1) 管理者の知らないところでユーザーによって登録された マルチテナント アプリケーションは、Azure AD 上のリソースにアクセスが可能なのですか？セキュリティ的に心配です。"></a>よくある質問 (1) 管理者の知らないところでユーザーによって登録された マルチテナント アプリケーションは、Azure AD 上のリソースにアクセスが可能なのですか？セキュリティ的に心配です。</h2><p>これは「はい」であり「いいえ」です。まず、下記の大原則がございます。</p><ol><li><p>アプリケーションが Azure AD のリソースにアクセスするためには、テナントのユーザーが明示的に “アクセス許可” を付与する操作が必要です。その操作が行われるのは (先ほども出てきた) この画面です。</p><p> <img src="/blog/azure-active-directory/enterpriseapps-multitenantapps/fig2.png" alt="fig2"></p></li><li><p>ユーザーが “アクセス許可” を承諾することができるのは、そのユーザー自身がアクセスできるリソースの範囲に限られます。</p></li><li><p>Azure AD テナント全体 (テナントユーザー全員のリソースや、テナント自体に紐づくデータなど) へのアクセス許可を承諾することができるのは、管理者ユーザーのみです。</p></li></ol><p>“アクセス許可” 自体の考え方や仕組みについては、下記の記事でより詳細に、分かりやすくご紹介しておりますので、こちらをご覧ください。</p><ul><li>「管理者の承認が必要」のメッセージが表示された場合の対処法(<a href="https://jpazureid.github.io/blog/azure-active-directory/azure-ad-consent-framework/">https://jpazureid.github.io/blog/azure-active-directory/azure-ad-consent-framework/</a>)</li></ul><p>ここでお伝えしたいことの要点は下記の通りです。</p><ul><li><strong>管理者が知らないところで一般ユーザーによって追加されたマルチテナント アプリのサービス プリンシパルが、Azure AD のリソース全体にアクセスできる ! ということは起こりえません</strong> ので、ご安心ください。</li><li>なぜなら、Azure AD のリソース全体にアクセスするための許可 (アプリケーション権限) をサービス プリンシパルに与えられるのは、管理者ユーザーのみだからです。</li><li>一般ユーザーは、自身がアクセス可能な範囲でアプリにアクセス許可を与えることができます。(ユーザー委任の権限)</li></ul><p>先述の例だと、userA は Graph Explorer に対して、下記のアクセスを許可しています。<br>    - userA 自身の基本情報 (openid, profile, User.Read) へのアクセス<br>    - userA が許可済みのアクセスに対する、継続的なアクセス権 (offline_access)<br>    - <a href="https://docs.microsoft.com/ja-jp/azure/active-directory/develop/v2-permissions-and-consent#openid-connect-scopes">profile と offline_access についての詳細はこちら</a></p><h2 id="よくある質問-2-エンタープライズ-アプリケーションが勝手に追加されるのは不本意です。一般ユーザーによるこの操作を禁止することは可能でしょうか"><a href="#よくある質問-2-エンタープライズ-アプリケーションが勝手に追加されるのは不本意です。一般ユーザーによるこの操作を禁止することは可能でしょうか" class="headerlink" title="よくある質問 (2) エンタープライズ アプリケーションが勝手に追加されるのは不本意です。一般ユーザーによるこの操作を禁止することは可能でしょうか?"></a>よくある質問 (2) エンタープライズ アプリケーションが勝手に追加されるのは不本意です。一般ユーザーによるこの操作を禁止することは可能でしょうか?</h2><p>結論から言うと可能です。</p><p>前述の通り、マルチテナント アプリケーションのサービス プリンシパルが追加されるタイミングは、「ユーザーが認証後、アクセス許可を承諾した時」です。<br>なので、ユーザーによるアクセス許可の承諾を禁止することで、マルチテナント アプリケーションの追加もできなくなります。</p><p>これによって、ユーザーの認証後に表示される “アクセス許可” の画面が、下記の画面に置きかわります。</p><p><img src="/blog/azure-active-directory/enterpriseapps-multitenantapps/fig4.png" alt="fig4"></p><p>ユーザーは管理者によってアクセス許可が承諾されない限り、このアプリケーションへアクセスすることができません。</p><p>ユーザーによるアクセス許可の承諾を禁止する設定画面は 2 つございます。</p><h3 id="1-エンタープライズ-アプリケーション-gt-ユーザー設定"><a href="#1-エンタープライズ-アプリケーション-gt-ユーザー設定" class="headerlink" title="1. [エンタープライズ アプリケーション] &gt; [ユーザー設定]"></a>1. [エンタープライズ アプリケーション] &gt; [ユーザー設定]</h3><p><img src="/blog/azure-active-directory/enterpriseapps-multitenantapps/fig5.png" alt="fig5"></p><p>設定項目 : [ユーザーは、アプリが自身の代わりに会社のデータにアクセスすることを許可できます]<br>この項目を “いいえ” にすることで、ユーザーはアプリケーションに対していかなるアクセス許可も承諾することができなくなります。 </p><h3 id="2-エンタープライズ-アプリケーション-gt-同意とアクセス許可"><a href="#2-エンタープライズ-アプリケーション-gt-同意とアクセス許可" class="headerlink" title="2. [エンタープライズ アプリケーション] &gt; [同意とアクセス許可]"></a>2. [エンタープライズ アプリケーション] &gt; [同意とアクセス許可]</h3><p><img src="/blog/azure-active-directory/enterpriseapps-multitenantapps/fig6.png" alt="fig6"></p><p>この画面では、前述の [ユーザー設定] よりも細かい設定が可能です。設定内容はより細かくなりましたが、前述の [ユーザーは、アプリが自身の代わりに会社のデータにアクセスすることを許可できます] と同一の設定ですので、[同意とアクセス許可] の画面で設定を変更すると、[ユーザー設定] の画面でも変更が反映されます。<br>[ユーザー設定] では、ユーザーによるアクセス許可承諾の可否は “はい” “いいえ” のみが選べますが、ここではその中間の選択肢があります。それが “確認済みの発行元からのアプリに対して選択されたアクセス許可を与えることへのユーザーの同意を許可する (推奨)” です。</p><p>とてもカジュアルに言い換えると、「発行元が怪しくないアプリケーションに対する、部分的なアクセス許可であれば、一般ユーザーでも承諾することができる」ということです。</p><ul><li>“確認済みの発行元” とは、「自身のテナント」+「Microsoft によって認められた発行元」のことを指します。「Microsoft によって認められた発行元」についての詳細は下記の公開情報をご覧ください。<ul><li><a href="https://docs.microsoft.com/ja-jp/azure/active-directory/develop/publisher-verification-overview">発行者の確認(docs.microsoft.com)</a></li></ul></li><li>“選択されたアクセス許可” とは、管理者があらかじめ [アクセス許可の分類] に登録したアクセス許可のことです。<ul><li>設定画面 : [エンタープライズ アプリケーション] &gt; [同意とアクセス許可] &gt; [アクセス許可の分類]</li></ul></li></ul><h2 id="よくある質問-3-ユーザーによるアクセス許可の承諾を一切禁止したので、勝手にマルチテナント-アプリケーションが追加されることはなくなりました！ただし、ユーザーが本当に必要なマルチテナント-アプリケーションの利用を許可するには、どうすればいいでしょうか。"><a href="#よくある質問-3-ユーザーによるアクセス許可の承諾を一切禁止したので、勝手にマルチテナント-アプリケーションが追加されることはなくなりました！ただし、ユーザーが本当に必要なマルチテナント-アプリケーションの利用を許可するには、どうすればいいでしょうか。" class="headerlink" title="よくある質問 (3) ユーザーによるアクセス許可の承諾を一切禁止したので、勝手にマルチテナント アプリケーションが追加されることはなくなりました！ただし、ユーザーが本当に必要なマルチテナント アプリケーションの利用を許可するには、どうすればいいでしょうか。"></a>よくある質問 (3) ユーザーによるアクセス許可の承諾を一切禁止したので、勝手にマルチテナント アプリケーションが追加されることはなくなりました！ただし、ユーザーが本当に必要なマルチテナント アプリケーションの利用を許可するには、どうすればいいでしょうか。</h2><p>結論から言うと、「ユーザーに代わって、管理者が代わりにアクセス許可を付与すること」が必要です。</p><p>再掲になりますが、下記の記事で手順をご紹介しています。</p><ul><li>「管理者の承認が必要」のメッセージが表示された場合の対処法(<a href="https://jpazureid.github.io/blog/azure-active-directory/azure-ad-consent-framework/">https://jpazureid.github.io/blog/azure-active-directory/azure-ad-consent-framework/</a>)</li></ul><p>以上の情報がご参考になれば幸いです。<br>ご不明な点がございましたら弊社サポートまでお気軽にお問い合わせください !</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは。Azure Identity チームの栗井です。&lt;/p&gt;
&lt;p&gt;突然ですが、Azure AD の管理者ユーザー様からよく、下記のようなお問い合わせをいただきます。&lt;/p&gt;
&lt;p&gt;「Azure AD の [エンタープライズ アプリケーション] 一覧に、管理者が追加</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="Application" scheme="https://jpazureid.github.io/blog/tags/Application/"/>
    
  </entry>
  
  <entry>
    <title>App Service 認証を利用して複数のテナントの Azure AD ユーザーをサインインさせる方法</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/app-service-auth-multi-tenant/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/app-service-auth-multi-tenant/</id>
    <published>2021-06-29T15:00:00.000Z</published>
    <updated>2021-09-16T18:49:48.398Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Azure &amp; Identity サポート チームの高田です。今回は、App Service 認証を利用して複数のテナントの Azure AD ユーザーを App Service にサインインさせる方法について案内いたします。</p><p>まず、App Service は Web サイトや REST API など HTTP ベースのサービスを公開するための Azure のサービスです。例えば Visual Studio で開発した ASP.NET Core アプリケーションを Azure を用いて公開したい場合、Visual Studio の Publish 機能を用いることで非常に簡単に実現できます。またお客様によっては、そのようにして公開した Web サイトに対し認証機能を組み込みたい場合もあると思います。この場合に活用いただけるのが App Service 認証です (Easy Auth という名称で呼ばれることもあります)。</p><p>以下では、App Service 認証を利用して複数の Azure AD テナントのユーザーを App Service 上の Web サイトにサインインさせる方法をご紹介します。Web サイトの公開範囲ごとにシナリオを分けて解説していきます。</p><ul><li>シナリオ 1: App Service の Web サイトを自テナントのユーザーだけに公開したい</li><li>シナリオ 2: 主に自テナントのユーザー向けに提供している App Service の Web サイトを別テナントの一部ユーザーにもアクセスさせたい</li><li>シナリオ 3: App Service の Web サイトを複数の Azure AD テナントのユーザーにアクセスさせたい</li></ul><p>以下にシナリオごとに順に解説していきます。以下のシナリオは、全て ASP.NET Core Web アプリケーションなどを Visual Studio などから App Service に Publish 済みであるということを前提とします。App Service へ ASP.NET Core アプリケーションを展開する方法については、<a href="https://docs.microsoft.com/ja-jp/aspnet/core/host-and-deploy/azure-apps/?view=aspnetcore-5.0&tabs=visual-studio">Azure App Service に ASP.NET Core アプリを展開する</a> などのページをご覧ください。</p><h2 id="シナリオ-1-App-Service-の-Web-サイトを自テナントのユーザーだけに公開したい"><a href="#シナリオ-1-App-Service-の-Web-サイトを自テナントのユーザーだけに公開したい" class="headerlink" title="シナリオ 1: App Service の Web サイトを自テナントのユーザーだけに公開したい"></a>シナリオ 1: App Service の Web サイトを自テナントのユーザーだけに公開したい</h2><p>まず最も基本的なパターンとして、App Service のサイトを自テナントのユーザーだけに公開したい場合を考えます。この場合、必要なのは、App Service 認証の設定のみです。App Service 認証の設定を行うだけで、アプリへのアクセス時に Azure AD での認証が求められるようになります。また認証が求められた際には、そのアプリが登録されている Azure AD テナントのユーザーのみがサインイン可能です。</p><p>App Service を構成するため以下の手順を進めます。以下の手順は <a href="https://docs.microsoft.com/ja-jp/azure/app-service/scenario-secure-app-authentication-app-service#configure-authentication-and-authorization">チュートリアル: Azure App Service で実行されている Web アプリに認証を追加する</a> でも解説がありますので、よろしければ併せてご参照ください。</p><ol><li>Auzre ポータルに App Service の管理者でサインインし、App Service を開きます。</li><li>App Service 認証を構成したい Web アプリを選びます。</li><li>[認証] を選択して、[ID プロバイダーを追加] を選択します。</li><li>[ID プロバイダー] として [Microsoft] を選択します。</li><li>[アプリの登録の種類] が [アプリの登録を新規作成する] であることを確認します。</li><li>[サポートされているアカウントの種類] が [現在のテナント - 単一テナント] であることを確認します。</li><li>[認証] が [認証が必要] に設定されていることを確認します。</li><li>[追加] を選択します。</li></ol><p><img src="/blog/azure-active-directory/app-service-auth-multi-tenant/screen1.png"></p><p>以上で操作は可能です。Web サイトの URL にアクセスいただくと、Azure AD の認証画面が表示されるようになります。上記操作を行った Azure AD テナントのユーザーを指定すれば、アプリにサインインできます。</p><p>なお、ユーザーが App Service 認証を経由して Web アプリにアクセスすると、Web アプリには以下のような値を含む HTTP ヘッダーが渡されます。Web アプリはこのヘッダーの値を確認することで、どのようなユーザーがサインインしてきたかを識別可能です。詳細については <a href="https://docs.microsoft.com/ja-jp/azure/app-service/app-service-authentication-how-to#access-user-claims">Azure App Service 上での認証と承認の高度な使用方法 - ユーザー要求へのアクセス</a> もご参照ください。</p><table><thead><tr><th>HTTP ヘッダーの名前</th><th>ヘッダーの値 (例)</th></tr></thead><tbody><tr><td>X-MS-CLIENT-PRINCIPAL-NAME</td><td><a href="mailto:&#116;&#101;&#x73;&#116;&#x40;&#99;&#x6f;&#x6e;&#x74;&#111;&#x73;&#x6f;&#x2e;&#99;&#111;&#109;">&#116;&#101;&#x73;&#116;&#x40;&#99;&#x6f;&#x6e;&#x74;&#111;&#x73;&#x6f;&#x2e;&#99;&#111;&#109;</a></td></tr><tr><td>X-MS-CLIENT-PRINCIPAL-ID</td><td>bfef01fb-9b32-457a-b488-690de651bf7f</td></tr></tbody></table><h2 id="シナリオ-2-主に自テナントのユーザー向けに提供している-App-Service-の-Web-サイトを別テナントの一部ユーザーにもアクセスさせたい"><a href="#シナリオ-2-主に自テナントのユーザー向けに提供している-App-Service-の-Web-サイトを別テナントの一部ユーザーにもアクセスさせたい" class="headerlink" title="シナリオ 2: 主に自テナントのユーザー向けに提供している App Service の Web サイトを別テナントの一部ユーザーにもアクセスさせたい"></a>シナリオ 2: 主に自テナントのユーザー向けに提供している App Service の Web サイトを別テナントの一部ユーザーにもアクセスさせたい</h2><p>このシナリオの場合、Azure AD が提供する B2B ゲスト招待機能を利用することが適切です。App Service 認証はシナリオ 1 と同様に単一テナントとして構成し、自テナントに外部テナントのユーザーをゲスト招待します。外部テナントのユーザーを都度招待するということが手間でなければ (事前にこのユーザーは App Service の Web サイトアクセスさせたいというのがわかっていれば)、Azure AD の観点でも適切な方法になります。</p><p>上述のとおり、このシナリオの場合は App Service 認証の観点では特に構成変更の必要はありません。シナリオ 1 に加えて、以下の Azure AD 側の対応 (ゲストの招待操作) を実施いただければと思います。</p><ol><li>Auzre ポータルにアクセスします。</li><li>App Service を構成しているテナントに Azure AD のグローバル管理者やゲスト招待元のディレクトリ ロールを持つユーザーでサインインします。</li><li>Azure Active Directory ブレードに進み、[ユーザー] を開きます。</li><li>[+ 新しいゲスト ユーザー] を押します。</li><li>招待したい外部校テナントのユーザーの E メール アドレス (<a href="mailto:&#116;&#x65;&#x73;&#x74;&#64;&#x66;&#97;&#x62;&#114;&#105;&#x6b;&#97;&#109;&#46;&#99;&#111;&#109;">&#116;&#x65;&#x73;&#x74;&#64;&#x66;&#97;&#x62;&#114;&#105;&#x6b;&#97;&#109;&#46;&#99;&#111;&#109;</a>) を入力して、招待ボタンを押します。</li><li>指定されたユーザーで招待メールが届いているかを確認します。</li><li>招待メールを受け取ったユーザーは、メールに従い招待の処理を完了します。</li></ol><p>以上の操作を行うことで、招待処理を完了したユーザーは、App Service を構成している Azure AD テナントにゲストとして Azure AD アカウントが作成されます。これにより、そのゲスト ユーザーは App Service を構成している Azure AD テナント上のユーザーとして認識されます。このため App Service 認証の設定が単一テナントのままでも、その Web サイトにサインインが可能になります。招待していないユーザーで Web サイトにアクセスしようとするとそのユーザーはアクセスがブロックされます。</p><h2 id="シナリオ-3-App-Service-の-Web-サイトを複数の-Azure-AD-テナントのユーザーにアクセスさせたい"><a href="#シナリオ-3-App-Service-の-Web-サイトを複数の-Azure-AD-テナントのユーザーにアクセスさせたい" class="headerlink" title="シナリオ 3: App Service の Web サイトを複数の Azure AD テナントのユーザーにアクセスさせたい"></a>シナリオ 3: App Service の Web サイトを複数の Azure AD テナントのユーザーにアクセスさせたい</h2><p>上記シナリオ 2 では、App Service の Web サイトに外部のユーザーをアクセスさせるにあたり個別にゲスト ユーザーの招待が必要でした。個別に招待を行うのではなく、複数の Azure AD テナントのユーザーに Web サイトへのアクセスを許可したい場合は、App Service 認証を単一テナントではなく、マルチテナントとして構成します。これにより、どの Azure AD テナントからでもその Web サイトにアクセスさせることができるようになります。</p><p>まず、既に単一テナントで App Service 認証を構成している場合は、以下の手順に沿って既存の構成を一旦削除ください。</p><ol><li>Auzre ポータルに App Service の管理者でサインインし、App Service を開きます。</li><li>App Service 認証を構成したい Web アプリを選びます。</li><li>[認証] を選択して、[認証の設定] の隣にある [編集] を選択します。</li><li>[認証されていないアクセスを許可する] を選択して、[保存] を押下します。</li><li>[ID プロバイダー] から Microsoft を探して、削除のアイコンをクリックします。</li><li>確認画面で [削除] を選択します。</li></ol><p>続いて、マルチテナントとして構成するため ID プロバイダーを追加しなおします。</p><ol><li>[ID プロバイダーを追加] を選択します。</li><li>[ID プロバイダー] として [Microsoft] を選択します。</li><li>[アプリの登録の種類] が [アプリの登録を新規作成する] であることを確認します。</li><li>[サポートされているアカウントの種類] で [任意の Azure AD ディレクトリ - マルチテナント] を選択します。</li><li>[認証] が [認証が必要] に設定されていることを確認します。</li><li>[追加] を選択します。</li></ol><p>なお、[追加] を押下した際に、同じ名前のアプリケーションが既に存在するメッセージが表示されるかと思います。これは先に単一テナントで App Service 認証を構成したときのアプリケーション オブジェクトが Azure AD 側に残っているためです。メッセージを回避するには名前を別のものに変更するか、以下の手順で Azure AD から該当のアプリケーション オブジェクトを削除して再度同じ名前で追加を実施ください。</p><ol><li>Azure Active Directory ブレードを開き、[アプリの登録] を開きます。</li><li>検索ボックスにアプリケーションの名前を入力します。</li><li>結果が表示されたらそれをクリックします。</li><li>[削除] を選択します。</li><li>確認が求められたら [削除] を再度押下します。</li></ol><p>ID プロバイダーの追加が完了したら、さらに以下の操作を行います。</p><ol><li>[ID プロバイダー] から Microsoft を探して、編集のアイコンをクリックします。</li><li>[発行者の URL] を <a href="https://login.microsoftonline.com/common/v2.0">https://login.microsoftonline.com/common/v2.0</a> に変更します。</li><li>[保存] を選択します。</li></ol><p><img src="/blog/azure-active-directory/app-service-auth-multi-tenant/screen2.png"></p><p>以上で操作は完了です。</p><p>Azure AD ではアプリケーション オブジェクト側の構成とログオン時の URL の指定内容によって、どのユーザーがアプリケーションにサインイン可能かを制御しています。元々上記 [発行者の URL] にはテナント ID を含む値が指定されていました。この場合、アプリケーションがマルチテナントで構成されていても、そのアプリにサインインできるのはその指定されたテナント上のユーザーのみとなります。発行者の URL を <a href="https://login.microsoftonline.com/common/v2.0">https://login.microsoftonline.com/common/v2.0</a> に書き換えると、URL としてもマルチテナントを受け入れるようになるため、複数のテナントのユーザーからサインインが可能となります。</p><p>なお、上記状態では構成したとおり様々な Azure AD テナントから Web アプリにアクセスが可能となります。もしアプリを特定の数テナントだけにアクセスさせたいという場合は、アプリケーション側で X-MS-CLIENT-PRINCIPAL-NAME ヘッダーの値を確認し、サインインしたユーザーのドメイン名が意図したものでなければアクセスを拒否するなどの対応をご検討ください。</p><h2 id="シナリオ-4-App-Service-の-Web-サイトを、App-Service-を構成したテナントとは別のテナントのユーザーにアクセスさせたい"><a href="#シナリオ-4-App-Service-の-Web-サイトを、App-Service-を構成したテナントとは別のテナントのユーザーにアクセスさせたい" class="headerlink" title="シナリオ 4: App Service の Web サイトを、App Service を構成したテナントとは別のテナントのユーザーにアクセスさせたい"></a>シナリオ 4: App Service の Web サイトを、App Service を構成したテナントとは別のテナントのユーザーにアクセスさせたい</h2><p>App Service に紐づくサブスクリプションがあるテナントと、ユーザーを管理しているテナントが異なる場合などに、ご利用いただける方法です。ここでご紹介する手順は、<a href="https://docs.microsoft.com/ja-jp/azure/app-service/configure-authentication-provider-aad#use-an-existing-registration-created-separately">Azure AD ログインを使用するように App Service または Azure Functions アプリを構成する - 個別に作成された既存の登録を使用する</a> の公開情報でも解説がございます。</p><p><strong>テナント構成の前提</strong></p><ul><li>テナント A: App Service の Web サイトをホストしているテナント</li><li>テナント B: App Service にアクセスするユーザーが存在しているテナント</li></ul><p><strong>テナント B 上での作業</strong></p><ol><li>テナント B の Azure ポータルにサインインし、Azure Active Directory ブレードを開き、[アプリの登録] を開きます。</li><li>[+ 新規登録] を選択し、各項目を下記のように設定し、[登録] を押下します。<ul><li>[名前] に任意の名前を設定します。</li><li>[サポートされているアカウント] の種類は [この組織ディレクトリのみに含まれるアカウント (シングル テナント)] を選択します。</li><li>[リダイレクト URI] では [Web] を選択し、”&lt;App Service の URL&gt;/.auth/login/aad/callback” と入力します<br>(例: “<a href="https://contoso.azurewebsites.net/.auth/login/aad/callback&quot;">https://contoso.azurewebsites.net/.auth/login/aad/callback&quot;</a>)</li></ul></li><li>アプリの登録完了したら、 [アプリケーション (クライアント) ID] と [ディレクトリ (テナント) ID] を控えておきます。</li><li>左端メニューから [認証] タブを選択します。 [暗黙的な許可およびハイブリッド フロー] で “ID トークン” を有効にします。</li><li>(省略可能) 左端メニューから [ブランド] で [ホーム ページ URL] に App Service アプリの URL を入力して [保存] を選択します。</li><li>左端メニューから [API の公開] を選択します。</li><li>[アプリケーション ID の URI] に App Service アプリの URL を入力し、[保存] を選択します。</li><li>左端メニューから [証明書とシークレット] を選択します。</li><li>[新しいクライアント シークレット] を選択し、クライアント シークレットを追加します。  </li></ol><p>なお、クライアント シークレットの追加後は、画面に表示されるクライアント シークレットの値を必ずお控えください。一度この画面を離れたら二度と表示されません。クライアント シークレットの有効期限は最長 2 年間です。有効期限が切れた場合は更新の対応が必要です。</p><p><strong>テナント A 上での作業</strong></p><ol><li>テナント A の Azure ポータルにサインインし、Web アプリをホストしている App Service の画面を開きます。</li><li>左側のメニューで [認証] を選択します。 [ID プロバイダーの追加] をクリックします。</li><li>[ID プロバイダー] ドロップダウンで [Microsoft] を選択し、下記のように設定します。<ul><li>[アプリの登録の種類] では [既存アプリの登録の詳細を提供します] を選択します。</li><li>[アプリケーション (クライアント) ID] には、前述の手順で控えた [アプリケーション (クライアント) ID] を設定します。</li><li>[クライアント シークレット] には前述の手順で控えたクライアント シークレットの値を設定します。</li><li>[発行者の URL] には “<a href="https://login.microsoftonline.com/">https://login.microsoftonline.com/</a>&lt;テナント B のテナント ID&gt;/v2.0” を設定します。<br>テナント B のテナント ID は、前述の手順で控えた [ディレクトリ (テナント) ID] です。</li></ul></li><li>これまで Web アプリに他の ID プロバイダーがされていない場合は、[App Service 認証設定] のセクションが表示されます。<ul><li>[認証] は “認証が必要” を選択します。</li><li>[認証されていない要求] では、[HTTP 302 リダイレクトが見つかりました: Web サイトに推奨] を選びます。<br>この設定は、アプリケーションが認証されていない要求にどのように応答するかを決定します。基本的には上記設定で問題ありません。</li></ul></li><li>[追加] をクリックします。 </li></ol><p>設定手順は以上です。</p><p>App Service のアプリの URL にアクセスすることで、Azure AD の認証画面が表示されます。ここからサインインできるのは、テナント B 上のユーザー (テナントユーザー、テナント B に招待されたゲストユーザー) のみです。他のテナントのユーザーの資格情報でサインインを試行すると、エラーが表示されて失敗します。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Azure &amp;amp; Identity サポート チームの高田です。今回は、App Service 認証を利用して複数のテナントの Azure AD ユーザーを App Service にサインインさせる方法について案内いたします。&lt;/p&gt;
&lt;p&gt;まず、App</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="App Service" scheme="https://jpazureid.github.io/blog/tags/App-Service/"/>
    
  </entry>
  
  <entry>
    <title>PIM の活用方法</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/pim-overview/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/pim-overview/</id>
    <published>2021-06-14T15:00:00.000Z</published>
    <updated>2021-09-16T18:49:48.586Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Azure &amp; Identity サポート チームの福島です。</p><p>システムの管理者は、定常運用時における運用管理アカウントのアクセス権管理に悩まれていないでしょうか。</p><p>今回のブログでは、”最低限必要な権限” を ”最低限必要な人間” に ”最低限の期間” 付与することが出来る Previleged Identity Management (PIM) という機能についてご紹介します。</p><span id="more"></span><p>例えば、自社のシステムが Azure 上でリリースされた後も下記のようなトラブルが発生した時には運用管理アカウントで Azure ポータルにサインインしてシステム変更作業を行う必要があると思います。</p><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="number">1</span>. 一般ユーザーが MFA 用に利用していたスマートフォンを紛失したため、該当アカウントの MFA 情報をリセットする必要がある</span><br><span class="line"></span><br><span class="line"><span class="number">2</span>. Azure AD に登録したアプリケーションのシークレットの有効期限が切れるため、新しいシークレットを発行する必要がある</span><br><span class="line"></span><br><span class="line"><span class="number">3</span>. 新しく発行したアプリケーションのシークレットをサブスクリプション X のリソースグループ A にある Key Vault に登録する必要がある</span><br><span class="line"></span><br><span class="line"><span class="number">4</span>. 業務アプリケーションが稼働するサブスクリプション X のリソースグループ A にある Azure VM がハングアップしたので、Azure ポータルから強制的に再起動する必要がある</span><br></pre></td></tr></table></figure><p> それぞれの作業を行うには Azure 上で下記のようなアクセス権を運用管理アカウントに付与する必要があります。</p><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="number">1</span>. -&gt; Azure AD ロールのユーザー管理者</span><br><span class="line"></span><br><span class="line"><span class="number">2</span>. -&gt; Azure AD ロールのクラウドアプリケーション管理者</span><br><span class="line"></span><br><span class="line"><span class="number">3.4</span>. -&gt; リソースグループ A の共同作成者</span><br></pre></td></tr></table></figure><p>Azure 上ではアクセス権はロール (役割) として集約されており、ロールには大きく <a href="https://docs.microsoft.com/ja-jp/azure/active-directory/roles/permissions-reference">Azure AD ロール</a> と <a href="https://docs.microsoft.com/ja-jp/azure/role-based-access-control/rbac-and-directory-admin-roles#azure-roles">Azure リソースロール</a> があります。<br>前者は Azure Active Directory 上のアクセス権を示すのに対して、後者は Azure サブスクリプションに作成したリソース (VM や App Service など) に対するアクセス権を指します。<br>これらのロールは Azure テナント上で最上位の権限を持つグローバル管理者 (システム管理者) が、Azure ポータル上で運用管理アカウントに対してアクセス権として付与してあげれば何ら問題はありません。<br>しかし、セキュリティに厳格な会社では実際にアクセス権を付与するまでに様々なステップがあるものと思います。<br><img src="/blog/azure-active-directory/pim-overview/pic01.jpg"></p><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="number">1</span>. 運用担当者はシステム変更日時、システム変更内容、システム変更に必要なアクセス権 (ロール) をメールなどに記載してシステム管理者に申請します。</span><br><span class="line"></span><br><span class="line"><span class="number">2</span>. システム管理者はメールに記載されたシステム変更作業の日時や変更作業内容を精査して問題なければ指定されたアクセス権 (ロール) を運用管理アカウントに付与します。</span><br><span class="line"></span><br><span class="line"><span class="number">3</span>. 作業日当日、運用担当者はアクセス権 (ロール) を付与された運用管理アカウントを利用して Azure にサインインし、システム変更作業を行います。作業完了後はシステム管理者に報告を行います。</span><br><span class="line"></span><br><span class="line"><span class="number">4</span>. システム管理者はシステム変更作業の完了報告を確認し、問題がなければ運用アカウントに付与したアクセス権 (ロール) を削除します。</span><br></pre></td></tr></table></figure><p>しかし、これらの作業ステップには図中に記載の通り様々な問題があります。</p><ul><li><p>実際のシステム変更作業を行っていないシステム管理者にもかなりの作業負担がある。</p></li><li><p>前日にアクセス権の付与を行った後に、作業日当日まで時間が空いている場合は必要以上に長い期間運用管理アカウントに強力なアクセス権 (ロール) が付与された状態になる。</p></li><li><p>万が一、システム管理者が運用管理アカウントに付与したアクセス権 (ロール) を削除し忘れた場合、運用管理アカウントは永続的に強力なアクセス権を保持することになる。</p></li></ul><p>上記の問題のうち、特に後半 2 つについては「セキュリティ」的な懸案事項になるかと思います。<br>万が一、運用管理アカウントに強力なアクセス権が付与されていた状態で運用管理アカウントの資格情報が漏洩し、悪意ある攻撃者によって企業の Azure テナントに不正に侵入されてしまった場合、攻撃者は運用管理アカウントに付与されたアクセス権 (ロール) を悪用して可能な限りの不正行為、資産の奪取を行うことが想定されます。</p><p>このようなリスク (攻撃者によるアカウントの乗っ取りが発生した時に、保持するアクセス権に応じてセキュリティ被害が拡大してしまうリスク) を最小限にするべく、アクセス権の管理は冒頭に記載の通り「最小権限の原則」に則り、”最低限必要な権限” を ”最低限必要な人間” に ”最低限の期間” 付与することが望ましいといえます。</p><h1 id="PIM-を使った-Just-in-Time-のアクセス権"><a href="#PIM-を使った-Just-in-Time-のアクセス権" class="headerlink" title="PIM を使った Just in Time のアクセス権"></a>PIM を使った Just in Time のアクセス権</h1><p>Azure では、上述した「最小権限の原則」に則り「セキュリティ」リスクを最小化する機能として Previleged Identity Management (PIM) が提供されています。</p><p>PIM を利用した場合、システム管理者は運用管理アカウントに対して<code>「対象割り当て」</code>と<code>「アクティブ割り当て」</code>という 2 つのロールアサインを行うことが可能です。</p><p><code>「アクティブ割り当て」</code>は、PIM を利用しない場合と同様に特定のロールを割り当て時点で有効状態として割り当てることを指します。<br>一方で<code>「対象割り当て」</code>を行った場合、運用管理アカウントはそのままでは割り当てられたロールの権限を保有することは出来ません。<br>実際に割り当てられたロールのアクセス権を保有したい場合は、ロールの<code>アクティブ化</code>処理を行う必要があります。<br>また、<code>アクティブ化</code>処理を行う際には特定アカウントの<code>承認</code>を必須とすることも可能です。<br>加えて一度アクティブ化されたロールは既定の場合 8 時間のみ有効で、8 時間が経過した後は自動的にアクティブ化が解除されます。</p><p><img src="/blog/azure-active-directory/pim-overview/pic03.jpg"></p><p>これらの PIM の動作をシステム変更管理プロセスに組み込むと下記のように運用することが可能です。</p><p><img src="/blog/azure-active-directory/pim-overview/pic02.jpg"></p><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="number">1</span>. システム管理者はシステムの運用開始日に運用管理アカウントに特定ロールを「対象割り当て」でアサインします。</span><br><span class="line"></span><br><span class="line"><span class="number">2</span>. 運用担当者は運用変更作業が発生した日に「対象割り当て」を受けたロールのアクティブ化処理を行います。</span><br><span class="line"></span><br><span class="line"><span class="number">3</span>. 運用責任者 (運用担当者の上長など) は、運用担当者が行ったアクティブ化処理の承認処理を行います。</span><br><span class="line"></span><br><span class="line"><span class="number">4</span>. 承認を受けた運用担当者は実際のシステム変更作業を行います。</span><br><span class="line"></span><br><span class="line"><span class="number">5</span>. アクティブ化の有効期限 (既定で <span class="number">8</span> 時間) を迎えれば、自動的にアクティブ化されたロールが無効化されます。</span><br><span class="line"></span><br><span class="line"><span class="number">6</span>. 「対象割り当て」の期間は既定で <span class="number">1</span> 年間となっていますので、<span class="number">1</span> 年間の間は必要に応じて何度もアクティブ化処理を行うことが可能です。</span><br></pre></td></tr></table></figure><p>一見すると冒頭に記載したステップとあまり変わらないように見えますが、運用期間が長くなるほどそのメリットが見えてきます。</p><ul><li><p>システム管理者は運用開始日の「対象割り当て」作業のみを行い、以降のシステム変更を運用部門に完全に移管することが出来ます。</p></li><li><p>「対象割り当て」期間中、運用管理アカウントは実際のアクセス権を行使することは出来ません。万が一攻撃者にアカウントが乗っ取られた場合も攻撃者はロールのアクセス権を悪用することが出来ません。</p></li><li><p>実際にロールのアクセス権をアクティブ化して利用するためには、運用担当者以外のユーザー (上記例の場合、運用担当者の上長である運用責任者) によってアクティブ化の承認を行う必要があります。そのため、万が一運用管理アカウントが乗っ取られていた場合も承認処理によって水際対策を行うことが可能です。</p></li><li><p>承認によってアクティブ化されたロールは既定で 8 時間だけ有効です。有効時間が過ぎた場合アクティブ化されたロールは自動的に無効になり、運用管理アカウントのアクセス権は作業前の状態に戻ります。(アクセス権の削除忘れが発生することはありません。また、作業日当日に必要な時間帯だけロールが有効化される、まさに Just in Time のアクセス権となります。)</p></li></ul><h1 id="PIM-の参考画面"><a href="#PIM-の参考画面" class="headerlink" title="PIM の参考画面"></a>PIM の参考画面</h1><p>もっとイメージがつきやすいように実際に PIM を利用した画面をみてみましょう。</p><p>・システム管理者は事前に「ユーザー管理者」ロールの承認者として「運用管理責任者」を登録しておきます。</p><p><img src="/blog/azure-active-directory/pim-overview/pic04.jpg"></p><p>・その後、運用管理アカウントに対して「ユーザー管理者」ロールを<code>対象割り当て</code>でアサインします。</p><p><img src="/blog/azure-active-directory/pim-overview/pic05.jpg"><br><img src="/blog/azure-active-directory/pim-overview/pic06.jpg"></p><p>・運用管理アカウントは作業日の当日に、<code>対象割り当て</code>を受けたロールをアクティブ化します。</p><p><img src="/blog/azure-active-directory/pim-overview/pic07.jpg"><br><img src="/blog/azure-active-directory/pim-overview/pic08.jpg"></p><p>・運用管理責任者に自動的に承認要求のメールが届きますので、運用管理責任者はこれを承認します。</p><p><img src="/blog/azure-active-directory/pim-overview/pic09.jpg"><br><img src="/blog/azure-active-directory/pim-overview/pic10.jpg"></p><p>・運用管理アカウントのロールがアクティブ化されたので運用管理担当者はシステム変更作業を開始します。アクティブ化時間は既定で 8 時間となっていますので、8 時間以内に作業を完了します。</p><p><img src="/blog/azure-active-directory/pim-overview/pic11.jpg"></p><p>・8 時間後には自動的にアクティブ化されたロールが無効化されます。</p><p><img src="/blog/azure-active-directory/pim-overview/pic13.jpg"></p><h1 id="よくある質問と回答"><a href="#よくある質問と回答" class="headerlink" title="よくある質問と回答"></a>よくある質問と回答</h1><blockquote><p><em><strong>PIM を利用するのにライセンスが必要ですか？</strong></em></p></blockquote><p>はい。PIM を利用するためには、<a href="https://docs.microsoft.com/ja-jp/azure/active-directory/privileged-identity-management/subscription-requirements">Azure Active Directory P2 ライセンスが必要</a>です。<br>追加のコストは掛かりますが、上述の通り長期的な目線で見ればシステム管理者の負担の軽減やセキュリティリスクの最小化を実現することができますので、是非ご検討いただければと思います。</p><blockquote><p><em><strong>PIM を利用しないと Azure を安全に利用できないということですか？</strong></em></p></blockquote><p>いいえ。PIM はアカウントが乗っ取られた場合のセキュリティリスクを最小化する機能 (且つ運用負担を軽減する機能) ではありますが、アカウントの「認証」自体を強固にする機能ではありません。Azure では「認証」に多要素認証 (MFA) を用いていることでアカウント保護をより強固にすることが可能であり、Azure Active Direcotory では「セキュリティの既定値群」などを利用して既定の状態で強力なアカウント保護機能を提供しておりますので、PIM を利用しない場合も Azure Active Directory は強固なセキュリティ対策機能を保持しているとお考えいただいて問題ありません。</p><p>*PIM のアクティブ化時に多要素認証 (MFA) 済トークンを必須とすることは可能ですが、多要素認証 (MFA) 済のセッションが端末ごと悪意あるユーザーに奪取された場合にはそのままアクティブ化を実行されてしまいますので、必ず「承認」のプロセスで水際対策することを推奨します。また、多要素認証 (MFA) といった認証の強度を構成する設定は別途「条件付きアクセス」といった認証・認可を専任で設定する機能に一元化することが適しています。</p><p>*「最小権限の原則」については、PIM を利用しない状態でもシステム管理者が運用担当者と物理的に近くで働いており、最短時間でのアクセス権付与・ダブルチェック・アクセス権の削除を実施できるようであれば、いわば手動で「最小権限の原則」を実現することは可能です。しかし、これらの項目はシステム管理者の労力を多く伴うものであり、または運用ミスが発生する可能性もございますので、これらのタスクを自動化する PIM を是非ご活用いただければと存じます。</p><blockquote><p><em><strong>ロール毎に承認者を設定することが出来ますか？</strong></em></p></blockquote><p>「ユーザー管理者」などの Azure AD ロールは Azure AD テナント上で一意のロールとなるため、Azure AD ロール 1 つに対して承認者を決定します。</p><p>(例 : 「ユーザー管理者」の承認者をリーダー A に設定し、「クラウドアプリケーション管理者」の承認者をリーダー B に設定します。)</p><p>一方で Azure AD リソースのロール (「共同作成者」など) は管理グループ、サブスクリプション、リソースグループ、リソース毎に用意されており、それぞれに別の承認者を設定することが可能です。</p><p>(例 : リソースグループ A の「共同作成者」の承認者をリーダー A に設定し、リソースグループ B の「共同作成者」の承認者をリーダー B に設定します。)</p><blockquote><p><em><strong>最低限の権限が良いということは Azure リソース毎、且つ運用操作毎にロールを定義しておいたほうが良いのでしょうか？(例 : ”Restart Virtual Machine” というアクションのみを許可したカスタムロールを作成し VM1 のみに付与できるようにする、など)</strong></em></p></blockquote><p>極端なことを言えば記載された方法も考えられます。しかし、カスタムロールを作成するコストと、複数リソースの複数操作が必要になったときに複数のカスタムロール毎に「対象割り当て」「アクティブ化」「承認」を行う運用コストが、それによって得られるセキュリティメリットと釣り合わないものと思います。そのため、上記の例では最低限の作業対象をリソースグループとし、操作権限の纏まりはビルトインの「共同作成者」としています。</p><p>*多くの会社では、チーム毎にリソースグループを用意し、そのリソースグループにチームが管理する対象の複数リソースを纏めていることから、リソースグループはロールの割り当て対象として最も適しているものと思います。</p><p>*アクセス権にはアクセスレベル (読み取り、書き込みなど) とアクセス範囲 (A リソースと B リソース含むなど) という考え方があります。(縦軸と横軸のイメージです。) 「共同作成者」は最上位のアクセスレベルを保有しますが、アクセス範囲が 1 リソースグループに限定されていることからも、運用レベルに合った ”最低限のアクセス権” と定義することができるものと思います。</p><blockquote><p><em><strong>PIM によるロールのアクティブ化は監査できますか？</strong></em></p></blockquote><p>はい、PIM を利用したロールのアクティブ化は Azure AD の監査ログに情報が記録されます。参考情報としてアクティブ化の承認が行われた時は <code>Add member to role approval requested (PIM activation)</code> が記録され、自動的にアクティブ化が無効化された場合は <code>Remove member from role (PIM activation expired)</code> が記録されます。システム変更日の後日に作業履歴を確認する場合は、Azure AD の監査ログでこれらのログをご確認いただければと思います。</p><h1 id="終わりに"><a href="#終わりに" class="headerlink" title="終わりに"></a>終わりに</h1><p>いかがでしたでしょうか。PIM は Azure AD Premium P2 という追加のライセンスが必要になりますが、その分システム管理者が多くのメリットを享受できるものと思います。<br>本ブログが少しでもお役に立てれば幸甚ですので、是非 PIM の活用についてご検討ください。</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;こんにちは、Azure &amp;amp; Identity サポート チームの福島です。&lt;/p&gt;
&lt;p&gt;システムの管理者は、定常運用時における運用管理アカウントのアクセス権管理に悩まれていないでしょうか。&lt;/p&gt;
&lt;p&gt;今回のブログでは、”最低限必要な権限” を ”最低限必要な人間” に ”最低限の期間” 付与することが出来る Previleged Identity Management (PIM) という機能についてご紹介します。&lt;/p&gt;</summary>
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="Security" scheme="https://jpazureid.github.io/blog/tags/Security/"/>
    
    <category term="PIM" scheme="https://jpazureid.github.io/blog/tags/PIM/"/>
    
  </entry>
  
  <entry>
    <title>Azure における ゲスト ユーザー招待 (B2B) のよくある質問</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/b2bfaq/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/b2bfaq/</id>
    <published>2021-05-31T01:00:00.000Z</published>
    <updated>2021-09-16T18:49:48.438Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは。 Azure Identity サポート チームです。<br>こちらのブログでは、Azure における ゲスト ユーザー招待 (B2B) のよくある質問をお纏めいたしました。</p><p>それぞれ 招待をする側 と 招待された側にわけて記載をしておりますので、以下のリンクより参照いただけますと幸いです。</p><ul><li><a href="#1-%E6%8B%9B%E5%BE%85%E3%81%97%E3%81%9F%E5%81%B4%E3%81%AE%E3%82%88%E3%81%8F%E3%81%82%E3%82%8B%E8%B3%AA%E5%95%8F">1.招待した側のよくある質問</a></li><li><a href="#2-%E6%8B%9B%E5%BE%85%E3%81%95%E3%82%8C%E3%81%9F%E5%81%B4%E3%81%AE%E3%82%88%E3%81%8F%E3%81%82%E3%82%8B%E8%B3%AA%E5%95%8F">2.招待された側のよくある質問</a></li></ul><p>なお、B2B についてのご説明は以下のブログにもおまとめしておりますので、機能のご紹介は以下を参照ください。</p><ul><li><a href="/blog/azure-active-directory/what-is-b2b/">Azure AD B2B とは | Japan Azure Identity Support Blog</a></li></ul><p>また、本ブログでは ユーザーが元々所属している Azure AD を “ホーム ディレクトリ”<br>そのユーザーが招待された先の Azure AD を “招待先ディレクトリ” と記載します。</p><p><img src="/blog/azure-active-directory/b2bfaq/image01.png"></p><h2 id="1-招待した側のよくある質問"><a href="#1-招待した側のよくある質問" class="headerlink" title="1.招待した側のよくある質問"></a>1.招待した側のよくある質問</h2><p><img src="/blog/azure-active-directory/b2bfaq/image02.png"></p><h3 id="Q-ゲスト-ユーザーを招待した際に名前-表示名-を指定しましたが、後日確認すると違う名前が表示されました。なぜですか"><a href="#Q-ゲスト-ユーザーを招待した際に名前-表示名-を指定しましたが、後日確認すると違う名前が表示されました。なぜですか" class="headerlink" title="Q. ゲスト ユーザーを招待した際に名前 (表示名) を指定しましたが、後日確認すると違う名前が表示されました。なぜですか?"></a>Q. ゲスト ユーザーを招待した際に名前 (表示名) を指定しましたが、後日確認すると違う名前が表示されました。なぜですか?</h3><p>A. ゲスト ユーザーの名前は、ユーザーが招待に承諾した際にホーム ディレクトリ側の情報で上書きします。<br>そのため、招待時に指定した名前は 招待への承諾時に変更されます。</p><p><img src="/blog/azure-active-directory/b2bfaq/image03.png"></p><p>ホーム ディレクトリとは異なる、招待先ディレクトリ独自の名前を設定する場合には、招待への承諾後に再度変更します。</p><p><img src="/blog/azure-active-directory/b2bfaq/image04.png"></p><h3 id="Q-招待したゲスト-ユーザーからサインインができないと連絡がありました。対処方法を教えて下さい"><a href="#Q-招待したゲスト-ユーザーからサインインができないと連絡がありました。対処方法を教えて下さい" class="headerlink" title="Q. 招待したゲスト ユーザーからサインインができないと連絡がありました。対処方法を教えて下さい"></a>Q. 招待したゲスト ユーザーからサインインができないと連絡がありました。対処方法を教えて下さい</h3><p>A. ゲスト ユーザーであっても、サインインはホーム ディレクトリにて行われます。<br>そのため、まずは招待したゲスト ユーザーが ホーム ディレクトリ にサインインができるかを切り分けてください。</p><p>“ホーム ディレクトリ” にもサインインができない場合には、”ホーム ディレクトリ” 側での対応が必要となりますので招待した側のディレクトリの管理者で対応できません。<br>一方、ホーム ディレクトリにはサインインができるが、”招待先ディレクトリ” にはサインインができない場合には、招待した側のディレクトリにて調査します。</p><p>ゲスト ユーザーのよくある サインインができない問題については、<a href="#2-%E6%8B%9B%E5%BE%85%E3%81%95%E3%82%8C%E3%81%9F%E5%81%B4%E3%81%AE%E3%82%88%E3%81%8F%E3%81%82%E3%82%8B%E8%B3%AA%E5%95%8F">2.招待された側のよくある質問</a> に記載しています。</p><h3 id="Q-招待したいユーザーがメールを受信できないアカウントです。メールを受信できなければ、ゲスト-ユーザーとして招待できませんか"><a href="#Q-招待したいユーザーがメールを受信できないアカウントです。メールを受信できなければ、ゲスト-ユーザーとして招待できませんか" class="headerlink" title="Q. 招待したいユーザーがメールを受信できないアカウントです。メールを受信できなければ、ゲスト ユーザーとして招待できませんか?"></a>Q. 招待したいユーザーがメールを受信できないアカウントです。メールを受信できなければ、ゲスト ユーザーとして招待できませんか?</h3><p>A. メールを受信できないユーザーであっても招待することが可能です。<br>( メールを受信できないユーザーとは  <a href="mailto:&#120;&#x78;&#120;&#64;&#99;&#x6f;&#x6e;&#x74;&#x73;&#111;&#x2e;&#111;&#110;&#109;&#x69;&#99;&#x72;&#x6f;&#115;&#x6f;&#102;&#116;&#x2e;&#x63;&#111;&#x6d;">&#120;&#x78;&#120;&#64;&#99;&#x6f;&#x6e;&#x74;&#x73;&#111;&#x2e;&#111;&#110;&#109;&#x69;&#99;&#x72;&#x6f;&#115;&#x6f;&#102;&#116;&#x2e;&#x63;&#111;&#x6d;</a> のような Azure AD 上のユーザーも含みます。)</p><p>メールを受信できないアカウントの場合、招待メールを受け取ることができないため、直接リンクを利用して招待に承諾します。<br>以下の URL をゲスト ユーザーに送付し、招待への承諾を依頼ください。</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">https://portal.azure.com/&lt;招待先ディレクトリのテナントID&gt;</span><br></pre></td></tr></table></figure><p>メールを利用しない招待については、<a href="https://docs.microsoft.com/ja-jp/azure/active-directory/external-identities/redemption-experience#redemption-through-a-direct-link">B2B コラボレーションの招待の利用 - Azure AD | Microsoft Docs</a> を参照ください。(直接リンクによる利用 の項 に記載があります)</p><h3 id="Q-招待するユーザーのUPN-とMail-属性の値が違います。どちらを利用するべきですか"><a href="#Q-招待するユーザーのUPN-とMail-属性の値が違います。どちらを利用するべきですか" class="headerlink" title="Q. 招待するユーザーのUPN とMail 属性の値が違います。どちらを利用するべきですか?"></a>Q. 招待するユーザーのUPN とMail 属性の値が違います。どちらを利用するべきですか?</h3><p>A.UPN を指定して招待ください。</p><p><a href="#Q-%E6%8B%9B%E5%BE%85%E3%81%97%E3%81%9F%E3%81%84%E3%83%A6%E3%83%BC%E3%82%B6%E3%83%BC%E3%81%8C%E3%83%A1%E3%83%BC%E3%83%AB%E3%82%92%E5%8F%97%E4%BF%A1%E3%81%A7%E3%81%8D%E3%81%AA%E3%81%84%E3%82%A2%E3%82%AB%E3%82%A6%E3%83%B3%E3%83%88%E3%81%A7%E3%81%99%E3%80%82%E3%83%A1%E3%83%BC%E3%83%AB%E3%82%92%E5%8F%97%E4%BF%A1%E3%81%A7%E3%81%8D%E3%81%AA%E3%81%91%E3%82%8C%E3%81%B0%E3%80%81%E3%82%B2%E3%82%B9%E3%83%88-%E3%83%A6%E3%83%BC%E3%82%B6%E3%83%BC%E3%81%A8%E3%81%97%E3%81%A6%E6%8B%9B%E5%BE%85%E3%81%A7%E3%81%8D%E3%81%BE%E3%81%9B%E3%82%93%E3%81%8B">Q. 招待したいユーザーがメールを受信できないアカウントです。</a> の項 の通り、メールを受信できないユーザーであっても招待が可能です。<br>Mail 属性にて招待をした場合も招待に承諾することができ、ゲスト ユーザーとしてアクセスできますが、一部で 正常にサービスが利用できないという過去事例があります。<br>そのため、より安全に機能をご利用いただくためには、UPN を指定し招待ください。</p><h3 id="Q-ゲスト-ユーザー招待時にメールを送信したくありません。メールを送らずに招待する方法はありますか"><a href="#Q-ゲスト-ユーザー招待時にメールを送信したくありません。メールを送らずに招待する方法はありますか" class="headerlink" title="Q. ゲスト ユーザー招待時にメールを送信したくありません。メールを送らずに招待する方法はありますか?"></a>Q. ゲスト ユーザー招待時にメールを送信したくありません。メールを送らずに招待する方法はありますか?</h3><p>A. Azure Portal など 画面からの招待では メールを送らずに招待することが出来ません。<br>メールを送らずに招待をしたい場合、PowerShell コマンドを利用します。</p><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="comment"># コマンドのインストール</span></span><br><span class="line"><span class="built_in">Install-Module</span> AzureAD</span><br><span class="line"></span><br><span class="line"><span class="comment"># ユーザーで認証</span></span><br><span class="line"><span class="built_in">Connect-AzureAD</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># メールを送らずに招待</span></span><br><span class="line"><span class="built_in">New-AzureADMSInvitation</span> <span class="literal">-InvitedUserEmailAddress</span> &lt;招待するユーザーのUPN(メールアドレス形式)&gt; <span class="literal">-InvitedUserDisplayName</span> &lt;ゲスト ユーザーの表示名&gt; <span class="literal">-InviteRedirectUrl</span> &lt;招待へ承諾後、アクセスするURL&gt;  <span class="literal">-SendInvitationMessage</span> <span class="variable">$false</span></span><br></pre></td></tr></table></figure><h3 id="Q-招待を実施すると、”グループ電子メール-アドレスはサポートされていません”-とエラーになる"><a href="#Q-招待を実施すると、”グループ電子メール-アドレスはサポートされていません”-とエラーになる" class="headerlink" title="Q. 招待を実施すると、”グループ電子メール アドレスはサポートされていません” とエラーになる"></a>Q. 招待を実施すると、”グループ電子メール アドレスはサポートされていません” とエラーになる</h3><p><img src="/blog/azure-active-directory/b2bfaq/image05.png"></p><p>A. 招待時に指定したメールアドレスが 、Microsoft 365 (Azure AD) 上でグループのメールアドレスに指定されています。<br>ゲスト ユーザーとして招待が行えるのは ユーザーアカウントのみとなるため、別途 招待するユーザーにてアカウントを作成する必要があります。</p><blockquote><p>(補足)<br>グループを指定して招待することで、そのグループに所属しているユーザーを一括で招待するといった機能もありません。<br>そのため、必ず ホーム ディレクトリ にてユーザー アカウント として作成されているアカウントを招待します。</p></blockquote><h3 id="Q-ゲスト-ユーザーの招待に有効期限はありますか"><a href="#Q-ゲスト-ユーザーの招待に有効期限はありますか" class="headerlink" title="Q. ゲスト ユーザーの招待に有効期限はありますか?"></a>Q. ゲスト ユーザーの招待に有効期限はありますか?</h3><p>A. Azure Portal や Teams からの招待では 、特に有効期限はありません。<br>ただし、SharePoint Online で招待した場合は既定で 90 日間の有効期限となります。</p><h2 id="2-招待された側のよくある質問"><a href="#2-招待された側のよくある質問" class="headerlink" title="2.招待された側のよくある質問"></a>2.招待された側のよくある質問</h2><p><img src="/blog/azure-active-directory/b2bfaq/image08.png"></p><h3 id="アクセスができない際の対処"><a href="#アクセスができない際の対処" class="headerlink" title="アクセスができない際の対処"></a>アクセスができない際の対処</h3><h3 id="Q-“ネットワーク管理者によってアクセスがブロックされました-外部アクセスがポリシーによってブロックされています。アクセスするには、IT-部門にお問い合わせください。”-と表示されアクセスできない"><a href="#Q-“ネットワーク管理者によってアクセスがブロックされました-外部アクセスがポリシーによってブロックされています。アクセスするには、IT-部門にお問い合わせください。”-と表示されアクセスできない" class="headerlink" title="Q. “ネットワーク管理者によってアクセスがブロックされました / 外部アクセスがポリシーによってブロックされています。アクセスするには、IT 部門にお問い合わせください。” と表示されアクセスできない"></a>Q. “ネットワーク管理者によってアクセスがブロックされました / 外部アクセスがポリシーによってブロックされています。アクセスするには、IT 部門にお問い合わせください。” と表示されアクセスできない</h3><p><img src="/blog/azure-active-directory/b2bfaq/image09.png"></p><p>A.<br>原因: ゲスト ユーザーが利用してい社内の NW 機器 によって アクセスできる ディレクトリが制限されています。<br>対処: 利用しているネットワークの管理者に依頼の上、NW　機器 にアクセス先のテナント ID を追加します。</p><blockquote><p>補足:<br>このエラーは “テナント 制限” と呼ばれる機能による制限です。<br><a href="https://docs.microsoft.com/ja-jp/azure/active-directory/manage-apps/tenant-restrictions">テナント制限を使用して SaaS クラウド アプリケーションへのアクセスを管理する</a></p></blockquote><h3 id="Q-“アカウントがブロックされました-お客様のアカウントについて、疑わしいアクティビティが検出されました。”-と表示されアクセスできない"><a href="#Q-“アカウントがブロックされました-お客様のアカウントについて、疑わしいアクティビティが検出されました。”-と表示されアクセスできない" class="headerlink" title="Q. “アカウントがブロックされました / お客様のアカウントについて、疑わしいアクティビティが検出されました。” と表示されアクセスできない"></a>Q. “アカウントがブロックされました / お客様のアカウントについて、疑わしいアクティビティが検出されました。” と表示されアクセスできない</h3><p>“申し訳ございません。アクセスしようとしている組織では危険なユーザーを制限しています。Contoso の管理者にお問い合わせください。” と表示されアクセスできない。</p><p><img src="/blog/azure-active-directory/b2bfaq/image10.png"></p><blockquote><p>補足 :<br>サインインログには以下が記録されます。<br>530032<br>Failure reason : User blocked due to risk on home tenant.</p></blockquote><p>A.<br>原因: ゲスト ユーザーのアカウントにてリスクが検知されています。<br>対処: <a href="https://passwordreset.microsoftonline.com/">https://passwordreset.microsoftonline.com</a> にアクセスし、パスワード リセットを行い リスクをクリアします。</p><p>自身でパスワード リセットができない場合、ホーム ディレクトリ の管理者に依頼し、パスワード リセットかリスクのクリアを依頼します。<br>なお、オンプレミス Active Directory から同期しているユーザーは、パスワード リセットを実施してもリスクがクリアされないため、クラウド側 (Azure AD) の管理者への依頼が必要になります。</p><p>【リスクのクリア手順】<br>Azure Portal (<a href="https://portal.azure.com/">https://portal.azure.com</a>) &gt; [Azure Active Directory] &gt; [セキュリティ] &gt; [危険なユーザー]<br>対象のユーザーにチェックをつけ、”ユーザー リスクを無視する”を実行ください。</p><div class="alert is-important"><p class="alert-title">重要</p><p>本当にリスクを無視していいかの判断は管理者様が実際のユーザーに確認するなど、セキュリティ リスクを考慮の上、ご実施ください。</p></div><p><img src="/blog/azure-active-directory/b2bfaq/image11.png"></p><blockquote><p>補足 : こちらは Azure AD Identity Protection という機能にて制限しています。<br>アクセスをブロックするかはそれぞれのテナント毎の設定になるため、このエラーが表示された場合には招待先ディレクトリ にてブロックの設定がされています。</p></blockquote><p>なお、リスクの検出はそれぞれのホーム ディレクトリで行われます。<br>ホーム ディレクトリで検出されたリスクが、招待先ディレクトリ の Identity Protection で検知される仕組みとなります。</p><ul><li><a href="https://docs.microsoft.com/ja-jp/azure/active-directory/identity-protection/concept-identity-protection-risks">リスクとは Azure AD Identity Protection | Microsoft Docs</a></li></ul><h3 id="Q-“これに対するアクセス権がありません-サインインは完了しましたが、このリソースへのアクセス許可がありません。”-と表示されアクセスできない"><a href="#Q-“これに対するアクセス権がありません-サインインは完了しましたが、このリソースへのアクセス許可がありません。”-と表示されアクセスできない" class="headerlink" title="Q. “これに対するアクセス権がありません / サインインは完了しましたが、このリソースへのアクセス許可がありません。” と表示されアクセスできない"></a>Q. “これに対するアクセス権がありません / サインインは完了しましたが、このリソースへのアクセス許可がありません。” と表示されアクセスできない</h3><p><img src="/blog/azure-active-directory/b2bfaq/image12.png"></p><p>A.<br>原因: “招待先ディレクトリ” での 条件付きアクセスと呼ばれる設定にて、許可されていないアクセスをしています。<br>対処: “招待先ディレクトリ” の管理者 に依頼の上、条件付きアクセスの設定を変更します。 または、適切な条件下でアクセスを行うようにします。</p><blockquote><p>補足 : このエラーの詳細は、<a href="/blog/azure-active-directory/azuread-access-denied/">「アクセス権がありません」のエラーについて | Japan Azure Identity Support Blog</a> を参照ください。</p></blockquote><h3 id="アクセス後に情報が閲覧できない"><a href="#アクセス後に情報が閲覧できない" class="headerlink" title="アクセス後に情報が閲覧できない"></a>アクセス後に情報が閲覧できない</h3><h3 id="Q-“xxxxディレクトリには-Azure-サブスクリプションがありません。ここをクリックして、別のディレクトリに切り替えてください。”-と表示され、Azure-サブスクリプションにアクセスできない"><a href="#Q-“xxxxディレクトリには-Azure-サブスクリプションがありません。ここをクリックして、別のディレクトリに切り替えてください。”-と表示され、Azure-サブスクリプションにアクセスできない" class="headerlink" title="Q. “xxxxディレクトリには Azure サブスクリプションがありません。ここをクリックして、別のディレクトリに切り替えてください。” と表示され、Azure サブスクリプションにアクセスできない"></a>Q. “xxxxディレクトリには Azure サブスクリプションがありません。ここをクリックして、別のディレクトリに切り替えてください。” と表示され、Azure サブスクリプションにアクセスできない</h3><p><img src="/blog/azure-active-directory/b2bfaq/image13.png"></p><p>A.<br>原因: Azure サブスクリプションに対しての閲覧権限がないか、アクセスしている ディレクトリが異なっている可能性があります。<br>対処: Azure サブスクリプションの管理者に依頼し 権限を付与するか、アクセスしている ディレクトリを確認します。</p><p>ディレクトリの変更 は Azure Portal の <code>ディレクトリ + サブスクリプション</code> から行います。</p><p><img src="/blog/azure-active-directory/b2bfaq/image14.png"></p><blockquote><p>補足: このエラーの詳細は、<a href="https://jpazureid.github.io/blog/azure-active-directory/subscription-azuread">サブスクリプションが見えない | Japan Azure Identity Support Blog</a> を参照ください。</p></blockquote><h3 id="Q-“このデータへのアクセス権がありません。”が表示される-と表示され、ユーザー一覧にアクセスできない"><a href="#Q-“このデータへのアクセス権がありません。”が表示される-と表示され、ユーザー一覧にアクセスできない" class="headerlink" title="Q. “このデータへのアクセス権がありません。”が表示される と表示され、ユーザー一覧にアクセスできない"></a>Q. “このデータへのアクセス権がありません。”が表示される と表示され、ユーザー一覧にアクセスできない</h3><p><img src="/blog/azure-active-directory/b2bfaq/image15.png"></p><p>A.<br>原因: 既定では、ゲスト ユーザーは “招待先ディレクトリ” のユーザー情報を閲覧することができません。<br>対処: “招待先ディレクトリ” の管理者によって ゲスト ユーザーへのアクセス権を変更依頼をするか、個別に “ディレクトリ閲覧者” などのロールの付与を依頼します。</p><blockquote><p>補足: 既定でのゲスト ユーザーによる権限については、<a href="https://docs.microsoft.com/ja-jp/azure/active-directory/fundamentals/users-default-permissions">既定のユーザー アクセス許可 - Azure Active Directory | Microsoft Docs</a> を参照ください。</p></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは。 Azure Identity サポート チームです。&lt;br&gt;こちらのブログでは、Azure における ゲスト ユーザー招待 (B2B) のよくある質問をお纏めいたしました。&lt;/p&gt;
&lt;p&gt;それぞれ 招待をする側 と 招待された側にわけて記載をしておりますので、</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="B2B" scheme="https://jpazureid.github.io/blog/tags/B2B/"/>
    
  </entry>
  
  <entry>
    <title>CAE (Continuous Access Evaluation: 継続的アクセス評価)</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/cae-overview/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/cae-overview/</id>
    <published>2021-05-16T15:00:00.000Z</published>
    <updated>2021-09-16T18:49:48.450Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは。Azure Identity チームの金森です。</p><p>みなさんは CAE (Continuous Access Evaluation: 継続的アクセス評価) という機能をご存知でしょうか。<br>2021 年 5 月現在、以下のようなお知らせがあり、目にされた方も多いのではないかと思います。</p><ul><li>Microsoft 365 管理ポータルのメッセージ センターに MC255540 (Continuous access evaluation on by default) として情報が公開</li><li>送信元 : Microsoft Azure <a href="mailto:&#97;&#x7a;&#x75;&#114;&#x65;&#45;&#x6e;&#111;&#x72;&#101;&#x70;&#x6c;&#x79;&#64;&#x6d;&#x69;&#x63;&#114;&#111;&#115;&#111;&#102;&#x74;&#x2e;&#x63;&#111;&#x6d;">&#97;&#x7a;&#x75;&#114;&#x65;&#45;&#x6e;&#111;&#x72;&#101;&#x70;&#x6c;&#x79;&#64;&#x6d;&#x69;&#x63;&#114;&#111;&#115;&#111;&#102;&#x74;&#x2e;&#x63;&#111;&#x6d;</a> から TRACKING ID: 5T93-LTG として以下の件名のメールでお知らせ<br>-&gt; Continuous access evaluation will be enabled in premium Azure AD tenants beginning on 15 June 2021</li><li>Microsoft 365 管理ポータルのメッセージ センターに MC273937 (Update: CAE On By Default) として展開時期が変更となる情報が公開</li></ul><p>CAE とは、簡単に言いますと <strong>あるサービスを利用しているクライアントの状態が変わった際、ほぼリアルタイムでその変化を検知してアクセス制御を行う</strong> ことができる機能、です！<br>実は以下のような技術情報、Blog にてお伝えしてきた通り、2020 年から機能自体は実装が進んでいました。</p><p><a href="https://jpazureid.github.io/blog/azure-active-directory/moving-towards-real-time-policy-and-security-enforcement/">ポリシーとセキュリティのリアル タイムな適用に向けて</a></p><p><a href="https://docs.microsoft.com/ja-jp/azure/active-directory/fundamentals/resilience-with-continuous-access-evaluation">継続的アクセス評価を使用して回復性を強化する</a></p><p><a href="https://docs.microsoft.com/ja-jp/azure/active-directory/conditional-access/concept-continuous-access-evaluation">継続的アクセス評価</a></p><p>この CAE 機能が、Azure AD Premium を有効にしているテナントについても2021 年 9 月 30 日から 2021 年 11 月の終わりにかけて順次有効になります、というお知らせが MC255540 であり 5T93-LTG の通知となります。</p><div class="alert is-info"><p class="alert-title">Note</p><p>当初 2021 年 6 月 15 日から 9 月 30 日での展開を予定しておりましたが MC273937 にて、2021 年 9 月 30 日から 2021 年 11 月の終わりの間に展開予定に変更されたとアナウンスされました。</p></div><h2 id="CAE-とは具体的にどんな機能なの？"><a href="#CAE-とは具体的にどんな機能なの？" class="headerlink" title="CAE とは具体的にどんな機能なの？"></a>CAE とは具体的にどんな機能なの？</h2><p>これまで、条件付きアクセス (CA) によるアクセス制御を行われている環境では [Azure AD (AAD) に対してクライアントがアクセス トークンの新規取得、もしくは取得済みアクセス トークンの更新] を行うタイミングで、CA ポリシーの評価が行われていました。これは、逆に言うと [クライアントの取得済みアクセス トークンの有効期限内であれば、AAD へのアクセスが行われず CA ポリシーの評価もその間は行われない] ことを意味しています。</p><p>通常、あるリソース (Exchange Online や SharePoint Online 等) へクライアントがアクセスするために、AAD が発行しているアクセス トークンの有効期限は既定では 60 分です。つまり、アクセス トークンを取得してから 60 分間は、該当クライアントはリソースに対してアクセスし続けることが可能です。<br>もしその 60 分間に、該当 AAD ユーザー自体が (運用によって適切に) 無効もしくは削除されたり、セキュリティ リスクに伴いパスワードの変更や発行済みトークンの失効が行われたり、アクセスが許可されていない場所にクライアントが移動したりしたとしても、これまでは [アクセス トークンの更新タイミング = 前回取得から約 60 分後] までは、リソースへのアクセスが継続して行えてしまいました。</p><p>ここで、CAE が有効な AAD テナントでは、CAE に対応しているリソースに対して AAD から状態変化の Event がほぼリアルタイム (*) で通知されるようになります。また、CA ポリシーがリソースにも共有され、クライアントのアクセス元 IP アドレスのチェックがリソース側でも行われるようになり、アクセスが許可されていない場所にクライアントが移動した場合の検知がほぼリアルタイム (*) に行えることになります。</p><div class="alert is-info"><p class="alert-title">Note</p><p>(*) クラウド サービス間の処理となるため、数分～十数分程度のバッファはあるものとしてお考えください</p></div><p>CAE が有効に動作した際の、実際の処理フローのシナリオ例は、前述の技術情報 <a href="https://docs.microsoft.com/ja-jp/azure/active-directory/conditional-access/concept-continuous-access-evaluation">継続的アクセス評価</a> の <a href="https://docs.microsoft.com/ja-jp/azure/active-directory/conditional-access/concept-continuous-access-evaluation#example-flows">フローの例</a> をぜひご覧ください。以下にそれぞれのシナリオを解説します。</p><h3 id="ユーザー失効イベントのフロー"><a href="#ユーザー失効イベントのフロー" class="headerlink" title="ユーザー失効イベントのフロー"></a>ユーザー失効イベントのフロー</h3><p>こちらは管理者が意図して、ある AAD ユーザーの更新トークンを失効させた、というシナリオになります。<br>CAE が提供される前では、何らかの理由 (セキュリティ要因に関する理由が主なものでしょう) で更新トークンを失効させても、アクセス トークンが有効な 60 分間は、継続してユーザーはリソース アクセスが可能でした。<br>しかし、管理者としては、更新トークンの失効と併せて一刻も早くアクセス トークンの利用も停止させ、その AAD ユーザーに早く再認証を求めさせたい、と思うのが自然です。<br>再認証を求めることができれば、改めて CA によるアクセス制御が行えるため、CA のアクセス制御を突破した場合のみリソースにアクセスできるようにすることが可能です。</p><p>AAD は、ある AAD ユーザーの更新トークンが失効されると、Events として CAE に対応しているリソース (Exchange Online や SharePoint Online 等) に失効されたことを通知します。<br>この通知を受けたリソース側は、クライアントがまだ期限内のアクセス トークンを保持していても、クライアントからのアクセスを拒否して 401+ 認証チャレンジをクライアントに返します。<br>つまり [手持ちのトークンが期限内かどうかはさておき、クライアントに AAD に更新トークンの妥当性をチェックさせに行く] 応答を返します。<br>ここでクライアントは AAD に向かい、改めて認証が行われて、CA によるアクセス制御の評価を受けることになります。</p><h3 id="ユーザー状態変更のフロー-プレビュー"><a href="#ユーザー状態変更のフロー-プレビュー" class="headerlink" title="ユーザー状態変更のフロー (プレビュー)"></a>ユーザー状態変更のフロー (プレビュー)</h3><p>こちらは、[CA ポリシーで場所 (クライアントの接続元 IP アドレス) によるアクセス制御] を行っている場合に有効なシナリオになります。<br>例えば、CA ポリシーで [信頼された場所 A (送信元 IP アドレス範囲) からのアクセスは許可するが、それ以外の場所からのアクセスはブロックする] というアクセス制御を行っていたとします。<br>信頼された場所 A からアクセスしたクライアントは、もちろんその時点ではリソース (Exchange Online や SharePoint Online 等) に対してアクセスが可能です。</p><p>ここでクライアントが [CA ポリシー上、信頼されていない場所] に移動したとします。<br>前述の通り、これまではクライアントが取得しているアクセス トークン (基本的に 60 分) の更新タイミングが来るまでは、信頼されていない場所からのアクセスも行えていました。<br>しかし、AAD で CAE が有効になっていると、CAE に対応しているリソースへも CA ポリシーが同期され内容を評価できるようになります。<br>つまり、リソース側もクライアントの送信元 IP (場所) の情報を元に、CA ポリシーで許可された送信元 IP アドレスかどうか、をチェックすることができます。</p><p>CA ポリシーで許可されていない送信元 IP アドレスからクライアントがアクセスしてきていると判断したリソース側は、クライアントがまだ期限内のアクセス トークンを保持していても、クライアントからのアクセスを拒否して 401+ 認証チャレンジをクライアントに返します。<br>ここでクライアントは AAD に向かい、改めて認証が行われて、CA によるアクセス制御の評価を受けることになります。</p><p>CAE とは、上記のように [クライアント/ユーザーの変化に応じて、”改めて AAD でのアクセス制御の評価を受けてほしい” 状態になったタイミング] で、今までよりも速やかにアクセス制御 (=AAD への認証に伴う CA ポリシーの評価) を受けることが可能になる機能です。</p><h2 id="CAE-が有効になるとどんな影響があるの？"><a href="#CAE-が有効になるとどんな影響があるの？" class="headerlink" title="CAE が有効になるとどんな影響があるの？"></a>CAE が有効になるとどんな影響があるの？</h2><p>先に記載した通り、今までよりもほぼリアルタイムに、クライアント/ユーザーの状態変化に応じてアクセス トークンの有効期間内であってもユーザーのアクセスの失効がおこなわれた場合に反映させることができたり、 CA ポリシーの評価を受けられるようになります。つまり有効になることで困ることは基本的には無いのですが、注意が必要な点として CAE が有効になりますとアクセス トークンの有効期限が最大 28 時間になります。<br>前述の技術情報 <a href="https://docs.microsoft.com/ja-jp/azure/active-directory/conditional-access/concept-continuous-access-evaluation">継続的アクセス評価</a> の <a href="https://docs.microsoft.com/ja-jp/azure/active-directory/conditional-access/concept-continuous-access-evaluation#token-lifetime">トークンの有効期間</a> をご覧ください。</p><p>最大 28 時間というアクセス トークンの有効期間は長すぎじゃないか？！という印象を持たれるかもしれません。<br>しかし、前述の機能の説明のとおり、セキュリティという観点ではアクセス トークンの有効期間内であっても、クライアント/ユーザーの状態変化に応じて速やかに CA ポリシーの評価を受けることができるようになるので、むしろ向上するとお考えいただければと思います。</p><p>運用面において、 CAE のデメリットとなりうるところとしては、ユーザー アカウントのグループ メンバーシップや条件付きアクセス ポリシーに変更を加えても、その変更が反映されるまでに 1 日 (正確には最大 28 時間) 要することが挙げられます。これは、ユーザーのグループメンバーシップの更新や、ポリシーの更新については、特に CAE による発行済みアクセス トークンの再確認対象にならないためです。<br>技術情報 <a href="https://docs.microsoft.com/ja-jp/azure/active-directory/conditional-access/concept-continuous-access-evaluation">継続的アクセス評価</a> の <a href="https://docs.microsoft.com/ja-jp/azure/active-directory/conditional-access/concept-continuous-access-evaluation#troubleshooting">トラブルシューティング</a> の項目にあります <strong>グループ メンバーシップとポリシー更新が有効になる時間</strong> もご参照ください。</p><p>なお、条件付きアクセスのサインインの頻度の設定は CAE よりも優先されます。仮に CAE が有効になってもサインインの頻度で設定したタイミングで再認証を求めるようにすることができますのでご安心ください。</p><h2 id="CAE-はどのリソースおよびクライアントでも実現できるの？"><a href="#CAE-はどのリソースおよびクライアントでも実現できるの？" class="headerlink" title="CAE はどのリソースおよびクライアントでも実現できるの？"></a>CAE はどのリソースおよびクライアントでも実現できるの？</h2><p>現時点では、リソースとしては Exchange Online と SharePoint Online、アクセス元のクライアントとしてはブラウザと Office アプリが対象になります。<br>なお、Exchange Onine や SharePoint Online が併用されている Teams も対象になります。</p><p>CAE に対応していないリソース、クライアント アプリの場合は、アクセス トークンの考え方はこれまで通りです。</p><h2 id="CAE-は無効にできるの？"><a href="#CAE-は無効にできるの？" class="headerlink" title="CAE は無効にできるの？"></a>CAE は無効にできるの？</h2><p>はい、CAE を無効にすることは、Azure ポータル上の操作にて可能です。<br>前述の技術情報 <a href="https://docs.microsoft.com/ja-jp/azure/active-directory/conditional-access/concept-continuous-access-evaluation">継続的アクセス評価</a> <a href="https://docs.microsoft.com/ja-jp/azure/active-directory/conditional-access/concept-continuous-access-evaluation#enable-or-disable-cae-preview">CAE を有効または無効にする (プレビュー)</a> をご覧ください。</p><p>既定では <code>一般提供の後に自動で有効にする</code> が選択されており、2021 年 9 月 30 日から 2021 年 11 月の終わりの間に CAE が有効化される予定になります。</p><p><img src="/blog/azure-active-directory/cae-overview/cae-gui.png"></p><p>もし CAE を自動で有効化させたくない場合には、2021 年 9 月 30 日までに <code>プレビューを無効にする</code> に変更ください。</p><p>上記内容が CAE の理解に向けて、皆様の参考となりますと幸いです。<br>どちら様も素敵な AAD ライフをお過ごしください！</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは。Azure Identity チームの金森です。&lt;/p&gt;
&lt;p&gt;みなさんは CAE (Continuous Access Evaluation: 継続的アクセス評価) という機能をご存知でしょうか。&lt;br&gt;2021 年 5 月現在、以下のようなお知らせがあり、目</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="Conditional Access" scheme="https://jpazureid.github.io/blog/tags/Conditional-Access/"/>
    
    <category term="Zero Trust" scheme="https://jpazureid.github.io/blog/tags/Zero-Trust/"/>
    
  </entry>
  
  <entry>
    <title>パスワード ライトバックのしくみと一般的なトラブルシューティング</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory-connect/password-writeback-overview/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory-connect/password-writeback-overview/</id>
    <published>2021-05-10T15:00:00.000Z</published>
    <updated>2021-09-16T18:49:48.286Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Azure &amp; Identity サポート チームの金子です。<br>今回はパスワード ライトバックのしくみと一般的なトラブルシューティングについてご紹介します。</p><h2 id="パスワード-ハッシュ同期とパスワード-ライトバックの違いとは"><a href="#パスワード-ハッシュ同期とパスワード-ライトバックの違いとは" class="headerlink" title="パスワード ハッシュ同期とパスワード ライトバックの違いとは"></a>パスワード ハッシュ同期とパスワード ライトバックの違いとは</h2><p>まず、ユーザーは Azure AD Connect により、オンプレミス AD から Azure AD に同期されていることを前提とします。<br>パスワード ハッシュ同期についてはご存じの方が多いと思いますが、パスワード ハッシュ同期はオンプレミスの認証パスワード (厳密にはパスワード ハッシュ) を Azure AD に同期する機能です。これによりユーザーは同じ ID/パスワードで Office 365 などのクラウド上のアプリにもサインインすることができるようになります。<br>オンプレミス側でパスワードを変更した場合も同様にクラウド側へ同期されますが、逆にクラウド側からはオンプレミス側のパスワードをリセットしたり変更することはできません。なぜなら、パスワード ハッシュ同期はオンプレミスの Active Directory Domain Services (AD DS) から Azure AD への一方向の同期しかおこなわないためです。</p><p><img src="/blog/azure-active-directory-connect/password-writeback-overview/1_phs.png"></p><p>そのため、社外で仕事をしておりオンプレミス AD に接続できないような状況で次のような要件が発生する場合はパスワード ライトバックを有効化する必要があります。</p><ul><li><p><strong>ユーザーが Microsoft 365 などのクラウド アプリにサインインする認証パスワードを忘れたため、ユーザー自身で同期ユーザーのパスワードをリセットしたい</strong></p></li><li><p><strong>何らかの要件があり Azure AD の管理者が、同期ユーザーのパスワードを強制的にリセットしたい</strong></p></li><li><p><strong>Azure AD Identity Protection によって同期ユーザーの資格情報の漏洩が疑われた (リスク検知した) 場合に、ユーザー自身でパスワードを変更 (または リセット) したい、Azure AD の管理者がユーザーに代わってパスワードをリセットしたい</strong></p></li></ul><p>上記のようなシナリオでは、パスワード ライトバックを有効にすることで要件を実現できます。<br>SSPR と連動させれば、ユーザーがパスワードを忘れてしまった場合でもユーザー自身がオンプレミス AD のパスワードをリセットできるため、IT 管理者の負荷を軽減することができます。<br>また、Identity Protection によって不正なアクセスなどを検知した場合、ユーザー自身が同期ユーザーのパスワードを変更 (リセット) できる他、管理者は Azure ポータルにサインインできる環境であれば、どこにいてもユーザーのパスワードを強制的にリセットすることができますので、セキュリティ リスクを軽減することにもつながります。</p><p><img src="/blog/azure-active-directory-connect/password-writeback-overview/2_password-writeback.png"></p><h2 id="前提条件"><a href="#前提条件" class="headerlink" title="前提条件"></a>前提条件</h2><p>同期ユーザーに対する社外ネットワークからのパスワード変更およびリセットを実現するためには、次の前提条件をすべて満たしている必要があります。</p><ol><li>Azure AD Connect でパスワード ライトバックを有効化していること</li><li>Azure ポータル上でセルフサービス パスワード リセット (SSPR) が有効になっていること（“オンプレミスとの統合”）</li><li>利用するユーザーごとに Azure AD Premium P1 または P2 ライセンス、もしくは Microsoft 365 Business Premium ライセンスを持っていること</li><li>AD DS コネクタ アカウントに下記のアクセス許可があること<ul><li>パスワードのリセット</li><li>lockoutTime に対する書き込みアクセス許可</li><li>pwdLastSet に対する書き込みアクセス許可</li><li>まだ設定していない場合は、そのフォレスト内の “各ドメイン” のルート オブジェクトに対する “期限切れではないパスワード” の拡張権利があること</li></ul></li><li>Azure AD Connect サーバーから下記の外部 URL へ HTTPS で接続できること<pre><code> *.passwordreset.microsoftonline.com *.servicebus.windows.net</code></pre></li></ol><h2 id="パスワード-ライトバックのしくみ"><a href="#パスワード-ライトバックのしくみ" class="headerlink" title="パスワード ライトバックのしくみ"></a>パスワード ライトバックのしくみ</h2><p>ではパスワード ライトバックが実際にどのようなしくみで動作しているかを説明します。</p><p><img src="/blog/azure-active-directory-connect/password-writeback-overview/3_password-writeback-detail.png"></p><p>まず、ユーザーが Azure AD のアカウントでパスワード変更 (SSPR)  要求をおこないますと、設定したパスワードが暗号化され、テナント固有の Service Bus へ送られます。<br>Service Bus に保留中のリセット要求が届くと、パスワード リセット エンドポイントがオープンし、Azure AD Connect サーバーの Password Reset Service が処理を開始 (PasswordResetRequestStart) し Azure AD 側から暗号化されたパスワードを取得します。<br>これはオンプレミス側からクラウド側への Outbound (HTTPS / 443) の通信でおこなわれますので、クラウド側からオンプレミス側への Inbound の通信（ポート）を開放する必要はありません。</p><p>Password Reset Service がパスワードを取得しますと、秘密鍵で複合化し、Azure AD Connect はリセット要求のあったユーザーをデータべ―ス内から探し出し、AD Sync サービスが適切な AD DS に対してパスワード リセットを要求します。この時、実際のパスワードリセットは Azure AD Connect で設定したオンプレミス AD 上の AD DS コネクタ アカウント (既定では MSOL_xxxxx) がおこないます。</p><p>そして、パスワード リセット (変更) が成功しますと、Password Reset Service は成功 (PasswordResetSuccess) を Azure AD 側に通知します。<br>この通知を受け取るとパスワード変更 (SSPR)  が完了します。</p><p>このパスワード ライトバックの一連の処理はログ上では次のように記録されます。</p><h3 id="●-Azure-AD-Connect-サーバーのアプリケーション-イベントログ"><a href="#●-Azure-AD-Connect-サーバーのアプリケーション-イベントログ" class="headerlink" title="● Azure AD Connect サーバーのアプリケーション イベントログ"></a>● Azure AD Connect サーバーのアプリケーション イベントログ</h3><p><strong>PasswordResetService</strong><br>Event ID: 31001<br>PasswordResetRequestStart, Details: <a href="mailto:&#x75;&#x73;&#101;&#x72;&#49;&#64;&#x63;&#x6f;&#x6e;&#116;&#111;&#x73;&#x6f;&#46;&#99;&#x6f;&#109;">&#x75;&#x73;&#101;&#x72;&#49;&#64;&#x63;&#x6f;&#x6e;&#116;&#111;&#x73;&#x6f;&#46;&#99;&#x6f;&#109;</a></p><p><strong>ADSync</strong><br>Event ID: 405<br>Call sync ldap_bind for DomainName=CONTOSO.COM, UserName=MSOL_xxxxxxxxx.</p><p><strong>ADSync</strong><br>Event ID: 403<br>ImpersonationHelper call LogonUser for DomainName=CONTOSO.COM, UserName=MSOL_xxxxxxxxx.</p><p><strong>ADSync</strong><br>Event ID: 405<br>Call sync ldap_bind for DomainName=CONTOSO.COM, UserName=MSOL_xxxxxxxxx.</p><p><strong>PasswordResetService</strong><br>Event ID: 31002<br>TrackingId: xxxxxxxxx-xxxx-xxxxxxxxx-xxxxxxxxx, PasswordResetSuccess, Details: Context: cloudAnchor: User_xxxxxxxxx-xxxxxxxxx, SourceAnchorValue: xxxxxxxxxxxxxxxxxx, UserPrincipalName: <a href="mailto:&#117;&#x73;&#101;&#114;&#x31;&#64;&#99;&#111;&#x6e;&#116;&#x6f;&#115;&#111;&#x2e;&#99;&#111;&#109;">&#117;&#x73;&#101;&#114;&#x31;&#64;&#99;&#111;&#x6e;&#116;&#x6f;&#115;&#111;&#x2e;&#99;&#111;&#109;</a>, unblockUser: True</p><h3 id="●-Azure-AD-の監査ログ"><a href="#●-Azure-AD-の監査ログ" class="headerlink" title="● Azure AD の監査ログ"></a>● Azure AD の監査ログ</h3><p><strong>Self-service password reset flow activity progress</strong><br>User submitted a new password</p><p><strong>Reset user password</strong></p><p><strong>Update StsRefreshTokenValidFrom Timestamp</strong></p><p><strong>Reset password (self-service)</strong><br>Successfully completed reset.</p><p><strong>Self-service password reset flow activity progress</strong><br>User successfully reset password</p><p>また、パスワード ハッシュ同期を有効化している場合は、パスワード ライトバック後に下記のログが記録されます。<br>これは Password Reset Service とは別のパスワード ハッシュ同期処理のプロセスが動作しているためで、オンプレミス AD 側で変更されたパスワードは通常のパスワード ハッシュ同期のタイミング ( 2 分に一度) で Azure AD 側へ同期されます。<br>これはパスワード ハッシュ同期の既定の動作とご理解ください。</p><h3 id="●-Azure-AD-Connect-サーバーのアプリケーション-イベントログ-1"><a href="#●-Azure-AD-Connect-サーバーのアプリケーション-イベントログ-1" class="headerlink" title="● Azure AD Connect サーバーのアプリケーション イベントログ"></a>● Azure AD Connect サーバーのアプリケーション イベントログ</h3><p><strong>Directory Synchronization</strong><br>Event ID: 657<br>Password Change Result</p><h3 id="●-Azure-AD-の監査ログ-1"><a href="#●-Azure-AD-の監査ログ-1" class="headerlink" title="● Azure AD の監査ログ"></a>● Azure AD の監査ログ</h3><p><strong>Change user password</strong></p><p>(補足）<br>パスワード ライトバックを利用する上で、パスワード ハッシュ同期の有効化は必須ではありません。<br>パスワード ライトバックはパスワード ハッシュ同期による認証だけではなく、パススルー認証や AD FS の環境でもサポートされています。よって、認証方法によらず、同期ユーザーは Azure AD 側からもパスワード変更 (SSPR) をおこなうことができます。</p><h2 id="トラブルシューティング"><a href="#トラブルシューティング" class="headerlink" title="トラブルシューティング"></a>トラブルシューティング</h2><p>パスワード ライトバックが失敗するシナリオはいくつか考えられます。<br>ここでは一般的なエラー要因とその対処方法についてご紹介します。</p><ol><li>変更したパスワードが オンプレミス AD のパスワード ポリシーを満たしていない (Event ID 33008)</li><li>“password” や “baseball” といった推測されやすい用語が含まれているため Azure AD 側で変更が拒否された</li><li>パスワード ライトバックに必要なアクセス許可が付与されていない (Event ID 33004)</li><li>ADSync サービスがダウンしていた (Event ID 31034)</li><li>オンプレミス AD 側でユーザーが見つからない (Event ID 33002)</li><li>オンプレミス AD の保護されたグループ内に存在する管理者アカウントのパスワードをリセットした (Event ID 33004)</li><li>Azure AD Connect 構成ウィザードでパスワード ライトバックを有効化できない</li></ol><h4 id="1-変更したパスワードが-オンプレミス-AD-のパスワード-ポリシーを満たしていない-Event-ID-33008"><a href="#1-変更したパスワードが-オンプレミス-AD-のパスワード-ポリシーを満たしていない-Event-ID-33008" class="headerlink" title="1. 変更したパスワードが オンプレミス AD のパスワード ポリシーを満たしていない (Event ID 33008)"></a>1. 変更したパスワードが オンプレミス AD のパスワード ポリシーを満たしていない (Event ID 33008)</h4><p>[エラー内容]<br>Azure AD Connect のイベントログには Event ID 33008 のエラーが記録されます。<br>エラー メッセージ：<strong>A restriction prevents the password from being changed to the current one specified.</strong></p><p>[原因と対処方法]<br>パスワードライトバックを利用して同期ユーザーのパスワードリセット (変更) を行った場合、オンプレミス AD のパスワードポリシーおよび Azure AD のパスワードポリシー双方が評価されます。<br>オンプレミス AD のパスワード ポリシー (文字数や変更禁止期間など) やアカウントのパスワード変更禁止設定など、パスワード ポリシーを満たしていない場合、パスワード変更は下記のエラーが返されます。</p><p><img src="/blog/azure-active-directory-connect/password-writeback-overview/4_error.png"></p><p>この場合はオンプレミス AD のパスワード ポリシーで決められた範囲でパスワードを変更する必要があります。<br>「グループ ポリシー管理エディター」にて「パスワード ポリシーの設定」をご確認ください。</p><p><img src="/blog/azure-active-directory-connect/password-writeback-overview/5_gpo.png"></p><h4 id="2-“password”-や-“baseball”-といった推測されやすい用語が含まれているため-Azure-AD-側で変更が拒否された"><a href="#2-“password”-や-“baseball”-といった推測されやすい用語が含まれているため-Azure-AD-側で変更が拒否された" class="headerlink" title="2. “password” や “baseball” といった推測されやすい用語が含まれているため Azure AD 側で変更が拒否された"></a>2. “password” や “baseball” といった推測されやすい用語が含まれているため Azure AD 側で変更が拒否された</h4><p>[エラー内容]<br>上述の通り、パスワードライトバックを利用して同期ユーザーのパスワード変更 (リセット) を実施した場合、オンプレミス AD のパスワードポリシーに加えて、Azure AD のパスワードポリシーも評価されます。<br>もし パスワード リセットで設定したパスワードが Azure AD 側の禁止文字に該当する場合は、変更が拒否されます。</p><p><img src="/blog/azure-active-directory-connect/password-writeback-overview/6_error2.png"></p><p>[原因と対処方法]<br>Azure AD 側ではパスワードの文字列に対して以下の両方のチェックがおこなわれます。このチェックはオンプレミス AD にパスワード リセットを要求する前に Azure AD によって内部的に実行されます。</p><ul><li>グローバル禁止パスワード</li><li>カスタム禁止パスワード</li></ul><p>グローバル禁止パスワードは、 Azure AD がグローバルで禁止しているパスワード リストです。<br>セキュリティ上このリストは公開されていませんが、 “password” や “baseball” といった推測されやすい用語が含まれている場合が該当します。</p><p>カスタム禁止パスワードは、管理者が設定できる禁止パスワードです。<br>これらの禁止パスワードを利用しないようにパスワード変更 (リセット) を行うことが対処策となります。</p><h4 id="3-パスワード-ライトバックに必要なアクセス許可が付与されていない-Event-ID-33004"><a href="#3-パスワード-ライトバックに必要なアクセス許可が付与されていない-Event-ID-33004" class="headerlink" title="3. パスワード ライトバックに必要なアクセス許可が付与されていない (Event ID 33004)"></a>3. パスワード ライトバックに必要なアクセス許可が付与されていない (Event ID 33004)</h4><p>[エラー内容]<br>前述の「前提条件 (4)」 に記載したパスワード ライトバックに必要なアクセス許可が対象のユーザーや OU に付与されていない場合はエラーが返されます。</p><p>Azure AD Connect のイベントログに Event ID 33004 のエラーが記録されます。<br>エラー メッセージ：<strong>Requesting user was denied access to perform the operation on a privileged account.</strong></p><p>[原因と対処方法]<br>パスワード変更をおこなう AD DS コネクタ アカウントには以下の 2 つがあり、ご自身の環境がどちらのアカウントを使用しているかを確認します。</p><p>a. Azure AD Connect のインストール時に新規で作成されたアカウント (既定では MSOL_xxxxx)<br>b. オンプレミス AD 上に作成した既存のアカウント</p><p>a のアカウントは自動でルート ディレクトリに対して必要なアクセス許可が付与されますので、配下の OU やユーザーにもアクセス許可が継承されます。そのため、通常はパスワード変更の権限も付与されています。</p><p>b のアカウントはアクセス許可を手動で割り当てる必要があります。もしアクセス許可を付与していない場合は、下記に記載された PowerShell コマンドレットで権限を付与してください。</p><p>パスワード ライトバックのアクセス許可<br><a href="https://docs.microsoft.com/ja-jp/azure/active-directory/hybrid/how-to-connect-configure-ad-ds-connector-account#permissions-for-password-writeback">https://docs.microsoft.com/ja-jp/azure/active-directory/hybrid/how-to-connect-configure-ad-ds-connector-account#permissions-for-password-writeback</a></p><h4 id="4-ADSync-サービスがダウンしていた-Event-ID-31034"><a href="#4-ADSync-サービスがダウンしていた-Event-ID-31034" class="headerlink" title="4. ADSync サービスがダウンしていた (Event ID 31034)"></a>4. ADSync サービスがダウンしていた (Event ID 31034)</h4><p>[エラー内容]<br>Azure AD Connect のイベントログには Event ID 31034 のエラーが記録されます。<br>エラー メッセージ：<strong>The connection to the connect service was lost.</strong></p><p>[原因と対処方法]<br>ADSync サービスがダウンしている場合はパスワード リセットが失敗します。<br>Azure AD Connect サーバーの ADSync サービスを再起動してください。</p><h4 id="5-オンプレミス-AD-側でユーザーが見つからない-Event-ID-33002"><a href="#5-オンプレミス-AD-側でユーザーが見つからない-Event-ID-33002" class="headerlink" title="5. オンプレミス AD 側でユーザーが見つからない (Event ID 33002)"></a>5. オンプレミス AD 側でユーザーが見つからない (Event ID 33002)</h4><p>[エラー内容]<br>Azure AD Connect のイベントログには Event ID 33002 のエラーが記録されます。<br>エラー メッセージ：<strong>The operation failed because the object could not be found.</strong></p><p>[原因と対処方法]<br>オンプレミス AD 側でユーザーが見つからない場合はパスワード リセットが失敗します。<br>オンプレミス AD にユーザーが存在することを確認してください。</p><h4 id="6-オンプレミス-AD-の保護されたグループ内に存在する管理者アカウントのパスワードをリセットした-Event-ID-33004"><a href="#6-オンプレミス-AD-の保護されたグループ内に存在する管理者アカウントのパスワードをリセットした-Event-ID-33004" class="headerlink" title="6. オンプレミス AD の保護されたグループ内に存在する管理者アカウントのパスワードをリセットした (Event ID 33004)"></a>6. オンプレミス AD の保護されたグループ内に存在する管理者アカウントのパスワードをリセットした (Event ID 33004)</h4><p>[エラー内容]<br>Azure AD Connect のイベントログには Event ID 33004 のエラーが記録されます。<br>エラー メッセージ：<strong>The password could not be updated because the management agent credentials were denied access.</strong></p><p>●エラーになる操作<br>サインイン時に「パスワードを忘れた場合」をクリックします。</p><p><img src="/blog/azure-active-directory-connect/password-writeback-overview/7_forget-password.png"></p><p>SSPR の画面に遷移します。</p><p><img src="/blog/azure-active-directory-connect/password-writeback-overview/8_sspr.png"></p><p>パスワード リセットはエラーになります。</p><p><img src="/blog/azure-active-directory-connect/password-writeback-overview/9_sspr-error.png"></p><p>[原因と対処方法]<br>対象のユーザー アカウントが Active Directory の保護されたグループ (例えば Enterprise Admins や Domain Admins ) に所属していることが考えられます。</p><p>オンプレミス AD の保護されたグループに所属しているメンバーは、パスワード リセット (パスワードを忘れた場合のリセット) はできません。<br>オンプレミス AD の保護されたグループに所属しているメンバーは、以下のいずれかの方法でパスワードの変更・リセットを行う必要があります。</p><ul><li>オンプレミス AD でパスワード変更をまたはパスワードリセットを行う</li><li>Azure にサインイン後自らパスワード “変更” を行う</li><li>Azure のセルフサービス パスワードリセット (SSPR) を利用し自らパスワード “リセット” を行う</li></ul><p>Active Directory の保護されたグループ (いわゆる管理者グループ) に所属すると、そのユーザー アカウントの adminCount 属性に “1” が自動で設定されます。<br>この属性が 1 に設定されたアカウントに対してはドメイン コントローラーにおける SDProp と呼ばれるプロセスにより 1 時間に 1 回、AdminSDHolder オブジェクトに設定されているアクセス許可で上書きされます。そのため、AD ユーザーに対してパスワード リセットを実行している “AD DS コネクタ アカウント” のリセット権限が失われ、結果として Azure AD Connect のパスワード リセットが失敗します。</p><p>本エラーの対処方法としては、そのようなアカウントについては Azure AD でのパスワード リセットの機能を利用しないようにする、または Active Directory の保護されたグループ メンバーから外す (対処策 1) か、 AdminSDHolder に対して Azure AD Connect を動作させているアカウントに権限を付与します (対処策 2)。</p><p><strong>対処策 1. Active Directory の保護されたグループ メンバーから外す場合</strong></p><p>パスワード ライドバックを実行したいユーザーを保護されたグループのメンバーから外します。そのうえで [Active Directoty ユーザーとコンピューター] の プロパティ内の [属性エディター] タブにて、adminCount の 1 の値を手動でクリアします。<br>保護されたグループのメンバーから外しても adminCount の値、ならびに権限の継承設定は自動で元に戻りません。そのため、過去に Domain Admins 等の保護されたグループに所属しており、現在は所属していないアカウントについても本事象が発生することがあります。<br>このようなケースでは対象アカウントに対して adminCount 値をクリアし、権限の継承を有効化することで対処可能です。</p><p>[属性エディター] にて adminCount 値をクリアします。</p><p><img src="/blog/azure-active-directory-connect/password-writeback-overview/10_property.png"></p><p>そして、[セキュリティ] タブの [詳細設定] にて、「継承の有効化」をおこなってください。</p><p><img src="/blog/azure-active-directory-connect/password-writeback-overview/11_inheritance.png"></p><p>継承が有効化されますと、ルート ディレクトリのアクセス許可が継承されますので、 “AD DS コネクタ アカウント” に対してパスワード リセットのアクセス許可が付与されます。</p><p><img src="/blog/azure-active-directory-connect/password-writeback-overview/12_check.png"></p><p><strong>対処策 2. 今後も Active Directory の保護されたグループ メンバーに所属させる場合</strong></p><p>Active Directory の保護されたグループ メンバーに所属させ続けなければならない場合は後述の手順を実施することで Azure AD からのパスワードの変更は可能です。<br>しかしながら、保護されたグループ メンバーに所属するユーザーを Azure 管理ポータル上などでユーザー以外の管理者がリセットさせることはできません。<br>保護されたグループ メンバーに所属するユーザーは adminCount の値が “1” となりますが、 Azure AD からオンプレミス Active Directory 上の保護されたグループ メンバーに所属するユーザーをリセットしようとした際に adminCount の値がチェックされ、 adminCount の値が 1 の場合にはユーザー以外のパスワード リセットを許容しません。ユーザー本人によるパスワード リセットについては adminCount が “1” であってもパスワード リセットは可能です。ユーザー本人によるパスワード リセットを行いたい場合には、後述のアクセス許可を付与ください。</p><ul><li><p>保護されたグループ メンバーに対して、パスワード変更を行う場合の設定手順</p><p> この場合は、AdminSDHolder にパスワード ライトバックに必要なアクセス許可を付与します。ドメインの構成を変更する作業となりますため、事前に検証環境などで動作をお試しいただいてから運用環境で設定されることをお勧めいたします。<br> なお、 MSOL からはじまるアカウント名の場合、 Azure AD Connect が自動で必要な権限は付与しているため通常であれば作業は不要です。権限が付与されていない場合に設定ください。</p></li></ul><p>手順 :</p><ol><li>Azure AD Connect サーバーにて Synchronization Service Manager を起動します。</li><li>画面上部の [Connectors] を選択し、表示された Connector 一覧より、オンプレミス AD フォレスト名のコネクタを選択して画面右の Actions メニューより [Properties] を選択します。</li><li>プロパティ画面が表示するので [Connect to Active Directory Forest] メニューを選択します。</li><li>画面右に表示されたアカウントが、AD フォレストに対して同期処理時にアクセスしているアカウントとなりますので、アカウント名を控えます。</li><li>任意の ドメイン コントローラー に、ドメイン管理者でサインインし、[ADSI エディタ] を開きます。</li><li>左ペイン上で [ADSI エディタ] を選択し、右クリック – [接続] と選択し、「既定の名前付けコンテキスト」が選択された状態で [OK] を選択します。</li><li>左ペインでドメイン名配下の [CN=System] - [CN=AdminSDHolder] と展開し、 AdminSDHolder を右クリックしてプロパティを表示します。</li><li>[セキュリティ] タブより [詳細設定] ボタンをクリックし、[アクセス許可] タブ内の [追加] ボタンをクリックします。</li><li>アクセス許可エントリ画面にて上部の [プリンシパルの選択] リンクをクリックし、前の手順で確認した「AD フォレストに対して同期処理時にアクセスしているアカウント」を追加します。</li><li>画面下部のアクセス許可の一覧最下部にある [すべてクリア] ボタンをクリックします。</li><li>適用先が「このオブジェクトのみ」となっていることを確認した上で [すべてのプロパティの読み取り] および [すべてのプロパティの書き込み] にチェックを入れて保存します。</li><li>[OK] ボタンを複数回クリックし、設定を終了します。</li><li>既定では 1 時間以内に、自動で adminCount 属性が 1 となっているユーザーのアクセス許可が上記で設定したアクセス許可と同じとなります。</li></ol><ul><li>保護されたグループ メンバーに対して、ユーザー自身がパスワード リセットを行う場合の設定手順<br>「保護されたグループ メンバーに対して、パスワード変更を行う場合の設定手順」を実施し、その後更に以下の手順でパスワード リセット権限を付与します。</li></ul><ol start="14"><li><p>ドメイン コントローラーにドメイン管理者権限を持つユーザーでサインインし、コマンド プロンプトを起動します。</p></li><li><p>以下のコマンドを実行します。<br>dsacls “cn=adminsdholder,cn=system,dc=&lt;ドメイン名&gt; “ /G “&lt;ドメイン名&gt;&lt;AD DS コネクタ アカウントの sAMAccountName&gt;:CA;Reset Password”</p></li><li><p>実行後、既定では 1 時間以内に、自動で adminCount 属性が 1 となっているユーザーのアクセス許可に手順 15. で付与した権限が追加されます。</p></li></ol><h4 id="7-Azure-AD-Connect-構成ウィザードでパスワード-ライトバックを有効化できない"><a href="#7-Azure-AD-Connect-構成ウィザードでパスワード-ライトバックを有効化できない" class="headerlink" title="7. Azure AD Connect 構成ウィザードでパスワード ライトバックを有効化できない"></a>7. Azure AD Connect 構成ウィザードでパスワード ライトバックを有効化できない</h4><p>[エラー内容]<br>構成ウィザードでパスワード ライトバックの構成中に下記のエラー メッセージが表示される場合があります。</p><p>エラーメッセージ：<br><strong>パスワードの書き戻しを構成できません。 必要なライセンスを持っていることを確認します。</strong><br>Unable to configure password writeback. Ensure you have the required license and consult the event log for addition information.</p><p>[原因と対処方法]<br>このエラーメッセージは「前提条件の (5) 」のエンドポイントに接続できない場合に発生します。<br>オンプレミスでプロキシ サーバーをご利用されている場合に、Azure AD Connect が machine.config のプロキシ設定を正しく読み込めていないため、外部エンドポイントへの通信がプロキシを経由できず、オンプレミスのファイアウォール等でブロックされている可能性があります。</p><p>外部エンドポイントへの接続がプロキシを経由できていない場合は、machine.config にプロキシの設定を追加した後、一度 Azure AD Connect サーバーを再起動してください。<br>その後、構成ウィザードでパスワード ライトバックを有効にしますと、オンプレミスのファイアウォール等でブロックされることなくエンドポイントへ接続できるようになりエラーが解消されます。</p><p>もし何かエラーが生じて原因がわからないなどお困り事がありましたら、お気軽にテクニカル サポートへお問い合わせください。<br>上記の情報が少しでも皆様のお役に立ちましたら幸いです。</p><h3 id="参考文献やリンクなど"><a href="#参考文献やリンクなど" class="headerlink" title="参考文献やリンクなど"></a>参考文献やリンクなど</h3><p>前提条件<br><a href="https://docs.microsoft.com/ja-jp/azure/active-directory/authentication/tutorial-enable-sspr-writeback#prerequisites">https://docs.microsoft.com/ja-jp/azure/active-directory/authentication/tutorial-enable-sspr-writeback#prerequisites</a></p><p>Azure AD Connect に使用されるアカウント<br><a href="https://docs.microsoft.com/ja-jp/azure/active-directory/hybrid/reference-connect-accounts-permissions#accounts-used-for-azure-ad-connect">https://docs.microsoft.com/ja-jp/azure/active-directory/hybrid/reference-connect-accounts-permissions#accounts-used-for-azure-ad-connect</a></p><p>Azure AD Connect に対するアカウントのアクセス許可を構成する<br><a href="https://docs.microsoft.com/ja-jp/azure/active-directory/authentication/tutorial-enable-sspr-writeback#configure-account-permissions-for-azure-ad-connect">https://docs.microsoft.com/ja-jp/azure/active-directory/authentication/tutorial-enable-sspr-writeback#configure-account-permissions-for-azure-ad-connect</a></p><p>Confirm network connectivity<br><a href="https://docs.microsoft.com/ja-jp/azure/active-directory/authentication/troubleshoot-sspr-writeback#confirm-network-connectivity">https://docs.microsoft.com/ja-jp/azure/active-directory/authentication/troubleshoot-sspr-writeback#confirm-network-connectivity</a></p><p>エディションと機能の比較<br><a href="https://docs.microsoft.com/ja-jp/azure/active-directory/authentication/concept-sspr-licensing#compare-editions-and-features">https://docs.microsoft.com/ja-jp/azure/active-directory/authentication/concept-sspr-licensing#compare-editions-and-features</a></p><p>パスワード ライトバックのしくみ<br><a href="https://docs.microsoft.com/ja-jp/azure/active-directory/authentication/concept-sspr-writeback#how-password-writeback-works">https://docs.microsoft.com/ja-jp/azure/active-directory/authentication/concept-sspr-writeback#how-password-writeback-works</a></p><p>Password writeback event log error codes<br><a href="https://docs.microsoft.com/ja-jp/azure/active-directory/authentication/troubleshoot-sspr-writeback#password-writeback-event-log-error-codes">https://docs.microsoft.com/ja-jp/azure/active-directory/authentication/troubleshoot-sspr-writeback#password-writeback-event-log-error-codes</a></p><p>カスタムの禁止パスワードを構成する<br><a href="https://docs.microsoft.com/ja-jp/azure/active-directory/authentication/tutorial-configure-custom-password-protection#configure-custom-banned-passwords">https://docs.microsoft.com/ja-jp/azure/active-directory/authentication/tutorial-configure-custom-password-protection#configure-custom-banned-passwords</a></p><p>パスワード ライトバックのアクセス許可<br><a href="https://docs.microsoft.com/ja-jp/azure/active-directory/hybrid/how-to-connect-configure-ad-ds-connector-account#permissions-for-password-writeback">https://docs.microsoft.com/ja-jp/azure/active-directory/hybrid/how-to-connect-configure-ad-ds-connector-account#permissions-for-password-writeback</a></p><p>付録 c: 保護されたアカウントと Active Directory のグループ<br><a href="https://docs.microsoft.com/ja-jp/windows-server/identity/ad-ds/plan/security-best-practices/appendix-c--protected-accounts-and-groups-in-active-directory">https://docs.microsoft.com/ja-jp/windows-server/identity/ad-ds/plan/security-best-practices/appendix-c--protected-accounts-and-groups-in-active-directory</a></p><p>Azure AD Connect ウィザードを実行すると、エラーが発生する: パスワードの書き戻しを構成できません<br><a href="https://docs.microsoft.com/ja-jp/troubleshoot/azure/active-directory/unable-configure-pwd-writeback-error">https://docs.microsoft.com/ja-jp/troubleshoot/azure/active-directory/unable-configure-pwd-writeback-error</a></p><p>パスワードの書き戻し (FAQ)<br><a href="https://docs.microsoft.com/ja-jp/azure/active-directory/authentication/active-directory-passwords-faq#password-writeback">https://docs.microsoft.com/ja-jp/azure/active-directory/authentication/active-directory-passwords-faq#password-writeback</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Azure &amp;amp; Identity サポート チームの金子です。&lt;br&gt;今回はパスワード ライトバックのしくみと一般的なトラブルシューティングについてご紹介します。&lt;/p&gt;
&lt;h2 id=&quot;パスワード-ハッシュ同期とパスワード-ライトバックの違いとは&quot;&gt;&lt;</summary>
      
    
    
    
    
    <category term="Azure AD Connect" scheme="https://jpazureid.github.io/blog/tags/Azure-AD-Connect/"/>
    
    <category term="Password Writeback" scheme="https://jpazureid.github.io/blog/tags/Password-Writeback/"/>
    
    <category term="Self Service Password Reset" scheme="https://jpazureid.github.io/blog/tags/Self-Service-Password-Reset/"/>
    
  </entry>
  
</feed>
